<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ES6ç‰¹æ€§</title>
      <link href="/2020/07/24/ES6%E7%89%B9%E6%80%A7/"/>
      <url>/2020/07/24/ES6%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<hr><p>title: ES6ç‰¹æ€§<br>date: 2020-07-24 17:39:49<br>tags:</p><ul><li>JavaScript<br>categories:</li><li>JavaScript<h2 id="ä¸€ã€letå’Œconst"><a href="#ä¸€ã€letå’Œconst" class="headerlink" title="ä¸€ã€letå’Œconst"></a>ä¸€ã€letå’Œconst</h2></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//varå£°æ˜çš„å˜é‡å¾€å¾€ä¼šè¶ŠåŸŸ</span></span><br><span class="line"><span class="comment">//letå£°æ˜çš„å˜é‡ä¸¥æ ¼å±€éƒ¨ä½œç”¨åŸŸ</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     var a = 1;</span></span><br><span class="line"><span class="comment">//     let b = 2;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// console.log(a);</span></span><br><span class="line"><span class="comment">// console.log(b); //1-let.html:17 Uncaught ReferenceError: b is not defined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//var å¯ä»¥å¤šæ¬¡å£°æ˜</span></span><br><span class="line"><span class="comment">//let åªèƒ½å£°æ˜ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">// var m = 3;</span></span><br><span class="line"><span class="comment">// var m = 4;</span></span><br><span class="line"><span class="comment">// let n = 5;</span></span><br><span class="line"><span class="comment">// let n = 6;</span></span><br><span class="line"><span class="comment">// console.log(m);</span></span><br><span class="line"><span class="comment">// console.log(n); //Uncaught SyntaxError: Identifier 'n' has already been declared</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//var ä¼šå˜é‡æå‡</span></span><br><span class="line"><span class="comment">//let ä¸ä¼šå˜é‡æå‡</span></span><br><span class="line"><span class="comment">// console.log(x); // undefined</span></span><br><span class="line"><span class="comment">// var x = 10;</span></span><br><span class="line"><span class="comment">// console.log(y); // Uncaught ReferenceError: Cannot access 'y' before initialization</span></span><br><span class="line"><span class="comment">// let y = 20;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€æ—¦å£°æ˜å¿…é¡»åˆå§‹åŒ–, åªè¯»å˜é‡</span></span><br><span class="line"><span class="keyword">const</span> c = <span class="number">4</span>;</span><br><span class="line">c = <span class="number">5</span>; <span class="comment">//Uncaught TypeError: Assignment to constant variable.</span></span><br><span class="line"><span class="built_in">console</span>.log(c);</span><br></pre></td></tr></table></figure><h2 id="äºŒã€è§£æ„è¡¨è¾¾å¼"><a href="#äºŒã€è§£æ„è¡¨è¾¾å¼" class="headerlink" title="äºŒã€è§£æ„è¡¨è¾¾å¼"></a>äºŒã€è§£æ„è¡¨è¾¾å¼</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">a = arr[<span class="number">0</span>];</span><br><span class="line">b = arr[<span class="number">1</span>];</span><br><span class="line">c = arr[<span class="number">2</span>];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a="</span>+a,<span class="string">"b="</span>+b,<span class="string">"c="</span>+c);</span><br><span class="line"><span class="comment">//è§£æ„è¡¨è¾¾å¼</span></span><br><span class="line"><span class="keyword">let</span>[x,y,z] = arr;</span><br><span class="line"><span class="built_in">console</span>.log(x,y,z);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  name: <span class="string">"jack1"</span>,</span><br><span class="line">  age: <span class="number">18</span>,</span><br><span class="line">  language: [<span class="string">'java'</span>,<span class="string">'css'</span>,<span class="string">'js'</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> name = person.name;</span><br><span class="line"><span class="keyword">const</span> age = person.age;</span><br><span class="line"><span class="keyword">const</span> language = person.language;</span><br><span class="line"><span class="built_in">console</span>.log(name,age,language);</span><br><span class="line"><span class="comment">//å¯¹è±¡è§£æ„</span></span><br><span class="line"><span class="keyword">const</span> &#123;<span class="attr">name</span>:abc,age,language&#125; = person;</span><br><span class="line"><span class="built_in">console</span>.log(abc,age,language); </span><br><span class="line"></span><br><span class="line"><span class="comment">//å­—ç¬¦ä¸²æ‰©å±•</span></span><br><span class="line"><span class="keyword">let</span> str = <span class="string">"hello str"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(str.startsWith(<span class="string">"hello"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(str.endsWith(<span class="string">"str"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(str.includes(<span class="string">"s"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(str.includes(<span class="string">"str"</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å­—ç¬¦ä¸²æ‰©å±•</span></span><br><span class="line"><span class="keyword">let</span> htm = <span class="string">`</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">&lt;span&gt;æˆ‘æ˜¯<span class="subst">$&#123;abc&#125;</span>ï¼Œå¹´é¾„<span class="subst">$&#123;age + <span class="number">10</span>&#125;</span>; I want say : <span class="subst">$&#123;fun()&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(htm);</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€å‡½æ•°ä¼˜åŒ–"><a href="#ä¸‰ã€å‡½æ•°ä¼˜åŒ–" class="headerlink" title="ä¸‰ã€å‡½æ•°ä¼˜åŒ–"></a>ä¸‰ã€å‡½æ•°ä¼˜åŒ–</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6ä»¥å‰ç»™æˆ‘ä»¬ç»™ä¸€ä¸ªå‡½æ•°çš„å‚æ•°è®¾ç½®é»˜è®¤å€¼,åªèƒ½é‡‡ç”¨å˜é€šçš„å†™æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// bå¦‚æœä¸ºç©ºè®¾ç½®ä¸º1</span></span><br><span class="line">  b = b || <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">10</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç°åœ¨å¯ä»¥ç›´æ¥å†™ä¸Šé»˜è®¤å€¼ï¼Œæ²¡æœ‰ä¼ å°±ç›´æ¥ä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add2</span>(<span class="params">a, b=<span class="number">1</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(add2(<span class="number">20</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸å®šå‚æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">...values</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(values);</span><br><span class="line">&#125;</span><br><span class="line">fun(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">fun(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®­å¤´å‡½æ•°</span></span><br><span class="line"><span class="comment">//ä»¥å‰å£°æ˜ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// var print = obj =&gt; console.log(obj);</span></span><br><span class="line"><span class="comment">// print("hello");</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var sum2 = (a,b) =&gt; a + b;</span></span><br><span class="line"><span class="comment">// console.log(sum2(1,2));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var sum3 = (a,b) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     c = a+b;</span></span><br><span class="line"><span class="comment">//     console.log(a+c);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// console.log(sum3(1,2));</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person=&#123;</span><br><span class="line">  name: <span class="string">"jack"</span>,</span><br><span class="line">  age: <span class="number">13</span>,</span><br><span class="line">  language: [<span class="string">'java'</span>,<span class="string">'css'</span>,<span class="string">'js'</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">param</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"hello "</span> + param.name);</span><br><span class="line">&#125;</span><br><span class="line">hello(person);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  è§£æ„å‡½æ•°</span></span><br><span class="line"><span class="keyword">var</span> hello2 = <span class="function">(<span class="params">&#123;name&#125;</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"hello "</span> + name);</span><br><span class="line">hello2(person);</span><br></pre></td></tr></table></figure><h2 id="å››ã€å¯¹è±¡ä¼˜åŒ–"><a href="#å››ã€å¯¹è±¡ä¼˜åŒ–" class="headerlink" title="å››ã€å¯¹è±¡ä¼˜åŒ–"></a>å››ã€å¯¹è±¡ä¼˜åŒ–</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">     name: <span class="string">"lucy"</span>,</span><br><span class="line">     age: <span class="number">99</span>,</span><br><span class="line">     language:[<span class="string">'java'</span>,<span class="string">'css'</span>,<span class="string">'js'</span>]</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(person)); <span class="comment">// ["name", "age", "language"]</span></span><br><span class="line"> <span class="built_in">console</span>.log(<span class="built_in">Object</span>.values(person)); <span class="comment">// ["lucy", 99, Array(3)]</span></span><br><span class="line"> <span class="built_in">console</span>.log(<span class="built_in">Object</span>.entries(person)); <span class="comment">// [Array(2), Array(2), Array(2)]</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">// å¯¹è±¡åˆå¹¶</span></span><br><span class="line"> <span class="keyword">const</span> target = &#123;<span class="attr">a</span>: <span class="number">1</span>&#125;;</span><br><span class="line"> <span class="keyword">const</span> source1 = &#123;<span class="attr">b</span>: <span class="number">2</span>&#125;;</span><br><span class="line"> <span class="keyword">const</span> source2 = &#123;<span class="attr">c</span>: <span class="number">3</span>&#125;;</span><br><span class="line"> <span class="built_in">Object</span>.assign(target,source1,source2); <span class="comment">//source1å’Œsource2åˆå¹¶åˆ° target</span></span><br><span class="line"> <span class="built_in">console</span>.log(target); <span class="comment">// &#123;a: 1, b: 2, c: 3&#125;  </span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//å£°æ˜å¯¹è±¡ç®€å†™</span></span><br><span class="line"> <span class="keyword">const</span> age = <span class="number">12</span>;</span><br><span class="line"> <span class="keyword">const</span> name = <span class="string">"zhangsan"</span>;</span><br><span class="line"> <span class="keyword">const</span> person1 = &#123;<span class="attr">age</span>: age, <span class="attr">name</span>: name&#125;; <span class="comment">//ä¼ ç»Ÿå†™æ³•</span></span><br><span class="line"> <span class="built_in">console</span>.log(person1);</span><br><span class="line"> <span class="keyword">const</span> person2 = &#123;age,name&#125;; <span class="comment">// å±æ€§åå’Œå±æ€§å€¼çš„å˜é‡åéƒ½ä¸€æ ·æ—¶ï¼Œå¯ä»¥ç¼©å†™</span></span><br><span class="line"> <span class="built_in">console</span>.log(person2);</span><br><span class="line"></span><br><span class="line"> <span class="comment">//å¯¹è±¡çš„å‡½æ•°å±æ€§ç®€å†™</span></span><br><span class="line"> <span class="keyword">let</span> person3 = &#123;</span><br><span class="line">     name: <span class="string">"jack"</span>,</span><br><span class="line">     <span class="comment">//ä»¥å‰</span></span><br><span class="line">     eat: <span class="function"><span class="keyword">function</span> (<span class="params">food</span>) </span>&#123;</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">"åœ¨åƒ"</span> + food);</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="comment">//ç®­å¤´å‡½æ•°ï¼Œthisä¸èƒ½ä½¿ç”¨ï¼Œå¿…é¡»ä½¿ç”¨å¯¹è±¡å±æ€§</span></span><br><span class="line">     eat2: <span class="function"><span class="params">food</span> =&gt;</span> <span class="built_in">console</span>.log(person3.name + <span class="string">"åœ¨åƒ"</span> + food),</span><br><span class="line">     eat3(food)&#123;</span><br><span class="line">         <span class="built_in">console</span>.log(person3.name + <span class="string">"åœ¨åƒ"</span> + food);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> person3.eat(<span class="string">"ğŸ"</span>);</span><br><span class="line"> person3.eat2(<span class="string">"ğŸŒ"</span>);</span><br><span class="line"> person3.eat3(<span class="string">"ğŸŠ"</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// å¯¹è±¡æ‰©å±•è¿ç®—ç¬¦</span></span><br><span class="line"> <span class="comment">//1 æ‹·è´ï¼ˆæ·±æ‹·è´ï¼‰</span></span><br><span class="line"> <span class="keyword">let</span> p1 = &#123;<span class="attr">name</span>: <span class="string">"lucy"</span>, <span class="attr">age</span>: <span class="number">8</span>&#125;;</span><br><span class="line"> <span class="keyword">let</span> someone = &#123;...p1&#125;;</span><br><span class="line"> <span class="built_in">console</span>.log(someone);</span><br><span class="line"></span><br><span class="line"> <span class="comment">//2 å’Œå¹¶å¯¹è±¡</span></span><br><span class="line"> <span class="keyword">let</span> age1 = &#123;<span class="attr">age</span>: <span class="number">9</span>&#125;;</span><br><span class="line"> <span class="keyword">let</span> name1 = &#123;<span class="attr">name</span>: <span class="string">"xiaoming"</span>&#125;;</span><br><span class="line"> <span class="keyword">let</span> p2 = &#123;...age1,...name1&#125;;</span><br><span class="line"> <span class="built_in">console</span>.log(p2);</span><br></pre></td></tr></table></figure><h2 id="äº”ã€mapå’Œreduceæ–¹æ³•"><a href="#äº”ã€mapå’Œreduceæ–¹æ³•" class="headerlink" title="äº”ã€mapå’Œreduceæ–¹æ³•"></a>äº”ã€mapå’Œreduceæ–¹æ³•</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ•°ç»„ä¸­æ–°å¢äº†mapå’Œreduceæ–¹æ³•</span></span><br><span class="line"><span class="comment">//map(): æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œå°†åŸæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ç”¨è¿™ä¸ªå‡½æ•°å¤„ç†åæ”¾å…¥æ–°æ•°ç»„è¿”å›ã€‚</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="string">'1'</span>,<span class="string">'20'</span>,<span class="string">'40'</span>,<span class="string">'-5'</span>];</span><br><span class="line">arr = arr.map(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> item*<span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line">arr = arr.map(<span class="function"><span class="params">item</span>=&gt;</span>item*<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br><span class="line"><span class="comment">//reduce() ä¸ºæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä¾æ¬¡æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œä¸åŒ…å«æ•°ç»„ä¸­è¢«åˆ é™¤æˆ–ä»æœªè¢«èµ‹å€¼çš„å…ƒç´ ï¼Œ</span></span><br><span class="line"><span class="comment">//arr.reduce(callback,[initalValue])</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">1, previousValue (ä¸Šä¸€æ¬¡è°ƒç”¨å›è°ƒè¿”å›çš„å€¼ï¼Œæˆ–è€…æ˜¯æä¾›çš„åˆå§‹å€¼ï¼ˆinitialValueï¼‰)</span></span><br><span class="line"><span class="comment">2, currentValue (æ•°ç»„ä¸­å½“å‰è¢«å¤„ç†çš„å…ƒç´ )</span></span><br><span class="line"><span class="comment">3ï¼Œindex ï¼ˆå½“å‰å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ï¼‰</span></span><br><span class="line"><span class="comment">4ï¼Œarray (è°ƒç”¨reduceçš„æ•°ç»„)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">let</span> result = arr.reduce(<span class="function">(<span class="params">a,b</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"ä¸Šä¸€æ¬¡å¤„ç†åï¼š"</span> + a);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"å½“å‰æ­£åœ¨å¤„ç†ï¼š"</span> + b);</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;,<span class="number">100</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure><h2 id="å…­ã€Promise-å¯¹è±¡"><a href="#å…­ã€Promise-å¯¹è±¡" class="headerlink" title="å…­ã€Promise å¯¹è±¡"></a>å…­ã€Promise å¯¹è±¡</h2><p>Promise åœ¨JavasCriptçš„ä¸–ç•Œä¸­ï¼Œæ‰€æœ‰ä»£ç éƒ½æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ã€‚ç”±äºè¿™ä¸ªâ€œç¼ºé™·â€ï¼Œå¯¼è‡´JavasCriptçš„æ‰€æœ‰ç½‘ç»œæ“ä½œï¼Œæµè§ˆå™¨äº‹ä»¶ï¼Œéƒ½å¿…é¡»æ˜¯å¼‚æ­¥æ‰§è¡Œã€‚å¼‚æ­¥æ‰§è¡Œå¯ä»¥ç”¨å›è°ƒå‡½æ•°å®ç°ã€‚ä¸€æ—¦æœ‰ä¸€è¿ä¸²çš„ajaxè¯·æ±‚å•Ša, b , c , d â€¦ åé¢çš„è¯·æ±‚ä¾èµ–å‰é¢çš„è¯·æ±‚ç»“æœï¼Œå°±éœ€è¦å±‚å±‚åµŒå¥—ã€‚è¿™ç§ç¼©è¿›å’Œå±‚å±‚åµŒå¥—çš„æ–¹å¼ï¼Œéå¸¸å®¹æ˜“é€ æˆä¸Šä¸‹æ–‡ä»£ç æ··ä¹±ï¼Œæˆ‘ä»¬ä¸å¾—ä¸éå¸¸å°å¿ƒç¿¼ç¿¼å¤„ç†å†…å±‚å‡½æ•°ä¸å¤–å±‚å‡½æ•°çš„æ•°æ®ï¼Œä¸€æ—¦å†…å±‚å‡½æ•°ä½¿ç”¨äº†ä¸Šå±‚å‡½æ•°çš„å˜é‡ï¼Œè¿™ç§æ··ä¹±ç¨‹åº¦å°±ä¼šåŠ å‰§â€¦â€¦æ€»ä¹‹ï¼Œè¿™ç§â€™å±‚å ä¸Šä¸‹æ–‡â€™çš„å±‚å±‚åµŒå¥—æ–¹å¼ï¼Œç€å®å¢åŠ äº†ç¥ç»çš„ç´§å¼ ç¨‹åº¦ã€‚ </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">æ¡ˆä¾‹ï¼šç”¨æˆ·ç™»å½•ï¼Œå¹¶å±•ç¤ºè¯¥ç”¨æˆ·çš„å„ç§‘æˆç»©ã€‚åœ¨é¡µé¢å‘é€ä¸¤æ¬¡è¯·æ±‚ï¼š </span><br><span class="line">1 ï¼æŸ¥è¯¢ç”¨æˆ·ï¼ŒæŸ¥è¯¢æˆåŠŸè¯´æ˜å¯ä»¥ç™»å½• </span><br><span class="line">2 ï¼æŸ¥è¯¢ç”¨æˆ·æˆåŠŸï¼ŒæŸ¥è¯¢ç§‘ç›® </span><br><span class="line">3 ï¼æ ¹æ®ç§‘ç›®çš„æŸ¥è¯¢ç»“æœï¼Œè·å–å»æˆç»©</span><br><span class="line">åˆ†æï¼šæ­¤æ—¶åå°åº”è¯¥æä¾›ä¸‰ä¸ªæ¥å£ï¼Œä¸€ä¸ªæä¾›ç”¨æˆ·æŸ¥è¯¢æ¥å£ï¼Œä¸€ä¸ªæä¾›ç§‘ç›®çš„æ¥å£ï¼Œä¸€ä¸ªæä¾›å„ç§‘æˆç»©çš„æ¥å£ï¼Œä¸ºäº†æ¸²æŸ“æ–¹ä¾¿ï¼Œæœ€å¥½å“åº”è·³ç°æ•°æ®ã€‚åœ¨è¿™é‡Œå°±ä¸ç¼–å†™åå°æ¥å£äº†ï¼Œè€Œæ˜¯æä¾›ä¸‰ä¸ªjsonæ–‡ä»¶ï¼Œç›´æ¥æä¾›jsonæ•°æ®ï¼Œæ¨¡æ‹Ÿåå°æ¥å£ï¼š</span><br><span class="line"></span><br><span class="line">user.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"jack"</span>,</span><br><span class="line">    <span class="attr">"password"</span>:<span class="string">"123123"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user_corse_1.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"English"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">corse_score_10.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="attr">"score"</span>: <span class="number">99</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 ajaxåµŒå¥—æŸ¥è¯¢</span></span><br><span class="line">        <span class="comment">//æŸ¥è¯¢å½“å‰ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        <span class="comment">//æ ¹æ®å½“å‰ç”¨æˆ·idæŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</span></span><br><span class="line">        <span class="comment">//æ ¹æ®è¯¾ç¨‹ä¿¡æ¯idæŸ¥è¯¢åˆ†æ•°</span></span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url: <span class="string">"./mock/user.json"</span>,</span><br><span class="line">            success(data)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"æŸ¥è¯¢çš„ç”¨æˆ·ï¼š"</span> ,  data);</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    url: <span class="string">`./mock/user_corse_<span class="subst">$&#123;data.id&#125;</span>.json`</span>,</span><br><span class="line">                    success(data)&#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">"æŸ¥è¯¢çš„è¯¾ç¨‹ï¼š"</span> ,  data);</span><br><span class="line">                        $.ajax(&#123;</span><br><span class="line">                            url: <span class="string">`./mock/corse_score_<span class="subst">$&#123;data.id&#125;</span>.json`</span>,</span><br><span class="line">                            success(data)&#123;</span><br><span class="line">                                <span class="built_in">console</span>.log(<span class="string">"æŸ¥è¯¢çš„åˆ†æ•°ï¼š"</span> ,  data.score);</span><br><span class="line">                            &#125;,</span><br><span class="line">                            error(err)&#123;</span><br><span class="line">                                <span class="built_in">console</span>.log(<span class="string">"æŸ¥è¯¢å¼‚å¸¸ï¼š"</span>,err);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            error(err)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"æŸ¥è¯¢å¼‚å¸¸ï¼š"</span>,err);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2 promise å°è£…å¼‚æ­¥æ“ä½œ</span></span><br><span class="line">        <span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                url: <span class="string">"./mock/user.json"</span>,</span><br><span class="line">                success(data)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼š"</span>, data);</span><br><span class="line">                    resolve(data);</span><br><span class="line">                &#125;,</span><br><span class="line">                error(err)&#123;</span><br><span class="line">                    reject(err);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">        p.then(<span class="function">(<span class="params">obj</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    url: <span class="string">`./mock/user_corse_<span class="subst">$&#123;obj.id&#125;</span>.json`</span>,</span><br><span class="line">                    success(data)&#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">"æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯ï¼š"</span>, data);</span><br><span class="line">                        resolve(data);</span><br><span class="line">                    &#125;,</span><br><span class="line">                    error(err)&#123;</span><br><span class="line">                        reject(err);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);  </span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;).then(<span class="function">(<span class="params">obj</span>)=&gt;</span>&#123;</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                url: <span class="string">`./mock/corse_score_<span class="subst">$&#123;obj.id&#125;</span>.json`</span>,</span><br><span class="line">                success(data)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"æŸ¥è¯¢åˆ†æ•°ï¼š"</span>, data);</span><br><span class="line">                &#125;,</span><br><span class="line">                error(err)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"æŸ¥è¯¢å¼‚å¸¸ï¼š"</span>,err);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);  </span><br><span class="line">        &#125;).catch(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"æŸ¥è¯¢å¼‚å¸¸ï¼š"</span>,err);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3 å°è£…å…¬å…±æ–¹æ³•</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">url,data</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    url: url,</span><br><span class="line">                    data: data,</span><br><span class="line">                    success(data)&#123;</span><br><span class="line">                        resolve(data);</span><br><span class="line">                    &#125;,</span><br><span class="line">                    error(err)&#123;</span><br><span class="line">                        reject(err);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">get</span>("./mock/user.json")</span><br><span class="line">            .then((data)=&gt;&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æˆåŠŸï¼š"</span>,data);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">get</span>(`./mock/user_corse_$&#123;data.id&#125;.json<span class="string">`);</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">            .then((data)=&gt;&#123;</span></span><br><span class="line"><span class="string">                console.log("æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯æˆåŠŸï¼š", data);</span></span><br><span class="line"><span class="string">                return get(`</span>./mock/corse_score_$&#123;data.id&#125;.json<span class="string">`);</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">            .then((data)=&gt;&#123;</span></span><br><span class="line"><span class="string">                console.log("æŸ¥è¯¢åˆ†æ•°ä¸ºï¼š", data); </span></span><br><span class="line"><span class="string">            &#125;).catch(err=&gt;&#123;</span></span><br><span class="line"><span class="string">                console.log("æŸ¥è¯¢å¼‚å¸¸ï¼š",err);</span></span><br><span class="line"><span class="string">            &#125;);</span></span><br></pre></td></tr></table></figure><h2 id="ä¸ƒã€æ¨¡å—åŒ–"><a href="#ä¸ƒã€æ¨¡å—åŒ–" class="headerlink" title="ä¸ƒã€æ¨¡å—åŒ–"></a>ä¸ƒã€æ¨¡å—åŒ–</h2><p>æ¨¡å—åŒ–å°±æ˜¯æŠŠä»£ç è¿›è¡Œæ‹†åˆ†ï¼Œæ–¹ä¾¿é‡å¤åˆ©ç”¨ã€‚ç±»ä¼¼javaä¸­çš„å¯¼åŒ…ï¼Œè¦ä½¿ç”¨ä¸€ä¸ªåŒ…ï¼Œå¿…é¡»å…ˆå¯¼åŒ…ã€‚è€ŒJSä¸­æ²¡æœ‰åŒ…çš„æ¦‚å¿µï¼Œæ¢æ¥çš„æ˜¯æ¨¡å—</p><p>æ¨¡å—åŠŸèƒ½ä¸»è¦ç”±ä¸¤ä¸ªå‘½ä»¤æ„æˆï¼šexport å’Œ import</p><ul><li>export å‘½ä»¤ç”¨äºè§„å®šæ¨¡å—çš„å¯¹å¤–æ¥å£ã€‚</li><li>importå‘½ä»¤ç”¨äºå¯¼å…¥å…¶å®ƒæ¨¡å—æä¾›çš„åŠŸèƒ½ã€‚</li></ul><p>user.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">"jack"</span>;</span><br><span class="line"><span class="keyword">const</span> age = <span class="number">40</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¼å‡ºdefault ï¼Œimportæ—¶å¯ä»¥è‡ªå®šä¹‰å˜é‡åxxx: import xxx from "user.js"</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    mul(a,b)&#123;</span><br><span class="line">        <span class="keyword">return</span> a*b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;name,age,add&#125;;</span><br></pre></td></tr></table></figure><p>utils.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> util =&#123;</span><br><span class="line">     sum(a,b)&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;util&#125;;</span><br></pre></td></tr></table></figure><p>main.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> util <span class="keyword">from</span> <span class="string">"./utils.js"</span></span><br><span class="line"><span class="keyword">import</span> &#123;name,age,add&#125; <span class="keyword">from</span> <span class="string">"./user.js"</span> </span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(util.sum(<span class="number">3</span>,<span class="number">4</span>),name,age);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaç¼–ç å®ç°ActiveMQé€šè®¯</title>
      <link href="/2020/05/18/Java%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0ActiveMQ%E9%80%9A%E8%AE%AF/"/>
      <url>/2020/05/18/Java%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0ActiveMQ%E9%80%9A%E8%AE%AF/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¸€ã€IDEAåˆ›å»ºMavenå·¥ç¨‹"><a href="#ä¸€ã€IDEAåˆ›å»ºMavenå·¥ç¨‹" class="headerlink" title="ä¸€ã€IDEAåˆ›å»ºMavenå·¥ç¨‹"></a>ä¸€ã€IDEAåˆ›å»ºMavenå·¥ç¨‹</h3><h4 id="1ã€pom-xmlä¸­ï¼š"><a href="#1ã€pom-xmlä¸­ï¼š" class="headerlink" title="1ã€pom.xmlä¸­ï¼š"></a>1ã€pom.xmlä¸­ï¼š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">org.apache.activemq</span><br><span class="line">activemq-all</span><br><span class="line">5.15.11</span><br><span class="line"></span><br><span class="line">org.apache.xbean</span><br><span class="line">xbean-spring</span><br><span class="line">4.15</span><br></pre></td></tr></table></figure><h4 id="2ã€JMSç¼–ç æ€»ä½“æ¶æ„"><a href="#2ã€JMSç¼–ç æ€»ä½“æ¶æ„" class="headerlink" title="2ã€JMSç¼–ç æ€»ä½“æ¶æ„"></a>2ã€JMSç¼–ç æ€»ä½“æ¶æ„</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gewg51ige9j314m0u07wh.jpg" alt="img"> </p><p>å›å¿†ä¸€ä¸‹ä»¥å‰çš„JDBCç¼–ç å¥—è·¯ï¼š</p><ul><li><p>ç¬¬ä¸€æ­¥:æ³¨å†Œé©±åŠ¨(ä»…ä»…åªåšä¸€æ¬¡)</p><p>Class.forName(â€œcom.mysql.jdbc.comâ€);</p></li><li><p>ç¬¬äºŒæ­¥:å»ºç«‹è¿æ¥(Connection)</p><p>DriverManager.getConnection(url,user,password);</p></li><li><p>ç¬¬ä¸‰æ­¥:åˆ›å»ºè¿è¡ŒSQLè¯­å¥(Statement)</p><p>connection.createStatement();</p></li><li><p>ç¬¬å››æ­¥:è¿è¡Œè¯­å¥</p><p>rs.executeQuery(sql);</p></li><li><p>ç¬¬äº”æ­¥:å¤„ç†ç»“æœé›†(ResultSet)</p></li><li><p>ç¬¬å…­æ­¥:é‡Šæ”¾èµ„æº</p></li></ul><h4 id="3ã€ç®€ä»‹ç›®çš„åœ°Destinationï¼šé˜Ÿåˆ—-Queue-å’Œä¸»é¢˜-Topic"><a href="#3ã€ç®€ä»‹ç›®çš„åœ°Destinationï¼šé˜Ÿåˆ—-Queue-å’Œä¸»é¢˜-Topic" class="headerlink" title="3ã€ç®€ä»‹ç›®çš„åœ°Destinationï¼šé˜Ÿåˆ—(Queue)å’Œä¸»é¢˜(Topic)"></a>3ã€ç®€ä»‹ç›®çš„åœ°Destinationï¼šé˜Ÿåˆ—(Queue)å’Œä¸»é¢˜(Topic)</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gewg6gcz07j31m20u0art.jpg" alt="img"> </p><h4 id="4ã€åœ¨ç‚¹å¯¹ç‚¹çš„æ¶ˆæ¯ä¼ é€’åŸŸä¸­-ç›®çš„åœ°è¢«ç§°ä¸ºé˜Ÿåˆ—-queue"><a href="#4ã€åœ¨ç‚¹å¯¹ç‚¹çš„æ¶ˆæ¯ä¼ é€’åŸŸä¸­-ç›®çš„åœ°è¢«ç§°ä¸ºé˜Ÿåˆ—-queue" class="headerlink" title="4ã€åœ¨ç‚¹å¯¹ç‚¹çš„æ¶ˆæ¯ä¼ é€’åŸŸä¸­,ç›®çš„åœ°è¢«ç§°ä¸ºé˜Ÿåˆ—(queue)"></a>4ã€åœ¨ç‚¹å¯¹ç‚¹çš„æ¶ˆæ¯ä¼ é€’åŸŸä¸­,ç›®çš„åœ°è¢«ç§°ä¸ºé˜Ÿåˆ—(queue)</h4><p>æ¡ˆä¾‹ï¼š</p><h5 id="4-1ã€æ¶ˆæ¯ç”Ÿäº§è€…ï¼š"><a href="#4-1ã€æ¶ˆæ¯ç”Ÿäº§è€…ï¼š" class="headerlink" title="4-1ã€æ¶ˆæ¯ç”Ÿäº§è€…ï¼š"></a>4-1ã€æ¶ˆæ¯ç”Ÿäº§è€…ï¼š</h5><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.activemq.queue;</span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> javax.jms.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JmsProduce</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTIVEMQ_URL = <span class="string">"tcp://192.168.10.130:61616"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">"queue01"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        <span class="comment">//1.åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‰ç…§ç»™å®šçš„URLï¼Œé‡‡ç”¨é»˜è®¤çš„ç”¨æˆ·åå¯†ç </span></span><br><span class="line">        ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);</span><br><span class="line">        <span class="comment">//2.é€šè¿‡è¿æ¥å·¥å‚,è·å¾—connectionå¹¶å¯åŠ¨è®¿é—®</span></span><br><span class="line">        Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line">        connection.start();</span><br><span class="line">        <span class="comment">//3.åˆ›å»ºä¼šè¯session</span></span><br><span class="line">        <span class="comment">//ä¸¤ä¸ªå‚æ•°transacted=äº‹åŠ¡,acknowledgeMode=ç¡®è®¤æ¨¡å¼(ç­¾æ”¶)</span></span><br><span class="line">        Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">        <span class="comment">//4.åˆ›å»ºç›®çš„åœ°(å…·ä½“æ˜¯é˜Ÿåˆ—queueè¿˜æ˜¯ä¸»é¢˜topic)</span></span><br><span class="line">        Queue queue = session.createQueue(QUEUE_NAME);</span><br><span class="line">        <span class="comment">//5.åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€…</span></span><br><span class="line">        MessageProducer messageProducer = session.createProducer(queue);</span><br><span class="line">        <span class="comment">//6.é€šè¿‡ä½¿ç”¨æ¶ˆæ¯ç”Ÿäº§è€…,ç”Ÿäº§ä¸‰æ¡æ¶ˆæ¯,å‘é€åˆ°MQçš„é˜Ÿåˆ—é‡Œé¢</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i </span><br><span class="line">            <span class="comment">//7.åˆ›å»ºæ¶ˆæ¯</span></span><br><span class="line">            TextMessage textMessage = session.createTextMessage(<span class="string">"msg---hello"</span> + i);<span class="comment">//ç†è§£ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">            <span class="comment">//8.é€šè¿‡messageProducerå‘é€ç»™MQé˜Ÿåˆ—</span></span><br><span class="line">            messageProducer.send(textMessage);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//9.å…³é—­èµ„æº</span></span><br><span class="line">        messageProducer.close();</span><br><span class="line">        session.close();</span><br><span class="line">        System.out.println(<span class="string">"****æ¶ˆæ¯å‘å¸ƒåˆ°MQé˜Ÿåˆ—å®Œæˆ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4-2ã€æ§åˆ¶å°è¯´æ˜ï¼š"><a href="#4-2ã€æ§åˆ¶å°è¯´æ˜ï¼š" class="headerlink" title="4-2ã€æ§åˆ¶å°è¯´æ˜ï¼š"></a>4-2ã€æ§åˆ¶å°è¯´æ˜ï¼š</h5><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gewg7obmraj31ii079q3g.jpg" alt="img"> </p><p>Number Of Pending Messages=ç­‰å¾…æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œè¿™ä¸ªæ˜¯æœªå‡ºé˜Ÿåˆ—çš„æ•°é‡ï¼Œå…¬å¼=æ€»æ¥æ”¶æ•°-æ€»å‡ºé˜Ÿåˆ—æ•°ã€‚</p><p>Number Of Consumers=æ¶ˆè´¹è€…æ•°é‡ï¼Œæ¶ˆè´¹è€…ç«¯çš„æ¶ˆè´¹è€…æ•°é‡ã€‚</p><p>Messages Enqueued=è¿›é˜Ÿæ¶ˆæ¯æ•°ï¼Œè¿›é˜Ÿåˆ—çš„æ€»æ¶ˆæ¯é‡ï¼ŒåŒ…æ‹¬å‡ºé˜Ÿåˆ—çš„ã€‚è¿™ä¸ªæ•°åªå¢ä¸å‡ã€‚</p><p>Messages Dequeued=å‡ºé˜Ÿæ¶ˆæ¯æ•°ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯æ¶ˆè´¹è€…æ¶ˆè´¹æ‰çš„æ•°é‡ã€‚</p><p>æ€»ç»“ï¼š</p><ul><li>å½“æœ‰ä¸€ä¸ªæ¶ˆæ¯è¿›å…¥è¿™ä¸ªé˜Ÿåˆ—æ—¶ï¼Œç­‰å¾…æ¶ˆè´¹çš„æ¶ˆæ¯æ˜¯1ï¼Œè¿›å…¥é˜Ÿåˆ—çš„æ¶ˆæ¯æ˜¯1ã€‚</li><li>å½“æ¶ˆæ¯æ¶ˆè´¹åï¼Œç­‰å¾…æ¶ˆè´¹çš„æ¶ˆæ¯æ˜¯0ï¼Œè¿›å…¥é˜Ÿåˆ—çš„æ¶ˆæ¯æ˜¯1ï¼Œå‡ºé˜Ÿåˆ—çš„æ¶ˆæ¯æ˜¯1ã€‚</li><li>å½“å†æ¥ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œç­‰å¾…æ¶ˆè´¹çš„æ¶ˆæ¯æ˜¯1ï¼Œè¿›å…¥é˜Ÿåˆ—çš„æ¶ˆæ¯å°±æ˜¯2ã€‚</li></ul><h5 id="4-3ã€æ¶ˆæ¯æ¶ˆè´¹è€…"><a href="#4-3ã€æ¶ˆæ¯æ¶ˆè´¹è€…" class="headerlink" title="4-3ã€æ¶ˆæ¯æ¶ˆè´¹è€…"></a>4-3ã€æ¶ˆæ¯æ¶ˆè´¹è€…</h5><p>ä»£ç 1-é˜»å¡å¼æ¶ˆè´¹è€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.activemq.queue;</span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> javax.jms.*;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç®€å•æ¶ˆæ¯æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JmsConsumer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTIVEMQ_URL = <span class="string">"tcp://192.168.10.130:61616"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">"queue01"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        <span class="comment">//1.åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‰ç…§ç»™å®šçš„URLï¼Œé‡‡ç”¨é»˜è®¤çš„ç”¨æˆ·åå¯†ç </span></span><br><span class="line">        ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);</span><br><span class="line">        <span class="comment">//2.é€šè¿‡è¿æ¥å·¥å‚,è·å¾—connectionå¹¶å¯åŠ¨è®¿é—®</span></span><br><span class="line">        Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line">        connection.start();</span><br><span class="line">        <span class="comment">//3.åˆ›å»ºä¼šè¯session</span></span><br><span class="line">        <span class="comment">//ä¸¤ä¸ªå‚æ•°transacted=äº‹åŠ¡,acknowledgeMode=ç¡®è®¤æ¨¡å¼(ç­¾æ”¶)</span></span><br><span class="line">        Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">        <span class="comment">//4.åˆ›å»ºç›®çš„åœ°(å…·ä½“æ˜¯é˜Ÿåˆ—queueè¿˜æ˜¯ä¸»é¢˜topic)</span></span><br><span class="line">        Queue queue = session.createQueue(QUEUE_NAME);</span><br><span class="line">        <span class="comment">//5.åˆ›å»ºæ¶ˆæ¯çš„æ¶ˆè´¹è€…,æŒ‡å®šæ¶ˆè´¹å“ªä¸€ä¸ªé˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯</span></span><br><span class="line">        MessageConsumer messageConsumer = session.createConsumer(queue);</span><br><span class="line">        <span class="comment">//å¾ªç¯è·å–</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">//6.é€šè¿‡æ¶ˆè´¹è€…è°ƒç”¨æ–¹æ³•è·å–é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯(å‘é€çš„æ¶ˆæ¯æ˜¯ä»€ä¹ˆç±»å‹,æ¥æ”¶çš„æ—¶å€™å°±å¼ºè½¬æˆä»€ä¹ˆç±»å‹)</span></span><br><span class="line">            TextMessage textMessage = (TextMessage) messageConsumer.receive();</span><br><span class="line">            <span class="keyword">if</span> (textMessage != <span class="keyword">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"****æ¶ˆè´¹è€…æ¥æ”¶åˆ°çš„æ¶ˆæ¯:  "</span> + textMessage.getText());</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//7.å…³é—­èµ„æº</span></span><br><span class="line">        messageConsumer.close();</span><br><span class="line">        session.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç 2-å¼‚æ­¥ç›‘å¬å¼æ¶ˆè´¹è€…:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.activemq.queue;</span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> javax.jms.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç›‘å¬æ¨¡å¼ä¸‹çš„æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JmsConsumer2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTIVEMQ_URL = <span class="string">"tcp://192.168.10.130:61616"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">"queue01"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JMSException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1.åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‰ç…§ç»™å®šçš„URLï¼Œé‡‡ç”¨é»˜è®¤çš„ç”¨æˆ·åå¯†ç </span></span><br><span class="line">        ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);</span><br><span class="line">        <span class="comment">//2.é€šè¿‡è¿æ¥å·¥å‚,è·å¾—connectionå¹¶å¯åŠ¨è®¿é—®</span></span><br><span class="line">        Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line">        connection.start();</span><br><span class="line">        <span class="comment">//3.åˆ›å»ºä¼šè¯session</span></span><br><span class="line">        <span class="comment">//ä¸¤ä¸ªå‚æ•°transacted=äº‹åŠ¡,acknowledgeMode=ç¡®è®¤æ¨¡å¼(ç­¾æ”¶)</span></span><br><span class="line">        Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">        <span class="comment">//4.åˆ›å»ºç›®çš„åœ°(å…·ä½“æ˜¯é˜Ÿåˆ—queueè¿˜æ˜¯ä¸»é¢˜topic)</span></span><br><span class="line">        Queue queue = session.createQueue(QUEUE_NAME);</span><br><span class="line">        <span class="comment">//5.åˆ›å»ºæ¶ˆæ¯çš„æ¶ˆè´¹è€…,æŒ‡å®šæ¶ˆè´¹å“ªä¸€ä¸ªé˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯</span></span><br><span class="line">        MessageConsumer messageConsumer = session.createConsumer(queue);</span><br><span class="line">        <span class="comment">//6.é€šè¿‡ç›‘å¬çš„æ–¹å¼æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        å¼‚æ­¥éé˜»å¡å¼æ–¹å¼ç›‘å¬å™¨(onMessage)</span></span><br><span class="line"><span class="comment">        è®¢é˜…è€…æˆ–æ¶ˆè´¹è€…é€šè¿‡åˆ›å»ºçš„æ¶ˆè´¹è€…å¯¹è±¡,ç»™æ¶ˆè´¹è€…æ³¨å†Œæ¶ˆæ¯ç›‘å¬å™¨setMessageListener,</span></span><br><span class="line"><span class="comment">        å½“æ¶ˆæ¯æœ‰æ¶ˆæ¯çš„æ—¶å€™,ç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨MessageListenerç±»çš„onMessageæ–¹æ³•</span></span><br><span class="line"><span class="comment">        æˆ‘ä»¬åªéœ€è¦åœ¨onMessageæ–¹æ³•å†…åˆ¤æ–­æ¶ˆæ¯ç±»å‹å³å¯è·å–æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        messageConsumer.setMessageListener(<span class="keyword">new</span> MessageListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (message != <span class="keyword">null</span> &amp;&amp; message <span class="keyword">instanceof</span> TextMessage) &#123;</span><br><span class="line">                    <span class="comment">//7.æŠŠmessageè½¬æ¢æˆæ¶ˆæ¯å‘é€å‰çš„ç±»å‹å¹¶è·å–æ¶ˆæ¯å†…å®¹</span></span><br><span class="line">                    TextMessage textMessage = (TextMessage) message;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        System.out.println(<span class="string">"****æ¶ˆè´¹è€…æ¥æ”¶åˆ°çš„æ¶ˆæ¯:  "</span> + textMessage.getText());</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">"æ‰§è¡Œäº†39è¡Œ"</span>);</span><br><span class="line">        <span class="comment">//ä¿è¯æ§åˆ¶å°ä¸å…³é—­,é˜»æ­¢ç¨‹åºå…³é—­</span></span><br><span class="line">        System.in.read();</span><br><span class="line">        <span class="comment">//å…³é—­èµ„æº</span></span><br><span class="line">        messageConsumer.close();</span><br><span class="line">        session.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ§åˆ¶å°:</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gewg8c63ftj31iz07lt98.jpg" alt="img"> </p><h4 id="5ã€åœ¨å‘å¸ƒè®¢é˜…æ¶ˆæ¯ä¼ é€’åŸŸä¸­-ç›®çš„åœ°è¢«ç§°ä¸ºä¸»é¢˜-topic"><a href="#5ã€åœ¨å‘å¸ƒè®¢é˜…æ¶ˆæ¯ä¼ é€’åŸŸä¸­-ç›®çš„åœ°è¢«ç§°ä¸ºä¸»é¢˜-topic" class="headerlink" title="5ã€åœ¨å‘å¸ƒè®¢é˜…æ¶ˆæ¯ä¼ é€’åŸŸä¸­,ç›®çš„åœ°è¢«ç§°ä¸ºä¸»é¢˜(topic)"></a>5ã€åœ¨å‘å¸ƒè®¢é˜…æ¶ˆæ¯ä¼ é€’åŸŸä¸­,ç›®çš„åœ°è¢«ç§°ä¸ºä¸»é¢˜(topic)</h4><p>å‘å¸ƒä¸»é¢˜ç”Ÿäº§è€…:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.activemq.topic;</span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> javax.jms.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JmsProducer_Topic</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTIVEMQ_URL = <span class="string">"tcp://192.168.10.130:61616"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC_NAME = <span class="string">"topic01"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        <span class="comment">//1.åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‰ç…§ç»™å®šçš„URLï¼Œé‡‡ç”¨é»˜è®¤çš„ç”¨æˆ·åå¯†ç </span></span><br><span class="line">        ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);</span><br><span class="line">        <span class="comment">//2.é€šè¿‡è¿æ¥å·¥å‚,è·å¾—connectionå¹¶å¯åŠ¨è®¿é—®</span></span><br><span class="line">        Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line">        connection.start();</span><br><span class="line">        <span class="comment">//3.åˆ›å»ºä¼šè¯session</span></span><br><span class="line">        <span class="comment">//ä¸¤ä¸ªå‚æ•°transacted=äº‹åŠ¡,acknowledgeMode=ç¡®è®¤æ¨¡å¼(ç­¾æ”¶)</span></span><br><span class="line">        Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">        <span class="comment">//4.åˆ›å»ºç›®çš„åœ°(å…·ä½“æ˜¯é˜Ÿåˆ—queueè¿˜æ˜¯ä¸»é¢˜topic)</span></span><br><span class="line">        Topic topic = session.createTopic(TOPIC_NAME);</span><br><span class="line">        <span class="comment">//5.åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€…</span></span><br><span class="line">        MessageProducer messageProducer = session.createProducer(topic);</span><br><span class="line">        <span class="comment">//6.é€šè¿‡ä½¿ç”¨æ¶ˆæ¯ç”Ÿäº§è€…,ç”Ÿäº§ä¸‰æ¡æ¶ˆæ¯,å‘é€åˆ°MQçš„é˜Ÿåˆ—é‡Œé¢</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ )</span><br><span class="line">            <span class="comment">//7.é€šè¿‡sessionåˆ›å»ºæ¶ˆæ¯</span></span><br><span class="line">            TextMessage textMessage = session.createTextMessage(<span class="string">"TOPIC_NAME---"</span> + i);</span><br><span class="line">            <span class="comment">//8.ä½¿ç”¨æŒ‡å®šå¥½ç›®çš„åœ°çš„æ¶ˆæ¯ç”Ÿäº§è€…å‘é€æ¶ˆæ¯</span></span><br><span class="line">            messageProducer.send(textMessage);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//9.å…³é—­èµ„æº</span></span><br><span class="line">        messageProducer.close();</span><br><span class="line">        session.close();</span><br><span class="line">        connection.close();</span><br><span class="line">        System.out.println(<span class="string">"****TOPIC_NAMEæ¶ˆæ¯å‘å¸ƒåˆ°MQå®Œæˆ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¢é˜…ä¸»é¢˜æ¶ˆè´¹è€…:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.activemq.topic;</span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> javax.jms.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JmsConsumer_Topic</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTIVEMQ_URL = <span class="string">"tcp://192.168.10.130:61616"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC_NAME = <span class="string">"topic01"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JMSException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æˆ‘æ˜¯1å·æ¶ˆè´¹è€…"</span>);</span><br><span class="line">        <span class="comment">//1.åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‰ç…§ç»™å®šçš„URLï¼Œé‡‡ç”¨é»˜è®¤çš„ç”¨æˆ·åå¯†ç </span></span><br><span class="line">        ActiveMQConnectionFactory activeMQConnectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);</span><br><span class="line">        <span class="comment">//2.é€šè¿‡è¿æ¥å·¥å‚,è·å¾—connectionå¹¶å¯åŠ¨è®¿é—®</span></span><br><span class="line">        Connection connection = activeMQConnectionFactory.createConnection();</span><br><span class="line">        connection.start();</span><br><span class="line">        <span class="comment">//3.åˆ›å»ºä¼šè¯session</span></span><br><span class="line">        <span class="comment">//ä¸¤ä¸ªå‚æ•°transacted=äº‹åŠ¡,acknowledgeMode=ç¡®è®¤æ¨¡å¼(ç­¾æ”¶)</span></span><br><span class="line">        Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">        <span class="comment">//4.åˆ›å»ºç›®çš„åœ°(å…·ä½“æ˜¯é˜Ÿåˆ—queueè¿˜æ˜¯ä¸»é¢˜topic)</span></span><br><span class="line">        Topic topic = session.createTopic(TOPIC_NAME);</span><br><span class="line">        <span class="comment">//5.åˆ›å»ºæ¶ˆæ¯çš„æ¶ˆè´¹è€…</span></span><br><span class="line">        MessageConsumer messageConsumer = session.createConsumer(topic);</span><br><span class="line">        <span class="comment">//5.åˆ›å»ºæ¶ˆæ¯çš„æ¶ˆè´¹è€…,æŒ‡å®šæ¶ˆè´¹å“ªä¸€ä¸ªé˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯</span></span><br><span class="line">        messageConsumer.setMessageListener(message -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (message <span class="keyword">instanceof</span> TextMessage)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    String text = ((TextMessage) message).getText();</span><br><span class="line">                    System.out.println(text);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gewg9prkc1j321o0rdjvi.jpg" alt="img"> </p><p>å…ˆå¯åŠ¨è®¢é˜…è€…å†å¯åŠ¨ç”Ÿäº§è€…,ä¸ç„¶å‘é€çš„æ¶ˆæ¯æ˜¯åºŸæ¶ˆæ¯</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gewgaafnx6j31bk0g8dh8.jpg" alt="img">  </p><p>å°æ€»ç»“:</p><p>ä¸¤å¤§æ¨¡å¼ç‰¹æ•ˆ</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gewgb3zicvj31kr0u0ng0.jpg" alt="img"> </p><div class="table-container"><table><thead><tr><th>æ¯”è¾ƒé¡¹ç›®</th><th>Topicé˜Ÿåˆ—æ¨¡å¼</th><th>Queueé˜Ÿåˆ—æ¨¡å¼</th></tr></thead><tbody><tr><td>å·¥ä½œæ¨¡å¼</td><td>â€œè®¢é˜…-å‘å¸ƒâ€æ¨¡å¼ï¼Œå¦‚æœå½“å‰æ²¡æœ‰è®¢é˜…è€…ï¼Œæ¶ˆæ¯å°†ä¼šè¢«ä¸¢å¼ƒï¼Œå¦‚æœæœ‰å¤šä¸ªè®¢é˜…è€…ï¼Œé‚£ä¹ˆè¿™äº›è®¢é˜…è€…éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯</td><td>â€œè´Ÿè½½å‡è¡¡â€æ¨¡å¼ï¼Œå¦‚æœå½“å‰æ²¡æœ‰æ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¼ƒï¼›å¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆä¸€æ¡æ¶ˆæ¯ä¹Ÿåªä¼šå‘é€ç»™å…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶ä¸”è¦æ±‚æ¶ˆè´¹è€…ackä¿¡æ¯</td></tr><tr><td>æœ‰æ— çŠ¶æ€</td><td>æ— çŠ¶æ€</td><td>Queueæ•°æ®é»˜è®¤ä¼šåœ¨mqæœåŠ¡å™¨ä¸Šå·²æ–‡ä»¶å½¢å¼ä¿å­˜ï¼Œæ¯”å¦‚Active MQä¸€èˆ¬ä¿å­˜åœ¨$AMQ_HOME\data\kr-store\dataä¸‹é¢ï¼Œä¹Ÿå¯ä»¥é…ç½®æˆDBå­˜å‚¨</td></tr><tr><td>ä¼ é€’å®Œæ•´æ€§</td><td>å¦‚æœæ²¡æœ‰è®¢é˜…è€…ï¼Œæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒ</td><td>æ¶ˆæ¯ä¸ä¼šè¢«ä¸¢å¼ƒ</td></tr><tr><td>å¤„ç†æ•ˆç‡</td><td>ç”±äºæ¶ˆæ¯è¦æŒ‰ç…§è®¢é˜…è€…çš„æ•°é‡è¿›è¡Œå¤åˆ¶ï¼Œæ‰€ä»¥å¤„ç†æ€§èƒ½ä¼šéšç€è®¢é˜…è€…çš„å¢åŠ è€Œæ˜æ˜¾é™ä½ï¼Œå¹¶ä¸”è¿˜è¦ç»“åˆä¸åŒæ¶ˆæ¯åè®®è‡ªèº«çš„æ€§èƒ½å·®å¼‚</td><td>ç”±äºä¸€æ¡æ¶ˆæ¯åªå‘é€ç»™ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ‰€ä»¥å°±ç®—æ¶ˆè´¹è€…å†å¤šï¼Œæ€§èƒ½ä¹Ÿä¸ä¼šæœ‰æ˜æ˜¾é™ä½ã€‚å½“ç„¶ä¸åŒæ¶ˆæ¯åè®®çš„å…·ä½“æ€§èƒ½ä¹Ÿæ˜¯æœ‰å·®å¼‚çš„</td></tr></tbody></table></div>]]></content>
      
      
      <categories>
          
          <category> MQ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ActiveMQå…¥é—¨</title>
      <link href="/2020/05/15/ActiveMQ%E5%85%A5%E9%97%A8/"/>
      <url>/2020/05/15/ActiveMQ%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¸€ã€åœ¨ä½•ç§åœºæ™¯ä¸‹éœ€è¦ä½¿ç”¨æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿä¸ºä»€ä¹ˆè¦åœ¨ç³»ç»Ÿé‡Œå¼•å…¥æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿ"><a href="#ä¸€ã€åœ¨ä½•ç§åœºæ™¯ä¸‹éœ€è¦ä½¿ç”¨æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿä¸ºä»€ä¹ˆè¦åœ¨ç³»ç»Ÿé‡Œå¼•å…¥æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿ" class="headerlink" title="ä¸€ã€åœ¨ä½•ç§åœºæ™¯ä¸‹éœ€è¦ä½¿ç”¨æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿä¸ºä»€ä¹ˆè¦åœ¨ç³»ç»Ÿé‡Œå¼•å…¥æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿ"></a>ä¸€ã€åœ¨ä½•ç§åœºæ™¯ä¸‹éœ€è¦ä½¿ç”¨æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿä¸ºä»€ä¹ˆè¦åœ¨ç³»ç»Ÿé‡Œå¼•å…¥æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿ</h3><p>mqä½œç”¨ï¼šè§£è€¦ã€æ¶ˆå³°ã€å¼‚æ­¥</p><h4 id="1ã€ç³»ç»Ÿä¹‹é—´æ¥å£è€¦åˆæ¯”è¾ƒä¸¥é‡"><a href="#1ã€ç³»ç»Ÿä¹‹é—´æ¥å£è€¦åˆæ¯”è¾ƒä¸¥é‡" class="headerlink" title="1ã€ç³»ç»Ÿä¹‹é—´æ¥å£è€¦åˆæ¯”è¾ƒä¸¥é‡"></a>1ã€ç³»ç»Ÿä¹‹é—´æ¥å£è€¦åˆæ¯”è¾ƒä¸¥é‡</h4><p>æ¯æ–°å¢ä¸€ä¸ªä¸‹æ¸¸åŠŸèƒ½ï¼Œéƒ½è¦å¯¹ä¸Šæ¸¸çš„ç›¸å…³æ¥å£è¿›è¡Œæ”¹é€ ï¼›</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœç³»ç»ŸAè¦å‘é€æ•°æ®ç»™ç³»ç»ŸBå’Œç³»ç»ŸCï¼Œå‘é€ç»™æ¯ä¸ªç³»ç»Ÿçš„æ•°æ®å¯èƒ½æœ‰å·®å¼‚ï¼Œå› æ­¤ç³»ç»ŸAå¯¹è¦å‘é€ç»™æ¯ä¸ªç³»ç»Ÿçš„æ•°æ®è¿›è¡Œäº†ç»„è£…ï¼Œç„¶åé€ä¸€å‘é€ï¼›</p><p>å½“ä»£ç ä¸Šçº¿ååˆæ–°å¢äº†ä¸€ä¸ªéœ€æ±‚ï¼š</p><p>æŠŠæ•°æ®ä¹Ÿå‘é€ç»™Dï¼Œæ–°ä¸Šäº†ä¸€ä¸ªDç³»ç»Ÿä¹Ÿè¦æ¥å—Aç³»ç»Ÿçš„æ•°æ®ï¼Œæ­¤æ—¶å°±éœ€è¦ä¿®æ”¹Aç³»ç»Ÿï¼Œè®©ä»–æ„ŸçŸ¥åˆ°Dç³»ç»Ÿçš„å­˜åœ¨ï¼ŒåŒæ—¶æŠŠæ•°æ®å¤„ç†å¥½å†ç»™Dã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä½ ä¼šçœ‹åˆ°ï¼Œæ¯æ¥å…¥ä¸€ä¸ªä¸‹æ¸¸ç³»ç»Ÿï¼Œéƒ½è¦å¯¹ç³»ç»ŸAè¿›è¡Œä»£ç æ”¹é€ ï¼Œå¼€å‘è”è°ƒçš„æ•ˆç‡å¾ˆä½ã€‚å…¶æ•´ä½“æ¶æ„å¦‚ä¸‹å›¾</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gesyzz96uwj317x0ietcf.jpg" alt="img">  </p><h4 id="2ã€é¢å¯¹å¤§æµé‡å¹¶å‘æ—¶ï¼Œå®¹æ˜“è¢«å†²å®"><a href="#2ã€é¢å¯¹å¤§æµé‡å¹¶å‘æ—¶ï¼Œå®¹æ˜“è¢«å†²å®" class="headerlink" title="2ã€é¢å¯¹å¤§æµé‡å¹¶å‘æ—¶ï¼Œå®¹æ˜“è¢«å†²å®"></a>2ã€é¢å¯¹å¤§æµé‡å¹¶å‘æ—¶ï¼Œå®¹æ˜“è¢«å†²å®</h4><p>æ¯ä¸ªæ¥å£æ¨¡å—çš„ååèƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œè¿™ä¸ªä¸Šé™èƒ½åŠ›å¦‚æœæ˜¯å ¤åï¼Œå½“å¤§æµé‡ï¼ˆæ´ªæ°´ï¼‰æ¥ä¸´æ—¶ï¼Œå®¹æ˜“è¢«å†²å®ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ç§’æ€ä¸šåŠ¡ï¼šä¸Šæ¸¸ç³»ç»Ÿå‘èµ·ä¸‹å•è´­ä¹°æ“ä½œï¼Œæˆ‘å°±æ˜¯ä¸‹å•ä¸€ä¸ªæ“ä½œ</p><p>ä¸‹æ¸¸ç³»ç»Ÿå®Œæˆç§’æ€ä¸šåŠ¡é€»è¾‘ï¼šï¼ˆè¯»å–è®¢å•ï¼Œåº“å­˜æ£€æŸ¥ï¼Œåº“å­˜å†»ç»“ï¼Œä½™é¢æ£€æŸ¥ï¼Œä½™é¢å†»ç»“ï¼Œè®¢å•ç”Ÿäº§ï¼Œä½™é¢æ‰£å‡ï¼Œåº“å­˜å‡å°‘ï¼Œç”Ÿæˆæµæ°´ï¼Œä½™é¢è§£å†»ï¼Œåº“å­˜è§£å†»ï¼‰</p><h4 id="3ã€ç­‰å¾…åŒæ­¥å­˜åœ¨æ€§èƒ½é—®é¢˜"><a href="#3ã€ç­‰å¾…åŒæ­¥å­˜åœ¨æ€§èƒ½é—®é¢˜" class="headerlink" title="3ã€ç­‰å¾…åŒæ­¥å­˜åœ¨æ€§èƒ½é—®é¢˜"></a>3ã€ç­‰å¾…åŒæ­¥å­˜åœ¨æ€§èƒ½é—®é¢˜</h4><p>RPCæ¥å£ä¸ŠåŸºæœ¬éƒ½æ˜¯åŒæ­¥è°ƒç”¨ï¼Œæ•´ä½“çš„æœåŠ¡æ€§èƒ½éµå¾ªâ€œæœ¨æ¡¶ç†è®ºâ€ï¼Œå³æ•´ä½“ç³»ç»Ÿçš„è€—æ—¶å–å†³äºé“¾è·¯ä¸­æœ€æ…¢çš„é‚£ä¸ªæ¥å£ã€‚</p><p>æ¯”å¦‚Aè°ƒç”¨B/C/Déƒ½æ˜¯50msï¼Œä½†æ­¤æ—¶Båˆè°ƒç”¨äº†B1ï¼ŒèŠ±è´¹2000msï¼Œé‚£ä¹ˆç›´æ¥å°±æ‹–ç´¯äº†æ•´ä¸ªæœåŠ¡æ€§èƒ½ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gesz0kti4hj31bd0qfahm.jpg" alt="img"> </p><h4 id="4ã€éœ€è¦æœ‰ä¸€ç§ä¸œä¸œèƒ½æ‘†å¹³ä¸Šè¿°æƒ…å†µ"><a href="#4ã€éœ€è¦æœ‰ä¸€ç§ä¸œä¸œèƒ½æ‘†å¹³ä¸Šè¿°æƒ…å†µ" class="headerlink" title="4ã€éœ€è¦æœ‰ä¸€ç§ä¸œä¸œèƒ½æ‘†å¹³ä¸Šè¿°æƒ…å†µ"></a>4ã€éœ€è¦æœ‰ä¸€ç§ä¸œä¸œèƒ½æ‘†å¹³ä¸Šè¿°æƒ…å†µ</h4><p>æ ¹æ®ä¸Šè¿°çš„å‡ ä¸ªé—®é¢˜ï¼Œåœ¨è®¾è®¡ç³»ç»Ÿæ—¶å¯ä»¥æ˜ç¡®è¦è¾¾åˆ°çš„ç›®æ ‡ï¼š</p><ol><li>è¦åšåˆ°ç³»ç»Ÿè§£è€¦ï¼Œå½“æ–°çš„æ¨¡å—æ¥è¿›æ¥æ—¶ï¼Œå¯ä»¥åšåˆ°ä»£ç æ”¹åŠ¨æœ€å°ï¼›èƒ½å¤Ÿè§£è€¦</li><li>è®¾ç½®æµé‡ç¼“å†²æ± ï¼Œå¯ä»¥è®©åç«¯ç³»ç»ŸæŒ‰ç…§è‡ªèº«ååèƒ½åŠ›è¿›è¡Œæ¶ˆè´¹ï¼Œä¸è¢«å†²å®ï¼›èƒ½å‰Šå³°</li><li>å¼ºå¼±ä¾èµ–æ¢³ç†èƒ½å°†éå…³é”®è°ƒç”¨é“¾è·¯çš„æ“ä½œå¼‚æ­¥åŒ–å¹¶æå‡æ•´ä½“ç³»ç»Ÿçš„ååèƒ½åŠ›ï¼›èƒ½å¤Ÿå¼‚æ­¥</li></ol><h3 id="äºŒã€MQçš„å®šä¹‰"><a href="#äºŒã€MQçš„å®šä¹‰" class="headerlink" title="äºŒã€MQçš„å®šä¹‰"></a>äºŒã€MQçš„å®šä¹‰</h3><p>é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ï¼ˆmessage-oriented middlewareï¼‰MOMèƒ½å¤Ÿå¾ˆå¥½çš„è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œæ˜¯æŒ‡<strong>åˆ©ç”¨é«˜æ•ˆå¯é çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ä¸å¹³å°æ— å…³çš„æ•°æ®äº¤æµ</strong>ï¼Œå¹¶åŸºäºæ•°æ®é€šä¿¡æ¥è¿›è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„é›†æˆã€‚</p><p>é€šè¿‡æä¾›æ¶ˆæ¯ä¼ é€’å’Œæ¶ˆæ¯æ’é˜Ÿæ¨¡å‹åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹æä¾›åº”ç”¨è§£è€¦ï¼Œå¼¹æ€§ä¼¸ç¼©ï¼Œå†—ä½™å­˜å‚¨ã€æµé‡å‰Šå³°ï¼Œå¼‚æ­¥é€šä¿¡ï¼Œæ•°æ®åŒæ­¥ç­‰åŠŸèƒ½ã€‚</p><p>å¤§è‡´çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p>å‘é€è€…æŠŠæ¶ˆæ¯å‘é€ç»™æ¶ˆæ¯æœåŠ¡å™¨ï¼Œæ¶ˆæ¯æœåŠ¡å™¨å°†æ¶ˆæ¯å­˜æ”¾åœ¨è‹¥å¹²<strong>é˜Ÿåˆ—/ä¸»é¢˜topic</strong>ä¸­ï¼Œåœ¨åˆé€‚çš„æ—¶å€™ï¼Œæ¶ˆæ¯æœåŠ¡å™¨å›å°†æ¶ˆæ¯è½¬å‘ç»™æ¥å—è€…ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå‘é€å’Œæ¥æ”¶æ˜¯å¼‚æ­¥çš„ï¼Œä¹Ÿå°±æ˜¯å‘é€æ— éœ€ç­‰å¾…ï¼Œè€Œä¸”å‘é€è€…å’Œæ¥å—è€…çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿæ²¡æœ‰å¿…ç„¶çš„å…³ç³»ï¼›</p><p>å°¤å…¶åœ¨å‘å¸ƒpub/è®¢é˜…subæ¨¡å¼ä¸‹ï¼Œä¹Ÿå¯ä»¥å®Œæˆä¸€å¯¹å¤šçš„é€šä¿¡ï¼Œå³è®©ä¸€ä¸ªæ¶ˆæ¯æœ‰å¤šä¸ªæ¥å—è€…ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gesz1or8ijj31fw0jswsa.jpg" alt="img"> </p><h3 id="ä¸‰ã€ç‰¹ç‚¹"><a href="#ä¸‰ã€ç‰¹ç‚¹" class="headerlink" title="ä¸‰ã€ç‰¹ç‚¹"></a>ä¸‰ã€ç‰¹ç‚¹</h3><h4 id="1ã€é‡‡ç”¨å¼‚æ­¥å¤„ç†æ¨¡å¼"><a href="#1ã€é‡‡ç”¨å¼‚æ­¥å¤„ç†æ¨¡å¼" class="headerlink" title="1ã€é‡‡ç”¨å¼‚æ­¥å¤„ç†æ¨¡å¼"></a>1ã€é‡‡ç”¨å¼‚æ­¥å¤„ç†æ¨¡å¼</h4><p>æ¶ˆæ¯å‘é€è€…å¯ä»¥å‘é€ä¸€ä¸ªæ¶ˆæ¯è€Œæ— é¡»ç­‰å¾…å“åº”ã€‚æ¶ˆæ¯å‘é€è€…å°†æ¶ˆæ¯å‘é€åˆ°ä¸€æ¡è™šæ‹Ÿçš„é€šé“ï¼ˆä¸»é¢˜æˆ–è€…é˜Ÿåˆ—ï¼‰ä¸Šï¼›</p><p>æ¶ˆæ¯æ¥æ”¶è€…åˆ™è®¢é˜…æˆ–è€…ç›‘å¬è¯¥çˆ±é€šé“ã€‚ä¸€æ¡æ¶ˆæ¯å¯èƒ½æœ€ç»ˆè½¬å‘ç»™ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ¶ˆæ¯æ¥æ”¶è€…ï¼Œè¿™äº›æ¶ˆæ¯æ¥æ”¶è€…éƒ½æ— éœ€å¯¹æ¶ˆæ¯å‘é€è€…åšå‡ºåŒæ­¥å›åº”ã€‚æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯å¼‚æ­¥çš„ã€‚</p><p>æ¡ˆä¾‹ï¼š</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªç³»ç»Ÿè·Ÿå¦ä¸€ä¸ªç³»ç»Ÿä¹‹é—´è¿›è¡Œé€šä¿¡çš„æ—¶å€™ï¼Œå‡å¦‚ç³»ç»ŸAå¸Œæœ›å‘é€ä¸€ä¸ªæ¶ˆæ¯ç»™ç³»ç»ŸBï¼Œè®©ä»–å»å¤„ç†ã€‚ä½†æ˜¯ç³»ç»ŸAä¸å…³æ³¨ç³»ç»ŸBåˆ°åº•æ€ä¹ˆå¤„ç†æˆ–è€…æœ‰æ²¡æœ‰å¤„ç†å¥½ï¼Œæ‰€ä»¥ç³»ç»ŸAæŠŠæ¶ˆæ¯å‘é€ç»™MQï¼Œç„¶åå°±ä¸ç®¡è¿™æ¡æ¶ˆæ¯çš„â€œæ­»æ´»äº†â€ï¼Œæ¥ç€ç³»ç»ŸBä»MQé‡Œé¢æ¶ˆè´¹å‡ºæ¥å¤„ç†å³å¯ã€‚è‡³äºæ€ä¹ˆå¤„ç†ï¼Œæ˜¯å¦å¤„ç†å®Œæ¯•ï¼Œä»€ä¹ˆæ—¶å€™å¤„ç†ï¼Œéƒ½æ˜¯ç³»ç»ŸBçš„äº‹å„¿ï¼Œä¸ç³»ç»ŸAæ— å…³ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geszca2nacj31460gl42g.jpg" alt="img"> </p><p>è¿™æ ·çš„ä¸€ç§é€šä¿¡æ–¹å¼ï¼Œå°±æ˜¯æ‰€è°“çš„â€œå¼‚æ­¥â€é€šä¿¡æ–¹å¼ï¼Œå¯¹äºç³»ç»ŸAæ¥è¯´ï¼Œåªéœ€è¦æŠŠæ¶ˆæ¯å‘é€ç»™MQï¼Œç„¶åç³»ç»ŸBå°±ä¼šå¼‚æ­¥çš„å»è¿›è¡Œå¤„ç†äº†ï¼Œç³»ç»ŸAä¸éœ€è¦â€œåŒæ­¥â€çš„ç­‰å¾…ç³»ç»ŸBå¤„ç†å®Œæˆã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸¤ä¸ªå­—ï¼šè§£è€¦</p><h4 id="2ã€åº”ç”¨ç³»ç»Ÿä¹‹é—´è§£è€¦åˆ"><a href="#2ã€åº”ç”¨ç³»ç»Ÿä¹‹é—´è§£è€¦åˆ" class="headerlink" title="2ã€åº”ç”¨ç³»ç»Ÿä¹‹é—´è§£è€¦åˆ"></a>2ã€åº”ç”¨ç³»ç»Ÿä¹‹é—´è§£è€¦åˆ</h4><p>å‘é€è€…å’Œæ¥å—è€…ä¸å¿…äº†è§£å¯¹æ–¹ï¼Œåªéœ€è¦ç¡®è®¤æ¶ˆæ¯ï¼›å‘é€è€…å’Œæ¥å—è€…ä¸å¿…åŒæ—¶åœ¨çº¿</p><h4 id="3ã€æ•´ä½“æ¶æ„"><a href="#3ã€æ•´ä½“æ¶æ„" class="headerlink" title="3ã€æ•´ä½“æ¶æ„"></a>3ã€æ•´ä½“æ¶æ„</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gesx6us1n6j30x20gs79g.jpg" alt="image-20200511173532314"></p><h3 id="å››ã€æ€ä¹ˆç©"><a href="#å››ã€æ€ä¹ˆç©" class="headerlink" title="å››ã€æ€ä¹ˆç©"></a>å››ã€æ€ä¹ˆç©</h3><p><a href="http://activemq.apache.org/" target="_blank" rel="noopener">http://activemq.apache.org/</a> å®˜ç½‘åœ°å€</p><ul><li>æœ€é‡è¦çš„åŠŸèƒ½ï¼šå®ç°é«˜å¯ç”¨ï¼Œé«˜æ€§èƒ½ï¼Œå¯ä¼¸ç¼©ï¼Œæ˜“ç”¨å’Œå®‰å…¨çš„ä¼ä¸šçº§é¢å‘æ¶ˆæ¯æœåŠ¡çš„ç³»ç»Ÿ</li><li>å¼‚æ­¥æ¶ˆæ¯çš„æ¶ˆè´¹å’Œå¤„ç†</li><li>æ§åˆ¶æ¶ˆæ¯çš„æ¶ˆè´¹é¡ºåº</li><li>å¯ä»¥å’ŒSpringæˆ–è€…SpringBootæ•´åˆç®€åŒ–ä»£ç </li><li>é…ç½®é›†ç¾¤å®¹é”™çš„MQé›†ç¾¤</li></ul><p>æŸ¥çœ‹activeMqå¯åŠ¨è¿›ç¨‹çš„3ç§æ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep activemq|grep -v grep</span><br><span class="line">netstat -anp|grep 61616</span><br><span class="line">lsof -i:61616</span><br></pre></td></tr></table></figure><h4 id="1ã€é»˜è®¤ç«¯å£ä¸º61616"><a href="#1ã€é»˜è®¤ç«¯å£ä¸º61616" class="headerlink" title="1ã€é»˜è®¤ç«¯å£ä¸º61616"></a>1ã€é»˜è®¤ç«¯å£ä¸º61616</h4><p>æ™®é€šç™»å½•ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geszdf3nkoj312h0h47cd.jpg" alt="img"> </p><p>æ™®é€šå…³é—­ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geszeu9n8fj312t0m3qg9.jpg" alt="img"> </p><p>å¸¦æ—¥å¿—å¯åŠ¨ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geszerqikfj30rt03o0tg.jpg" alt="img"> </p><h4 id="2ã€Apache-ActiveMQæ§åˆ¶å°"><a href="#2ã€Apache-ActiveMQæ§åˆ¶å°" class="headerlink" title="2ã€Apache ActiveMQæ§åˆ¶å°"></a>2ã€Apache ActiveMQæ§åˆ¶å°</h4><p><a href="http://127.0.0.1:8161/admin" target="_blank" rel="noopener">http://127.0.0.1:8161/admin</a> ï¼›  é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç æ˜¯admin/admin</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geszeq17v6j31nb0szdjc.jpg" alt="img"> </p><p>å¤‡æ³¨ï¼šActiveMQé‡‡ç”¨61616ç«¯å£æä¾›JMSæœåŠ¡ï¼›ActiveMQé‡‡ç”¨8161ç«¯å£æä¾›ç®¡ç†æ§åˆ¶å°æœåŠ¡</p>]]></content>
      
      
      <categories>
          
          <category> MQ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>@Transactional Kotlin Example äº‹åŠ¡</title>
      <link href="/2020/04/29/Transactional-Kotlin-Example-%E4%BA%8B%E5%8A%A1/"/>
      <url>/2020/04/29/Transactional-Kotlin-Example-%E4%BA%8B%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="Transactional-Kotlin-Example-äº‹åŠ¡"><a href="#Transactional-Kotlin-Example-äº‹åŠ¡" class="headerlink" title="@Transactional Kotlin Example äº‹åŠ¡"></a>@Transactional Kotlin Example äº‹åŠ¡</h1><p>How to make transactional failed? How to use @Transactional<br>æ€ä¹ˆåšä¼šä½¿äº‹åŠ¡å¤±è´¥ï¼Ÿ æ€ä¹ˆç”¨äº‹åŠ¡æ³¨è§£</p><h2 id="1-Transactional"><a href="#1-Transactional" class="headerlink" title="1. @Transactional"></a>1. @Transactional</h2><p>äº‹åŠ¡æ³¨è§£ä¼šè®©ä¸€ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œå®Œä¹‹åï¼Œè¦ä¹ˆæäº¤æ‰€æœ‰çš„æ”¹å˜ï¼Œè¦ä¹ˆä»€ä¹ˆéƒ½ä¸æ”¹å˜ã€‚ACID åŸåˆ™</p><h3 id="1-1-Mysql-engine-use-InnoDB-æ•°æ®åº“å¼•æ“å¿…é¡»æ”¯æŒäº‹åŠ¡"><a href="#1-1-Mysql-engine-use-InnoDB-æ•°æ®åº“å¼•æ“å¿…é¡»æ”¯æŒäº‹åŠ¡" class="headerlink" title="1.1 Mysql engine: use InnoDB æ•°æ®åº“å¼•æ“å¿…é¡»æ”¯æŒäº‹åŠ¡"></a>1.1 Mysql engine: use InnoDB æ•°æ®åº“å¼•æ“å¿…é¡»æ”¯æŒäº‹åŠ¡</h3><p>MyISAM: Transactions NO Before MySQL 5.5.5, MyISAM is the default storage engine. (The default was changed to InnoDB in MySQL 5.5.5.) MyISAM is based on the older (and no longer available) ISAM storage engine but has many useful extensions.</p><p>å¦‚æœ MySQL æ•°æ®åº“çš„å¼•æ“æ˜¯ MyISAMï¼Œé‚£å®ƒæ ¹æœ¬ä¸æ”¯æŒäº‹åŠ¡</p><p><a href="https://dev.mysql.com/doc/refman/5.5/en/myisam-storage-engine.html" target="_blank" rel="noopener">More detail for MyISAM</a></p><h3 id="1-2-Make-sure-the-class-will-be-instance-as-a-Bean-Service-ç±»å¿…é¡»å®ä¾‹åŒ–æˆ-Spring-çš„-Bean"><a href="#1-2-Make-sure-the-class-will-be-instance-as-a-Bean-Service-ç±»å¿…é¡»å®ä¾‹åŒ–æˆ-Spring-çš„-Bean" class="headerlink" title="1.2 Make sure the class will be instance as a Bean: @Service ç±»å¿…é¡»å®ä¾‹åŒ–æˆ Spring çš„ Bean"></a>1.2 Make sure the class will be instance as a Bean: @Service ç±»å¿…é¡»å®ä¾‹åŒ–æˆ Spring çš„ Bean</h3><h3 id="1-3-Function-must-be-public-æ–¹æ³•å¿…é¡»æ˜¯-public-çš„"><a href="#1-3-Function-must-be-public-æ–¹æ³•å¿…é¡»æ˜¯-public-çš„" class="headerlink" title="1.3 Function must be public æ–¹æ³•å¿…é¡»æ˜¯ public çš„"></a>1.3 Function must be public æ–¹æ³•å¿…é¡»æ˜¯ <em>public</em> çš„</h3><p>Method visibility and @Transactional<br>When using proxies, you should apply the @Transactional annotation only to methods with public visibility. If you do annotate protected, private or package-visible methods with the @Transactional annotation, no error is raised, but the annotated method does not exhibit the configured transactional settings. Consider the use of AspectJ (see below) if you need to annotate non-public methods.</p><h3 id="1-4-Self-invocation-è‡ªæˆ‘è°ƒç”¨é—®é¢˜"><a href="#1-4-Self-invocation-è‡ªæˆ‘è°ƒç”¨é—®é¢˜" class="headerlink" title="1.4 Self-invocation è‡ªæˆ‘è°ƒç”¨é—®é¢˜"></a>1.4 Self-invocation è‡ªæˆ‘è°ƒç”¨é—®é¢˜</h3><p>åœ¨åŒä¸€ä¸ª Bean ä¸­ ä¸€ä¸ªæ­£å¸¸çš„æ–¹æ³•å«ä¸€ä¸ªå¸¦äº‹åŠ¡æ³¨è§£çš„æ–¹æ³•ï¼Œäº‹ç‰©æ˜¯ä¸ä¼šå¥æ•ˆçš„<br><code>testSelfInvocation</code>å«<code>save</code>æ–¹æ³•ï¼Œè™½ç„¶æœ€åæœ‰ Runtime çš„å¼‚å¸¸ï¼Œä½†æ•°æ®ä¾ç„¶æ’å…¥äº†<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡å»¶è¿Ÿæ³¨å…¥ä¸€ä¸ªç›¸åŒç±»å‹çš„ Bean æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ManService</span>(</span></span><br><span class="line">    private val manRepository: ManRepository,</span><br><span class="line">    <span class="meta">@Lazy</span></span><br><span class="line">    <span class="keyword">private</span> val self: ManService</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">// NO INSERT</span></span><br><span class="line">    <span class="function">fun <span class="title">notSelfInvocation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        val man = Man(<span class="string">"1"</span>, Woman(<span class="string">"1"</span>))</span><br><span class="line">        self.save(man)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// NO INSERT</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function">fun <span class="title">save</span><span class="params">(man: Man)</span>: Man </span>&#123;</span><br><span class="line">        val result = manRepository.save(man)</span><br><span class="line">        <span class="keyword">throw</span> RuntimeException(<span class="string">"test"</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    In proxy mode (which is the default), only external method calls coming in through the proxy</span></span><br><span class="line"><span class="comment">    are intercepted. This means that self-invocation, in effect, a method within the target object</span></span><br><span class="line"><span class="comment">    calling another method of the target object, will not lead to an actual transaction at runtime</span></span><br><span class="line"><span class="comment">    even if the invoked method is marked with @Transactional. Also, the proxy must be fully</span></span><br><span class="line"><span class="comment">    initialized to provide the expected behaviour so you should not rely on this feature in your</span></span><br><span class="line"><span class="comment">    initialization code, i.e. @PostConstruct.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    Hibernate: insert into woman (reference, id) values (?, ?)</span></span><br><span class="line"><span class="comment">    Hibernate: insert into man (reference, woman_id, id) values (?, ?, ?)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">fun <span class="title">testSelfInvocation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        val man = Man(<span class="string">"1"</span>, Woman(<span class="string">"1"</span>))</span><br><span class="line">        <span class="keyword">this</span>.save(man)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-5-catch-custom-exception-but-do-not-throw-it-insert-wonâ€™t-be-rollback-åªæŠ“ä¸æŠ›å¼‚å¸¸æ˜¯ä¸ä¼šè®©äº‹åŠ¡å›æ»šçš„"><a href="#1-5-catch-custom-exception-but-do-not-throw-it-insert-wonâ€™t-be-rollback-åªæŠ“ä¸æŠ›å¼‚å¸¸æ˜¯ä¸ä¼šè®©äº‹åŠ¡å›æ»šçš„" class="headerlink" title="1.5 catch custom exception but do not throw it, insert wonâ€™t be rollback åªæŠ“ä¸æŠ›å¼‚å¸¸æ˜¯ä¸ä¼šè®©äº‹åŠ¡å›æ»šçš„"></a>1.5 catch custom exception but do not throw it, insert wonâ€™t be rollback åªæŠ“ä¸æŠ›å¼‚å¸¸æ˜¯ä¸ä¼šè®©äº‹åŠ¡å›æ»šçš„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class MyException(m: String) : Exception(m)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function">fun <span class="title">catchException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        val man = Man(<span class="string">"1"</span>, Woman(<span class="string">"1"</span>))</span><br><span class="line">        manRepository.save(man)</span><br><span class="line">        <span class="keyword">throw</span> MyException(<span class="string">"custom exception"</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Hibernate: <span class="function">insert into <span class="title">woman</span> <span class="params">(reference, id)</span> <span class="title">values</span> <span class="params">(?, ?)</span></span></span><br><span class="line"><span class="function">Hibernate: insert into <span class="title">man</span> <span class="params">(reference, woman_id, id)</span> <span class="title">values</span> <span class="params">(?, ?, ?)</span></span></span><br></pre></td></tr></table></figure><h3 id="1-6-Throws-exception-but-do-not-rollback-æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸æ˜¯ä¸ä¼šè®©äº‹åŠ¡å›æ»šçš„"><a href="#1-6-Throws-exception-but-do-not-rollback-æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸æ˜¯ä¸ä¼šè®©äº‹åŠ¡å›æ»šçš„" class="headerlink" title="1.6 Throws exception but do not rollback æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸æ˜¯ä¸ä¼šè®©äº‹åŠ¡å›æ»šçš„"></a>1.6 Throws exception but do not rollback æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸æ˜¯ä¸ä¼šè®©äº‹åŠ¡å›æ»šçš„</h3><p><img src="https://magiciendecode.fr/static/4ccfc733594f10ad094f9d0eb6cdc333/5a190/exception.png" alt="exception">By default, a transaction will be rolling back on RuntimeException and Error but not on checked exceptions (business exceptions).<br>äº‹åŠ¡é»˜è®¤åªä¼šå›æ»š<code>RuntimeException</code> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Transactional.html" target="_blank" rel="noopener">Spring @Transactional</a></p><ul><li>Not Runtime Exception, so transaction wonâ€™t be rollback ä¸æ˜¯ Runtime çš„å¼‚å¸¸ä¸è¡Œ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Throws</span>(MyException::<span class="class"><span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">fun</span> <span class="title">catchThrowsException</span>() </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        val man = Man(<span class="string">"1"</span>, Woman(<span class="string">"1"</span>))</span><br><span class="line">        manRepository.save(man)</span><br><span class="line">        <span class="keyword">throw</span> MyException(<span class="string">"custom exception"</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: MyException) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Hibernate: <span class="function">insert into <span class="title">woman</span> <span class="params">(reference, id)</span> <span class="title">values</span> <span class="params">(?, ?)</span></span></span><br><span class="line"><span class="function">Hibernate: insert into <span class="title">man</span> <span class="params">(reference, woman_id, id)</span> <span class="title">values</span> <span class="params">(?, ?, ?)</span></span></span><br></pre></td></tr></table></figure><ul><li>Declare rollbackFor å£°æ˜éœ€è¦ä¸ºå“ªäº›å¼‚å¸¸å›æ»š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Transactional(rollbackFor = [MyException::class])</span><br><span class="line"><span class="meta">@Throws</span>(MyException::<span class="class"><span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">fun</span> <span class="title">catchThrowsExceptionWithTransactional</span>() </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        val man = Man(<span class="string">"1"</span>, Woman(<span class="string">"1"</span>))</span><br><span class="line">        manRepository.save(man)</span><br><span class="line">        <span class="keyword">throw</span> MyException(<span class="string">"custom exception"</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: MyException) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// NO INSERT</span></span><br></pre></td></tr></table></figure><ul><li>RuntimeException é»˜è®¤çš„å›æ»šå¼‚å¸¸</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function">fun <span class="title">runtimeException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    val man = Man(<span class="string">"1"</span>, Woman(<span class="string">"1"</span>))</span><br><span class="line">    manRepository.save(man)</span><br><span class="line">    <span class="keyword">throw</span> RuntimeException(<span class="string">"custom exception"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// NO INSERT</span></span><br></pre></td></tr></table></figure><h2 id="2-Propagation-äº‹åŠ¡çš„ä¼ æ’­æ¨¡å¼"><a href="#2-Propagation-äº‹åŠ¡çš„ä¼ æ’­æ¨¡å¼" class="headerlink" title="2. Propagation äº‹åŠ¡çš„ä¼ æ’­æ¨¡å¼"></a>2. Propagation äº‹åŠ¡çš„ä¼ æ’­æ¨¡å¼</h2><h3 id="2-1-REQUIRED-amp-REQUIRED-NEW"><a href="#2-1-REQUIRED-amp-REQUIRED-NEW" class="headerlink" title="2.1 REQUIRED &amp; REQUIRED_NEW"></a>2.1 REQUIRED &amp; REQUIRED_NEW</h3><ul><li>REQUIRED<ul><li>å¦‚æœæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ªï¼Œå¦‚æœæœ‰ï¼Œå°±ç”¨å½“å‰çš„</li></ul></li><li>REQUIRED_NEW<ul><li>æ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œå¦‚æœå½“å‰å°±æœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆä¼šæŠŠå½“å‰çš„æŒ‚èµ·</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Support a current transaction, create a new one if none exists.</span></span><br><span class="line"><span class="comment"> * Analogous to EJB transaction attribute of the same name.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This is the default setting of a transaction annotation.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">REQUIRED(TransactionDefinition.PROPAGATION_REQUIRED),</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create a new transaction, and suspend the current transaction if one exists.</span></span><br><span class="line"><span class="comment"> * Analogous to the EJB transaction attribute of the same name.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;&lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; Actual transaction suspension will not work out-of-the-box</span></span><br><span class="line"><span class="comment"> * on all transaction managers. This in particular applies to</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> org.springframework.transaction.jta.JtaTransactionManager&#125;,</span></span><br><span class="line"><span class="comment"> * which requires the &#123;<span class="doctag">@code</span> javax.transaction.TransactionManager&#125; to be</span></span><br><span class="line"><span class="comment"> * made available to it (which is server-specific in standard Java EE).</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.transaction.jta.JtaTransactionManager#setTransactionManager</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">REQUIRED_NEW(TransactionDefinition.PROPAGATION_REQUIRED_NEW),</span><br></pre></td></tr></table></figure><ul><li>REQUIRED å¦‚æœä¸¤ä¸ªæ–¹æ³•å…±äº«ä¸€ä¸ªå®åŠ¡ï¼Œä¸€ä¸ªéœ€è¦å›æ»šï¼Œä¸€ä¸ªéœ€è¦æäº¤ï¼Œå°±ä¼šå‡ºç°<code>UnexpectedRollbackException</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NO INSERT TO DB</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function">fun <span class="title">runtimeException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    val man = Man(<span class="string">"1"</span>, Woman(<span class="string">"1"</span>))</span><br><span class="line">    manRepository.save(man)</span><br><span class="line">    <span class="keyword">throw</span> RuntimeException(<span class="string">"custom exception"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// org.springframework.transaction.UnexpectedRollbackException:</span></span><br><span class="line"><span class="comment">// Transaction silently rolled back because it has been marked as rollback-only</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function">fun <span class="title">callAnotherTransactionalThrowRuntimeException</span><span class="params">()</span></span>&#123;</span><br><span class="line">    val woman = Woman(<span class="string">"1"</span>)</span><br><span class="line">    womanRepository.save(woman)</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        manService.runtimeException()</span><br><span class="line">    &#125;<span class="keyword">catch</span> (e:RuntimeException)&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>REQUIRED_NEW ä¸¤ä¸ªæ–¹æ³•éƒ½æœ‰è‡ªå·±çš„äº‹åŠ¡ï¼Œæ‰€ä»¥ä¸ä¼šäº’ç›¸å½±å“ã€‚</p><p><a href="https://magiciendecode.fr/static/a98b3299767024dc22680f9e8c3d3cc2/b5bda/propagation_required_new.png" target="_blank" rel="noopener"><img src="https://magiciendecode.fr/static/a98b3299767024dc22680f9e8c3d3cc2/b5bda/propagation_required_new.png" alt="propagation required new"></a>These two functions are in the same transaction. When function <code>runtimeException</code> throws an exception, it will mark current transaction should be rollback. But <code>callAnotherTransactional</code> <code>ThrowRuntimeException</code> catch it, so current transaction think it should commit. Thatâ€™s why it throws UnexpectedRollbackException . Another example with @Transactional(propagation = Propagation.REQUIRED_NEW)</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NO INSERT TO DB</span></span><br><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED_NEW)</span><br><span class="line"><span class="function">fun <span class="title">runtimeExceptionWithPropagationRequiredNew</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    val man = Man(<span class="string">"1"</span>, Woman(<span class="string">"1"</span>))</span><br><span class="line">    manRepository.save(man)</span><br><span class="line">    <span class="keyword">throw</span> RuntimeException(<span class="string">"custom exception"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">Hibernate: select woman0_.id as id1_1_0_, woman0_.created_at as created_2_1_0_, woman0_.reference as ...</span></span><br><span class="line"><span class="comment">Hibernate: select man0_.id as id1_0_1_, man0_.created_at as created_2_0_1_, ...</span></span><br><span class="line"><span class="comment">Hibernate: select woman0_.id as id1_1_0_, woman0_.created_at as created_2_1_0_, ...</span></span><br><span class="line"><span class="comment">Hibernate: insert into woman (reference, id) values (?, ?)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function">fun <span class="title">callAnotherTransactional</span><span class="params">()</span></span>&#123;</span><br><span class="line">        val woman = Woman(<span class="string">"1"</span>)</span><br><span class="line">        womanRepository.save(woman)</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            manService.runtimeExceptionWithPropagationRequiredNew()</span><br><span class="line">        &#125;<span class="keyword">catch</span> (e:RuntimeException)&#123;&#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>runtimeExceptionWithPropagationRequiredNew</code> will rollback, but <code>callAnotherTransactional</code> will commit.</p><h3 id="2-2-SUPPORTS-å¦‚æœå½“å‰æœ‰äº‹åŠ¡å°±ç”¨ï¼Œå¦‚æœæ²¡æœ‰å°±ä¸ç”¨äº‹åŠ¡çš„"><a href="#2-2-SUPPORTS-å¦‚æœå½“å‰æœ‰äº‹åŠ¡å°±ç”¨ï¼Œå¦‚æœæ²¡æœ‰å°±ä¸ç”¨äº‹åŠ¡çš„" class="headerlink" title="2.2 SUPPORTS å¦‚æœå½“å‰æœ‰äº‹åŠ¡å°±ç”¨ï¼Œå¦‚æœæ²¡æœ‰å°±ä¸ç”¨äº‹åŠ¡çš„"></a>2.2 SUPPORTS å¦‚æœå½“å‰æœ‰äº‹åŠ¡å°±ç”¨ï¼Œå¦‚æœæ²¡æœ‰å°±ä¸ç”¨äº‹åŠ¡çš„</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Support a current transaction, execute non-transactionally if none exists.</span><br><span class="line"> * Analogous to EJB transaction attribute of the same name.</span><br><span class="line"> * &lt;p&gt;Note: For transaction managers with transaction synchronization,</span><br><span class="line"> * &#123;@code SUPPORTS&#125; is slightly different from no transaction at all,</span><br><span class="line"> * as it defines a transaction scope that synchronization will apply for.</span><br><span class="line"> * As a consequence, the same resources (JDBC Connection, Hibernate Session, etc)</span><br><span class="line"> * will be shared for the entire specified scope. Note that this depends on</span><br><span class="line"> * the actual synchronization configuration of the transaction manager.</span><br><span class="line"> * @see org.springframework.transaction.support.AbstractPlatformTransactionManager#setTransactionSynchronization</span><br><span class="line"> */</span><br><span class="line">SUPPORTS(TransactionDefinition.PROPAGATION_SUPPORTS)</span><br></pre></td></tr></table></figure><p>See example below</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.SUPPORTS)</span><br><span class="line"><span class="function">fun <span class="title">propagationSupport</span><span class="params">()</span></span>&#123;</span><br><span class="line">    val man = Man(<span class="string">"1"</span>, Woman(<span class="string">"1"</span>))</span><br><span class="line">    manRepository.save(man)</span><br><span class="line">    <span class="keyword">throw</span> RuntimeException(<span class="string">"custom exception"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Hibernate: insert into woman (reference, id) values (?, ?)</span></span><br><span class="line"><span class="comment">Hibernate: insert into man (reference, woman_id, id) values (?, ?, ?)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">fun <span class="title">nonTransactionalCallSupport</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    manService.propagationSupport()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NO INSERT</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function">fun <span class="title">transactionalCallSupport</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    manService.propagationSupport()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-NESTED-ä¸å»ºè®®ä½¿ç”¨ï¼Œå’Œ-JDBC-ç‰ˆæœ¬æœ‰å…³"><a href="#2-3-NESTED-ä¸å»ºè®®ä½¿ç”¨ï¼Œå’Œ-JDBC-ç‰ˆæœ¬æœ‰å…³" class="headerlink" title="2.3 NESTED ä¸å»ºè®®ä½¿ç”¨ï¼Œå’Œ JDBC ç‰ˆæœ¬æœ‰å…³"></a>2.3 NESTED ä¸å»ºè®®ä½¿ç”¨ï¼Œå’Œ JDBC ç‰ˆæœ¬æœ‰å…³</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Execute within a nested transaction if a current transaction exists,</span></span><br><span class="line"><span class="comment"> * behave like &#123;<span class="doctag">@code</span> REQUIRED&#125; otherwise. There is no analogous feature in EJB.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Note: Actual creation of a nested transaction will only work on specific</span></span><br><span class="line"><span class="comment"> * transaction managers. Out of the box, this only applies to the JDBC</span></span><br><span class="line"><span class="comment"> * DataSourceTransactionManager. Some JTA providers might support nested</span></span><br><span class="line"><span class="comment"> * transactions as well.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.jdbc.datasource.DataSourceTransactionManager</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">NESTED(TransactionDefinition.PROPAGATION_NESTED)</span><br></pre></td></tr></table></figure><p>As I have</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.transaction.NestedTransactionNotSupportedException:</span><br><span class="line">JpaDialect does not support savepoints - check your JPA provider<span class="string">'s capabilities</span></span><br></pre></td></tr></table></figure><p>there is no test.<br>I see somewhere says that DataSourceTransactionManager only available for JdbcTemplate and ibatis, need JDBC3.0</p><h2 id="3-Isolation-äº‹åŠ¡çš„éš”ç¦»"><a href="#3-Isolation-äº‹åŠ¡çš„éš”ç¦»" class="headerlink" title="3. Isolation äº‹åŠ¡çš„éš”ç¦»"></a>3. Isolation äº‹åŠ¡çš„éš”ç¦»</h2><ul><li>Dirty read è„è¯»: read the uncommitted change of a concurrent transaction.<ul><li>A äº‹åŠ¡åœ¨è¯»å–æŸä¸€è¡Œæ•°æ®çš„æ—¶å€™ï¼Œèƒ½å¤Ÿè¯»åˆ° B äº‹åŠ¡è¿˜æœªæäº¤çš„ã€å¯¹åŒä¸€è¡Œæ•°æ®çš„ä¿®æ”¹ã€‚</li></ul></li><li>Non-repeatable read ä¸å¯é‡å¤: get different value on re-read of a row if a concurrent transaction updates the same row and commits. * åœ¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œï¼Œåœ¨ T1 æ—¶é—´è¯»å–åˆ°çš„æŸä¸€è¡Œçš„æ•°æ®ï¼Œåœ¨ T2 æ—¶é—´å†æ¬¡è¯»å–åŒä¸€è¡Œæ•°æ®æ—¶ï¼Œå‘ç”Ÿäº†å˜åŒ–ã€‚åè€…å˜åŒ–å¯èƒ½æ˜¯è¢«æ›´æ–°äº†ã€æ¶ˆå¤±äº†ã€‚</li><li>Phantom read å¹»è¯»: get different rows after re-execution of a range query if another transaction adds or removes some rows in the range and commits. * åœ¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œï¼Œç”¨æ¡ä»¶ Aï¼Œåœ¨ T1 æ—¶é—´æŸ¥è¯¢åˆ°çš„æ•°æ®æ˜¯ 10 è¡Œï¼Œä½†æ˜¯åœ¨ T2 æ—¶é—´æŸ¥è¯¢åˆ°çš„æ•°æ®å¤šäº 10 è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ å’Œ Nonrepeatable read ä¸åŒï¼ŒPhantom read åœ¨ T1 æ—¶è¯»åˆ°çš„æ•°æ®åœ¨ T2 æ—¶ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚æ³¨æ„ï¼Œä¸ºä½•åªè¯´æ¯” 10 è¡Œå¤šï¼Œ é‚£ä¹ˆæ¯” 10 è¡Œå°‘å°±ä¸æ˜¯ Phantom read äº†å—ï¼Ÿå› ä¸º Nonrepeatable read åŒ…å«äº†æ•°æ®æ¶ˆå¤±çš„æƒ…å†µã€‚</li></ul><div class="table-container"><table><thead><tr><th>Isolation level</th><th>Dirty read</th><th>Non-repeatable read</th><th>Phantom read</th></tr></thead><tbody><tr><td>READ_UNCOMMITTED</td><td>may occur</td><td>may occur</td><td>may occur</td></tr><tr><td>READ_COMMITTED</td><td></td><td>may occur</td><td>may occur</td></tr><tr><td>REPEATABLE_READ</td><td></td><td></td><td>may occur</td></tr><tr><td>SERIALIZABLE</td><td></td><td></td></tr></tbody></table></div>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rediså®ç°åˆ†å¸ƒå¼é”</title>
      <link href="/2020/04/29/Redis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"/>
      <url>/2020/04/29/Redis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¸€ã€é€šè¿‡Redisåˆ†å¸ƒå¼é”åŒé‡é˜²æ­»é”"><a href="#ä¸€ã€é€šè¿‡Redisåˆ†å¸ƒå¼é”åŒé‡é˜²æ­»é”" class="headerlink" title="ä¸€ã€é€šè¿‡Redisåˆ†å¸ƒå¼é”åŒé‡é˜²æ­»é”"></a>ä¸€ã€é€šè¿‡Redisåˆ†å¸ƒå¼é”<strong>åŒé‡é˜²æ­»é”</strong></h3><p>1ã€Redisåˆ†å¸ƒå¼é”å‘½ä»¤ï¼š</p><p>setnx: åªæœ‰ä¸å­˜åœ¨çš„æ—¶å€™æ‰set</p><p>getset: å…ˆgetå†set</p><p>expire: è®¾ç½®keyçš„æœ‰æ•ˆæœŸ</p><p>del: åˆ é™¤</p><p>2ã€Redisåˆ†å¸ƒå¼é”ä¼˜åŒ–ç‰ˆæµç¨‹å›¾</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geafxgzn82j31hz0u04qp.jpg" alt="image-20200429104359491"></p><p>ä»£ç å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled</span>(cron=<span class="string">"0 */1 * * * ?"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeOrderTaskV3</span><span class="params">()</span></span>&#123;</span><br><span class="line">    log.info(<span class="string">"å…³é—­è®¢å•å®šæ—¶ä»»åŠ¡å¯åŠ¨"</span>);</span><br><span class="line">    <span class="keyword">long</span> lockTimeout = Long.parseLong(PropertiesUtil.getProperty(<span class="string">"lock.timeout"</span>,<span class="string">"5000"</span>));</span><br><span class="line">    Long setnxResult = RedisShardedPoolUtil.setnx(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,String.valueOf(System.currentTimeMillis()+lockTimeout));</span><br><span class="line">    <span class="keyword">if</span>(setnxResult != <span class="keyword">null</span> &amp;&amp; setnxResult.intValue() == <span class="number">1</span>)&#123;</span><br><span class="line">        closeOrder(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//æœªè·å–åˆ°é”ï¼Œç»§ç»­åˆ¤æ–­ï¼Œåˆ¤æ–­æ—¶é—´æˆ³ï¼Œçœ‹æ˜¯å¦å¯ä»¥é‡ç½®å¹¶è·å–åˆ°é”</span></span><br><span class="line">        String lockValueStr = RedisShardedPoolUtil.get(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK);</span><br><span class="line">        <span class="keyword">if</span>(lockValueStr != <span class="keyword">null</span> &amp;&amp; System.currentTimeMillis() &gt; Long.parseLong(lockValueStr))&#123;</span><br><span class="line">            String getSetResult = RedisShardedPoolUtil.getSet(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,String.valueOf(System.currentTimeMillis()+lockTimeout));</span><br><span class="line">            <span class="comment">//å†æ¬¡ç”¨å½“å‰æ—¶é—´æˆ³getsetã€‚</span></span><br><span class="line">            <span class="comment">//è¿”å›ç»™å®šçš„keyçš„æ—§å€¼ï¼Œ-&gt;æ—§å€¼åˆ¤æ–­ï¼Œæ˜¯å¦å¯ä»¥è·å–é”</span></span><br><span class="line">            <span class="comment">//å½“keyæ²¡æœ‰æ—§å€¼æ—¶ï¼Œå³keyä¸å­˜åœ¨æ—¶ï¼Œè¿”å›nil -&gt;è·å–é”</span></span><br><span class="line">            <span class="comment">//è¿™é‡Œæˆ‘ä»¬setäº†ä¸€ä¸ªæ–°çš„valueå€¼ï¼Œè·å–æ—§çš„å€¼ã€‚</span></span><br><span class="line">            <span class="keyword">if</span>(getSetResult == <span class="keyword">null</span> || (getSetResult != <span class="keyword">null</span> &amp;&amp; StringUtils.equals(lockValueStr,getSetResult)))&#123;</span><br><span class="line">                <span class="comment">//çœŸæ­£è·å–åˆ°é”</span></span><br><span class="line">                closeOrder(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                log.info(<span class="string">"æ²¡æœ‰è·å–åˆ°åˆ†å¸ƒå¼é”:&#123;&#125;"</span>,Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            log.info(<span class="string">"æ²¡æœ‰è·å–åˆ°åˆ†å¸ƒå¼é”:&#123;&#125;"</span>,Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">"å…³é—­è®¢å•å®šæ—¶ä»»åŠ¡ç»“æŸ"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">closeOrder</span><span class="params">(String lockName)</span></span>&#123;</span><br><span class="line">    RedisShardedPoolUtil.expire(lockName,<span class="number">5</span>);<span class="comment">//æœ‰æ•ˆæœŸ50ç§’ï¼Œé˜²æ­¢æ­»é”</span></span><br><span class="line">    log.info(<span class="string">"è·å–&#123;&#125;,ThreadName:&#123;&#125;"</span>,Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,Thread.currentThread().getName());</span><br><span class="line">    <span class="keyword">int</span> hour = Integer.parseInt(PropertiesUtil.getProperty(<span class="string">"close.order.task.time.hour"</span>,<span class="string">"2"</span>));</span><br><span class="line">    iOrderService.closeOrder(hour);</span><br><span class="line">    RedisShardedPoolUtil.del(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK);</span><br><span class="line">    log.info(<span class="string">"é‡Šæ”¾&#123;&#125;,ThreadName:&#123;&#125;"</span>,Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,Thread.currentThread().getName());</span><br><span class="line">    log.info(<span class="string">"==============================="</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºŒã€Redissonæ¡†æ¶å®ç°åˆ†å¸ƒå¼é”</p><p>1ã€Redissonä»‹ç»</p><ul><li>Redissonæ˜¯æ¶è®¾åœ¨RedisåŸºç¡€ä¸Šçš„ä¸€ä¸ªJavaé©»å†…å­˜æ•°æ®ç½‘ç»œ(In-Memort-Data-Grid)</li><li>Redissonåœ¨åŸºäºNIOçš„Nettyæ¡†æ¶ä¸Šï¼Œå……åˆ†çš„åˆ©ç”¨äº†Redisé”®å€¼æ•°æ®åº“æä¾›çš„ä¸€ç³»åˆ—ä¼˜åŠ¿</li><li>åœ¨Javaå®ç”¨å·¥å…·åŒ…ä¸­å¸¸ç”¨æ¥å£çš„åŸºç¡€ä¸Šï¼Œä¸ºä½¿ç”¨è€…æä¾›äº†ä¸€ç³»åˆ—å…·æœ‰åˆ†å¸ƒå¼ç‰¹æ€§çš„å¸¸ç”¨å·¥å…·ç±»</li><li>ä½¿å¾—åŸæœ¬ä¸ºåè°ƒå•æœºå¤šçº¿ç¨‹å¹¶å‘ç¨‹åºçš„å·¥å…·åŒ…è·å¾—äº†åè°ƒåˆ†å¸ƒå¼å¤šæœºå¤šçº¿ç¨‹å¹¶å‘ç³»ç»Ÿçš„èƒ½åŠ›ï¼Œå¤§å¤§é™ä½äº†è®¾è®¡å’Œç ”å‘å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„éš¾åº¦ã€‚</li><li>åŒæ—¶ç»“åˆå„å¯Œç‰¹è‰²çš„åˆ†å¸ƒå¼æœåŠ¡ï¼Œæ›´è¿›ä¸€æ­¥ç®€åŒ–äº†åˆ†å¸ƒå¼ç¯å¢ƒä¸­ç¨‹åºç›¸äº’ä¹‹é—´çš„åä½œ</li><li>Redissonå®˜ç½‘ï¼š<a href="https://redisson.org" target="_blank" rel="noopener">https://redisson.org</a> Redisson Github: <a href="https://github.com/redisson/" target="_blank" rel="noopener">https://github.com/redisson/</a> Redisson Wikiï¼š<a href="https://github.com/redisson/redisson/wiki" target="_blank" rel="noopener">https://github.com/redisson/redisson/wiki</a></li></ul><p>2ã€å¼•å…¥mavenä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-avro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3ã€Redissonå·¥å…·ç±»å°è£…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mmall.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mmall.util.PropertiesUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.redisson.Redisson;</span><br><span class="line"><span class="keyword">import</span> org.redisson.config.Config;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020-04-20  11:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedissonManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Config config = <span class="keyword">new</span> Config();</span><br><span class="line">    <span class="keyword">private</span> Redisson redisson = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Redisson <span class="title">getRedisson</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisson;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String redis1Ip = PropertiesUtil.getProperty(<span class="string">"redis1.ip"</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer redis1Port = Integer.parseInt(PropertiesUtil.getProperty(<span class="string">"redis1.port"</span>));</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String redis2Ip = PropertiesUtil.getProperty(<span class="string">"redis2.ip"</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer redis2Port = Integer.parseInt(PropertiesUtil.getProperty(<span class="string">"redis2.port"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            config.useSingleServer().setAddress(<span class="keyword">new</span> StringBuilder().append(redis1Ip).append(<span class="string">":"</span>).append(redis1Port).toString());</span><br><span class="line"></span><br><span class="line">            redisson = (Redisson) Redisson.create(config);</span><br><span class="line"></span><br><span class="line">            log.info(<span class="string">"åˆå§‹åŒ–Redissonç»“æŸ"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"redisson init error"</span>,e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€ä¸šåŠ¡ä»£ç ä¸­çš„ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//    @Scheduled(cron="0 */1 * * * ?")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeOrderTaskV4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        RLock lock = redissonManager.getRedisson().getLock(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK);</span><br><span class="line">        <span class="keyword">boolean</span> getLock = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(getLock = lock.tryLock(<span class="number">0</span>,<span class="number">50</span>, TimeUnit.SECONDS))&#123;</span><br><span class="line">                log.info(<span class="string">"Redissonè·å–åˆ°åˆ†å¸ƒå¼é”:&#123;&#125;,ThreadName:&#123;&#125;"</span>,Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,Thread.currentThread().getName());</span><br><span class="line">                <span class="keyword">int</span> hour = Integer.parseInt(PropertiesUtil.getProperty(<span class="string">"close.order.task.time.hour"</span>,<span class="string">"2"</span>));</span><br><span class="line"><span class="comment">//                iOrderService.closeOrder(hour);</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                log.info(<span class="string">"Redissonæ²¡æœ‰è·å–åˆ°åˆ†å¸ƒå¼é”:&#123;&#125;,ThreadName:&#123;&#125;"</span>,Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            log.error(<span class="string">"Redissonåˆ†å¸ƒå¼é”è·å–å¼‚å¸¸"</span>,e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(!getLock)&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            lock.unlock();</span><br><span class="line">            log.info(<span class="string">"Redissonåˆ†å¸ƒå¼é”é‡Šæ”¾é”"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    RedisShardedPoolUtil.expire(lockName,<span class="number">5</span>);<span class="comment">//æœ‰æ•ˆæœŸ50ç§’ï¼Œé˜²æ­¢æ­»é”</span></span><br><span class="line">        log.info(<span class="string">"è·å–&#123;&#125;,ThreadName:&#123;&#125;"</span>,Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">int</span> hour = Integer.parseInt(PropertiesUtil.getProperty(<span class="string">"close.order.task.time.hour"</span>,<span class="string">"2"</span>));</span><br><span class="line">        iOrderService.closeOrder(hour);</span><br><span class="line">        RedisShardedPoolUtil.del(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK);</span><br><span class="line">        log.info(<span class="string">"é‡Šæ”¾&#123;&#125;,ThreadName:&#123;&#125;"</span>,Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,Thread.currentThread().getName());</span><br><span class="line">        log.info(<span class="string">"==============================="</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringSessioné›¶å…¥ä¾µä¸šåŠ¡ä»£ç å®ç°å•ç‚¹ç™»å½•</title>
      <link href="/2020/04/27/SpringSession%E9%9B%B6%E5%85%A5%E4%BE%B5%E4%B8%9A%E5%8A%A1%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/"/>
      <url>/2020/04/27/SpringSession%E9%9B%B6%E5%85%A5%E4%BE%B5%E4%B8%9A%E5%8A%A1%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>1ã€ä¸šåŠ¡ä»£ç ï¼Œlogin.doå†™å…¥,loginout.doåˆ é™¤ï¼Œget_user_info.doè¯»å–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mmall.controller.portal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mmall.common.Const;</span><br><span class="line"><span class="keyword">import</span> com.mmall.common.ServerResponse;</span><br><span class="line"><span class="keyword">import</span> com.mmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.mmall.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020-04-20  11:31</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user/springsession/"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserSpringSessionController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserService iUserService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ç™»å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"login.do"</span>,method = RequestMethod.GET)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServerResponse&lt;User&gt; <span class="title">login</span><span class="params">(String username, String password, HttpSession session, HttpServletResponse httpServletResponse)</span></span>&#123;</span><br><span class="line">        ServerResponse&lt;User&gt; response = iUserService.login(username,password);</span><br><span class="line">        <span class="keyword">if</span>(response.isSuccess())&#123;</span><br><span class="line">            session.setAttribute(Const.CURRENT_USER,response.getData());</span><br><span class="line">JsonUtil.obj2String(response.getData()),Const.RedisCacheExtime.REDIS_SESSION_EXTIME);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"logout.do"</span>,method = RequestMethod.GET)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServerResponse&lt;String&gt; <span class="title">logout</span><span class="params">(HttpSession session,HttpServletRequest httpServletRequest,HttpServletResponse httpServletResponse)</span></span>&#123;</span><br><span class="line">        session.removeAttribute(Const.CURRENT_USER);</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createBySuccess();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"get_user_info.do"</span>,method = RequestMethod.GET)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServerResponse&lt;User&gt; <span class="title">getUserInfo</span><span class="params">(HttpSession session, HttpServletRequest httpServletRequest)</span></span>&#123;</span><br><span class="line">        User user = (User)session.getAttribute(Const.CURRENT_USER);</span><br><span class="line">        <span class="keyword">if</span>(user != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ServerResponse.createBySuccess(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"ç”¨æˆ·æœªç™»å½•,æ— æ³•è·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€pom.xmlé‡Œé¢å¼•å…¥jaråŒ…ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- springSession å•ç‚¹ç™»å½• --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-avro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3ã€springé…ç½®æ–‡ä»¶applicationContext.xmlé‡Œé¢æ³¨å…¥bean</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"redisHttpSessionConfiguration"</span> <span class="attr">class</span>=<span class="string">"org.springframework.session.data.redis.config.annotation.web.http.RedisHttpSessionConfiguration"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxInactiveIntervalInSeconds"</span> <span class="attr">value</span>=<span class="string">"1800"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"defaultCookieSerializer"</span> <span class="attr">class</span>=<span class="string">"org.springframework.session.web.http.DefaultCookieSerializer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"domainName"</span> <span class="attr">value</span>=<span class="string">"bytenote.cn"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"useHttpOnlyCookie"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cookiePath"</span> <span class="attr">value</span>=<span class="string">"/"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cookieMaxAge"</span> <span class="attr">value</span>=<span class="string">"31536000"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisPoolConfig"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPoolConfig"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxTotal"</span> <span class="attr">value</span>=<span class="string">"20"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisConnectionFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hostName"</span> <span class="attr">value</span>=<span class="string">"127.0.0.1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"port"</span> <span class="attr">value</span>=<span class="string">"6380"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"poolConfig"</span> <span class="attr">ref</span>=<span class="string">"jedisPoolConfig"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>4ã€web.xmlé‡Œé¢å¼•å…¥springSessionè¿‡æ»¤å™¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- äºŒæœŸæ–°å¢é‡ç½®sessionæ—¶é—´çš„filter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>sessionExpireFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.mmall.controller.common.SessionExpireFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>sessionExpireFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†</title>
      <link href="/2020/04/27/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86/"/>
      <url>/2020/04/27/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¼ ç»Ÿåˆ†å¸ƒå¼ç®—æ³•"><a href="#ä¼ ç»Ÿåˆ†å¸ƒå¼ç®—æ³•" class="headerlink" title="ä¼ ç»Ÿåˆ†å¸ƒå¼ç®—æ³•"></a>ä¼ ç»Ÿåˆ†å¸ƒå¼ç®—æ³•</h1><p>ä¼ ç»Ÿçš„åˆ†å¸ƒå¼ç®—æ³•é€šå¸¸æ˜¯é‡‡ç”¨hashå–æ¨¡çš„æ–¹å¼æ¥å¤„ç†æ•°æ®ä¸æœåŠ¡å™¨èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ã€‚</p><p>ä¸¾ä¸ªæ —å­</p><p>å‡è®¾æœ‰ä¸ªå›¾ç‰‡ä¸ºtest.jpgï¼Œç°åœ¨æœ‰3ä¸ªæœåŠ¡å™¨ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º0æœåŠ¡å™¨ã€1æœåŠ¡å™¨ã€2æœåŠ¡å™¨ã€‚é¦–å…ˆæˆ‘ä»¬å¯¹è¿™å¼ å›¾ç‰‡è¿›è¡Œhashï¼Œå¯ä»¥æ‹¿åˆ°ä¸€ä¸ªæ•£åˆ—å€¼ï¼Œç”¨æ•£åˆ—å€¼å¯¹3è¿›è¡Œå–æ¨¡ï¼Œå–æ¨¡ç»“æœä¸º0æˆ–è€…1æˆ–è€…2ã€‚å¦‚æœç»“æœæ˜¯0åˆ™å°†å›¾ç‰‡å­˜å…¥0æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šï¼Œå¦‚æœæ˜¯1åˆ™å­˜å…¥1æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯2åˆ™å­˜å…¥2æœåŠ¡å™¨èŠ‚ç‚¹ã€‚</p><p><img src="http://p3.pstatp.com/large/pgc-image/77263a6fe59a4156acb635bea5ae1c7e" alt="Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†"></p><p>æŒ‰ç…§ä¸Šè¿°çš„æ–¹å¼ï¼Œæ­¤æ—¶å‡è®¾æˆ‘ä»¬æœ‰4ä¸ªredisèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯redis0ã€redis1ã€redis2ã€redis3ã€‚æœ‰20ä¸ªæ•°æ®ï¼Œè¿™20ä¸ªæ•°æ®çš„hashç»“æœåˆ†åˆ«ä¸º1-20ã€‚ç„¶åå¯¹4è¿›è¡Œå–æ¨¡ï¼Œå–æ¨¡çš„ç»“æœå°±æ˜¯å¯¹åº”æ•°æ®å­˜å‚¨çš„redisèŠ‚ç‚¹ã€‚æœ€ç»ˆæ•°æ®çš„åˆ†é…æƒ…å†µå¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="http://p3.pstatp.com/large/pgc-image/cfc2ab0bcb344f4785591f8ac072202b" alt="Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†"></p><p>é¡¹ç›®è¿è¡Œæ—¶æˆ‘ä»¬å‘ç°redisèŠ‚ç‚¹ä¸å¤Ÿç”¨äº†ï¼Œæ‰€ä»¥æ–°å¢äº†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ–è€…æ˜¯è¯´å‘ç°redisé›†ç¾¤è´Ÿè½½éå¸¸ä½ï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹æ¥èŠ‚çœèµ„æºã€‚ç°åœ¨çš„åœºæ™¯æ˜¯å¢åŠ äº†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬é‡æ–°å°†è¿™20ä¸ªæ•°æ®è¿›è¡Œå–æ¨¡æ”¾ç½®åˆ°5ä¸ªredisèŠ‚ç‚¹ä¸­ã€‚</p><p>å¦‚å›¾ï¼Œå…¶ä¸­1ã€2ã€3ã€20è¿™å››ä¸ªæ•°æ®åœ¨4ä¸ªredisèŠ‚ç‚¹å’Œ5ä¸ªredisèŠ‚ç‚¹ä¸­å­˜å‚¨çš„æœåŠ¡å™¨æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥æ–°å¢äº†ä¸€ä¸ªredisèŠ‚ç‚¹ä¹‹åè¿˜èƒ½è·å–åˆ°è¿™4ä¸ªæ•°æ®ï¼Œå› ä¸ºå­˜å‚¨ä½ç½®æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚</p><p><img src="http://p3.pstatp.com/large/pgc-image/3528b4b0361f4ddd92d7c6d23eded478" alt="Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†"></p><h1 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h1><p>20ä¸ªæ•°æ®åœ¨æ–°å¢äº†ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ååªæœ‰4ä¸ªæ•°æ®å‘½ä¸­ï¼Œå‘½ä¸­ç‡æ˜¯ï¼š4/20 = 20%ã€‚</p><p>å½“ç„¶è¿™é‡Œåªæ˜¯ä¸¾ä¾‹ï¼Œå®é™…ç”Ÿæˆç¯å¢ƒæ•°æ®é‡å¯èƒ½æ˜¯ç™¾ä¸‡çº§ã€åƒä¸‡çº§ï¼Œåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½å¯¹cacheèŠ‚ç‚¹ä¼šæœ‰æ‰€è°ƒæ•´ï¼Œæ¯”å¦‚åˆ é™¤ä¸€ä¸ªcacheèŠ‚ç‚¹ï¼Œå¢åŠ ä¸€ä¸ªcacheèŠ‚ç‚¹ã€‚é‚£ä¹ˆä½¿ç”¨ä¼ ç»Ÿçš„hashç®—æ³•å–æ¨¡çš„æ–¹å¼å°†ä¼šå¯¹åå°æœåŠ¡å™¨é€ æˆå·¨å¤§çš„å†²å‡»ã€‚å¾ˆå¤šç¼“å­˜éƒ½æ²¡æœ‰å‘½ä¸­ï¼Œå¦‚æœä½ çš„ä¸šåŠ¡ä»£ç æ˜¯ç©¿é€å‹çš„ï¼Œé‚£å°±ä¼šç©¿è¿‡cacheç›´å‡»dbï¼Œå¾ˆå®¹æ˜“æŠŠæ•°æ®åº“æå®ã€‚æ¥ä¸‹æ¥å°±çœ‹ä¸€ä¸‹Consistent hashingä¸€è‡´æ€§ç®—æ³•çš„ç²¾é«“æ‰€åœ¨ã€‚</p><h1 id="Consistent-hashing"><a href="#Consistent-hashing" class="headerlink" title="Consistent hashing"></a>Consistent hashing</h1><p>ä¸€è‡´æ€§hashç®—æ³•ï¼ŒConsistent hashingç®—æ³•æ—©åœ¨1997å¹´å°±åœ¨è®ºæ–‡ã€ŠConsistent hashing and random treesã€‹æå‡ºã€‚</p><p>è®¾è®¡ç›®æ ‡æ˜¯ä¸ºäº†è§£å†³å› ç‰¹ç½‘ä¸­çš„çƒ­ç‚¹(Hot spot)é—®é¢˜ï¼Œç°åœ¨ä¸€è‡´æ€§hashç®—æ³•åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¹Ÿå¾—åˆ°äº†å¹¿æ³›åº”ç”¨ã€‚</p><p>ç¯å½¢hashç©ºé—´</p><p>é€šå¸¸hashç®—æ³•éƒ½æ˜¯å°†valueæ˜ å°„åœ¨ä¸€ä¸ª32ä½çš„keyå€¼å½“ä¸­ã€‚è€Œä¸€è‡´æ€§å“ˆå¸Œåˆ™å°†æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ï¼Œå–å€¼èŒƒå›´æ˜¯ä»0-2^32-1(å³å“ˆå¸Œå€¼æ˜¯ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´å½¢)ã€‚</p><p><img src="http://p1.pstatp.com/large/pgc-image/4e376eff354a46a0bac6a2b1f8e50bc0" alt="Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†"></p><p>æŠŠå¯¹è±¡æ˜ å°„åˆ°hashç©ºé—´</p><p>è¿™é‡Œçš„å¯¹è±¡å°±æ˜¯æˆ‘ä»¬çœŸå®å­˜å‚¨çš„æ•°æ®ï¼Œä»¥4ä¸ªä¸ºä¾‹ï¼Œåˆ†åˆ«ä¸ºobject1ï½object4ã€‚é€šè¿‡hashå‡½æ•°è®¡ç®—å‡ºhashå€¼ï¼Œåˆ†åˆ«ä¸ºkey1ï½key4ï¼Œè¿™å››ä¸ªå€¼è‚¯å®šä¼šè½åœ¨ç¯å½¢hashç©ºé—´ä¸Šã€‚</p><p><img src="http://p3.pstatp.com/large/pgc-image/77d8998419c949c6b394b93319181638" alt="Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†"></p><p>æŠŠcacheæ˜ å°„åˆ°hashç©ºé—´</p><p>åŸºæœ¬æ€æƒ³å°±æ˜¯å°†å¯¹è±¡å’Œcacheéƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªhashæ•°å€¼ç©ºé—´ä¸­ï¼Œå¹¶ä¸”ä½¿ç”¨ç›¸åŒçš„hashç®—æ³•ã€‚å³hash(cache A)=key A;</p><p>cacheå°±æ˜¯å®é™…çš„ç¼“å­˜æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œä»¥3ä¸ªä¸ºä¾‹ï¼Œå¯¹cacheçš„hashè®¡ç®—ä¸€èˆ¬çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨cacheçš„æœºå™¨çš„IPåœ°å€æˆ–è€…æœºå™¨åä½œä¸ºhashè¾“å…¥ï¼Œä¹Ÿå¯ä»¥å¼•å…¥æ›´å¤šçš„å› å­ï¼Œæ¯”å¦‚ç«¯å£å·ç­‰ã€‚æœ€ç»ˆcacheé€šè¿‡åŒä¸€ä¸ªhashç®—æ³•ä¹Ÿè½åœ¨å¯¹è±¡æ‰€åœ¨çš„ç›¸åŒçš„ç¯å½¢hashç©ºé—´ä¸Šã€‚</p><p><img src="http://p1.pstatp.com/large/pgc-image/9eaf259bea774ef88d24a3ae4c0caaa8" alt="Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†"></p><p>æŠŠå¯¹è±¡æ˜ å°„åˆ°cache</p><p>æ¥ä¸‹æ¥å°±æ˜¯è¦è€ƒè™‘å¦‚ä½•æŠŠå¯¹è±¡æ˜ å°„åˆ°cacheä¸Šï¼Œå…·ä½“çš„åšæ³•å°±æ˜¯æ‰¾åˆ°å¯¹è±¡æ‰€åœ¨ç¯å½¢ç©ºé—´çš„ä½ç½®ï¼Œé¡ºæ—¶é’ˆå‡ºå‘ï¼Œç¢°åˆ°çš„ç¬¬ä¸€ä¸ªcacheèŠ‚ç‚¹å°±ä½œä¸ºè¯¥å¯¹è±¡çš„å­˜å‚¨èŠ‚ç‚¹ã€‚å› ä¸ºå¯¹è±¡çš„hashå’Œcacheçš„hashéƒ½æ˜¯å›ºå®šçš„ï¼Œå› æ­¤æŸä¸ªå¯¹è±¡å­˜å‚¨çš„cacheå¿…ç„¶æ˜¯å”¯ä¸€å¹¶ä¸”ç¡®å®šçš„ã€‚è¿™æ ·å°±æ‰¾åˆ°äº†æ•°æ®æ˜ å°„åˆ°cacheçš„ä¸€ä¸ªæ–¹æ¡ˆ(å¦‚å›¾è™šçº¿ç®­å¤´æ‰€ç¤º)ã€‚</p><p><img src="http://p1.pstatp.com/large/pgc-image/15184dd52ab0450bbe4f683330d00f1d" alt="Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†"></p><p>ç§»é™¤Cache</p><p>åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­é€šå¸¸å¯¹cacheèŠ‚ç‚¹ä¼šæœ‰æ‰€è°ƒæ•´ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯å¦‚ä½•å¤„ç†çš„ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬ç§»é™¤cache Bï¼Œæ­¤æ—¶åªæœ‰object4æ— æ³•å‘½ä¸­ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥é€šè¿‡è¿™ä¸ªç®—æ³•ç»§ç»­æ‰¾åˆ°æ–°çš„cacheèŠ‚ç‚¹cache Cï¼Œobject4å°±ä¼šå­˜å‚¨åˆ°cache Cä¸Šã€‚æ‰€ä»¥å¯¹äºç§»é™¤cache Bæ¥è¯´ï¼Œå®ƒå½±å“çš„èŒƒå›´ä»…ä»…æ˜¯å®ƒå’Œé€†æ—¶é’ˆåˆ°è¾¾çš„ç¬¬ä¸€ä¸ªcahceèŠ‚ç‚¹å³cache Aä¹‹é—´çš„æ•°æ®(å¦‚å›¾æ‰€ç¤ºçš„é€æ˜åŒºåŸŸ)ï¼Œå¯¹äºç¯å½¢çš„å…¶ä»–æ•°æ®èŠ‚ç‚¹éƒ½ä¸ä¼šå½±å“ï¼Œå½±å“èŒƒå›´æ˜¯éå¸¸å°çš„ã€‚</p><p><img src="http://p3.pstatp.com/large/pgc-image/3c8b3b6fba8d49dbbf362ae0c4188e6c" alt="Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†"></p><p>æ·»åŠ Cache</p><p>æ¯”å¦‚æˆ‘ä»¬åœ¨cache Bå’Œcache Cä¹‹é—´æ–°å¢äº†ä¸€ä¸ªcache Dï¼Œç›¸åº”çš„object2å°±å¾—æ›´æ¢å­˜å‚¨çš„cacheèŠ‚ç‚¹ï¼Œè¿æ¥åˆ°äº†æ–°çš„cache Dä¸Šã€‚å¯¹äºæ·»åŠ çš„cache Då…¶å½±å“çš„èŒƒå›´æ˜¯å®ƒå’Œé€†æ—¶é’ˆåˆ°è¾¾çš„ç¬¬ä¸€ä¸ªcahceèŠ‚ç‚¹å³cache Bä¹‹é—´çš„æ•°æ®(å¦‚å›¾æ‰€ç¤ºçš„é€æ˜åŒºåŸŸ)ã€‚</p><p>æ‰€ä»¥å¯¹äºcacheå˜åŠ¨ï¼Œæ— è®ºæ˜¯æ·»åŠ cacheèŠ‚ç‚¹è¿˜æ˜¯åˆ é™¤cacheèŠ‚ç‚¹ï¼Œå®ƒå½±å“çš„èŒƒå›´éƒ½æ˜¯å¾ˆå°çš„ã€‚å½“ç„¶è¿™é‡Œè¿˜æœ‰ä¼˜åŒ–çš„ç©ºé—´ã€‚</p><p><img src="http://p3.pstatp.com/large/pgc-image/e5283deee7c4404a95912c30211cc2ef" alt="Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†"></p><p>ç†æƒ³ä¸ç°å®</p><p>ç†æƒ³éå¸¸ä¸°æ»¡ï¼Œç°å®éå¸¸éª¨æ„Ÿã€‚å·¦å›¾å°±æ˜¯ç†æƒ³ä¸­çš„æƒ…å†µï¼ŒAã€Bã€CèŠ‚ç‚¹åˆ†å¸ƒçš„éå¸¸å‡åŒ€ã€‚è€Œç°å®å‘¢æœ‰å¯èƒ½æ˜¯å³å›¾è¿™æ ·ï¼Œæ˜¾ç„¶å¤§é‡çš„æ•°æ®éƒ½ä¼šè½åœ¨AèŠ‚ç‚¹ä¸Šï¼ŒBå’ŒCèŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®ä¼šè¾ƒå°‘ï¼Œå¦‚æœè€ƒè™‘éšæœºæ€§è€Œè¨€çš„è¯ã€‚è¿™æ ·ä¼šå¯¼è‡´AèŠ‚ç‚¹æœåŠ¡å™¨å¾ˆå¿™ï¼Œè´Ÿè½½å¾ˆé«˜ï¼Œè€ŒBã€Cæ¯”è¾ƒæ¸…é—²ã€‚è¿™æ˜¯ç”±äºhashçš„å€¾æ–œæ€§å¯¼è‡´çš„ã€‚</p><p><img src="http://p1.pstatp.com/large/pgc-image/07af49263577407fbc217d3bb14af59a" alt="Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†"></p><p>Hashå€¾æ–œæ€§</p><p>å‡è®¾æœ‰6ä¸ªæ•°æ®ï¼Œå®ƒä»¬æ˜¯éšæœºå‡åŒ€åˆ†å¸ƒåœ¨ç¯å½¢hashç©ºé—´ä¸Šï¼Œè€Œcacheçš„åˆ†å¸ƒåˆ™æ¯”è¾ƒç´§å¯†ã€‚é‚£ä¹ˆæ ¹æ®è¿™ä¸ªç®—æ³•è§„åˆ™æ•°æ®1ã€2ã€3ã€4ã€6åˆ™éƒ½æ˜¯å­˜å‚¨åœ¨AèŠ‚ç‚¹ä¸Šï¼Œ5å­˜å‚¨åœ¨BèŠ‚ç‚¹ä¸Šï¼ŒCèŠ‚ç‚¹æ²¡æœ‰æ•°æ®ã€‚è¿™å°±æ˜¯hashå€¾æ–œæ€§ã€‚hashå€¾æ–œæ€§å¯¼è‡´äº†Aã€Bã€Cè¿™ä¸‰ä¸ªèŠ‚ç‚¹è´Ÿè½½ã€æ€§èƒ½éƒ½ä¸å‡åŒ€ã€‚</p><p><img src="http://p1.pstatp.com/large/pgc-image/c494664fad3d414f993c29bed31ab4b6" alt="Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†"></p><p>è™šæ‹ŸèŠ‚ç‚¹</p><p>ä¸ºäº†è§£å†³hashå€¾æ–œæ€§å¸¦æ¥çš„é—®é¢˜ï¼Œåœ¨è¿™ä¸ªç®—æ³•ä¸­å°±å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹ã€‚æ¥çœ‹ä¸€ä¸‹è™šæ‹ŸèŠ‚ç‚¹çš„ç®—æ³•åŸç†ã€‚</p><p>å‡è®¾æœ‰ä¸¤ä¸ªæ•°æ®object1å’Œobject2ï¼Œå¯¹å®ƒä»¬è¿›è¡Œhashï¼Œæˆ‘ä»¬å¢åŠ äº†6ä¸ªè™šæ‹ŸèŠ‚ç‚¹åˆ†åˆ«ä¸ºv1ï½v6ï¼Œä¸¤ä¸ªå¯¹è±¡hashä¹‹ååˆ†åˆ«è½åˆ°äº†v2å’Œv5è™šæ‹ŸèŠ‚ç‚¹ä¸Šï¼Œç„¶åå¯¹è™šæ‹ŸèŠ‚ç‚¹è¿›è¡Œrehashï¼Œæ­¤æ—¶v1ã€v2æ˜ å°„åˆ°äº†N1è¿™ä¸ªçœŸå®èŠ‚ç‚¹ä¸Šï¼Œv3ã€v4æ˜ å°„åˆ°äº†N2èŠ‚ç‚¹ä¸Šï¼Œv5ã€v6æ˜ å°„åˆ°äº†N3èŠ‚ç‚¹ä¸Šã€‚é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹æŠŠçœŸå®çš„æœåŠ¡å™¨èŠ‚ç‚¹è¿›è¡Œæ”¾å¤§ï¼Œæœ€ç»ˆobject1å­˜å‚¨åˆ°äº†N1èŠ‚ç‚¹ä¸Šï¼Œobject2å­˜åœ¨äº†N3èŠ‚ç‚¹ä¸Šã€‚</p><p>å…¶å·¥ä½œåŸç†å°±æ˜¯å°†ä¸€ä¸ªç‰©ç†èŠ‚ç‚¹æ‹†åˆ†ä¸ºå¤šä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹¶ä¸”åŒä¸€ä¸ªç‰©ç†èŠ‚ç‚¹çš„è™šæ‹ŸèŠ‚ç‚¹å°½é‡å‡åŒ€åˆ†å¸ƒåœ¨Hashç¯ä¸Šã€‚é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹å°±è§£å†³äº†æœåŠ¡èŠ‚ç‚¹å°‘æ—¶æ•°æ®å€¾æ–œçš„é—®é¢˜ã€‚</p><p><img src="http://p1.pstatp.com/large/pgc-image/74d611a1fdbd4d98a3dba5095759d090" alt="Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†"></p><p>è§£å†³hashå€¾æ–œæ€§</p><p>å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹åï¼Œå¯¹hashå€¾æ–œæ€§çš„è§£å†³æ–¹æ¡ˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p><p>æ¯”å¦‚æˆ‘ä»¬å¢åŠ äº†6ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œè¿™6ä¸ªè™šæ‹ŸèŠ‚ç‚¹æœ€ç»ˆæ˜ å°„åˆ°äº†3å°çœŸå®çš„cacheèŠ‚ç‚¹ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚æˆ‘ä»¬å¯¹æ•°æ®è¿›è¡Œhashåè½åœ¨äº†ç¯å½¢ç©ºé—´ä¸Šï¼Œé€šè¿‡ç®—æ³•è§„åˆ™æœ€ç»ˆ1ã€3æ•°æ®è½åœ¨Aä¸Šï¼Œ4ã€5è½åœ¨Bä¸Šï¼Œ2ã€6è½åœ¨CèŠ‚ç‚¹ä¸Šã€‚ ç›¸å¯¹å‡åŒ€äº†ä¸€äº›ã€‚</p><p>ä½†æ˜¯è™šæ‹ŸèŠ‚ç‚¹åœ¨rehashæ—¶ä¹Ÿå­˜åœ¨hashå€¾æ–œæ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´è™šæ‹ŸèŠ‚ç‚¹çš„æ•°é‡ï¼ŒæŠŠçœŸå®èŠ‚ç‚¹å’Œè™šæ‹ŸèŠ‚ç‚¹åˆ†é…ä¸€ä¸ªè‰¯å¥½çš„æ¯”ä¾‹ï¼Œå¯ä»¥æƒ³åƒçœŸå®èŠ‚ç‚¹å’ŒçœŸå®èŠ‚ç‚¹é—´éƒ½å­˜åœ¨å¤§é‡çš„è™šæ‹ŸèŠ‚ç‚¹ï¼Œéšç€èŠ‚ç‚¹è¶Šæ¥è¶Šå¤šï¼Œæ•°æ®è¶Šæ¥è¶Šå¤šï¼Œé‚£ä¹ˆåˆ†å¸ƒä¼šè¶Šæ¥è¶Šå‡åŒ€ã€‚å¹¶ä¸”åœ¨æ·»åŠ èŠ‚ç‚¹å’Œåˆ é™¤èŠ‚ç‚¹æ—¶å½±å“ä¹Ÿä¼šé™åˆ°æœ€ä½ã€‚</p><p><img src="http://p1.pstatp.com/large/pgc-image/853613571d79414595160f0e76fbb85c" alt="Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†"></p><p>å‘½ä¸­ç‡è®¡ç®—</p><p>å‘½ä¸­ç‡è®¡ç®—å…¬å¼ï¼š(1-n/(n + m)) * 100%</p><p>nï¼šæœåŠ¡å™¨å°æ•°</p><p>mï¼šæœåŠ¡å™¨å˜åŠ¨å°æ•°</p><p>å¯ä»¥çœ‹å‡ºå½“å˜åŠ¨çš„æœåŠ¡å™¨å°æ•°è¶Šå¤§ï¼Œå‘½ä¸­ç‡å°±ä¼šè¶Šå¤§ã€‚æ‰€ä»¥å½±å“å°±ä¼šè¶Šæ¥è¶Šå°ã€‚éšç€åˆ†å¸ƒå¼é›†ç¾¤ä¸æ–­æ‰©å¤§æ—¶ï¼Œè¿™ä¸ªç®—æ³•çš„ä¼˜ç‚¹å°±ä¼šå¾ˆè‡ªç„¶çš„è¿¸å‘å‡ºæ¥ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•é¦–å…ˆå°†æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´(0-2^32-1)ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ï¼Œç„¶åå°†å­˜å‚¨å¯¹è±¡è¿›è¡Œhashï¼Œå¾—åˆ°çš„å€¼æ˜ å°„åˆ°åœ†ç¯ç©ºé—´ä¸Šã€‚ç„¶åä½¿ç”¨ç›¸åŒçš„hashç®—æ³•å¯¹cacheæœåŠ¡å™¨èŠ‚ç‚¹è¿›è¡Œhashï¼Œå¹¶æ˜ å°„åˆ°ç›¸åŒçš„åœ†ç¯ä¸Šã€‚ç„¶åä»æ•°æ®æ˜ å°„åˆ°çš„ä½ç½®å¼€å§‹é¡ºæ—¶é’ˆæŸ¥æ‰¾ï¼Œå°†æ•°æ®ä¿å­˜åˆ°æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šã€‚</p><p>Consistent hashingå·²ç»æœ€å¤§é™åº¦çš„æŠ‘åˆ¶äº†é”®çš„é‡æ–°åˆ†å¸ƒï¼Œè€Œä¸”è¿˜å¯ä»¥é‡‡ç”¨è™šæ‹ŸèŠ‚ç‚¹çš„æ€æƒ³è®©æ¯ä¸ªå®é™…èŠ‚ç‚¹éƒ½é…ç½®100-500ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œè¿™æ ·å°±èƒ½æŠ‘åˆ¶åˆ†å¸ƒä¸å‡åŒ€äº†ã€‚åŒæ—¶è¿™ä¸ªç®—æ³•å·²ç»æœ€å¤§é™åº¦çš„å‡å°äº†æœåŠ¡å™¨å¢å‡æ—¶çš„ç¼“å­˜é‡æ–°åˆ†å¸ƒã€‚</p>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisåˆ†å¸ƒå¼Javaå®ç°</title>
      <link href="/2020/04/27/Redis%E5%88%86%E5%B8%83%E5%BC%8FJava%E5%AE%9E%E7%8E%B0/"/>
      <url>/2020/04/27/Redis%E5%88%86%E5%B8%83%E5%BC%8FJava%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>Redisåˆ†å¸ƒå¼Javaå®ç°</p><p>ä¸€ã€å•ç‚¹ç™»å½•Rediså­˜å‚¨Sessionå’ŒCookieé—®é¢˜è¯´æ˜ä¸é›†ç¾¤å®æˆ˜</p><h4 id="1ã€è§£å†³Cookieé—®é¢˜è¯»å†™sessionIdé—®é¢˜ï¼š"><a href="#1ã€è§£å†³Cookieé—®é¢˜è¯»å†™sessionIdé—®é¢˜ï¼š" class="headerlink" title="1ã€è§£å†³Cookieé—®é¢˜è¯»å†™sessionIdé—®é¢˜ï¼š"></a>1ã€è§£å†³Cookieé—®é¢˜è¯»å†™sessionIdé—®é¢˜ï¼š</h4><p>å°è£…CookieUtilå¤„ç†å¯¹Cookieçš„è¯»å†™æ“ä½œï¼ŒCOOKIE_DOMAINå‚æ•°ç”¨é™å®šè¯»å†™èŒƒå›´ï¼Œbytenote.cnçš„äºŒçº§åŸŸåä¸‹å¦‚mmall.byte.cnéƒ½å¯ä»¥è¯»å–åˆ°Cookieã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mmall.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by chenyawei on 2019/4/21.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CookieUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String COOKIE_DOMAIN = <span class="string">"bytenote.cn"</span>; <span class="comment">// "localhost"; //".happymmall.com";</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String COOKIE_NAME = <span class="string">"mmall_login_token"</span>;<span class="comment">//å®¢æˆ·ç«¯ç§åˆ°æœåŠ¡ç«¯çš„Cookieåå­—</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">readLoginToken</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        Cookie[] cks = request.getCookies();</span><br><span class="line">        <span class="keyword">if</span> (cks != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Cookie ck : cks) &#123;</span><br><span class="line">                log.info(<span class="string">"read cookieName:&#123;&#125;,cookieValue:&#123;&#125;"</span>, ck.getName(), ck.getValue());</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.equals(ck.getName(), COOKIE_NAME)) &#123;</span><br><span class="line">                    log.info(<span class="string">"return cookieName:&#123;&#125;,cookieValue:&#123;&#125;"</span>, ck.getName(), ck.getValue());</span><br><span class="line">                    <span class="keyword">return</span> ck.getValue();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//X:domain=".happymmall.com"</span></span><br><span class="line">    <span class="comment">//a:A.happymmall.com            cookie:domain=A.happymmall.com;path="/"</span></span><br><span class="line">    <span class="comment">//b:B.happymmall.com            cookie:domain=B.happymmall.com;path="/"</span></span><br><span class="line">    <span class="comment">//c:A.happymmall.com/test/cc    cookie:domain=A.happymmall.com;path="/test/cc"</span></span><br><span class="line">    <span class="comment">//d:A.happymmall.com/test/dd    cookie:domain=A.happymmall.com;path="/test/dd"</span></span><br><span class="line">    <span class="comment">//e:A.happymmall.com/test       cookie:domain=A.happymmall.com;path="/test"</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeLoginToken</span><span class="params">(HttpServletResponse response, String token)</span> </span>&#123;</span><br><span class="line">        Cookie ck = <span class="keyword">new</span> Cookie(COOKIE_NAME, token);</span><br><span class="line">        ck.setDomain(COOKIE_DOMAIN);</span><br><span class="line">        ck.setPath(<span class="string">"/"</span>);<span class="comment">//ä»£è¡¨è®¾ç½®åœ¨æ ¹ç›®å½•</span></span><br><span class="line">        ck.setHttpOnly(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//å•ä½æ˜¯ç§’ã€‚</span></span><br><span class="line">        <span class="comment">//å¦‚æœè¿™ä¸ªmaxageä¸è®¾ç½®çš„è¯ï¼Œcookieå°±ä¸ä¼šå†™å…¥ç¡¬ç›˜ï¼Œè€Œæ˜¯å†™åœ¨å†…å­˜ã€‚åªåœ¨å½“å‰é¡µé¢æœ‰æ•ˆã€‚</span></span><br><span class="line">        ck.setMaxAge(<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">365</span>);<span class="comment">//å¦‚æœæ˜¯-1ï¼Œä»£è¡¨æ°¸ä¹…</span></span><br><span class="line">        log.info(<span class="string">"write cookieName:&#123;&#125;,cookieValue:&#123;&#125;"</span>, ck.getName(), ck.getValue());</span><br><span class="line">        response.addCookie(ck);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">delLoginToken</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        Cookie[] cks = request.getCookies();</span><br><span class="line">        <span class="keyword">if</span> (cks != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Cookie ck : cks) &#123;</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.equals(ck.getName(), COOKIE_NAME)) &#123;</span><br><span class="line">                    ck.setDomain(COOKIE_DOMAIN);</span><br><span class="line">                    ck.setPath(<span class="string">"/"</span>);</span><br><span class="line">                    ck.setMaxAge(<span class="number">0</span>);<span class="comment">//è®¾ç½®æˆ0ï¼Œä»£è¡¨åˆ é™¤æ­¤cookieã€‚</span></span><br><span class="line">                    log.info(<span class="string">"del cookieName:&#123;&#125;,cookieValue:&#123;&#125;"</span>, ck.getName(), ck.getValue());</span><br><span class="line">                    response.addCookie(ck);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™æ“ä½œï¼š<strong>CookieUtil.writeLoginToken</strong>(httpServletResponse, session.getId());//ä¿å­˜redisçš„keyå€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"login.do"</span>, method = RequestMethod.POST)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;User&gt; <span class="title">login</span><span class="params">(String username, String password, HttpSession session, HttpServletResponse httpServletResponse, HttpServletRequest httpServletRequest)</span> </span>&#123;</span><br><span class="line">    ServerResponse&lt;User&gt; response = iUserService.login(username, password);</span><br><span class="line">    <span class="keyword">if</span> (response.isSuccess()) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//session.setAttribute(Const.CURRENT_USER,response.getData());</span></span><br><span class="line">        CookieUtil.writeLoginToken(httpServletResponse, session.getId());<span class="comment">//ä¿å­˜redisçš„keyå€¼</span></span><br><span class="line">        RedisShardedPoolUtil.setEx(session.getId(), JsonUtil.obj2String(response.getData()), Const.RedisCacheExtime.REDIS_SESSION_EXTIME);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯»æ“ä½œï¼šString loginToken = <strong>CookieUtil.readLoginToken</strong>(httpServletRequest);</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"get_user_info.do"</span>,method = RequestMethod.POST)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;User&gt; <span class="title">getUserInfo</span><span class="params">(HttpServletRequest httpServletRequest)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    String loginToken = CookieUtil.readLoginToken(httpServletRequest);</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isEmpty(loginToken))&#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"ç”¨æˆ·æœªç™»å½•,æ— æ³•è·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    String userJsonStr = RedisShardedPoolUtil.get(loginToken);</span><br><span class="line">    User user = JsonUtil.string2Obj(userJsonStr,User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(user != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createBySuccess(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"ç”¨æˆ·æœªç™»å½•,æ— æ³•è·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2ã€å•ç‚¹ç™»å½•ä¹‹SessionExpireFilteré‡ç½®sessionæœ‰æ•ˆæœŸï¼š"><a href="#2ã€å•ç‚¹ç™»å½•ä¹‹SessionExpireFilteré‡ç½®sessionæœ‰æ•ˆæœŸï¼š" class="headerlink" title="2ã€å•ç‚¹ç™»å½•ä¹‹SessionExpireFilteré‡ç½®sessionæœ‰æ•ˆæœŸï¼š"></a>2ã€å•ç‚¹ç™»å½•ä¹‹SessionExpireFilteré‡ç½®sessionæœ‰æ•ˆæœŸï¼š</h4><p>//å¦‚æœuserä¸ä¸ºç©ºï¼Œåˆ™é‡ç½®sessionçš„æ—¶é—´ï¼Œå³è°ƒç”¨expireå‘½ä»¤<br>RedisShardedPoolUtil.expire(loginToken, Const.RedisCacheExtime.REDIS_SESSION_EXTIME);</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mmall.controller.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mmall.common.Const;</span><br><span class="line"><span class="keyword">import</span> com.mmall.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.mmall.util.CookieUtil;</span><br><span class="line"><span class="keyword">import</span> com.mmall.util.JsonUtil;</span><br><span class="line"><span class="keyword">import</span> com.mmall.util.RedisShardedPoolUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020-04-20  11:56</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionExpireFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest httpServletRequest = (HttpServletRequest)servletRequest;</span><br><span class="line"></span><br><span class="line">        String loginToken = CookieUtil.readLoginToken(httpServletRequest);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(loginToken))&#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­logintokenæ˜¯å¦ä¸ºç©ºæˆ–è€…""ï¼›</span></span><br><span class="line">            <span class="comment">//å¦‚æœä¸ä¸ºç©ºçš„è¯ï¼Œç¬¦åˆæ¡ä»¶ï¼Œç»§ç»­æ‹¿userä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">            String userJsonStr = RedisShardedPoolUtil.get(loginToken);</span><br><span class="line">            User user = JsonUtil.string2Obj(userJsonStr,User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            <span class="keyword">if</span>(user != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">//å¦‚æœuserä¸ä¸ºç©ºï¼Œåˆ™é‡ç½®sessionçš„æ—¶é—´ï¼Œå³è°ƒç”¨expireå‘½ä»¤</span></span><br><span class="line">                RedisShardedPoolUtil.expire(loginToken, Const.RedisCacheExtime.REDIS_SESSION_EXTIME);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨web.xmlä¸­æ·»åŠ é…ç½®ï¼šå‡¡æ˜¯ä»¥*.doç»“å°¾çš„å°±é‡ç½®sessionç»“æŸæ—¶é—´(å³é‡ç½®redisæ—¶é—´)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- äºŒæœŸæ–°å¢é‡ç½®sessionæ—¶é—´çš„filter --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>sessionExpireFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.mmall.controller.common.SessionExpireFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>sessionExpireFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2ã€Redisåˆ†å¸ƒå¼ç¼“å­˜ç¯å¢ƒæ­å»º</p><p>å°è£…åˆ†å¸ƒå¼è¿æ¥æ± RedisShardedPool</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mmall.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mmall.util.PropertiesUtil;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisShardInfo;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.ShardedJedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.ShardedJedisPool;</span><br><span class="line"><span class="keyword">import</span> redis.clients.util.Hashing;</span><br><span class="line"><span class="keyword">import</span> redis.clients.util.Sharded;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by chenyawei on 2019/3/10.</span></span><br><span class="line"><span class="comment"> * redisåˆ†å¸ƒå¼è¿æ¥æ± </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisShardedPool</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ShardedJedisPool pool;<span class="comment">//sharded jedisè¿æ¥æ± </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer maxTotal = Integer.parseInt(PropertiesUtil.getProperty(<span class="string">"redis.max.total"</span>, <span class="string">"20"</span>)); <span class="comment">//æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer maxIdle = Integer.parseInt(PropertiesUtil.getProperty(<span class="string">"redis.max.idle"</span>, <span class="string">"20"</span>));<span class="comment">//åœ¨jedispoolä¸­æœ€å¤§çš„idleçŠ¶æ€(ç©ºé—²çš„)çš„jediså®ä¾‹çš„ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer minIdle = Integer.parseInt(PropertiesUtil.getProperty(<span class="string">"redis.min.idle"</span>, <span class="string">"20"</span>));<span class="comment">//åœ¨jedispoolä¸­æœ€å°çš„idleçŠ¶æ€(ç©ºé—²çš„)çš„jediså®ä¾‹çš„ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Boolean testOnBorrow = Boolean.parseBoolean(PropertiesUtil.getProperty(<span class="string">"redis.test.borrow"</span>, <span class="string">"true"</span>));<span class="comment">//åœ¨borrowä¸€ä¸ªjediså®ä¾‹çš„æ—¶å€™ï¼Œæ˜¯å¦è¦è¿›è¡ŒéªŒè¯æ“ä½œï¼Œå¦‚æœèµ‹å€¼trueã€‚åˆ™å¾—åˆ°çš„jediså®ä¾‹è‚¯å®šæ˜¯å¯ä»¥ç”¨çš„ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Boolean testOnReturn = Boolean.parseBoolean(PropertiesUtil.getProperty(<span class="string">"redis.test.return"</span>, <span class="string">"true"</span>));<span class="comment">//åœ¨returnä¸€ä¸ªjediså®ä¾‹çš„æ—¶å€™ï¼Œæ˜¯å¦è¦è¿›è¡ŒéªŒè¯æ“ä½œï¼Œå¦‚æœèµ‹å€¼trueã€‚åˆ™æ”¾å›jedispoolçš„jediså®ä¾‹è‚¯å®šæ˜¯å¯ä»¥ç”¨çš„ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String redis1Ip = PropertiesUtil.getProperty(<span class="string">"redis1.ip"</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer redis1Port = Integer.parseInt(PropertiesUtil.getProperty(<span class="string">"redis1.port"</span>));</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String redis2Ip = PropertiesUtil.getProperty(<span class="string">"redis2.ip"</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer redis2Port = Integer.parseInt(PropertiesUtil.getProperty(<span class="string">"redis2.port"</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line"></span><br><span class="line">        config.setMaxTotal(maxTotal);</span><br><span class="line">        config.setMaxIdle(maxIdle);</span><br><span class="line">        config.setMinIdle(minIdle);</span><br><span class="line"></span><br><span class="line">        config.setTestOnBorrow(testOnBorrow);</span><br><span class="line">        config.setTestOnReturn(testOnReturn);</span><br><span class="line"></span><br><span class="line">        config.setBlockWhenExhausted(<span class="keyword">true</span>);<span class="comment">//è¿æ¥è€—å°½çš„æ—¶å€™ï¼Œæ˜¯å¦é˜»å¡ï¼Œfalseä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œtrueé˜»å¡ç›´åˆ°è¶…æ—¶ã€‚é»˜è®¤ä¸ºtrueã€‚</span></span><br><span class="line"></span><br><span class="line">        JedisShardInfo info1 = <span class="keyword">new</span> JedisShardInfo(redis1Ip, redis1Port, <span class="number">1000</span> * <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        JedisShardInfo info2 = <span class="keyword">new</span> JedisShardInfo(redis2Ip, redis2Port, <span class="number">1000</span> * <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;JedisShardInfo&gt; jedisShardInfoList = <span class="keyword">new</span> ArrayList&lt;JedisShardInfo&gt;(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        jedisShardInfoList.add(info1);</span><br><span class="line">        jedisShardInfoList.add(info2);</span><br><span class="line"></span><br><span class="line">        pool = <span class="keyword">new</span> ShardedJedisPool(config, jedisShardInfoList, Hashing.MURMUR_HASH, Sharded.DEFAULT_KEY_TAG_PATTERN);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        initPool();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ShardedJedis <span class="title">getJedis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pool.getResource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">returnBrokenResource</span><span class="params">(ShardedJedis jedis)</span> </span>&#123;</span><br><span class="line">        pool.returnBrokenResource(jedis);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">returnResource</span><span class="params">(ShardedJedis jedis)</span> </span>&#123;</span><br><span class="line">        pool.returnResource(jedis);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ShardedJedis jedis = pool.getResource();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            jedis.set(<span class="string">"key"</span> + i, <span class="string">"value"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        returnResource(jedis);</span><br><span class="line"><span class="comment">//      pool.destroy();//ä¸´æ—¶è°ƒç”¨ï¼Œé”€æ¯è¿æ¥æ± ä¸­çš„æ‰€æœ‰è¿æ¥</span></span><br><span class="line">        System.out.println(<span class="string">"program is end"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°è£…Redisåˆ†å¸ƒå¼è¯»å†™å·¥å…·RedisShardedPoolUtilï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mmall.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mmall.common.RedisPool;</span><br><span class="line"><span class="keyword">import</span> com.mmall.common.RedisShardedPool;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.ShardedJedis;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by chenyawei on 2019/3/10.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisShardedPoolUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®keyçš„æœ‰æ•ˆæœŸï¼Œå•ä½æ˜¯ç§’</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exTime</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">expire</span><span class="params">(String key,<span class="keyword">int</span> exTime)</span></span>&#123;</span><br><span class="line">        ShardedJedis jedis = <span class="keyword">null</span>;</span><br><span class="line">        Long result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jedis = RedisShardedPool.getJedis();</span><br><span class="line">            result = jedis.expire(key,exTime);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"expire key:&#123;&#125; error"</span>,key,e);</span><br><span class="line">            RedisShardedPool.returnBrokenResource(jedis);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        RedisShardedPool.returnResource(jedis);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//exTimeçš„å•ä½æ˜¯ç§’</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">setEx</span><span class="params">(String key,String value,<span class="keyword">int</span> exTime)</span></span>&#123;</span><br><span class="line">        ShardedJedis jedis = <span class="keyword">null</span>;</span><br><span class="line">        String result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jedis = RedisShardedPool.getJedis();</span><br><span class="line">            result = jedis.setex(key,exTime,value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"setex key:&#123;&#125; value:&#123;&#125; error"</span>,key,value,e);</span><br><span class="line">            RedisShardedPool.returnBrokenResource(jedis);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        RedisShardedPool.returnResource(jedis);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">set</span><span class="params">(String key,String value)</span></span>&#123;</span><br><span class="line">        ShardedJedis jedis = <span class="keyword">null</span>;</span><br><span class="line">        String result = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jedis = RedisShardedPool.getJedis();</span><br><span class="line">            result = jedis.set(key,value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"set key:&#123;&#125; value:&#123;&#125; error"</span>,key,value,e);</span><br><span class="line">            RedisShardedPool.returnBrokenResource(jedis);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        RedisShardedPool.returnResource(jedis);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSet</span><span class="params">(String key,String value)</span></span>&#123;</span><br><span class="line">        ShardedJedis jedis = <span class="keyword">null</span>;</span><br><span class="line">        String result = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jedis = RedisShardedPool.getJedis();</span><br><span class="line">            result = jedis.getSet(key,value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"getset key:&#123;&#125; value:&#123;&#125; error"</span>,key,value,e);</span><br><span class="line">            RedisShardedPool.returnBrokenResource(jedis);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        RedisShardedPool.returnResource(jedis);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">get</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        ShardedJedis jedis = <span class="keyword">null</span>;</span><br><span class="line">        String result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jedis = RedisShardedPool.getJedis();</span><br><span class="line">            result = jedis.get(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"get key:&#123;&#125; error"</span>,key,e);</span><br><span class="line">            RedisShardedPool.returnBrokenResource(jedis);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        RedisShardedPool.returnResource(jedis);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">del</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        ShardedJedis jedis = <span class="keyword">null</span>;</span><br><span class="line">        Long result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jedis = RedisShardedPool.getJedis();</span><br><span class="line">            result = jedis.del(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"del key:&#123;&#125; error"</span>,key,e);</span><br><span class="line">            RedisShardedPool.returnBrokenResource(jedis);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        RedisShardedPool.returnResource(jedis);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">setnx</span><span class="params">(String key,String value)</span></span>&#123;</span><br><span class="line">        ShardedJedis jedis = <span class="keyword">null</span>;</span><br><span class="line">        Long result = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jedis = RedisShardedPool.getJedis();</span><br><span class="line">            result = jedis.setnx(key,value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"setnx key:&#123;&#125; value:&#123;&#125; error"</span>,key,value,e);</span><br><span class="line">            RedisShardedPool.returnBrokenResource(jedis);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        RedisShardedPool.returnResource(jedis);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ShardedJedis shardedJedis = RedisShardedPool.getJedis();</span><br><span class="line"></span><br><span class="line">        RedisShardedPoolUtil.set(<span class="string">"keyTest"</span>,<span class="string">"value"</span>);</span><br><span class="line"></span><br><span class="line">        String value = RedisShardedPoolUtil.get(<span class="string">"keyTest"</span>);</span><br><span class="line"></span><br><span class="line">        RedisShardedPoolUtil.setEx(<span class="string">"keyex"</span>,<span class="string">"valueex"</span>,<span class="number">60</span>*<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        RedisShardedPoolUtil.expire(<span class="string">"keyTest"</span>,<span class="number">60</span>*<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        RedisShardedPoolUtil.del(<span class="string">"keyTest"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String aaa = RedisShardedPoolUtil.get(<span class="keyword">null</span>);</span><br><span class="line">        System.out.println(aaa);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"end"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> [object Object] </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx+TomcatæœåŠ¡é›†ç¾¤</title>
      <link href="/2020/04/27/Nginx-Tomcat%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4/"/>
      <url>/2020/04/27/Nginx-Tomcat%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘ç»œåŸºç¡€çŸ¥è¯†è®²è§£</title>
      <link href="/2020/04/27/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E8%AE%B2%E8%A7%A3/"/>
      <url>/2020/04/27/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E8%AE%B2%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8h8ax39cj32l80o04qp.jpg" alt="image-20200316174438683"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8h8h4v7cj31q50u0npe.jpg" alt="image-20200316174402063"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8h8toc81j31rm0u0x6q.jpg" alt="image-20200316174043112"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8h8vnfmxj31ac0u0e81.jpg" alt="image-20200316174506278"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8h94ojhkj31h80u0gxv.jpg" alt="image-20200316174625567"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8h97hyp3j311g0u04g6.jpg" alt="image-20200316174730148"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8h9boumlj31lp0u0x30.jpg" alt="image-20200316174952517"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8h9cpkq3j319a0u0e5z.jpg" alt="image-20200316175220073"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8h9j4wybj313o0u0nlf.jpg" alt="image-20200316175530832"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8h9p7611j31940u0b2a.jpg" alt="image-20200316175835296"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8h9o435bj318m0u0e81.jpg" alt="image-20200316180331457"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8hawt5mej32320dwapp.jpg" alt="image-20200316180631422"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8h9sgtxfj32a40s47nd.jpg" alt="image-20200316180836831"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8h9u0ro0j32560ringh.jpg" alt="image-20200316180927877"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8h9xanhzj322w0qqnhg.jpg" alt="image-20200316181015865"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8ha2fg3bj318i0u0b2a.jpg" alt="image-20200316181401927"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8ha1brk0j319n0u0qv5.jpg" alt="image-20200316181451239"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8ha8c64qj31uo0s0qfc.jpg" alt="image-20200316181531825"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8ha67da4j322e0f616y.jpg" alt="image-20200316181602432"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8had5fatj324o0rg1e8.jpg" alt="image-20200316181659027"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8haaq8z6j32j80n01kx.jpg" alt="image-20200316181813009"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8hagsayhj32150u011i.jpg" alt="image-20200316183206637"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8hakau1fj31fg0u0azy.jpg" alt="image-20200316185130249"></p>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>socketç›¸å…³</title>
      <link href="/2020/04/15/socket%E7%9B%B8%E5%85%B3/"/>
      <url>/2020/04/15/socket%E7%9B%B8%E5%85%B3/</url>
      
        <content type="html"><![CDATA[<p>ç¼–å†™ä¸€ä¸ªç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯¥å­—ç¬¦ä¸²åå°†å…¶æ‰“å°åˆ°å‘½ä»¤è¡Œä¸Šï¼Œç„¶åå‘å®¢æˆ·ç«¯è¿”å›è¯¥å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæœ€åï¼Œå®¢æˆ·ç«¯è¾“å‡ºè¾“å‡ºæœåŠ¡å™¨ç«¯è¿”å›çš„è¯¥å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œåˆ†åˆ«ç”¨TCPå’ŒUDPä¸¤ç§æ–¹å¼å»å®ç°ï¼Ÿ</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gdua58hlglj30fo06agm2.jpg" alt="image-20200415111442901"></p><p>tcp:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.java.interview.socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020-04-14  18:10</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TCPServer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºsocketï¼Œå¹¶å°†socketç»‘å®šåˆ°65000ç«¯å£</span></span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">65000</span>);</span><br><span class="line">        <span class="comment">//æ­»å¾ªç¯ï¼Œä½¿å¾—socketä¸€ç›´ç­‰å¾…å¹¶å¤„ç†å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="comment">//ç›‘å¬65000ç«¯å£ï¼Œç›´åˆ°å®¢æˆ·ç«¯è¿”å›è¿æ¥ä¿¡æ¯åæ‰è¿”å›</span></span><br><span class="line">            Socket socket = serverSocket.accept();</span><br><span class="line">            <span class="comment">//è·å–å®¢æˆ·ç«¯ç«¯è¯·æ±‚ä¿¡æ¯åï¼Œæ‰§è¡Œç›¸å…³ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">            <span class="keyword">new</span> LengthCalculator(socket).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.java.interview.socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020-04-14  18:09</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> * SOCK_STREAMï¼šè¡¨ç¤ºé¢å‘è¿æ¥çš„æ•°æ®ä¼ è¾“æ–¹å¼ã€‚æ•°æ®å¯ä»¥å‡†ç¡®æ— è¯¯åœ°åˆ°è¾¾å¦ä¸€å°è®¡ç®—æœºï¼Œ</span></span><br><span class="line"><span class="comment"> * å¦‚æœæŸåæˆ–ä¸¢å¤±ï¼Œå¯ä»¥é‡æ–°å‘é€ï¼Œä½†æ•ˆç‡ç›¸å¯¹è¾ƒæ…¢ã€‚å¸¸è§çš„ http åè®®å°±ä½¿ç”¨ SOCK_STREAM ä¼ è¾“æ•°æ®ï¼Œ</span></span><br><span class="line"><span class="comment"> * å› ä¸ºè¦ç¡®ä¿æ•°æ®çš„æ­£ç¡®æ€§ï¼Œå¦åˆ™ç½‘é¡µä¸èƒ½æ­£å¸¸è§£æã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TCPClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºsocket,å¹¶æŒ‡å®šè¿æ¥çš„æ˜¯æœ¬æœºçš„ç«¯å£å·ä¸º65000çš„æœåŠ¡å™¨socket</span></span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket(<span class="string">"127.0.0.1"</span>,<span class="number">65000</span>);</span><br><span class="line">        <span class="comment">//è·å–è¾“å‡ºæµ</span></span><br><span class="line">        OutputStream os = socket.getOutputStream();</span><br><span class="line">        <span class="comment">//è·å–è¾“å…¥æµ</span></span><br><span class="line">        InputStream is = socket.getInputStream();</span><br><span class="line">        <span class="comment">//å°†è¦ä¼ é€’ç»™serverçš„å­—ç¬¦ä¸²å‚æ•°è½¬æ¢æˆbyteæ•°ç»„ï¼Œå¹¶å°†æ•°ç»„å†™å…¥åˆ°è¾“å‡ºæµä¸­</span></span><br><span class="line">        os.write(<span class="keyword">new</span> String(<span class="string">"hello world"</span>).getBytes());</span><br><span class="line">        <span class="keyword">int</span> ch = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] buff = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="comment">//buffä¸»è¦ç”¨æ¥è¯»å–è¾“å…¥çš„å†…å®¹ï¼Œå­˜æˆbyteæ•°ç»„ï¼Œchä¸»è¦ç”¨æ¥è¯»å–æ•°ç»„çš„é•¿åº¦</span></span><br><span class="line">        ch = is.read(buff);</span><br><span class="line">        <span class="comment">//å°†æ¥æ”¶æµçš„byteæ•°ç»„è½¬æ¢å­—ç¬¦ä¸²ï¼Œè¿™é‡Œæ˜¯ä»æœåŠ¡ç«¯å›å‘å›æ¥çš„å­—ç¬¦ä¸²å‚æ•°çš„é•¿åº¦</span></span><br><span class="line">        String content = <span class="keyword">new</span> String(buff,<span class="number">0</span>,ch);</span><br><span class="line">        System.out.println(content);</span><br><span class="line">        <span class="comment">//ä¸è¦å¿˜è®°å…³é—­è¾“å…¥è¾“å‡ºæµä»¥åŠsocket</span></span><br><span class="line">        is.close();</span><br><span class="line">        os.close();</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.java.interview.socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020-04-14  18:16</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LengthCalculator</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ä»¥socketä¸ºæˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LengthCalculator</span><span class="params">(Socket socket)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.socket = socket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è·å–socketç«¯è¾“å‡ºæµ</span></span><br><span class="line">            OutputStream os = socket.getOutputStream();</span><br><span class="line">            <span class="comment">//è·å–socketç«¯è¾“å…¥æµ</span></span><br><span class="line">            InputStream is = socket.getInputStream();</span><br><span class="line">            <span class="keyword">int</span> ch = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">byte</span>[] buff = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="comment">//buffä¸»è¦ç”¨æ¥è¯»å–è¾“å…¥ç«¯å†…å®¹ï¼Œå­˜æˆbyteæ•°ç»„ï¼Œchä¸»è¦ç”¨æ¥è·å–è¯»å–æ•°ç»„çš„é•¿åº¦</span></span><br><span class="line">            ch = is.read(buff);</span><br><span class="line">            <span class="comment">//å°†æ¥æ”¶æµçš„byteæ•°ç»„è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œè¿™é‡Œè·å–çš„ä¸»è¦å†…å®¹æ˜¯å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„å­—ç¬¦ä¸²</span></span><br><span class="line">            String content = <span class="keyword">new</span> String(buff,<span class="number">0</span>,ch);</span><br><span class="line">            System.out.println(content);</span><br><span class="line">            <span class="comment">//å¾€è¾“å‡ºæµé‡Œå†™å…¥è·å¾—çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå›å‘ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">            os.write(String.valueOf(content.length()).getBytes());</span><br><span class="line">            <span class="comment">//å…³é—­æµåŠsocket</span></span><br><span class="line">            is.close();</span><br><span class="line">            os.close();</span><br><span class="line">            socket.close();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>udp:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.java.interview.socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketException;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020-04-14  18:10</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//æœåŠ¡å™¨ç«¯æ¥å—å®¢æˆ·ç«¯å‘é€çš„æ•°æ®æŠ¥</span></span><br><span class="line">        DatagramSocket socket = <span class="keyword">new</span> DatagramSocket(<span class="number">65001</span>);<span class="comment">//ç›‘å¬çš„ç«¯å£å·</span></span><br><span class="line">        <span class="keyword">byte</span>[] buff = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">100</span>];<span class="comment">//å­˜å‚¨ä»å®¢æˆ·ç«¯æ¥å—åˆ°çš„å†…å®¹</span></span><br><span class="line">        DatagramPacket packet = <span class="keyword">new</span> DatagramPacket(buff,buff.length);</span><br><span class="line">        <span class="comment">//æ¥å—å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„å†…å®¹ï¼Œå¹¶å°†å†…å®¹å°è£…è¿›DatagramPacketå¯¹è±¡ä¸­</span></span><br><span class="line">        socket.receive(packet);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] data = packet.getData();<span class="comment">//ä»DatagramPacketå¯¹è±¡ä¸­è·å–åˆ°çœŸæ­£å­˜å‚¨çš„æ•°æ®</span></span><br><span class="line">        <span class="comment">//å°†æ•°æ®ä»äºŒè¿›åˆ¶è½¬æ¢æˆå­—ç¬¦ä¸²å½¢å¼</span></span><br><span class="line">        String content = <span class="keyword">new</span> String(data,<span class="number">0</span>,packet.getLength());</span><br><span class="line">        System.out.println(content);</span><br><span class="line">        <span class="comment">//å°†è¦å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®è½¬æ¢æˆäºŒè¿›åˆ¶</span></span><br><span class="line">        <span class="keyword">byte</span>[] sendedContent = String.valueOf(content.length()).getBytes();</span><br><span class="line">        <span class="comment">//æœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯å‘é€æ•°æ®æŠ¥</span></span><br><span class="line">        <span class="comment">//ä»DatagramPacketå¯¹è±¡ä¸­è·å–åˆ°æ•°æ®ç«¯æ¥æºåœ°å€å’Œç«¯å£å·</span></span><br><span class="line">        DatagramPacket packetToClient = <span class="keyword">new</span> DatagramPacket(sendedContent,sendedContent.length,</span><br><span class="line">                packet.getAddress(),packet.getPort());</span><br><span class="line">        socket.send(packetToClient);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.java.interview.socket;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020-04-14  18:10</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> * SOCK_DGRAMï¼šè¡¨ç¤ºæ— è¿æ¥çš„æ•°æ®ä¼ è¾“æ–¹å¼ã€‚è®¡ç®—æœºåªç®¡ä¼ è¾“æ•°æ®ï¼Œä¸ä½œæ•°æ®æ ¡éªŒï¼Œ</span></span><br><span class="line"><span class="comment"> * å¦‚æœæ•°æ®åœ¨ä¼ è¾“ä¸­æŸåï¼Œæˆ–è€…æ²¡æœ‰åˆ°è¾¾å¦ä¸€å°è®¡ç®—æœºï¼Œæ˜¯æ²¡æœ‰åŠæ³•è¡¥æ•‘çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®é”™äº†å°±é”™äº†ï¼Œ</span></span><br><span class="line"><span class="comment"> * æ— æ³•é‡ä¼ ã€‚å› ä¸º SOCK_DGRAM æ‰€åšçš„æ ¡éªŒå·¥ä½œå°‘ï¼Œæ‰€ä»¥æ•ˆç‡æ¯” SOCK_STREAM é«˜ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//å®¢æˆ·ç«¯å‘é€æ•°æ®ç»™æœåŠ¡ç«¯</span></span><br><span class="line">        DatagramSocket socket = <span class="keyword">new</span> DatagramSocket();</span><br><span class="line">        <span class="comment">//è¦å‘é€ç»™æœåŠ¡ç«¯ç«¯çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">byte</span>[] buf = <span class="string">"hello world"</span>.getBytes();</span><br><span class="line">        <span class="comment">//å°†IPåœ°å€å°è£…æˆInetAddresså¯¹è±¡</span></span><br><span class="line">        InetAddress address = InetAddress.getByName(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">        <span class="comment">//å°†è¦å‘é€ç»™æœåŠ¡ç«¯çš„æ•°æ®å°è£…æˆDatagramPacketå¯¹è±¡ï¼Œéœ€è¦å¡«å†™ipåœ°å€ä¸ç«¯å£å·</span></span><br><span class="line">        DatagramPacket packet = <span class="keyword">new</span> DatagramPacket(buf,buf.length,address,<span class="number">65001</span>);</span><br><span class="line">        <span class="comment">//å‘é€æ•°æ®ç»™æœåŠ¡ç«¯</span></span><br><span class="line">        socket.send(packet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å®¢æˆ·ç«¯æ¥å—æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„æ•°æ®æŠ¥</span></span><br><span class="line">        <span class="keyword">byte</span>[] data = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºDatagramPacketå¯¹è±¡ç”¨æ¥å­˜å‚¨æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„æ•°æ®</span></span><br><span class="line">        DatagramPacket receivedPacket = <span class="keyword">new</span> DatagramPacket(data,data.length);</span><br><span class="line">        <span class="comment">//å°†æ¥å—åˆ°çš„æ•°æ®å­˜å‚¨åˆ°DatagramPacketå¯¹è±¡ä¸­</span></span><br><span class="line">        socket.receive(receivedPacket);</span><br><span class="line">        <span class="comment">//å°†æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„æ•°æ®å–å‡ºæ¥å¹¶æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class="line">        String content = <span class="keyword">new</span> String(receivedPacket.getData(),<span class="number">0</span>,receivedPacket.getLength());</span><br><span class="line">        System.out.println(content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SocketåŸç†"><a href="#SocketåŸç†" class="headerlink" title="SocketåŸç†"></a>SocketåŸç†</h2><h4 id="ï¼‘ã€ä»€ä¹ˆæ˜¯Socket"><a href="#ï¼‘ã€ä»€ä¹ˆæ˜¯Socket" class="headerlink" title="ï¼‘ã€ä»€ä¹ˆæ˜¯Socket"></a><strong>ï¼‘ã€ä»€ä¹ˆæ˜¯Socket</strong></h4><p>åœ¨è®¡ç®—æœºé€šä¿¡é¢†åŸŸï¼Œsocket è¢«ç¿»è¯‘ä¸ºâ€œå¥—æ¥å­—â€ï¼Œå®ƒæ˜¯è®¡ç®—æœºä¹‹é—´è¿›è¡Œ<strong>é€šä¿¡</strong>çš„<strong>ä¸€ç§çº¦å®š</strong>æˆ–ä¸€ç§æ–¹å¼ã€‚é€šè¿‡ socket è¿™ç§çº¦å®šï¼Œä¸€å°è®¡ç®—æœºå¯ä»¥æ¥æ”¶å…¶ä»–è®¡ç®—æœºçš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥å‘å…¶ä»–è®¡ç®—æœºå‘é€æ•°æ®<br> ã€€socketèµ·æºäºUnixï¼Œè€ŒUnix/LinuxåŸºæœ¬å“²å­¦ä¹‹ä¸€å°±æ˜¯â€œä¸€åˆ‡çš†æ–‡ä»¶â€ï¼Œéƒ½å¯ä»¥ç”¨â€œæ‰“å¼€open â€“&gt; è¯»å†™write/read â€“&gt; å…³é—­closeâ€æ¨¡å¼æ¥æ“ä½œã€‚<br> ã€€æˆ‘çš„ç†è§£å°±æ˜¯Socketå°±æ˜¯è¯¥æ¨¡å¼çš„ä¸€ä¸ªå®ç°ï¼šå³socketæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œä¸€äº›socketå‡½æ•°å°±æ˜¯å¯¹å…¶è¿›è¡Œçš„æ“ä½œï¼ˆè¯»/å†™IOã€æ‰“å¼€ã€å…³é—­ï¼‰ã€‚<br> ã€€Socket()å‡½æ•°è¿”å›ä¸€ä¸ªæ•´å‹çš„Socketæè¿°ç¬¦ï¼Œéšåçš„è¿æ¥å»ºç«‹ã€æ•°æ®ä¼ è¾“ç­‰æ“ä½œéƒ½æ˜¯é€šè¿‡è¯¥Socketå®ç°çš„ã€‚</p><h4 id="ï¼’ã€ç½‘ç»œä¸­è¿›ç¨‹å¦‚ä½•é€šä¿¡"><a href="#ï¼’ã€ç½‘ç»œä¸­è¿›ç¨‹å¦‚ä½•é€šä¿¡" class="headerlink" title="ï¼’ã€ç½‘ç»œä¸­è¿›ç¨‹å¦‚ä½•é€šä¿¡"></a><strong>ï¼’ã€ç½‘ç»œä¸­è¿›ç¨‹å¦‚ä½•é€šä¿¡</strong></h4><p>æ—¢ç„¶Socketä¸»è¦æ˜¯ç”¨æ¥è§£å†³ç½‘ç»œé€šä¿¡çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥ç†è§£ç½‘ç»œä¸­è¿›ç¨‹æ˜¯å¦‚ä½•é€šä¿¡çš„ã€‚</p><h6 id="2-1ã€æœ¬åœ°è¿›ç¨‹é—´é€šä¿¡"><a href="#2-1ã€æœ¬åœ°è¿›ç¨‹é—´é€šä¿¡" class="headerlink" title="2.1ã€æœ¬åœ°è¿›ç¨‹é—´é€šä¿¡"></a>2.1ã€æœ¬åœ°è¿›ç¨‹é—´é€šä¿¡</h6><p>aã€æ¶ˆæ¯ä¼ é€’ï¼ˆç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€FIFOï¼‰<br> ã€€bã€åŒæ­¥ï¼ˆäº’æ–¥é‡ã€æ¡ä»¶å˜é‡ã€è¯»å†™é”ã€æ–‡ä»¶å’Œå†™è®°å½•é”ã€ä¿¡å·é‡ï¼‰ï¼Ÿã€ä¸æ˜¯å¾ˆæ˜ç™½ã€‘<br> ã€€cã€å…±äº«å†…å­˜ï¼ˆåŒ¿åçš„å’Œå…·åçš„ï¼Œeg:channelï¼‰<br> ã€€dã€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨(RPC)</p><h6 id="2-2ã€ç½‘ç»œä¸­è¿›ç¨‹å¦‚ä½•é€šä¿¡"><a href="#2-2ã€ç½‘ç»œä¸­è¿›ç¨‹å¦‚ä½•é€šä¿¡" class="headerlink" title="2.2ã€ç½‘ç»œä¸­è¿›ç¨‹å¦‚ä½•é€šä¿¡"></a>2.2ã€ç½‘ç»œä¸­è¿›ç¨‹å¦‚ä½•é€šä¿¡</h6><p>æˆ‘ä»¬è¦ç†è§£ç½‘ç»œä¸­è¿›ç¨‹å¦‚ä½•é€šä¿¡ï¼Œå¾—è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š<br> ã€€ï½ã€æˆ‘ä»¬è¦å¦‚ä½•æ ‡è¯†ä¸€å°ä¸»æœºï¼Œå³æ€æ ·ç¡®å®šæˆ‘ä»¬å°†è¦é€šä¿¡çš„è¿›ç¨‹æ˜¯åœ¨é‚£ä¸€å°ä¸»æœºä¸Šè¿è¡Œã€‚<br> ã€€ï½‚ã€æˆ‘ä»¬è¦å¦‚ä½•æ ‡è¯†å”¯ä¸€è¿›ç¨‹ï¼Œæœ¬åœ°é€šè¿‡pidæ ‡è¯†ï¼Œç½‘ç»œä¸­åº”è¯¥æ€æ ·æ ‡è¯†ï¼Ÿ<br> è§£å†³åŠæ³•ï¼š<br> ã€€ï½ã€TCP/IPåè®®æ—å·²ç»å¸®æˆ‘ä»¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œç½‘ç»œå±‚çš„â€œipåœ°å€â€å¯ä»¥å”¯ä¸€æ ‡è¯†ç½‘ç»œä¸­çš„ä¸»æœº<br> ã€€ï½‚ã€ä¼ è¾“å±‚çš„â€œåè®®+ç«¯å£â€å¯ä»¥å”¯ä¸€æ ‡è¯†ä¸»æœºä¸­çš„åº”ç”¨ç¨‹åºï¼ˆè¿›ç¨‹ï¼‰ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åˆ©ç”¨ä¸‰å…ƒç»„ï¼ˆipåœ°å€ï¼Œåè®®ï¼Œç«¯å£ï¼‰å°±å¯ä»¥æ ‡è¯†ç½‘ç»œçš„è¿›ç¨‹äº†ï¼Œç½‘ç»œä¸­çš„è¿›ç¨‹é€šä¿¡å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ ‡å¿—ä¸å…¶å®ƒè¿›ç¨‹è¿›è¡Œäº¤äº’</p><h4 id="ï¼“ã€Socketæ€ä¹ˆé€šä¿¡"><a href="#ï¼“ã€Socketæ€ä¹ˆé€šä¿¡" class="headerlink" title="ï¼“ã€Socketæ€ä¹ˆé€šä¿¡"></a><strong>ï¼“ã€Socketæ€ä¹ˆé€šä¿¡</strong></h4><p>ç°åœ¨ï¼Œæˆ‘ä»¬çŸ¥é“äº†ç½‘ç»œä¸­è¿›ç¨‹é—´å¦‚ä½•é€šä¿¡ï¼Œå³åˆ©ç”¨ä¸‰å…ƒç»„ã€ipåœ°å€ï¼Œåè®®ï¼Œç«¯å£ã€‘å¯ä»¥è¿›è¡Œç½‘ç»œé—´é€šä¿¡äº†ï¼Œé‚£æˆ‘ä»¬åº”è¯¥æ€ä¹ˆå®ç°äº†ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬socketåº”è¿è€Œç”Ÿï¼Œå®ƒå°±æ˜¯åˆ©ç”¨ä¸‰å…ƒç»„è§£å†³ç½‘ç»œé€šä¿¡çš„ä¸€ä¸ªä¸­é—´ä»¶å·¥å…·ï¼Œå°±ç›®å‰è€Œè¨€ï¼Œå‡ ä¹æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½æ˜¯é‡‡ç”¨socketï¼Œå¦‚UNIX  BSDçš„å¥—æ¥å­—ï¼ˆsocketï¼‰å’ŒUNIX System Vçš„TLIï¼ˆå·²ç»è¢«æ·˜æ±°ï¼‰ã€‚<br> Socketé€šä¿¡çš„æ•°æ®ä¼ è¾“æ–¹å¼ï¼Œå¸¸ç”¨çš„æœ‰ä¸¤ç§ï¼š<br> ã€€ï½ã€SOCK_STREAMï¼šè¡¨ç¤ºé¢å‘è¿æ¥çš„æ•°æ®ä¼ è¾“æ–¹å¼ã€‚æ•°æ®å¯ä»¥å‡†ç¡®æ— è¯¯åœ°åˆ°è¾¾å¦ä¸€å°è®¡ç®—æœºï¼Œå¦‚æœæŸåæˆ–ä¸¢å¤±ï¼Œå¯ä»¥é‡æ–°å‘é€ï¼Œä½†æ•ˆç‡ç›¸å¯¹è¾ƒæ…¢ã€‚å¸¸è§çš„ http åè®®å°±ä½¿ç”¨ SOCK_STREAM ä¼ è¾“æ•°æ®ï¼Œå› ä¸ºè¦ç¡®ä¿æ•°æ®çš„æ­£ç¡®æ€§ï¼Œå¦åˆ™ç½‘é¡µä¸èƒ½æ­£å¸¸è§£æã€‚<br> ã€€ï½‚ã€SOCK_DGRAMï¼šè¡¨ç¤ºæ— è¿æ¥çš„æ•°æ®ä¼ è¾“æ–¹å¼ã€‚è®¡ç®—æœºåªç®¡ä¼ è¾“æ•°æ®ï¼Œä¸ä½œæ•°æ®æ ¡éªŒï¼Œå¦‚æœæ•°æ®åœ¨ä¼ è¾“ä¸­æŸåï¼Œæˆ–è€…æ²¡æœ‰åˆ°è¾¾å¦ä¸€å°è®¡ç®—æœºï¼Œæ˜¯æ²¡æœ‰åŠæ³•è¡¥æ•‘çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®é”™äº†å°±é”™äº†ï¼Œæ— æ³•é‡ä¼ ã€‚å› ä¸º SOCK_DGRAM æ‰€åšçš„æ ¡éªŒå·¥ä½œå°‘ï¼Œæ‰€ä»¥æ•ˆç‡æ¯” SOCK_STREAM é«˜ã€‚<br> ã€€ä¾‹å¦‚ï¼šQQ è§†é¢‘èŠå¤©å’Œè¯­éŸ³èŠå¤©å°±ä½¿ç”¨ SOCK_DGRAM ä¼ è¾“æ•°æ®ï¼Œå› ä¸ºé¦–å…ˆè¦ä¿è¯é€šä¿¡çš„æ•ˆç‡ï¼Œå°½é‡å‡å°å»¶è¿Ÿï¼Œè€Œæ•°æ®çš„æ­£ç¡®æ€§æ˜¯æ¬¡è¦çš„ï¼Œå³ä½¿ä¸¢å¤±å¾ˆå°çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œè§†é¢‘å’ŒéŸ³é¢‘ä¹Ÿå¯ä»¥æ­£å¸¸è§£æï¼Œæœ€å¤šå‡ºç°å™ªç‚¹æˆ–æ‚éŸ³ï¼Œä¸ä¼šå¯¹é€šä¿¡è´¨é‡æœ‰å®è´¨çš„å½±å“</p>]]></content>
      
      
      <categories>
          
          <category> socket </category>
          
      </categories>
      
      
        <tags>
            
            <tag> socket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰æ®µæ¶æ„è®¾è®¡ä¸æŠ€æœ¯é€‰å‹</title>
      <link href="/2020/03/16/%E5%89%8D%E6%AE%B5%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B/"/>
      <url>/2020/03/16/%E5%89%8D%E6%AE%B5%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ã€æ¶æ„è®¾è®¡</p><p>1ã€åˆ†å±‚æ¶æ„</p><p>å®šä¹‰ï¼šæŠŠåŠŸèƒ½ç›¸ä¼¼ï¼ŒæŠ½è±¡çº§åˆ«ç›¸è¿‘çš„å®ç°è¿›è¡Œåˆ†å±‚éš”ç¦»</p><p>ä¼˜åŠ¿ï¼šæ¾æ•£è€¦åˆï¼Œæ˜“ç»´æŠ¤ã€æ˜“å¤ç”¨ã€æ˜“æ‰©å±•ã€‚</p><p>å¸¸è§çš„åˆ†å±‚æ–¹å¼ï¼šMVCã€MVVM</p><p>2ã€æ¨¡å—åŒ–</p><p>å®šä¹‰ï¼šè§£å†³ä¸€ä¸ªå¤æ‚çš„é—®é¢˜ï¼Œè‡ªé¡¶å‘ä¸‹é€å±‚æŠŠç³»ç»Ÿåˆ†æˆè‹¥å¹²æ¨¡å—çš„è¿‡ç¨‹ã€‚</p><p>æ„ä¹‰ï¼šè§£è€¦åˆï¼Œå¯å¹¶è¡Œå¼€å‘ã€‚</p><p>æ¨¡å—åŒ–æ–¹æ¡ˆï¼šAMDã€CMDã€commonJSã€ES6</p><p>3ã€æ¶æ„è®¾è®¡</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcvoxkouyej31g40u0kjl.jpg" alt="image-20200316131142621"></p><p>äºŒã€æŠ€æœ¯é€‰å‹</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcvoz11esej31mr0u0khv.jpg" alt="image-20200316131307082"></p><p>1ã€è½¯ä»¶è¿‡ç¨‹é€‰æ‹©â€”æ•æ·å¼€å‘</p><ul><li>å®šä¹‰ï¼šä»¥ç”¨æˆ·çš„éœ€æ±‚è¿›åŒ–ä¸ºæ ¸å¿ƒï¼Œé‡‡ç”¨è¿­ä»£ã€å¾ªåºæ¸è¿›çš„æ–¹æ³•è¿›è¡Œè½¯ä»¶å¼€å‘</li><li>æ˜¯ä¸€ç§è¿­ä»£çš„æ„è¯†å’Œæ–¹æ³•ï¼Œè€Œä¸æ˜¯æ¦‚å¿µå’Œå·¥å…·</li><li>ä¼˜ç‚¹ï¼šèƒ½å¤Ÿæ»¡è¶³ä¸æ–­å˜åŒ–çš„éœ€æ±‚</li><li>ä¸è¶³ï¼šå¯¹å›¢é˜Ÿæˆå‘˜çš„èƒ½åŠ›éœ€æ±‚æ¯”è¾ƒé«˜</li></ul><p>2ã€å‰åç«¯åˆ†ç¦»æ–¹å¼â€”ä¸åˆ†ç¦»</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcvp6kf00oj31k20u0k9v.jpg" alt="image-20200316131729235"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcvp6moygnj31jo0u0h92.jpg" alt="image-20200316131747784"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcvp6t50jyj31r00rg4ki.jpg" alt="image-20200316131804311"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcvp6xf1dhj31f60u04mm.jpg" alt="image-20200316131819807"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcvp72y5q2j31b20u01kx.jpg" alt="image-20200316131842898"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcvp74j0e8j31io0u01kx.jpg" alt="image-20200316131901980"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcvp77ts4qj31c70u0kjb.jpg" alt="image-20200316131918559"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcvp7cxcasj31h70u04qp.jpg" alt="image-20200316131939853"></p>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mavenç¯å¢ƒéš”ç¦»</title>
      <link href="/2020/03/16/Maven%E7%8E%AF%E5%A2%83%E9%9A%94%E7%A6%BB/"/>
      <url>/2020/03/16/Maven%E7%8E%AF%E5%A2%83%E9%9A%94%E7%A6%BB/</url>
      
        <content type="html"><![CDATA[<ol><li><p>è§£å†³çš„å®é™…é—®é¢˜</p><p>é¿å…äººå·¥ä¿®æ”¹çš„å¼Šç«¯ï¼Œå³å®¹æ˜“çŠ¯é”™ï¼›</p><p>è½»æ¾åˆ†ç¯å¢ƒç¼–è¯‘ã€æ‰“åŒ…ã€éƒ¨ç½²ï¼›</p></li><li><p>é…ç½®åŠåŸç†</p><p>pom.xml ä¸­buildèŠ‚ç‚¹å†…å¢åŠ resourcesèŠ‚ç‚¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--buildä¸­æ·»åŠ Mavenç¯å¢ƒéš”ç¦»é…ç½®--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources.$&#123;deploy.type&#125;<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>*.jsp<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure><p>pom.xml ä¸­å¢åŠ profilesèŠ‚ç‚¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Mavenç¯å¢ƒéš”ç¦»é…ç½®ï¼Œä¸buildèŠ‚ç‚¹åŒçº§çš„èŠ‚ç‚¹--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--é»˜è®¤æ¿€æ´»çš„èŠ‚ç‚¹--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">deploy.type</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">deploy.type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>beta<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">deploy.type</span>&gt;</span>beta<span class="tag">&lt;/<span class="name">deploy.type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">deploy.type</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">deploy.type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>Mavenç¯å¢ƒéš”ç¦»ç¼–è¯‘æ‰“åŒ…å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -Dmaven.test.skip=true -Pdev</span><br><span class="line">mvn clean package -Dmaven.test.skip=true -Pbeta</span><br><span class="line">mvn clean package -Dmaven.test.skip=true -Pprod</span><br></pre></td></tr></table></figure></li><li><p>æ–°å»ºå¯¹åº”çš„æ–‡ä»¶å¤¹ï¼Œå¹¶æŠŠè¦éš”ç¦»çš„æ–‡ä»¶åˆ†å¼€ï¼Œå…¬å…±çš„ç•™ä¸‹</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcvnxrmgi8j30na0q876j.jpg" style="zoom:45%;" /></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Maven </category>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisåº”ç”¨æ¡ˆä¾‹</title>
      <link href="/2020/01/23/Redis%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B/"/>
      <url>/2020/01/23/Redis%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="Redisåº”ç”¨æ¡ˆä¾‹"><a href="#Redisåº”ç”¨æ¡ˆä¾‹" class="headerlink" title="Redisåº”ç”¨æ¡ˆä¾‹"></a>Redisåº”ç”¨æ¡ˆä¾‹</h2><h3 id="1ã€æ‰‹æœºéªŒè¯ç "><a href="#1ã€æ‰‹æœºéªŒè¯ç " class="headerlink" title="1ã€æ‰‹æœºéªŒè¯ç "></a>1ã€æ‰‹æœºéªŒè¯ç </h3><p>éœ€æ±‚ï¼š</p><p>â‘ è¾“å…¥æ‰‹æœºå·ï¼Œç‚¹å‡»å‘é€åéšæœºç”Ÿæˆ 6 ä½æ•°å­—ç ï¼Œ2 åˆ†é’Ÿæœ‰æ•ˆ </p><p>â‘¡è¾“å…¥éªŒè¯ç ï¼Œç‚¹å‡»éªŒè¯ï¼Œè¿”å›æˆåŠŸæˆ–å¤±è´¥ </p><p>â‘¢æ¯ä¸ªæ‰‹æœºå·æ¯å¤©åªèƒ½è¾“å…¥ 3 æ¬¡</p><h3 id="2ã€ç§’æ€"><a href="#2ã€ç§’æ€" class="headerlink" title="2ã€ç§’æ€"></a>2ã€ç§’æ€</h3><h4 id="2-1-å®ç°æ€è·¯"><a href="#2-1-å®ç°æ€è·¯" class="headerlink" title="2.1  å®ç°æ€è·¯"></a>2.1  å®ç°æ€è·¯</h4><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb68uujdqlj31280d1aey.jpg" alt="image-20200123093358708"></p><h4 id="2-2-æ•°æ®åº“è¿æ¥æ± "><a href="#2-2-æ•°æ®åº“è¿æ¥æ± " class="headerlink" title="2.2 æ•°æ®åº“è¿æ¥æ± "></a>2.2 æ•°æ®åº“è¿æ¥æ± </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisPoolUtil</span> </span>&#123; </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> JedisPool jedisPool = <span class="keyword">null</span>;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">JedisPoolUtil</span><span class="params">()</span> </span>&#123; </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JedisPool <span class="title">getJedisPoolInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == jedisPool) &#123; </span><br><span class="line">      <span class="keyword">synchronized</span> (JedisPoolUtil<span class="class">.<span class="keyword">class</span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == jedisPool) &#123; </span><br><span class="line">          JedisPoolConfig poolConfig = <span class="keyword">new</span> JedisPoolConfig(); </span><br><span class="line">          poolConfig.setMaxTotal(<span class="number">200</span>);<span class="comment">//æœ€å¤§è¿æ¥æ•° </span></span><br><span class="line">          poolConfig.setMaxIdle(<span class="number">32</span>);<span class="comment">//æœ€å¤§ç©ºé—²è¿æ¥æ•° </span></span><br><span class="line">          <span class="comment">//è·å–è¿æ¥æ—¶çš„æœ€å¤§ç­‰å¾…æ¯«ç§’æ•°,å¦‚æœè¶…æ—¶å°±æŠ›å¼‚å¸¸,é»˜è®¤-1 </span></span><br><span class="line">          poolConfig.setMaxWaitMillis(<span class="number">100</span>*<span class="number">1000</span>); </span><br><span class="line">          <span class="comment">//è¿æ¥è€—å°½æ—¶æ˜¯å¦é˜»å¡, falseæŠ¥å¼‚å¸¸,tureé˜»å¡ç›´åˆ°è¶…æ—¶, é»˜è®¤true</span></span><br><span class="line">          poolConfig.setBlockWhenExhausted(<span class="keyword">true</span>); </span><br><span class="line">          <span class="comment">//åœ¨è·å–è¿æ¥çš„æ—¶å€™æ£€æŸ¥æœ‰æ•ˆæ€§, é»˜è®¤false </span></span><br><span class="line">          poolConfig.setTestOnBorrow(<span class="keyword">true</span>); </span><br><span class="line">          jedisPool = <span class="keyword">new</span> JedisPool(poolConfig, <span class="string">"192.168.162.128"</span>, <span class="number">6379</span>, <span class="number">60000</span> ); </span><br><span class="line">        &#125; </span><br><span class="line">      &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jedisPool; </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-3-ä½¿ç”¨-ab-è¿›è¡Œå‹åŠ›æµ‹è¯•"><a href="#2-3-ä½¿ç”¨-ab-è¿›è¡Œå‹åŠ›æµ‹è¯•" class="headerlink" title="2.3.ä½¿ç”¨ ab è¿›è¡Œå‹åŠ›æµ‹è¯•"></a>2.3.ä½¿ç”¨ ab è¿›è¡Œå‹åŠ›æµ‹è¯•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab -c 10 -n 100 -p /root/postarg -T application/x-www-form-urlencoded http://192.168.107.1:8080/seckill/doseckill</span><br></pre></td></tr></table></figure><p>å‚æ•°å«ä¹‰ï¼š</p><p>-c:æ¨¡æ‹Ÿå¤šå°‘ä¸ªå®¢æˆ·ç«¯ </p><p>-n:æµ‹è¯•å‡ æ¬¡ </p><p>-T:å†…å®¹ç±»å‹ </p><p>-P:å‚æ•°æ–‡ä»¶ï¼ˆæ³¨æ„å‚æ•°æ–‡ä»¶çš„å‚æ•°è¦ä»¥&amp;ç¬¦å·ç»“å°¾ï¼Œæ³¨æ„æºå¸¦ç»å¯¹è·¯å¾„ï¼‰</p><p>postarg æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prodid=1001&amp;</span><br></pre></td></tr></table></figure><h4 id="2-4-è¶…å–é—®é¢˜"><a href="#2-4-è¶…å–é—®é¢˜" class="headerlink" title="2.4 è¶…å–é—®é¢˜"></a>2.4 è¶…å–é—®é¢˜</h4><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb693rov4uj30ox0133ys.jpg" alt="image-20200123094438280"></p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6949tokzj30xt0sfwnq.jpg" alt="image-20200123094505039"></p><p>è§£å†³ï¼šä½¿ç”¨ä¹è§‚é”è§£å†³è¶…å–ï¼</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6957b10hj311k0nbtif.jpg" alt="image-20200123094559450"></p><h3 id="2-5-ç§’æ€å¯Œä½™é—®é¢˜"><a href="#2-5-ç§’æ€å¯Œä½™é—®é¢˜" class="headerlink" title="2.5 ç§’æ€å¯Œä½™é—®é¢˜"></a>2.5 ç§’æ€å¯Œä½™é—®é¢˜</h3><h4 id="2-5-1-å‹æµ‹è„šæœ¬"><a href="#2-5-1-å‹æµ‹è„šæœ¬" class="headerlink" title="2.5.1 å‹æµ‹è„šæœ¬"></a>2.5.1 å‹æµ‹è„šæœ¬</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab -c 200 -n 2000 -p /root/postarg -T application/x-www-form-urlencoded http://192.168.107.1:8080/seckill/doseckill</span><br></pre></td></tr></table></figure><h4 id="2-5-2-ä½¿ç”¨-lua-è„šæœ¬è§£å†³"><a href="#2-5-2-ä½¿ç”¨-lua-è„šæœ¬è§£å†³" class="headerlink" title="2.5.2 ä½¿ç”¨ lua è„šæœ¬è§£å†³!"></a>2.5.2 ä½¿ç”¨ lua è„šæœ¬è§£å†³!</h4><p>Lua æ˜¯ä¸€ä¸ªå°å·§çš„è„šæœ¬è¯­è¨€ï¼ŒLua è„šæœ¬å¯ä»¥å¾ˆå®¹æ˜“çš„è¢« C/C++ ä»£ç è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥è°ƒç”¨ C/C++çš„å‡½æ•°ï¼ŒLua å¹¶æ²¡æœ‰æä¾›å¼ºå¤§çš„åº“ï¼Œä¸€ä¸ªå®Œæ•´çš„ Lua è§£é‡Šå™¨ä¸è¿‡ 200kï¼Œæ‰€ä»¥ Lua ä¸é€‚åˆä½œä¸ºå¼€å‘ç‹¬ç«‹åº”ç”¨ç¨‹åºçš„è¯­è¨€ï¼Œè€Œæ˜¯ä½œä¸ºåµŒå…¥å¼è„šæœ¬è¯­è¨€</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb69cl97msj307k074wfw.jpg" alt="image-20200123095306932"></p><p>å¾ˆå¤šåº”ç”¨ç¨‹åºã€æ¸¸æˆä½¿ç”¨ LUA ä½œä¸ºè‡ªå·±çš„åµŒå…¥å¼è„šæœ¬è¯­è¨€ï¼Œä»¥æ­¤æ¥å®ç°å¯é…ç½®æ€§ã€å¯æ‰©å±•æ€§ã€‚è¿™å…¶ä¸­åŒ…æ‹¬é­”å…½äº‰éœ¸åœ°å›¾ã€é­”å…½ä¸–ç•Œã€åšå¾·ä¹‹é—¨ã€æ„¤æ€’çš„å°é¸Ÿç­‰ä¼—å¤šæ¸¸æˆæ’ä»¶æˆ–å¤–æŒ‚ã€‚</p><p>LUA è„šæœ¬åœ¨ Redis ä¸­çš„ä¼˜åŠ¿: </p><p>å°†å¤æ‚çš„æˆ–è€…å¤šæ­¥çš„ redis æ“ä½œï¼Œå†™ä¸ºä¸€ä¸ªè„šæœ¬ï¼Œä¸€æ¬¡æäº¤ç»™ redis æ‰§è¡Œï¼Œå‡å°‘åå¤è¿æ¥ redis çš„æ¬¡æ•°ã€‚æå‡æ€§èƒ½ã€‚</p><p>LUA è„šæœ¬æ˜¯ç±»ä¼¼ redis äº‹åŠ¡ï¼Œæœ‰ä¸€å®šçš„åŸå­æ€§ï¼Œä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ’é˜Ÿï¼Œå¯ä»¥å®Œæˆä¸€äº› redis äº‹åŠ¡æ€§çš„æ“ä½œã€‚ä½†æ˜¯æ³¨æ„ redis çš„ lua è„šæœ¬åŠŸèƒ½ï¼Œåªæœ‰åœ¨ 2.6 ä»¥ä¸Šçš„ç‰ˆæœ¬æ‰å¯ä»¥ä½¿ç”¨ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb69gsdnisj312p0i7gvv.jpg" alt="image-20200123095708758"></p>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis Clusteré›†ç¾¤</title>
      <link href="/2020/01/23/Redis-Cluster%E9%9B%86%E7%BE%A4/"/>
      <url>/2020/01/23/Redis-Cluster%E9%9B%86%E7%BE%A4/</url>
      
        <content type="html"><![CDATA[<h2 id="1ã€Redis-Clusterç®€ä»‹"><a href="#1ã€Redis-Clusterç®€ä»‹" class="headerlink" title="1ã€Redis Clusterç®€ä»‹"></a>1ã€Redis Clusterç®€ä»‹</h2><p>Redis clusteræ˜¯Redisçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œä¸ä¼šè¿˜ä½¿ç”¨å•ç‚¹çš„redisï¼Œåšåˆ°é«˜å¯ç”¨å’Œå®¹ç¾ï¼Œèµ·ç ä¹Ÿæ˜¯redisä¸»ä»ã€‚redisçš„å•çº¿ç¨‹å·¥ä½œï¼Œä¸€å°ç‰©ç†æœºåªè¿è¡Œä¸€ä¸ªrediså®ä¾‹å¤ªè¿‡æµªè´¹ï¼Œrediså•æœºæ˜¾ç„¶æ˜¯å­˜åœ¨å•ç‚¹æ•…éšœçš„éšæ‚£ã€‚å†…å­˜èµ„æºå¾€å¾€å—é™ï¼Œçºµå‘ä¸åœæ‰©å±•å†…å­˜å¹¶ä¸æ˜¯å¾ˆå®é™…ï¼Œå› æ­¤æ¨ªå‘å¯ä¼¸ç¼©æ‰©å±•ï¼Œéœ€è¦å¤šå°ä¸»æœºååŒæä¾›æœåŠ¡ï¼Œå³åˆ†å¸ƒå¼ä¸‹å¤šä¸ªRediså®ä¾‹ååŒè¿è¡Œã€‚</p><h3 id="Redis-Clusterç›®æ ‡"><a href="#Redis-Clusterç›®æ ‡" class="headerlink" title="Redis Clusterç›®æ ‡"></a>Redis Clusterç›®æ ‡</h3><ol><li>é«˜æ€§èƒ½</li><li>çº¿æ€§æ‰©å®¹</li><li>é«˜å¯ç”¨</li></ol><h3 id="å¼•å…¥é›†ç¾¤"><a href="#å¼•å…¥é›†ç¾¤" class="headerlink" title="å¼•å…¥é›†ç¾¤"></a>å¼•å…¥é›†ç¾¤</h3><p>é—®é¢˜ï¼š</p><ul><li><p>å®¹é‡ä¸å¤Ÿï¼Œredis å¦‚ä½•è¿›è¡Œæ‰©å®¹ï¼Ÿ </p></li><li><p>å¹¶å‘å†™æ“ä½œï¼Œ redis å¦‚ä½•åˆ†æ‘Šï¼Ÿ </p></li><li><p>ä»€ä¹ˆæ˜¯é›†ç¾¤ï¼š </p><p>Redis é›†ç¾¤å®ç°äº†å¯¹ Redis çš„æ°´å¹³æ‰©å®¹ï¼Œå³å¯åŠ¨ N ä¸ª redis èŠ‚ç‚¹ï¼Œå°†æ•´ä¸ªæ•°æ®åº“åˆ†å¸ƒå­˜å‚¨åœ¨è¿™ N ä¸ªèŠ‚ç‚¹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ€»æ•°æ®çš„ 1/Nã€‚ </p><p>Redis é›†ç¾¤é€šè¿‡åˆ†åŒºï¼ˆpartitionï¼‰æ¥æä¾›ä¸€å®šç¨‹åº¦çš„å¯ç”¨æ€§ï¼ˆavailabilityï¼‰ï¼š å³ä½¿é›†ç¾¤ä¸­æœ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹å¤±æ•ˆæˆ–è€…æ— æ³•è¿›è¡Œé€šè®¯ï¼Œ é›†ç¾¤ä¹Ÿå¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚</p></li></ul><h2 id="2ã€åˆ›å»ºé›†ç¾¤"><a href="#2ã€åˆ›å»ºé›†ç¾¤" class="headerlink" title="2ã€åˆ›å»ºé›†ç¾¤"></a>2ã€åˆ›å»ºé›†ç¾¤</h2><h3 id="2-1-å®‰è£…Rubyç¯å¢ƒ"><a href="#2-1-å®‰è£…Rubyç¯å¢ƒ" class="headerlink" title="2.1 å®‰è£…Rubyç¯å¢ƒ"></a>2.1 å®‰è£…Rubyç¯å¢ƒ</h3><p>æœ¬èº« redis é›†ç¾¤çš„å®‰è£…æ˜¯å¾ˆéº»çƒ¦äº†ï¼Œé€šè¿‡ ruby å·¥å…·ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„å°†ä¸€ç³»åˆ—å‘½ä»¤æ‰“åŒ…ä¸ºä¸€ä¸ªè„šæœ¬ï¼ </p><p>ï¼ˆ1ï¼‰æ— ç½‘ç¯å¢ƒï¼ˆCentOS6ï¼‰ </p><p><strong>ä¾æ¬¡æ‰§è¡Œ</strong>åœ¨å®‰è£…å…‰ç›˜ä¸‹çš„ Package ç›®å½•(/media/CentOS_6.8_Final/Packages)ä¸‹çš„ rpm åŒ…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh compat-readline5-5.2-17.1.el6.x86_64.rpm </span><br><span class="line">rpm -ivh ruby-libs-1.8.7.374-4.el6_6.x86_64.rpm </span><br><span class="line">rpm -ivh ruby-1.8.7.374-4.el6_6.x86_64.rpm </span><br><span class="line">rpm -ivh ruby-irb-1.8.7.374-4.el6_6.x86_64.rpm </span><br><span class="line">rpm -ivh ruby-rdoc-1.8.7.374-4.el6_6.x86_64.rpm</span><br><span class="line">rpm -ivh rubygems-1.3.7-5.el6.noarch.rpm</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰æ— ç½‘ç¯å¢ƒï¼ˆCentOS7ï¼‰</p><p>è¿›å…¥ Package ç›®å½•(/run/media/root/CentOS 7 x86_64/Packages)ï¼Œæ‹·è´å¦‚ä¸‹å®‰è£…åŒ…åˆ°ç‹¬ç«‹ç›®å½• rpmruby</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb69vas1pkj308f08htcd.jpg" alt="image-20200123101101076"></p><p>è¿›å…¥æ­¤ç›®å½•è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŒ‰ç…§ä¾èµ–å®‰è£…</p><p>rpm -Uvh *.rpm â€”nodeps â€”force</p><p>ï¼ˆ3ï¼‰è”ç½‘ç¯å¢ƒ </p><p>åœ¨è”ç½‘çŠ¶æ€ä¸‹ï¼Œæ‰§è¡Œ yum å®‰è£…ï¼Œæ‰§è¡Œ yum -y install ruby; </p><p>ä¹‹åå®‰è£… rubygem,rubygem æ˜¯ ruby çš„åŒ…ç®¡ç†æ¡†æ¶ã€‚yum -y install rubygems</p><h3 id="2-2-å®‰è£…-redis-gem"><a href="#2-2-å®‰è£…-redis-gem" class="headerlink" title="2.2 å®‰è£… redis gem"></a>2.2 å®‰è£… redis gem</h3><p>redis-3.2.0.gem æ˜¯ä¸€ä¸ªé€šè¿‡ ruby æ“ä½œ redis çš„æ’ä»¶ï¼ </p><p>æ‹·è´ redis-3.2.0.gem åˆ°/opt ç›®å½•ä¸‹ï¼Œåœ¨ opt ç›®å½•ä¸‹æ‰§è¡Œ gem install â€”local redis-3.2.0.gemï¼›</p><h3 id="2-3-åˆ¶ä½œ6ä¸ªredis-é…ç½®æ–‡ä»¶"><a href="#2-3-åˆ¶ä½œ6ä¸ªredis-é…ç½®æ–‡ä»¶" class="headerlink" title="2.3 åˆ¶ä½œ6ä¸ªredis é…ç½®æ–‡ä»¶"></a>2.3 åˆ¶ä½œ6ä¸ªredis é…ç½®æ–‡ä»¶</h3><p>ç«¯å£å·åˆ†åˆ«æ˜¯ï¼š6379,6380,6381,6389,6390,6391 </p><p>æ³¨æ„ï¼šæ¯ä¸ªé…ç½®æ–‡ä»¶ä¸­éœ€è¦æŒ‡å®š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes: æœåŠ¡åœ¨åå°è¿è¡Œ </span><br><span class="line">portï¼šç«¯å£å· </span><br><span class="line">pidfile:pid ä¿å­˜æ–‡ä»¶ </span><br><span class="line">logfileï¼šæ—¥å¿—æ–‡ä»¶(å¦‚æœæ²¡æœ‰æŒ‡å®šçš„è¯ï¼Œå°±ä¸éœ€è¦) </span><br><span class="line">dump.rdb: RDB å¤‡ä»½æ–‡ä»¶çš„åç§° </span><br><span class="line">appendonly å…³æ‰ï¼Œæˆ–è€…æ˜¯æ›´æ”¹ appendonly æ–‡ä»¶çš„åç§°ã€‚ </span><br><span class="line">cluster-enabled yes æ‰“å¼€é›†ç¾¤æ¨¡å¼ </span><br><span class="line">cluster-config-file nodes-6379.conf è®¾å®šèŠ‚ç‚¹é…ç½®æ–‡ä»¶å </span><br><span class="line">cluster-node-timeout 15000 è®¾å®šèŠ‚ç‚¹å¤±è”æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé›†ç¾¤è‡ªåŠ¨è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚</span><br></pre></td></tr></table></figure><p>æ ·ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">include /usr/local/myredis/rediscluster/redis_base.conf </span><br><span class="line">pidfile &quot;/var/run/redis_6379.pid&quot; </span><br><span class="line">port 6379 </span><br><span class="line">dbfilename &quot;dump_6379.rdb&quot; </span><br><span class="line">cluster-enabled yes </span><br><span class="line">cluster-config-file nodes-6379.conf </span><br><span class="line">cluster-node-timeout 15000</span><br></pre></td></tr></table></figure><p>æ³¨æ„åœ¨åˆ›å»ºé›†ç¾¤çš„æ—¶å€™ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ï¼ŒæŠŠæ‰€æœ‰èŠ‚ç‚¹çš„ dump æ–‡ä»¶å…¨éƒ¨åˆ æ‰ã€‚</p><h3 id="2-4-å¼€å¯é›†ç¾¤"><a href="#2-4-å¼€å¯é›†ç¾¤" class="headerlink" title="2.4 å¼€å¯é›†ç¾¤"></a>2.4 å¼€å¯é›†ç¾¤</h3><ul><li>é¦–å…ˆä¾æ¬¡å¯åŠ¨ 6 ä¸ªèŠ‚ç‚¹ï¼Œå¯åŠ¨åï¼Œä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹ç”Ÿæˆ nodes-xxxx.conf æ–‡ä»¶ </li></ul><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6a1hm326j30bv02lwg4.jpg" alt="image-20200123101702935"></p><ul><li><p>é…ç½®é›†ç¾¤</p><p>åœ¨/opt/redis-3.2.5/src ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-trib.rb create --replicas 1 192.168.31.211:6379 192.168.31.211:6380 192.168.31.211:6381 192.168.31.211:6389 192.168.31.211:6390 192.168.31.211:6391</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæ­¤å¤„ä¸è¦ç”¨ 127.0.0.1ï¼Œè¯·ç”¨çœŸå® IP åœ°å€ï¼</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6a34nxs6j30lp02a3zu.jpg" alt="image-20200123101837045"></p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6a3a4aikj30kk032dia.jpg" alt="image-20200123101845271"></p></li><li><p>ä¹‹åç™»å½•åˆ°å®¢æˆ·ç«¯ï¼Œé€šè¿‡ cluster nodes å‘½ä»¤æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6a3z3n4gj30r2033jw5.jpg" alt="image-20200123101925666"></p></li><li><p>6 ä¸ªèŠ‚ç‚¹ï¼Œä¸ºä»€ä¹ˆæ˜¯ä¸‰ä¸»ä¸‰ä»ï¼Ÿ</p><p>é…ç½®æœºå™¨ï¼Œè‡³å°‘éœ€è¦ 6 ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š </p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6a4q2u1ej30mh02mwgm.jpg" alt="image-20200123102009597"></p><p>å‘½ä»¤ create,ä»£è¡¨åˆ›å»ºä¸€ä¸ªé›†ç¾¤ã€‚å‚æ•°â€”replicas 1 è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›ä¸ºé›†ç¾¤ä¸­çš„æ¯ä¸ªä¸»èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªä»èŠ‚ç‚¹ã€‚ä¸€ä¸ªé›†ç¾¤è‡³å°‘è¦æœ‰<strong>ä¸‰ä¸ªä¸»èŠ‚ç‚¹</strong>ï¼Œåˆ†é…åŸåˆ™å°½é‡ä¿è¯æ¯ä¸ªä¸»æ•°æ®åº“è¿è¡Œåœ¨ä¸åŒçš„ IP åœ°å€ï¼Œæ¯ä¸ªä»åº“å’Œä¸»åº“ä¸åœ¨ä¸€ä¸ª IP åœ° å€ä¸Šã€‚</p></li></ul><h3 id="2-5-slot-æ’æ§½"><a href="#2-5-slot-æ’æ§½" class="headerlink" title="2.5 slot æ’æ§½"></a>2.5 slot æ’æ§½</h3><p>è¿›å…¥é›†ç¾¤åï¼Œå¦‚æœæˆ‘ä»¬ï¼Œç›´æ¥å†™å…¥æ•°æ®ï¼Œå¯èƒ½ä¼šçœ‹åˆ°æŠ¥é”™ä¿¡æ¯ï¼š </p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6a610jlnj30eh02n3z9.jpg" alt="image-20200123102124264"></p><p>è¿™æ˜¯å› ä¸ºï¼Œé›†ç¾¤ä¸­å¤šäº† slot(æ’æ§½)çš„è®¾è®¡ã€‚ä¸€ä¸ª Redis é›†ç¾¤åŒ…å« 16384 ä¸ªæ’æ§½ï¼ˆhash slotï¼‰ï¼Œ æ•°æ®åº“ä¸­çš„æ¯ä¸ª é”®éƒ½å±äºè¿™ 16384 ä¸ªæ’æ§½çš„å…¶ä¸­ä¸€ä¸ªï¼Œ é›†ç¾¤ä½¿ç”¨å…¬å¼ CRC16(key) % 16384 æ¥è®¡ç®—é”® key å±äºå“ªä¸ªæ§½ï¼Œ å…¶ä¸­ CRC16(key) è¯­å¥ç”¨äºè®¡ç®—é”® key çš„ CRC16 æ ¡éªŒå’Œ ã€‚ </p><p>é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å¤„ç†ä¸€éƒ¨åˆ†æ’æ§½ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œ å¦‚æœä¸€ä¸ªé›†ç¾¤å¯ä»¥æœ‰ä¸»èŠ‚ç‚¹ï¼Œ å…¶ä¸­ï¼š </p><ul><li>èŠ‚ç‚¹ A è´Ÿè´£å¤„ç† 0 å·è‡³ 5500 å·æ’æ§½ã€‚ </li><li>èŠ‚ç‚¹ B è´Ÿè´£å¤„ç† 5501 å·è‡³ 11000 å·æ’æ§½ã€‚ </li><li>èŠ‚ç‚¹ C è´Ÿè´£å¤„ç† 11001 å·è‡³ 16383 å·æ’æ§½ã€‚</li></ul><h3 id="2-6-é›†ç¾¤ä¸­å†™å…¥æ•°æ®"><a href="#2-6-é›†ç¾¤ä¸­å†™å…¥æ•°æ®" class="headerlink" title="2.6 é›†ç¾¤ä¸­å†™å…¥æ•°æ®"></a>2.6 é›†ç¾¤ä¸­å†™å…¥æ•°æ®</h3><h4 id="2-6-1-å®¢æˆ·ç«¯é‡å®šå‘"><a href="#2-6-1-å®¢æˆ·ç«¯é‡å®šå‘" class="headerlink" title="2.6.1 å®¢æˆ·ç«¯é‡å®šå‘"></a>2.6.1 å®¢æˆ·ç«¯é‡å®šå‘</h4><ul><li><p>åœ¨ redis-cli æ¯æ¬¡å½•å…¥ã€æŸ¥è¯¢é”®å€¼ï¼Œredis éƒ½ä¼šè®¡ç®—å‡ºè¯¥ key åº”è¯¥é€å¾€çš„æ’æ§½ï¼Œå¦‚æœä¸æ˜¯è¯¥å®¢æˆ·ç«¯å¯¹åº”æœåŠ¡å™¨æ’æ§½redis ä¼šæŠ¥é”™ï¼Œå¹¶å‘ŠçŸ¥åº”å‰å¾€çš„ redis å®ä¾‹åœ°å€å’Œç«¯å£ã€‚ </p></li><li><p>redis-cli å®¢æˆ·ç«¯æä¾›äº† â€“c å‚æ•°å®ç°è‡ªåŠ¨é‡å®šå‘ã€‚å¦‚ redis-cli -c â€“p 6379 ç™»å…¥åï¼Œå†å½•å…¥ã€æŸ¥è¯¢é”®å€¼å¯¹å¯ä»¥è‡ªåŠ¨é‡å®šå‘ã€‚ </p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6aa5icp0j30i801u3z6.jpg" alt="image-20200123102522197"></p></li><li><p>æ¯ä¸ª slot å¯ä»¥å­˜å‚¨ä¸€æ‰¹é”®å€¼å¯¹ã€‚</p></li></ul><h4 id="2-6-2-å¦‚ä½•å¤šé”®æ“ä½œ"><a href="#2-6-2-å¦‚ä½•å¤šé”®æ“ä½œ" class="headerlink" title="2.6.2 å¦‚ä½•å¤šé”®æ“ä½œ"></a>2.6.2 å¦‚ä½•å¤šé”®æ“ä½œ</h4><p>é‡‡ç”¨å“ˆå¸Œç®—æ³•åï¼Œä¼šè‡ªåŠ¨åœ°åˆ†é… slotï¼Œè€Œä¸åœ¨ä¸€ä¸ª slot ä¸‹çš„é”®å€¼ï¼Œæ˜¯ä¸èƒ½ä½¿ç”¨ mget,mset ç­‰å¤šé”®æ“ä½œã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6ab13p77j30h000xt9c.jpg" alt="image-20200123102613541"></p><p>å¦‚æœæœ‰éœ€æ±‚ï¼Œéœ€è¦å°†ä¸€æ‰¹ä¸šåŠ¡æ•°æ®ä¸€èµ·æ’å…¥å‘¢ï¼Ÿ </p><p>è§£å†³ï¼šå¯ä»¥é€šè¿‡{}æ¥å®šä¹‰ç»„çš„æ¦‚å¿µï¼Œä»è€Œä½¿ key ä¸­{}å†…ç›¸åŒå†…å®¹çš„é”®å€¼å¯¹æ”¾åˆ°ä¸€ä¸ª slot ä¸­å»ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6ac0ssfuj30il019gmg.jpg" alt="image-20200123102710350"></p><h3 id="2-7-é›†ç¾¤ä¸­è¯»å–æ•°æ®"><a href="#2-7-é›†ç¾¤ä¸­è¯»å–æ•°æ®" class="headerlink" title="2.7 é›†ç¾¤ä¸­è¯»å–æ•°æ®"></a>2.7 é›†ç¾¤ä¸­è¯»å–æ•°æ®</h3><ul><li><p>CLUSTER KEYSLOT <key> è®¡ç®—é”® key åº”è¯¥è¢«æ”¾ç½®åœ¨å“ªä¸ªæ§½ä¸Š </p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6afi7n2jj30c400yaa9.jpg" alt="image-20200123103031392"></p></li><li><p>CLUSTER COUNTKEYSINSLOT <slot> è¿”å›æ§½ slot ç›®å‰åŒ…å«çš„é”®å€¼å¯¹æ•°é‡ </p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6afci8pgj30de00wglv.jpg" alt="image-20200123103022753"></p></li><li><p>CLUSTER KEYSLOT <key>:è®¡ç®— key åº”è¯¥æ”¾åœ¨å“ªä¸ªæ§½</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6af87otvj30d400u74h.jpg" alt="image-20200123103015499"></p></li><li><p>CLUSTER GETKEYSINSLOT <slot> <count> è¿”å› count ä¸ª slot æ§½ä¸­çš„é”®ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6af3qmf6j30cp01saai.jpg" alt="image-20200123103007786"></p></li></ul><h3 id="2-8-é›†ç¾¤ä¸­æ•…éšœæ¢å¤"><a href="#2-8-é›†ç¾¤ä¸­æ•…éšœæ¢å¤" class="headerlink" title="2.8 é›†ç¾¤ä¸­æ•…éšœæ¢å¤"></a>2.8 é›†ç¾¤ä¸­æ•…éšœæ¢å¤</h3><p>é—®é¢˜ 1ï¼šå¦‚æœä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼Ÿä»èŠ‚ç‚¹èƒ½å¦è‡ªåŠ¨å‡ä¸ºä¸»èŠ‚ç‚¹ï¼Ÿ </p><p>ç­”ï¼šä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼Œä»èŠ‚ç‚¹è‡ªåŠ¨å‡ä¸ºä¸»èŠ‚ç‚¹ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6agxu21mj30gl00h0sx.jpg" alt="image-20200123103153385"></p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6ah3u8drj30se030dkn.jpg" alt="image-20200123103203503"></p><p>é—®é¢˜ 2ï¼šä¸»èŠ‚ç‚¹æ¢å¤åï¼Œä¸»ä»å…³ç³»ä¼šå¦‚ä½•ï¼Ÿ </p><p>ä¸»èŠ‚ç‚¹æ¢å¤åï¼Œä¸»èŠ‚ç‚¹å˜ä¸ºä»èŠ‚ç‚¹ï¼</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb6ahkdrupj30sj031q7u.jpg" alt="image-20200123103230091"></p><p>é—®é¢˜ 3ï¼šå¦‚æœæ‰€æœ‰æŸä¸€æ®µæ’æ§½çš„ä¸»ä»èŠ‚ç‚¹éƒ½å®•æ‰ï¼Œredis æœåŠ¡æ˜¯å¦è¿˜èƒ½ç»§ç»­? </p><p>ç­”ï¼šæœåŠ¡æ˜¯å¦ç»§ç»­ï¼Œå¯ä»¥é€šè¿‡ redis.conf ä¸­çš„ cluster-require-full-coverage å‚æ•°è¿›è¡Œæ§åˆ¶ã€‚ </p><p>â€‹        ä¸»ä»éƒ½å®•æ‰ï¼Œæ„å‘³ç€æœ‰ä¸€ç‰‡æ•°æ®ï¼Œä¼šå˜æˆçœŸç©ºï¼Œæ²¡æ³•å†è®¿é—®äº†ï¼ </p><p>â€‹        å¦‚æœæ— æ³•è®¿é—®çš„æ•°æ®ï¼Œæ˜¯è¿ç»­çš„ä¸šåŠ¡æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦åœæ­¢é›†ç¾¤ï¼Œé¿å…ç¼ºå°‘æ­¤éƒ¨åˆ†æ•°æ®ï¼Œé€ æˆæ•´ä¸ªä¸šåŠ¡çš„å¼‚å¸¸ã€‚æ­¤æ—¶å¯ä»¥é€šè¿‡é…ç½® cluster-require-full-coverage ä¸º yes. </p><p>â€‹        å¦‚æœæ— æ³•è®¿é—®çš„æ•°æ®ï¼Œæ˜¯ç›¸å¯¹ç‹¬ç«‹çš„ï¼Œå¯¹äºå…¶ä»–ä¸šåŠ¡çš„è®¿é—®ï¼Œå¹¶ä¸å½±å“ï¼Œé‚£ä¹ˆå¯ä»¥ç»§ç»­å¼€å¯é›†ç¾¤ä½“æä¾›æœåŠ¡ã€‚æ­¤æ—¶ï¼Œå¯ä»¥é…ç½® cluster-require-full-coverage ä¸º noã€‚</p><h3 id="2-9-é›†ç¾¤çš„Jediså¼€å‘"><a href="#2-9-é›†ç¾¤çš„Jediså¼€å‘" class="headerlink" title="2.9 é›†ç¾¤çš„Jediså¼€å‘"></a>2.9 é›†ç¾¤çš„Jediså¼€å‘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCluster</span><span class="params">()</span></span>&#123; </span><br><span class="line">  Set&lt;HostAndPort&gt; jedisClusterNodes = <span class="keyword">new</span> HashSet&lt;HostAndPort&gt;(); </span><br><span class="line">  <span class="comment">//Jedis Cluster will attempt to discover cluster nodes automatically </span></span><br><span class="line">  jedisClusterNodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.4.128"</span>, <span class="number">6379</span>)); </span><br><span class="line">  JedisCluster jc = <span class="keyword">new</span> JedisCluster(jedisClusterNodes); </span><br><span class="line">  jc.set(<span class="string">"foo"</span>, <span class="string">"bar"</span>); String value = jc.get(<span class="string">"foo"</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-10-é›†ç¾¤çš„ä¼˜ç¼ºç‚¹"><a href="#2-10-é›†ç¾¤çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="2.10 é›†ç¾¤çš„ä¼˜ç¼ºç‚¹"></a>2.10 é›†ç¾¤çš„ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹ï¼š </p><ul><li>å®ç°æ‰©å®¹ </li><li>åˆ†æ‘Šå‹åŠ› </li><li>æ— ä¸­å¿ƒé…ç½®ç›¸å¯¹ç®€å• </li></ul><p>ç¼ºç‚¹ï¼š </p><ul><li>å¤šé”®æ“ä½œæ˜¯ä¸è¢«æ”¯æŒçš„ </li><li>å¤šé”®çš„ Redis äº‹åŠ¡æ˜¯ä¸è¢«æ”¯æŒçš„ã€‚lua è„šæœ¬ä¸è¢«æ”¯æŒã€‚ </li><li>ç”±äºé›†ç¾¤æ–¹æ¡ˆå‡ºç°è¾ƒæ™šï¼Œå¾ˆå¤šå…¬å¸å·²ç»é‡‡ç”¨äº†å…¶ä»–çš„é›†ç¾¤æ–¹æ¡ˆï¼Œè€Œä»£ç†æˆ–è€…å®¢æˆ·ç«¯åˆ†ç‰‡çš„æ–¹æ¡ˆæƒ³è¦è¿ç§»è‡³ redis clusterï¼Œéœ€è¦æ•´ä½“è¿ç§»è€Œä¸æ˜¯é€æ­¥è¿‡æ¸¡ï¼Œå¤æ‚åº¦è¾ƒå¤§ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisçš„Javaå®¢æˆ·ç«¯Jedis</title>
      <link href="/2020/01/22/Redis%E7%9A%84Java%E5%AE%A2%E6%88%B7%E7%AB%AFJedis/"/>
      <url>/2020/01/22/Redis%E7%9A%84Java%E5%AE%A2%E6%88%B7%E7%AB%AFJedis/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€Jedisæ‰€éœ€è¦çš„jaråŒ…"><a href="#ä¸€ã€Jedisæ‰€éœ€è¦çš„jaråŒ…" class="headerlink" title="ä¸€ã€Jedisæ‰€éœ€è¦çš„jaråŒ…"></a>ä¸€ã€Jedisæ‰€éœ€è¦çš„jaråŒ…</h2><ul><li>commons-pool-1.6.jar</li><li>jedis-2.1.0.jar</li></ul><h2 id="äºŒã€Jediså¸¸ç”¨æ“ä½œ"><a href="#äºŒã€Jediså¸¸ç”¨æ“ä½œ" class="headerlink" title="äºŒã€Jediså¸¸ç”¨æ“ä½œ"></a>äºŒã€Jediså¸¸ç”¨æ“ä½œ</h2><h3 id="1ã€æµ‹è¯•è¿é€šæ€§"><a href="#1ã€æµ‹è¯•è¿é€šæ€§" class="headerlink" title="1ã€æµ‹è¯•è¿é€šæ€§"></a>1ã€æµ‹è¯•è¿é€šæ€§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//è¿æ¥æœ¬åœ°çš„ Redis æœåŠ¡</span></span><br><span class="line">Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"127.0.0.1"</span>,<span class="number">6379</span>);</span><br><span class="line"><span class="comment">//æŸ¥çœ‹æœåŠ¡æ˜¯å¦è¿è¡Œï¼Œæ‰“å‡ºpongè¡¨ç¤ºOK</span></span><br><span class="line">    System.out.println(<span class="string">"connection is OK==========&gt;: "</span>+jedis.ping());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€ï¼ˆ5-1ï¼‰ä¸€ä¸ªkey-äº”å¤§æ•°æ®ç±»å‹"><a href="#2ã€ï¼ˆ5-1ï¼‰ä¸€ä¸ªkey-äº”å¤§æ•°æ®ç±»å‹" class="headerlink" title="2ã€ï¼ˆ5+1ï¼‰ä¸€ä¸ªkey,äº”å¤§æ•°æ®ç±»å‹"></a>2ã€ï¼ˆ5+1ï¼‰ä¸€ä¸ªkey,äº”å¤§æ•°æ®ç±»å‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.redis.test;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test02</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">     Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"127.0.0.1"</span>,<span class="number">6379</span>);</span><br><span class="line"><span class="comment">//key</span></span><br><span class="line">     Set keys = jedis.keys(<span class="string">"*"</span>);</span><br><span class="line"><span class="keyword">for</span> (Iterator iterator = keys.iterator(); iterator.hasNext();) &#123;</span><br><span class="line">       String key = (String) iterator.next();</span><br><span class="line">       System.out.println(key);</span><br><span class="line">     &#125;</span><br><span class="line">     System.out.println(<span class="string">"jedis.exists====&gt;"</span>+jedis.exists(<span class="string">"k2"</span>));</span><br><span class="line">     System.out.println(jedis.ttl(<span class="string">"k1"</span>));</span><br><span class="line"><span class="comment">//String</span></span><br><span class="line"><span class="comment">//jedis.append("k1","myreids");</span></span><br><span class="line">     System.out.println(jedis.get(<span class="string">"k1"</span>));</span><br><span class="line">     jedis.set(<span class="string">"k4"</span>,<span class="string">"k4_redis"</span>);</span><br><span class="line">     System.out.println(<span class="string">"----------------------------------------"</span>);</span><br><span class="line">     jedis.mset(<span class="string">"str1"</span>,<span class="string">"v1"</span>,<span class="string">"str2"</span>,<span class="string">"v2"</span>,<span class="string">"str3"</span>,<span class="string">"v3"</span>);</span><br><span class="line">     System.out.println(jedis.mget(<span class="string">"str1"</span>,<span class="string">"str2"</span>,<span class="string">"str3"</span>));</span><br><span class="line"><span class="comment">//list</span></span><br><span class="line">     System.out.println(<span class="string">"----------------------------------------"</span>);</span><br><span class="line"><span class="comment">//jedis.lpush("mylist","v1","v2","v3","v4","v5");</span></span><br><span class="line">     List list = jedis.lrange(<span class="string">"mylist"</span>,<span class="number">0</span>,-<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> (String element : list) &#123;</span><br><span class="line">       System.out.println(element);</span><br><span class="line">     &#125;</span><br><span class="line"><span class="comment">//set</span></span><br><span class="line">     jedis.sadd(<span class="string">"orders"</span>,<span class="string">"jd001"</span>);</span><br><span class="line">     jedis.sadd(<span class="string">"orders"</span>,<span class="string">"jd002"</span>);</span><br><span class="line">     jedis.sadd(<span class="string">"orders"</span>,<span class="string">"jd003"</span>);</span><br><span class="line">     Set set1 = jedis.smembers(<span class="string">"orders"</span>);</span><br><span class="line"><span class="keyword">for</span> (Iterator iterator = set1.iterator(); iterator.hasNext();) &#123;</span><br><span class="line">       String string = (String) iterator.next();</span><br><span class="line">       System.out.println(string);</span><br><span class="line">     &#125;</span><br><span class="line">     jedis.srem(<span class="string">"orders"</span>,<span class="string">"jd002"</span>);</span><br><span class="line">     System.out.println(jedis.smembers(<span class="string">"orders"</span>).size());</span><br><span class="line"><span class="comment">//hash</span></span><br><span class="line">     jedis.hset(<span class="string">"hash1"</span>,<span class="string">"userName"</span>,<span class="string">"lisi"</span>);</span><br><span class="line">     System.out.println(jedis.hget(<span class="string">"hash1"</span>,<span class="string">"userName"</span>));</span><br><span class="line">     Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">     map.put(<span class="string">"telphone"</span>,<span class="string">"13811814763"</span>);</span><br><span class="line">     map.put(<span class="string">"address"</span>,<span class="string">"atguigu"</span>);</span><br><span class="line">     map.put(<span class="string">"email"</span>,<span class="string">"abc@163.com"</span>);</span><br><span class="line">     jedis.hmset(<span class="string">"hash2"</span>,map);</span><br><span class="line">     List result = jedis.hmget(<span class="string">"hash2"</span>, <span class="string">"telphone"</span>,<span class="string">"email"</span>);</span><br><span class="line"><span class="keyword">for</span> (String element : result) &#123;</span><br><span class="line">       System.out.println(element);</span><br><span class="line">     &#125;</span><br><span class="line"><span class="comment">//zset</span></span><br><span class="line">     jedis.zadd(<span class="string">"zset01"</span>,<span class="number">60</span>d,<span class="string">"v1"</span>);</span><br><span class="line">     jedis.zadd(<span class="string">"zset01"</span>,<span class="number">70</span>d,<span class="string">"v2"</span>);</span><br><span class="line">     jedis.zadd(<span class="string">"zset01"</span>,<span class="number">80</span>d,<span class="string">"v3"</span>);</span><br><span class="line">     jedis.zadd(<span class="string">"zset01"</span>,<span class="number">90</span>d,<span class="string">"v4"</span>);</span><br><span class="line">     Set s1 = jedis.zrange(<span class="string">"zset01"</span>,<span class="number">0</span>,-<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> (Iterator iterator = s1.iterator(); iterator.hasNext();) &#123;</span><br><span class="line">       String string = (String) iterator.next();</span><br><span class="line">       System.out.println(string);</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€äº‹åŠ¡æäº¤"><a href="#3ã€äº‹åŠ¡æäº¤" class="headerlink" title="3ã€äº‹åŠ¡æäº¤"></a>3ã€äº‹åŠ¡æäº¤</h3><ul><li>æ—¥å¸¸</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.redis.test;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Response;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Transaction;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test03</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"127.0.0.1"</span>,<span class="number">6379</span>);</span><br><span class="line"><span class="comment">//ç›‘æ§keyï¼Œå¦‚æœè¯¥åŠ¨äº†äº‹åŠ¡å°±è¢«æ”¾å¼ƒ</span></span><br><span class="line"><span class="comment">/*3</span></span><br><span class="line"><span class="comment">     jedis.watch("serialNum");</span></span><br><span class="line"><span class="comment">     jedis.set("serialNum","s#####################");</span></span><br><span class="line"><span class="comment">     jedis.unwatch();*/</span></span><br><span class="line">     Transaction transaction = jedis.multi();<span class="comment">//è¢«å½“ä½œä¸€ä¸ªå‘½ä»¤è¿›è¡Œæ‰§è¡Œ</span></span><br><span class="line">     Response response = transaction.get(<span class="string">"serialNum"</span>);</span><br><span class="line">     transaction.set(<span class="string">"serialNum"</span>,<span class="string">"s002"</span>);</span><br><span class="line">     response = transaction.get(<span class="string">"serialNum"</span>);</span><br><span class="line">     transaction.lpush(<span class="string">"list3"</span>,<span class="string">"a"</span>);</span><br><span class="line">     transaction.lpush(<span class="string">"list3"</span>,<span class="string">"b"</span>);</span><br><span class="line">     transaction.lpush(<span class="string">"list3"</span>,<span class="string">"c"</span>);</span><br><span class="line">     transaction.exec();</span><br><span class="line"><span class="comment">//2 transaction.discard();</span></span><br><span class="line">     System.out.println(<span class="string">"serialNum***********"</span>+response.get());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åŠ é”</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTransaction</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">transMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"127.0.0.1"</span>, <span class="number">6379</span>);</span><br><span class="line"><span class="keyword">int</span> balance;<span class="comment">// å¯ç”¨ä½™é¢</span></span><br><span class="line"><span class="keyword">int</span> debt;<span class="comment">// æ¬ é¢</span></span><br><span class="line"><span class="keyword">int</span> amtToSubtract = <span class="number">10</span>;<span class="comment">// å®åˆ·é¢åº¦</span></span><br><span class="line">     jedis.watch(<span class="string">"balance"</span>);</span><br><span class="line"><span class="comment">//jedis.set("balance","5");//æ­¤å¥ä¸è¯¥å‡ºç°ï¼Œè®²è¯¾æ–¹ä¾¿ã€‚æ¨¡æ‹Ÿå…¶ä»–ç¨‹åºå·²ç»ä¿®æ”¹äº†è¯¥æ¡ç›®</span></span><br><span class="line">     balance = Integer.parseInt(jedis.get(<span class="string">"balance"</span>));</span><br><span class="line"><span class="keyword">if</span> (balance </span><br><span class="line">       jedis.unwatch();</span><br><span class="line">       System.out.println(<span class="string">"modify"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       System.out.println(<span class="string">"***********transaction"</span>);</span><br><span class="line">Transaction transaction = jedis.multi();</span><br><span class="line">       transaction.decrBy(<span class="string">"balance"</span>, amtToSubtract);</span><br><span class="line">       transaction.incrBy(<span class="string">"debt"</span>, amtToSubtract);</span><br><span class="line">       transaction.exec();</span><br><span class="line">       balance = Integer.parseInt(jedis.get(<span class="string">"balance"</span>));</span><br><span class="line">       debt = Integer.parseInt(jedis.get(<span class="string">"debt"</span>));</span><br><span class="line">       System.out.println(<span class="string">"*******"</span> + balance);</span><br><span class="line">       System.out.println(<span class="string">"*******"</span> + debt);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é€šä¿—ç‚¹è®²ï¼Œwatchå‘½ä»¤å°±æ˜¯æ ‡è®°ä¸€ä¸ªé”®ï¼Œå¦‚æœæ ‡è®°äº†ä¸€ä¸ªé”®ï¼Œ åœ¨æäº¤äº‹åŠ¡å‰å¦‚æœè¯¥é”®è¢«åˆ«äººä¿®æ”¹è¿‡ï¼Œé‚£äº‹åŠ¡å°±ä¼šå¤±è´¥ï¼Œè¿™ç§æƒ…å†µé€šå¸¸å¯ä»¥åœ¨ç¨‹åºä¸­</span></span><br><span class="line"><span class="comment">   * é‡æ–°å†å°è¯•ä¸€æ¬¡ã€‚</span></span><br><span class="line"><span class="comment">   * é¦–å…ˆæ ‡è®°äº†é”®balanceï¼Œç„¶åæ£€æŸ¥ä½™é¢æ˜¯å¦è¶³å¤Ÿï¼Œä¸è¶³å°±å–æ¶ˆæ ‡è®°ï¼Œå¹¶ä¸åšæ‰£å‡ï¼› è¶³å¤Ÿçš„è¯ï¼Œå°±å¯åŠ¨äº‹åŠ¡è¿›è¡Œæ›´æ–°æ“ä½œï¼Œ</span></span><br><span class="line"><span class="comment">   * å¦‚æœåœ¨æ­¤æœŸé—´é”®balanceè¢«å…¶å®ƒäººä¿®æ”¹ï¼Œ é‚£åœ¨æäº¤äº‹åŠ¡ï¼ˆæ‰§è¡Œexecï¼‰æ—¶å°±ä¼šæŠ¥é”™ï¼Œ ç¨‹åºä¸­é€šå¸¸å¯ä»¥æ•è·è¿™ç±»é”™è¯¯å†é‡æ–°æ‰§è¡Œä¸€æ¬¡ï¼Œç›´åˆ°æˆåŠŸã€‚</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">     TestTransaction test = <span class="keyword">new</span> TestTransaction();</span><br><span class="line"><span class="keyword">boolean</span> retValue = test.transMethod();</span><br><span class="line">     System.out.println(<span class="string">"main retValue-------: "</span> + retValue);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€ä¸»ä»å¤åˆ¶"><a href="#4ã€ä¸»ä»å¤åˆ¶" class="headerlink" title="4ã€ä¸»ä»å¤åˆ¶"></a>4ã€ä¸»ä»å¤åˆ¶</h3><p>6379,6380å¯åŠ¨ï¼Œå…ˆå„è‡ªå…ˆç‹¬ç«‹</p><p>ä¸»å†™</p><p>ä»è¯»</p><h2 id="ä¸‰ã€JedisPool"><a href="#ä¸‰ã€JedisPool" class="headerlink" title="ä¸‰ã€JedisPool"></a>ä¸‰ã€JedisPool</h2><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>MaxTotal</td><td>æ§åˆ¶ä¸€ä¸ª pool å¯åˆ†é…å¤šå°‘ä¸ª jedis å®ä¾‹ï¼Œé€šè¿‡ pool.getResource()æ¥è·å–ï¼›å¦‚æœèµ‹å€¼ä¸º-1ï¼Œåˆ™è¡¨ç¤ºä¸é™åˆ¶ï¼›å¦‚æœ pool å·²ç»åˆ†é…äº† MaxTotal ä¸ª jedis å®ä¾‹ï¼Œåˆ™æ­¤æ—¶ pool çš„çŠ¶æ€ä¸º exhaustedã€‚</td></tr><tr><td>maxIdle</td><td>æ§åˆ¶ä¸€ä¸ª pool æœ€å¤šæœ‰å¤šå°‘ä¸ªçŠ¶æ€ä¸º idle(ç©ºé—²)çš„ jedis å®ä¾‹ã€‚</td></tr><tr><td>MaxWaitMillis</td><td>è¡¨ç¤ºå½“ borrow ä¸€ä¸ª jedis å®ä¾‹æ—¶ï¼Œæœ€å¤§çš„ç­‰å¾…æ¯«ç§’æ•°ï¼Œå¦‚æœè¶…è¿‡ç­‰å¾…æ—¶é—´ï¼Œåˆ™ç›´æ¥æŠ› JedisConnectionExceptionã€‚</td></tr><tr><td>testOnBorrow</td><td>è·å¾—ä¸€ä¸ª jedis å®ä¾‹çš„æ—¶å€™æ˜¯å¦æ£€æŸ¥è¿æ¥å¯ç”¨æ€§ï¼ˆping()ï¼‰ï¼›å¦‚æœä¸º trueï¼Œåˆ™å¾—åˆ°çš„ jediså®ä¾‹å‡æ˜¯å¯ç”¨çš„ã€‚</td></tr></tbody></table></div><p>è·å–Jediså®ä¾‹éœ€è¦ä»JedisPoolä¸­è·å–ï¼Œç”¨å®ŒJediså®ä¾‹éœ€è¦è¿”è¿˜ç»™JedisPoolï¼Œå¦‚æœJedisåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºé”™ï¼Œåˆ™ä¹Ÿéœ€è¦è¿˜ç»™JedisPool</p><p>æ¡ˆä¾‹è§ä»£ç </p><p>JedisPoolUtil</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.redis.test;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisPoolUtil</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> JedisPool jedisPool = <span class="keyword">null</span>;<span class="comment">//è¢«volatileä¿®é¥°çš„å˜é‡ä¸ä¼šè¢«æœ¬åœ°çº¿ç¨‹ç¼“å­˜ï¼Œå¯¹è¯¥å˜é‡çš„è¯»å†™éƒ½æ˜¯ç›´æ¥æ“ä½œå…±äº«å†…å­˜ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">JedisPoolUtil</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JedisPool <span class="title">getJedisPoolInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">null</span> == jedisPool)</span><br><span class="line">    &#123;</span><br><span class="line"><span class="keyword">synchronized</span> (JedisPoolUtil<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">      </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">null</span> == jedisPool)</span><br><span class="line">         &#123;</span><br><span class="line">           JedisPoolConfig poolConfig = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">           poolConfig.setMaxTotal(<span class="number">200</span>);<span class="comment">//æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">           poolConfig.setMaxActive(<span class="number">1000</span>);</span><br><span class="line">           poolConfig.setMaxIdle(<span class="number">32</span>); <span class="comment">//æœ€å¤§ç©ºé—²è¿æ¥æ•°</span></span><br><span class="line">           poolConfig.setMaxWait(<span class="number">100</span>*<span class="number">1000</span>);</span><br><span class="line">           poolConfig.setBlockWhenExhausted(<span class="keyword">true</span>); <span class="comment">//è¿æ¥è€—å°½æ—¶æ˜¯å¦é˜»å¡, falseæŠ¥å¼‚å¸¸,tureé˜»å¡ç›´åˆ°è¶…æ—¶, é»˜è®¤true</span></span><br><span class="line">           poolConfig.setTestOnBorrow(<span class="keyword">true</span>); <span class="comment">//åœ¨è·å–è¿æ¥çš„æ—¶å€™æ£€æŸ¥æœ‰æ•ˆæ€§, é»˜è®¤false</span></span><br><span class="line">jedisPool = <span class="keyword">new</span> JedisPool(poolConfig,<span class="string">"127.0.0.1"</span>);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span> jedisPool;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">(JedisPool jedisPool,Jedis jedis)</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">null</span> != jedis)</span><br><span class="line">    &#123;</span><br><span class="line">      jedisPool.returnResourceObject(jedis);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Demo5:  jedisPool.getResource();</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.redis.test;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">     JedisPool jedisPool = JedisPoolUtil.getJedisPoolInstance();</span><br><span class="line">     Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> </span><br><span class="line">     &#123;</span><br><span class="line">       jedis = jedisPool.getResource();</span><br><span class="line">       jedis.set(<span class="string">"k18"</span>,<span class="string">"v183"</span>);</span><br><span class="line">     &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">       e.printStackTrace();</span><br><span class="line">     &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">       JedisPoolUtil.release(jedisPool, jedis);</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®æ€»ç»“all</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">JedisPoolçš„é…ç½®å‚æ•°å¤§éƒ¨åˆ†æ˜¯ç”±JedisPoolConfigçš„å¯¹åº”é¡¹æ¥èµ‹å€¼çš„ã€‚</span><br><span class="line">maxActiveï¼šæ§åˆ¶ä¸€ä¸ªpoolå¯åˆ†é…å¤šå°‘ä¸ªjediså®ä¾‹ï¼Œé€šè¿‡pool.getResource()æ¥è·å–ï¼›å¦‚æœèµ‹å€¼ä¸º-1ï¼Œåˆ™è¡¨ç¤ºä¸é™åˆ¶ï¼›å¦‚æœpoolå·²ç»åˆ†é…äº†maxActiveä¸ªjediså®ä¾‹ï¼Œåˆ™æ­¤æ—¶poolçš„çŠ¶æ€ä¸ºexhaustedã€‚</span><br><span class="line">maxIdleï¼šæ§åˆ¶ä¸€ä¸ªpoolæœ€å¤šæœ‰å¤šå°‘ä¸ªçŠ¶æ€ä¸ºidle(ç©ºé—²)çš„jediså®ä¾‹ï¼›</span><br><span class="line">whenExhaustedActionï¼šè¡¨ç¤ºå½“poolä¸­çš„jediså®ä¾‹éƒ½è¢«allocatedå®Œæ—¶ï¼Œpoolè¦é‡‡å–çš„æ“ä½œï¼›é»˜è®¤æœ‰ä¸‰ç§ã€‚</span><br><span class="line"> WHEN_EXHAUSTED_FAIL --&gt; è¡¨ç¤ºæ— jediså®ä¾‹æ—¶ï¼Œç›´æ¥æŠ›å‡ºNoSuchElementExceptionï¼›</span><br><span class="line"> WHEN_EXHAUSTED_BLOCK --&gt; åˆ™è¡¨ç¤ºé˜»å¡ä½ï¼Œæˆ–è€…è¾¾åˆ°maxWaitæ—¶æŠ›å‡ºJedisConnectionExceptionï¼›</span><br><span class="line"> WHEN_EXHAUSTED_GROW --&gt; åˆ™è¡¨ç¤ºæ–°å»ºä¸€ä¸ªjediså®ä¾‹ï¼Œä¹Ÿå°±è¯´è®¾ç½®çš„maxActiveæ— ç”¨ï¼›</span><br><span class="line">maxWaitï¼šè¡¨ç¤ºå½“borrowä¸€ä¸ªjediså®ä¾‹æ—¶ï¼Œæœ€å¤§çš„ç­‰å¾…æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡ç­‰å¾…æ—¶é—´ï¼Œåˆ™ç›´æ¥æŠ›JedisConnectionExceptionï¼›</span><br><span class="line">testOnBorrowï¼šè·å¾—ä¸€ä¸ªjediså®ä¾‹çš„æ—¶å€™æ˜¯å¦æ£€æŸ¥è¿æ¥å¯ç”¨æ€§ï¼ˆping()ï¼‰ï¼›å¦‚æœä¸ºtrueï¼Œåˆ™å¾—åˆ°çš„jediså®ä¾‹å‡æ˜¯å¯ç”¨çš„ï¼›</span><br><span class="line">testOnReturnï¼šreturn ä¸€ä¸ªjediså®ä¾‹ç»™poolæ—¶ï¼Œæ˜¯å¦æ£€æŸ¥è¿æ¥å¯ç”¨æ€§ï¼ˆping()ï¼‰ï¼›</span><br><span class="line">testWhileIdleï¼šå¦‚æœä¸ºtrueï¼Œè¡¨ç¤ºæœ‰ä¸€ä¸ªidle object evitorçº¿ç¨‹å¯¹idle objectè¿›è¡Œæ‰«æï¼Œå¦‚æœvalidateå¤±è´¥ï¼Œæ­¤objectä¼šè¢«ä»poolä¸­dropæ‰ï¼›è¿™ä¸€é¡¹åªæœ‰åœ¨timeBetweenEvictionRunsMilliså¤§äº0æ—¶æ‰æœ‰æ„ä¹‰ï¼›</span><br><span class="line">timeBetweenEvictionRunsMillisï¼šè¡¨ç¤ºidle object evitorä¸¤æ¬¡æ‰«æä¹‹é—´è¦sleepçš„æ¯«ç§’æ•°ï¼›</span><br><span class="line">numTestsPerEvictionRunï¼šè¡¨ç¤ºidle object evitoræ¯æ¬¡æ‰«æçš„æœ€å¤šçš„å¯¹è±¡æ•°ï¼›</span><br><span class="line">minEvictableIdleTimeMillisï¼šè¡¨ç¤ºä¸€ä¸ªå¯¹è±¡è‡³å°‘åœç•™åœ¨idleçŠ¶æ€çš„æœ€çŸ­æ—¶é—´ï¼Œç„¶åæ‰èƒ½è¢«idle object evitoræ‰«æå¹¶é©±é€ï¼›è¿™ä¸€é¡¹åªæœ‰åœ¨timeBetweenEvictionRunsMilliså¤§äº0æ—¶æ‰æœ‰æ„ä¹‰ï¼›</span><br><span class="line">softMinEvictableIdleTimeMillisï¼šåœ¨minEvictableIdleTimeMillisåŸºç¡€ä¸Šï¼ŒåŠ å…¥äº†è‡³å°‘minIdleä¸ªå¯¹è±¡å·²ç»åœ¨poolé‡Œé¢äº†ã€‚å¦‚æœä¸º-1ï¼Œevictedä¸ä¼šæ ¹æ®idle timeé©±é€ä»»ä½•å¯¹è±¡ã€‚å¦‚æœminEvictableIdleTimeMillis&gt;0ï¼Œåˆ™æ­¤é¡¹è®¾ç½®æ— æ„ä¹‰ï¼Œä¸”åªæœ‰åœ¨timeBetweenEvictionRunsMilliså¤§äº0æ—¶æ‰æœ‰æ„ä¹‰ï¼›</span><br><span class="line">lifoï¼šborrowObjectè¿”å›å¯¹è±¡æ—¶ï¼Œæ˜¯é‡‡ç”¨DEFAULT_LIFOï¼ˆlast in first outï¼Œå³ç±»ä¼¼cacheçš„æœ€é¢‘ç¹ä½¿ç”¨é˜Ÿåˆ—ï¼‰ï¼Œå¦‚æœä¸ºFalseï¼Œåˆ™è¡¨ç¤ºFIFOé˜Ÿåˆ—ï¼›</span><br><span class="line">==================================================================================================================</span><br><span class="line">å…¶ä¸­JedisPoolConfigå¯¹ä¸€äº›å‚æ•°çš„é»˜è®¤è®¾ç½®å¦‚ä¸‹ï¼š</span><br><span class="line">testWhileIdle=true</span><br><span class="line">minEvictableIdleTimeMills=60000</span><br><span class="line">timeBetweenEvictionRunsMillis=30000</span><br><span class="line">numTestsPerEvictionRun=-1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisçš„å¤åˆ¶(MasterSlave)</title>
      <link href="/2020/01/22/Redis%E7%9A%84%E5%A4%8D%E5%88%B6-MasterSlave/"/>
      <url>/2020/01/22/Redis%E7%9A%84%E5%A4%8D%E5%88%B6-MasterSlave/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€-ä¸»ä»ç®€ä»‹"><a href="#ä¸€ã€-ä¸»ä»ç®€ä»‹" class="headerlink" title="ä¸€ã€ ä¸»ä»ç®€ä»‹"></a>ä¸€ã€ ä¸»ä»ç®€ä»‹</h2><p>é…ç½®å¤šå° Redis æœåŠ¡å™¨ï¼Œä»¥ä¸»æœºå’Œå¤‡æœºçš„èº«ä»½åˆ†å¼€ã€‚ä¸»æœºæ•°æ®æ›´æ–°åï¼Œæ ¹æ®é…ç½®å’Œç­–ç•¥ï¼Œè‡ªåŠ¨åŒæ­¥åˆ°å¤‡æœºçš„master/salver æœºåˆ¶ï¼Œ<strong>Masterä»¥å†™ä¸ºä¸»ï¼ŒSlaveä»¥è¯»ä¸ºä¸»</strong>ï¼ŒäºŒè€…ä¹‹é—´è‡ªåŠ¨åŒæ­¥æ•°æ®ã€‚ </p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb5b0rlln7j30qo0aidk4.jpg" alt="image-20200122140519988"></p><ul><li>ç›®çš„ï¼š</li></ul><p><strong>è¯»å†™åˆ†ç¦»</strong>æé«˜ Redis æ€§èƒ½ï¼› é¿å…å•ç‚¹æ•…éšœï¼Œ<strong>å®¹ç¾</strong>å¿«é€Ÿæ¢å¤ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4auaabqsj308x04kmxc.jpg" alt="image-20200121171335820"></p><ul><li>åŸç†ï¼š</li></ul><p>æ¯æ¬¡ä»æœºè”é€šåï¼Œéƒ½ä¼šç»™ä¸»æœºå‘é€ sync æŒ‡ä»¤(syncå‘½ä»¤ç”¨äºå¼ºåˆ¶å§æ–‡ä»¶ç³»ç»Ÿbuffçš„å†…å®¹ï¼Œå†™å…¥ç³»ç»Ÿç£ç›˜)ï¼Œä¸»æœºç«‹åˆ»è¿›è¡Œå­˜ç›˜æ“ä½œï¼Œå‘é€ RDB æ–‡ä»¶ï¼Œç»™ä»æœº ä»æœºæ”¶åˆ° RDB æ–‡ä»¶åï¼Œè¿›è¡Œå…¨ç›˜åŠ è½½ã€‚ä¹‹åæ¯æ¬¡ä¸»æœºçš„å†™æ“ä½œï¼Œéƒ½ä¼šç«‹åˆ»å‘é€ç»™ä»æœºï¼Œä»æœºæ‰§è¡Œç›¸åŒçš„å‘½ä»¤ã€‚</p><ul><li>å®˜ç½‘ï¼š</li></ul><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4axlo1vnj30p30gwq4o.jpg" alt="img"> </p><h2 id="äºŒã€æ“ä½œè¿‡ç¨‹"><a href="#äºŒã€æ“ä½œè¿‡ç¨‹" class="headerlink" title="äºŒã€æ“ä½œè¿‡ç¨‹"></a>äºŒã€æ“ä½œè¿‡ç¨‹</h2><h3 id="1ã€é…ä»-åº“-ä¸é…ä¸»-åº“"><a href="#1ã€é…ä»-åº“-ä¸é…ä¸»-åº“" class="headerlink" title="1ã€é…ä»(åº“)ä¸é…ä¸»(åº“)"></a>1ã€é…ä»(åº“)ä¸é…ä¸»(åº“)</h3><h3 id="2ã€ä»åº“é…ç½®ï¼šslaveof-ä¸»åº“IP-ä¸»åº“ç«¯å£"><a href="#2ã€ä»åº“é…ç½®ï¼šslaveof-ä¸»åº“IP-ä¸»åº“ç«¯å£" class="headerlink" title="2ã€ä»åº“é…ç½®ï¼šslaveof ä¸»åº“IP ä¸»åº“ç«¯å£"></a>2ã€ä»åº“é…ç½®ï¼šslaveof ä¸»åº“IP ä¸»åº“ç«¯å£</h3><p>æ¯æ¬¡ä¸masteræ–­å¼€ä¹‹åï¼Œéƒ½éœ€è¦é‡æ–°è¿æ¥ï¼Œé™¤éä½ é…ç½®è¿›redis.confæ–‡ä»¶</p><p>info replication : æŸ¥çœ‹æœåŠ¡çš„èŠ‚ç‚¹ä¿¡æ¯</p><h3 id="3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ç»†èŠ‚æ“ä½œ"><a href="#3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ç»†èŠ‚æ“ä½œ" class="headerlink" title="3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ç»†èŠ‚æ“ä½œ"></a>3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ç»†èŠ‚æ“ä½œ</h3><p>é™¤éæ˜¯ä¸åŒçš„ä¸»æœºé…ç½®ä¸åŒçš„ Redis æœåŠ¡ï¼Œå¦åˆ™åœ¨ä¸€å°æœºå™¨ä¸Šé¢è·‘å¤šä¸ª Redis æœåŠ¡ï¼Œéœ€è¦é…ç½®å¤šä¸ª Redis é…ç½®æ–‡ä»¶ã€‚</p><p>ï¼ˆ1ï¼‰å‡†å¤‡å¤šä¸ª Redis é…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªé…ç½®æ–‡ä»¶ï¼Œéœ€è¦é…ç½®ä»¥ä¸‹å±æ€§ </p><ul><li>daemonize yes: æœåŠ¡åœ¨åå°è¿è¡Œ </li><li>portï¼šç«¯å£å· </li><li>pidfile:pid ä¿å­˜æ–‡ä»¶ </li><li>logfileï¼šæ—¥å¿—æ–‡ä»¶(å¦‚æœæ²¡æœ‰æŒ‡å®šçš„è¯ï¼Œå°±ä¸éœ€è¦) </li><li>dump.rdb: RDB å¤‡ä»½æ–‡ä»¶çš„åç§° </li><li>appendonly å…³æ‰ï¼Œæˆ–è€…æ˜¯æ›´æ”¹ appendonly æ–‡ä»¶çš„åç§°ã€‚</li></ul><p>ï¼ˆ2ï¼‰æ ·æœ¬ï¼š</p><ul><li>include /root/redis_repilication/redis.conf </li><li>port 6379 </li><li>pidfile /var/run/redis_6379.pid </li><li>dbfilename dump_6379.rdb</li></ul><p>ï¼ˆ3ï¼‰ æ ¹æ®å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨å¤šä¸ª Redis æœåŠ¡</p><p>ï¼ˆ4ï¼‰æ¡ˆä¾‹ï¼š</p><ul><li><p>æ‹·è´å¤šä¸ªredis.confæ–‡ä»¶</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4azxvyalj31180eracd.jpg" alt="img"> </p></li><li><p>å¼€å¯daemonize yesï¼›pidæ–‡ä»¶åå­—ï¼›æŒ‡å®šç«¯å£</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4b0ijt01j30jf0efmy7.jpg" alt="img"> </p></li><li><p>logæ–‡ä»¶åå­—</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4b69zct7j30j3061aaf.jpg" alt="img"> </p></li><li><p>dump.rdbåå­—</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4b4jrsmmj30ad02cjr7.jpg" alt="img"> </p></li></ul><h3 id="4ã€å¸¸ç”¨3æ‹›"><a href="#4ã€å¸¸ç”¨3æ‹›" class="headerlink" title="4ã€å¸¸ç”¨3æ‹›"></a>4ã€å¸¸ç”¨3æ‹›</h3><p>(1) ä¸€ä¸»äºŒä»†,</p><ul><li><p>ä¸´æ—¶å»ºç«‹</p><p>åŸåˆ™ï¼šé…ä»ä¸é…ä¸»ã€‚ </p><p>é…ç½®ï¼šåœ¨ä»æœåŠ¡å™¨ä¸Šæ‰§è¡Œ SLAVEOF ip:port å‘½ä»¤ï¼› </p><p>æŸ¥çœ‹ï¼šæ‰§è¡Œ info replication å‘½ä»¤ï¼› </p></li><li><p>æ°¸ä¹…å»ºç«‹</p><p>åœ¨ä»æœºçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œç¼–å†™ slaveof å±æ€§é…ç½®ï¼</p></li></ul><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb5e6ve0jzj30d90a0gpo.jpg" alt="image-20200122155503185"></p><p>(2)ã€è–ªç«ç›¸ä¼ </p><ul><li><p>Init å¼€å§‹æ—¶éƒ½æ˜¯Master</p><p>redis-server redis6379.conf  å¯åŠ¨æœåŠ¡ç«¯</p><p>myredis redis-cli -p 6379      å¯åŠ¨å®¢æˆ·ç«¯</p></li></ul><p>  <img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4bhcppfnj311j0f4adz.jpg" alt="img"> </p><ul><li><p>ä¸€ä¸ªMasterä¸¤ä¸ªSlave</p><p>salvoes 127.0.0.1 6379  ä»æœº1</p><p>salvoes 127.0.0.1 6379  ä»æœº2</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4bhmuchhj311y0huadh.jpg" alt="img"> </p></li><li><p>æ—¥å¿—æŸ¥çœ‹</p><p>ä¸»æœºæ—¥å¿—</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4bi5qfnlj311c0ccdhx.jpg" alt="img"> </p><p>å¤‡æœºæ—¥å¿—</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4bihlarvj311d09wwfy.jpg" alt="img"> </p><p> info replication</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4bikgncbj310m0eqwgv.jpg" alt="img"> </p></li><li><p>ä¸»ä»é—®é¢˜æ¼”ç¤º</p><ol><li><p>åˆ‡å…¥ç‚¹é—®é¢˜ï¼Ÿslave1ã€slave2æ˜¯ä»å¤´å¼€å§‹å¤åˆ¶è¿˜æ˜¯ä»åˆ‡å…¥ç‚¹å¼€å§‹å¤åˆ¶? æ¯”å¦‚ä»k4è¿›æ¥ï¼Œé‚£ä¹‹å‰çš„123æ˜¯å¦ä¹Ÿå¯ä»¥å¤åˆ¶</p><p>ç­”ï¼šä»å¤´å¼€å§‹å¤åˆ¶</p></li><li><p>ä»æœºæ˜¯å¦å¯ä»¥å†™ï¼Ÿsetå¯å¦ï¼Ÿ</p><p>ç­”ï¼šä»æœºä¸å¯ä»¥å†™ã€‚å†™å…¥çš„æ—¶å€™ä¼šè¿”å›å¦‚ä¸‹é”™è¯¯ã€‚</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6380&gt; set k1 v1</span><br><span class="line">(error) READONLY You can&apos;t write against a read only replica.</span><br></pre></td></tr></table></figure><ol><li><p>ä¸»æœºshutdownåæƒ…å†µå¦‚ä½•ï¼Ÿä»æœºæ˜¯ä¸Šä½è¿˜æ˜¯åŸåœ°å¾…å‘½</p><p>ç­”ï¼šåŸåœ°å¾…å‘½</p></li><li><p>ä¸»æœºåˆå›æ¥äº†åï¼Œä¸»æœºæ–°å¢è®°å½•ï¼Œä»æœºè¿˜èƒ½å¦é¡ºåˆ©å¤åˆ¶ï¼Ÿ</p><p>ç­”ï¼šå¯ä»¥</p></li><li><p>å…¶ä¸­ä¸€å°ä»æœº down åé‡å¯ï¼Œèƒ½å¦é‡è®¤æ—§ä¸»ï¼Ÿ</p><p>ç­”ï¼šä¸ä¸€å®šï¼Œçœ‹é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦é…ç½®äº† slaveof</p></li><li><p>å¦‚æœä¸¤å°ä»æœºéƒ½ä»ä¸»æœºåŒæ­¥æ•°æ®ï¼Œæ­¤æ—¶ä¸»æœºçš„ IO å‹åŠ›ä¼šå¢å¤§ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</p><p>ç­”ï¼šæŒ‰ç…§ä¸»â€”-ä»ï¼ˆä¸»ï¼‰â€”-ä»æ¨¡å¼é…ç½®ï¼</p></li></ol></li></ul><p>(3)ã€SLAVEOF no one  å–æ¶ˆä»æœº</p><p>â€‹    ä½¿å½“å‰æ•°æ®åº“åœæ­¢ä¸å…¶ä»–æ•°æ®åº“çš„åŒæ­¥ï¼Œè½¬æˆä¸»æ•°æ®åº“</p><h2 id="ä¸‰ã€å¤åˆ¶åŸç†"><a href="#ä¸‰ã€å¤åˆ¶åŸç†" class="headerlink" title="ä¸‰ã€å¤åˆ¶åŸç†"></a>ä¸‰ã€å¤åˆ¶åŸç†</h2><ol><li>slaveå¯åŠ¨æˆåŠŸè¿æ¥åˆ°masteråä¼šå‘é€ä¸€ä¸ªsyncå‘½ä»¤</li><li>Masteræ¥åˆ°å‘½ä»¤å¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œåœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ°slave,ä»¥å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥</li><li>å…¨é‡å¤åˆ¶ï¼šè€ŒslaveæœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</li><li>å¢é‡å¤åˆ¶ï¼šMasterç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™slave,å®ŒæˆåŒæ­¥</li><li>ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿æ¥master,ä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶)å°†è¢«è‡ªåŠ¨æ‰§è¡Œ</li></ol><h2 id="å››ã€å“¨å…µæ¨¡å¼-sentinel"><a href="#å››ã€å“¨å…µæ¨¡å¼-sentinel" class="headerlink" title="å››ã€å“¨å…µæ¨¡å¼(sentinel)"></a>å››ã€å“¨å…µæ¨¡å¼(sentinel)</h2><h3 id="1ã€ç®€ä»‹"><a href="#1ã€ç®€ä»‹" class="headerlink" title="1ã€ç®€ä»‹"></a>1ã€ç®€ä»‹</h3><p>åå®¢ä¸ºä¸»çš„è‡ªåŠ¨ç‰ˆï¼Œèƒ½å¤Ÿåå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœæ•…éšœäº†æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“</p><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>Master çŠ¶æ€æ£€æµ‹</li><li>å¦‚æœ Master å¼‚å¸¸ï¼Œåˆ™ä¼šè¿›è¡Œ Master-Slave åˆ‡æ¢ï¼Œå°†å…¶ä¸­ä¸€ä¸ª Slave ä½œä¸º Masterï¼Œå°†ä¹‹å‰çš„ Master ä½œä¸ºSlave</li></ul><p><strong>ä¸‹çº¿</strong>ï¼š</p><ul><li>ä¸»è§‚ä¸‹çº¿ï¼šSubjectively Downï¼Œç®€ç§° SDOWNï¼ŒæŒ‡çš„æ˜¯å½“å‰ Sentinel å®ä¾‹å¯¹æŸä¸ª redis æœåŠ¡å™¨åšå‡ºçš„ä¸‹çº¿åˆ¤æ–­ã€‚ </li><li>å®¢è§‚ä¸‹çº¿ï¼šObjectively Downï¼Œ ç®€ç§° ODOWNï¼ŒæŒ‡çš„æ˜¯å¤šä¸ª Sentinel å®ä¾‹åœ¨å¯¹ Master Server åšå‡ºSDOWN åˆ¤æ–­ï¼Œå¹¶ä¸”é€šè¿‡ SENTINEL is-master-down-by-addr å‘½ä»¤äº’ç›¸äº¤æµä¹‹åï¼Œå¾—å‡ºçš„ Master Server ä¸‹çº¿åˆ¤æ–­ï¼Œç„¶åå¼€å¯ failover. </li></ul><p><strong>å·¥ä½œåŸç†</strong>ï¼š</p><ul><li>æ¯ä¸ª Sentinel ä»¥æ¯ç§’é’Ÿä¸€æ¬¡çš„é¢‘ç‡å‘å®ƒæ‰€çŸ¥çš„Masterã€Slaveä»¥åŠå…¶ä»– Sentinelå®ä¾‹å‘é€ä¸€ä¸ª PING å‘½ä»¤ ï¼› </li><li>å¦‚æœä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰è·ç¦»æœ€åä¸€æ¬¡æœ‰æ•ˆå›å¤ PING å‘½ä»¤çš„æ—¶é—´è¶…è¿‡ down-after-milliseconds é€‰é¡¹æ‰€æŒ‡å®šçš„å€¼ï¼Œ åˆ™è¿™ä¸ªå®ä¾‹ä¼šè¢« Sentinel æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼› </li><li>å¦‚æœä¸€ä¸ª Master è¢«æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼Œåˆ™æ­£åœ¨ç›‘è§†è¿™ä¸ª Master çš„æ‰€æœ‰ Sentinel è¦ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ç¡®è®¤ Master çš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼› </li><li>å½“æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå¤§äºç­‰äºé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼‰åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ç¡®è®¤ Master çš„ç¡®è¿›å…¥äº†ä¸» è§‚ä¸‹çº¿çŠ¶æ€ï¼Œ åˆ™ Master ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ ï¼› </li><li>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ æ¯ä¸ª Sentinel ä¼šä»¥æ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘å®ƒå·²çŸ¥çš„æ‰€æœ‰ Masterï¼ŒSlave å‘é€ INFO å‘½ä»¤ </li><li>å½“ Master è¢« Sentinel æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿æ—¶ï¼ŒSentinel å‘ä¸‹çº¿çš„ Master çš„æ‰€æœ‰ Slave å‘é€ INFO å‘½ä»¤çš„é¢‘ç‡ä¼šä» 10 ç§’ä¸€æ¬¡æ”¹ä¸ºæ¯ç§’ä¸€æ¬¡ ï¼› </li><li>è‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinel åŒæ„ Master å·²ç»ä¸‹çº¿ï¼Œ Master çš„å®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤;è‹¥ Master é‡æ–°å‘ Sentinel çš„ PING å‘½ä»¤è¿”å›æœ‰æ•ˆå›å¤ï¼Œ Master çš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ï¼› </li></ul><h3 id="2ã€é…ç½®æ­¥éª¤ï¼šå“¨å…µæ¨¡å¼éœ€è¦é…ç½®å“¨å…µçš„é…ç½®æ–‡ä»¶"><a href="#2ã€é…ç½®æ­¥éª¤ï¼šå“¨å…µæ¨¡å¼éœ€è¦é…ç½®å“¨å…µçš„é…ç½®æ–‡ä»¶" class="headerlink" title="2ã€é…ç½®æ­¥éª¤ï¼šå“¨å…µæ¨¡å¼éœ€è¦é…ç½®å“¨å…µçš„é…ç½®æ–‡ä»¶"></a>2ã€é…ç½®æ­¥éª¤ï¼šå“¨å…µæ¨¡å¼éœ€è¦é…ç½®å“¨å…µçš„é…ç½®æ–‡ä»¶</h3><ul><li><p>è°ƒæ•´ç»“æ„ï¼Œ6379å¸¦ç€80ã€81</p></li><li><p>è‡ªå®šä¹‰çš„/myredisç›®å½•ä¸‹æ–°å»ºsentinel.confæ–‡ä»¶ï¼Œ<strong>åå­—ç»ä¸èƒ½é”™</strong></p></li><li><p>é…ç½®å“¨å…µ,å¡«å†™å†…å®¹</p><p> sentinel monitor è¢«ç›‘æ§æ•°æ®åº“åå­—(è‡ªå·±èµ·åå­—) 127.0.0.1 6379 1</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb5emhowgnj30be055t8q.jpg" alt="img"> </p><p>ä¸Šé¢æœ€åä¸€ä¸ªæ•°å­—1ï¼Œè¡¨ç¤ºä¸»æœºæŒ‚æ‰åsalveæŠ•ç¥¨çœ‹è®©è°æ¥æ›¿æˆä¸ºä¸»æœºï¼Œå¾—ç¥¨æ•°å¤šå°‘åæˆä¸ºä¸»æœº</p></li><li><p>å¯åŠ¨å“¨å…µ</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb5en426qqj30ix0ecq3m.jpg" alt="img"> </p><p>redis-sentinel /myredis/sentinel.conf </p><p>ä¸Šè¿°ç›®å½•ä¾ç…§å„è‡ªçš„å®é™…æƒ…å†µé…ç½®ï¼Œå¯èƒ½ç›®å½•ä¸åŒ</p></li><li><p>åŸæœ‰çš„masteræŒ‚äº†</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb5f0ev199j311y0kg40z.jpg" alt="img"> </p></li><li><p>æŠ•ç¥¨æ–°é€‰</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb5f1lpzdej311y0kggp2.jpg" alt="img"> </p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb5fkzxyp9j30yy0u07kj.jpg" alt="image-20200122164312533"></p></li><li><p>é‡æ–°ä¸»ä»ç»§ç»­å¼€å·¥,info replicationæŸ¥æŸ¥çœ‹</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb5f1y07l5j311w0f541j.jpg" alt="img"> </p></li><li><p>é—®é¢˜ï¼šå¦‚æœä¹‹å‰çš„masteré‡å¯å›æ¥ï¼Œä¼šä¸ä¼šåŒmasterå†²çªï¼Ÿ</p><p>ç­”ï¼šä¸ä¼šå†²çªï¼Œmasteré‡å¯å›æ¥åå˜æˆäº†ä»æœºã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb5f2ifq2dj311y0fbjtz.jpg" alt="img"> </p></li></ul><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb5f7epmj6j30yu0mlnbs.jpg" alt="image-20200122163009552"></p><h2 id="äº”ã€ä¸€ç»„sentinelèƒ½åŒæ—¶ç›‘æ§å¤šä¸ªMaster"><a href="#äº”ã€ä¸€ç»„sentinelèƒ½åŒæ—¶ç›‘æ§å¤šä¸ªMaster" class="headerlink" title="äº”ã€ä¸€ç»„sentinelèƒ½åŒæ—¶ç›‘æ§å¤šä¸ªMaster"></a>äº”ã€ä¸€ç»„sentinelèƒ½åŒæ—¶ç›‘æ§å¤šä¸ªMaster</h2><h2 id="å…­ã€å¤åˆ¶çš„ç¼ºç‚¹ï¼š-å¤åˆ¶å»¶æ—¶"><a href="#å…­ã€å¤åˆ¶çš„ç¼ºç‚¹ï¼š-å¤åˆ¶å»¶æ—¶" class="headerlink" title="å…­ã€å¤åˆ¶çš„ç¼ºç‚¹ï¼š å¤åˆ¶å»¶æ—¶"></a>å…­ã€å¤åˆ¶çš„ç¼ºç‚¹ï¼š å¤åˆ¶å»¶æ—¶</h2><p>ç”±äºæ‰€æœ‰çš„å†™æ“ä½œéƒ½æ˜¯å…ˆåœ¨Masterä¸Šæ“ä½œï¼Œç„¶ååŒæ­¥æ›´æ–°åˆ°Slaveä¸Šï¼Œæ‰€ä»¥ä»MasteråŒæ­¥åˆ°Slaveæœºå™¨æœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå½“ç³»ç»Ÿå¾ˆç¹å¿™çš„æ—¶å€™ï¼Œå»¶è¿Ÿé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ï¼ŒSlaveæœºå™¨æ•°é‡çš„å¢åŠ ä¹Ÿä¼šä½¿è¿™ä¸ªé—®é¢˜æ›´åŠ ä¸¥é‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisçš„å‘å¸ƒè®¢é˜…</title>
      <link href="/2020/01/21/Redis%E7%9A%84%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/"/>
      <url>/2020/01/21/Redis%E7%9A%84%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/</url>
      
        <content type="html"><![CDATA[<h3 id="1ã€ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…"><a href="#1ã€ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…"></a>1ã€ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…</h3><p>è¿›ç¨‹é—´çš„ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€…(pub)å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…(sub)æ¥æ”¶æ¶ˆæ¯ã€‚</p><p>è®¢é˜…/å‘å¸ƒæ¶ˆæ¯å›¾ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4agp07x0j30ic0g576j.jpg" alt="img"></p><h3 id="2ã€å‘½ä»¤"><a href="#2ã€å‘½ä»¤" class="headerlink" title="2ã€å‘½ä»¤"></a>2ã€å‘½ä»¤</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4agqsnxjj30a808at90.jpg" alt="img"> </p><h3 id="3ã€æ¡ˆåˆ—"><a href="#3ã€æ¡ˆåˆ—" class="headerlink" title="3ã€æ¡ˆåˆ—"></a>3ã€æ¡ˆåˆ—</h3><p>å…ˆè®¢é˜…åå‘å¸ƒåæ‰èƒ½æ”¶åˆ°æ¶ˆæ¯ï¼Œ</p><p>1 å¯ä»¥ä¸€æ¬¡æ€§è®¢é˜…å¤šä¸ªï¼ŒSUBSCRIBE c1 c2 c3</p><p>2 æ¶ˆæ¯å‘å¸ƒï¼ŒPUBLISH c2 hello-redis</p><p>3 è®¢é˜…å¤šä¸ªï¼Œé€šé…ç¬¦<em>ï¼Œ PSUBSCRIBE new</em></p><p>4 æ”¶å–æ¶ˆæ¯ï¼Œ PUBLISH new1 redis2015</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4ap1pnzjj31jg0iqtfj.jpg" alt="image-20200121170832957"></p>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisäº‹åŠ¡</title>
      <link href="/2020/01/21/Redis%E4%BA%8B%E5%8A%A1/"/>
      <url>/2020/01/21/Redis%E4%BA%8B%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€-äº‹åŠ¡ç®€ä»‹"><a href="#ä¸€ã€-äº‹åŠ¡ç®€ä»‹" class="headerlink" title="ä¸€ã€ äº‹åŠ¡ç®€ä»‹"></a>ä¸€ã€ äº‹åŠ¡ç®€ä»‹</h2><p>å¯ä»¥ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œæœ¬è´¨æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆã€‚ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ï¼ŒæŒ‰é¡ºåºåœ°ä¸²è¡ŒåŒ–æ‰§è¡Œè€Œä¸ä¼šè¢«å…¶å®ƒå‘½ä»¤æ’å…¥ï¼Œä¸è®¸åŠ å¡ã€‚</p><p>å®˜ç½‘ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4acb3q7nj30rc0e575z.jpg" alt="img"> </p><h2 id="äºŒã€èƒ½å¹²å˜›"><a href="#äºŒã€èƒ½å¹²å˜›" class="headerlink" title="äºŒã€èƒ½å¹²å˜›"></a>äºŒã€èƒ½å¹²å˜›</h2><p>ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§çš„æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤</p><h2 id="ä¸‰ã€äº‹åŠ¡å¸¸ç”¨å‘½ä»¤"><a href="#ä¸‰ã€äº‹åŠ¡å¸¸ç”¨å‘½ä»¤" class="headerlink" title="ä¸‰ã€äº‹åŠ¡å¸¸ç”¨å‘½ä»¤"></a>ä¸‰ã€äº‹åŠ¡å¸¸ç”¨å‘½ä»¤</h2><div class="table-container"><table><thead><tr><th>MULTI</th><th>æ ‡è®°ä¸€ä¸ªäº‹åŠ¡å—çš„å¼€å§‹</th></tr></thead><tbody><tr><td>EXEC</td><td>æ‰§è¡Œäº‹åŠ¡ä¸­æ‰€æœ‰åœ¨æ’é˜Ÿç­‰å¾…çš„æŒ‡ä»¤å¹¶å°†é“¾æ¥çŠ¶æ€æ¢å¤åˆ°æ­£å¸¸å½“ä½¿ç”¨WATCH æ—¶ï¼Œåªæœ‰å½“è¢«ç›‘è§†çš„é”®æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œä¸”å…è®¸æ£€æŸ¥è®¾å®šæœºåˆ¶æ—¶ï¼ŒEXECä¼šè¢«æ‰§è¡Œ</td></tr><tr><td>DISCARD</td><td>åˆ·æ–°ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰€æœ‰åœ¨æ’é˜Ÿç­‰å¾…çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”å°†è¿æ¥çŠ¶æ€æ¢å¤åˆ°æ­£å¸¸ã€‚å¦‚æœå·²ä½¿ç”¨ WATCHï¼ŒDISCARD å°†é‡Šæ”¾æ‰€æœ‰è¢« WATCH çš„ keyã€‚</td></tr><tr><td>WATCH</td><td>æ ‡è®°æ‰€æœ‰æŒ‡å®šçš„ key è¢«ç›‘è§†èµ·æ¥ï¼Œåœ¨äº‹åŠ¡ä¸­æœ‰æ¡ä»¶çš„æ‰§è¡Œï¼ˆä¹è§‚é”ï¼‰</td></tr></tbody></table></div><h2 id="å››ã€äº‹åŠ¡çš„å¸¸è§æ¼”ç¤º"><a href="#å››ã€äº‹åŠ¡çš„å¸¸è§æ¼”ç¤º" class="headerlink" title="å››ã€äº‹åŠ¡çš„å¸¸è§æ¼”ç¤º"></a>å››ã€äº‹åŠ¡çš„å¸¸è§æ¼”ç¤º</h2><h3 id="1ã€ç®€å•ç»„é˜Ÿ"><a href="#1ã€ç®€å•ç»„é˜Ÿ" class="headerlink" title="1ã€ç®€å•ç»„é˜Ÿ"></a>1ã€ç®€å•ç»„é˜Ÿ</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb483yslwbj30g20g2dgz.jpg" alt="image-20200121153850691" style="zoom:50%;" /></p><p>MULTI å¼€å¯ç»„é˜Ÿï¼ŒEXEC ä¾æ¬¡æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‘½ä»¤ã€‚</p><p>DISCARD ä¸­é€”å–æ¶ˆç»„é˜Ÿ</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb484h8l9mj30ia098n26.jpg" alt="image-20200121153935550" style="zoom:50%;" /></p><h3 id="2ã€ç»„é˜Ÿå¤±è´¥"><a href="#2ã€ç»„é˜Ÿå¤±è´¥" class="headerlink" title="2ã€ç»„é˜Ÿå¤±è´¥"></a>2ã€ç»„é˜Ÿå¤±è´¥</h3><h4 id="2-1ã€è‡ªä½œè‡ªå—ï¼šè¯­æ³•ç¬¦åˆè§„èŒƒï¼ŒRedis-åªæœ‰åœ¨æ‰§è¡Œä¸­ï¼Œæ‰å¯ä»¥å‘ç°é”™è¯¯"><a href="#2-1ã€è‡ªä½œè‡ªå—ï¼šè¯­æ³•ç¬¦åˆè§„èŒƒï¼ŒRedis-åªæœ‰åœ¨æ‰§è¡Œä¸­ï¼Œæ‰å¯ä»¥å‘ç°é”™è¯¯" class="headerlink" title="2.1ã€è‡ªä½œè‡ªå—ï¼šè¯­æ³•ç¬¦åˆè§„èŒƒï¼ŒRedis åªæœ‰åœ¨æ‰§è¡Œä¸­ï¼Œæ‰å¯ä»¥å‘ç°é”™è¯¯"></a>2.1ã€è‡ªä½œè‡ªå—ï¼šè¯­æ³•ç¬¦åˆè§„èŒƒï¼ŒRedis åªæœ‰åœ¨æ‰§è¡Œä¸­ï¼Œæ‰å¯ä»¥å‘ç°é”™è¯¯</h4><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb488al2ftj30u00fygvt.jpg" alt="image-20200121154314629" style="zoom:50%;" /></p><p>æ­¤ç§æƒ…å†µï¼Œè¯­æ³•ç¬¦åˆè§„èŒƒï¼ŒRedis åªæœ‰åœ¨æ‰§è¡Œä¸­ï¼Œæ‰å¯ä»¥å‘ç°é”™è¯¯ã€‚è€Œåœ¨ Redis ä¸­ï¼Œå¹¶æ²¡æœ‰å›æ»šæœºåˆ¶ï¼Œå› æ­¤é”™è¯¯çš„å‘½ ä»¤ï¼Œæ— æ³•æ‰§è¡Œï¼Œæ­£ç¡®çš„å‘½ä»¤ä¼šå…¨éƒ¨æ‰§è¡Œï¼</p><h3 id="2-2ã€æ®ƒåŠæ± é±¼ï¼šé”™è¯¯çš„è¯­æ³•å‘½ä»¤"><a href="#2-2ã€æ®ƒåŠæ± é±¼ï¼šé”™è¯¯çš„è¯­æ³•å‘½ä»¤" class="headerlink" title="2.2ã€æ®ƒåŠæ± é±¼ï¼šé”™è¯¯çš„è¯­æ³•å‘½ä»¤"></a>2.2ã€æ®ƒåŠæ± é±¼ï¼šé”™è¯¯çš„è¯­æ³•å‘½ä»¤</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4ab5l5qqj30yo0fek3d.jpg" alt="image-20200121161636174" style="zoom:50%;" /></p><p>åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼ŒRedis æ£€æµ‹å‡ºæ¥äº†é”™è¯¯çš„è¯­æ³•å‘½ä»¤ï¼Œå› æ­¤å®ƒè®¤ä¸ºè¿™æ¡ç»„é˜Ÿï¼Œä¸€å®šä¼šå‘ç”Ÿé”™è¯¯ï¼Œå› æ­¤å…¨ä½“å–æ¶ˆï¼› </p><h3 id="2-3ã€Redisä¸æ”¯æŒå›æ»šï¼Œå®˜æ–¹è¯´æ˜"><a href="#2-3ã€Redisä¸æ”¯æŒå›æ»šï¼Œå®˜æ–¹è¯´æ˜" class="headerlink" title="2.3ã€Redisä¸æ”¯æŒå›æ»šï¼Œå®˜æ–¹è¯´æ˜"></a>2.3ã€Redisä¸æ”¯æŒå›æ»šï¼Œå®˜æ–¹è¯´æ˜</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb498wuvpsj30ps092ae9.jpg" alt="image-20200121161826634"></p><h3 id="äº”ã€watchç›‘æ§"><a href="#äº”ã€watchç›‘æ§" class="headerlink" title="äº”ã€watchç›‘æ§"></a>äº”ã€watchç›‘æ§</h3><h3 id="1ã€æ‚²è§‚é”-ä¹è§‚é”-CAS-Check-And-Set"><a href="#1ã€æ‚²è§‚é”-ä¹è§‚é”-CAS-Check-And-Set" class="headerlink" title="1ã€æ‚²è§‚é”/ä¹è§‚é”/CAS(Check And Set)"></a>1ã€æ‚²è§‚é”/ä¹è§‚é”/CAS(Check And Set)</h3><p>æ‚²è§‚é”ï¼š</p><p>æ‚²è§‚é”(Pessimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”</p><p>ä¹è§‚é”</p><p> ä¹è§‚é”(Optimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œ</p><p>ä¹è§‚é”ç­–ç•¥:æäº¤ç‰ˆæœ¬å¿…é¡»å¤§äºè®°å½•å½“å‰ç‰ˆæœ¬æ‰èƒ½æ‰§è¡Œæ›´æ–°</p><p>CAS</p><h3 id="2ã€åˆå§‹åŒ–ä¿¡ç”¨å¡å¯ç”¨ä½™é¢å’Œæ¬ é¢"><a href="#2ã€åˆå§‹åŒ–ä¿¡ç”¨å¡å¯ç”¨ä½™é¢å’Œæ¬ é¢" class="headerlink" title="2ã€åˆå§‹åŒ–ä¿¡ç”¨å¡å¯ç”¨ä½™é¢å’Œæ¬ é¢"></a>2ã€åˆå§‹åŒ–ä¿¡ç”¨å¡å¯ç”¨ä½™é¢å’Œæ¬ é¢</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb49djnhv2j30lv0clwf4.jpg" alt="img"> </p><h3 id="3ã€æ— åŠ å¡ç¯¡æ”¹ï¼Œå…ˆç›‘æ§å†å¼€å¯multiï¼Œä¿è¯ä¸¤ç¬”é‡‘é¢å˜åŠ¨åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…"><a href="#3ã€æ— åŠ å¡ç¯¡æ”¹ï¼Œå…ˆç›‘æ§å†å¼€å¯multiï¼Œä¿è¯ä¸¤ç¬”é‡‘é¢å˜åŠ¨åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…" class="headerlink" title="3ã€æ— åŠ å¡ç¯¡æ”¹ï¼Œå…ˆç›‘æ§å†å¼€å¯multiï¼Œä¿è¯ä¸¤ç¬”é‡‘é¢å˜åŠ¨åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…"></a>3ã€æ— åŠ å¡ç¯¡æ”¹ï¼Œå…ˆç›‘æ§å†å¼€å¯multiï¼Œä¿è¯ä¸¤ç¬”é‡‘é¢å˜åŠ¨åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb49rpx4vij30c707974i.jpg" alt="img"> </p><h3 id="4ã€æœ‰åŠ å¡ç¯¡æ”¹"><a href="#4ã€æœ‰åŠ å¡ç¯¡æ”¹" class="headerlink" title="4ã€æœ‰åŠ å¡ç¯¡æ”¹"></a>4ã€æœ‰åŠ å¡ç¯¡æ”¹</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb49xz9dhkj30d109qq3d.jpg" alt="img"> </p><p>ç›‘æ§äº†keyï¼Œå¦‚æœkeyè¢«ä¿®æ”¹äº†ï¼Œåé¢ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œå¤±æ•ˆ</p><h3 id="5ã€-unwatch"><a href="#5ã€-unwatch" class="headerlink" title="5ã€ unwatch"></a>5ã€ unwatch</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb4abgnkuzj30ds0d1wf4.jpg" alt="img"> </p><p>ä¸€æ—¦æ‰§è¡Œäº†execä¹‹å‰åŠ çš„ç›‘æ§é”éƒ½ä¼šè¢«å–æ¶ˆæ‰äº†</p><h3 id="6ã€å°ç»“"><a href="#6ã€å°ç»“" class="headerlink" title="6ã€å°ç»“"></a>6ã€å°ç»“</h3><p>WatchæŒ‡ä»¤ï¼Œç±»ä¼¼ä¹è§‚é”ï¼Œäº‹åŠ¡æäº¤æ—¶ï¼Œå¦‚æœKeyçš„å€¼å·²è¢«åˆ«çš„å®¢æˆ·ç«¯æ”¹å˜ï¼Œæ¯”å¦‚æŸä¸ªlistå·²è¢«åˆ«çš„å®¢æˆ·ç«¯push/popè¿‡äº†ï¼Œæ•´ä¸ªäº‹åŠ¡é˜Ÿåˆ—éƒ½ä¸ä¼šè¢«æ‰§è¡Œ</p><p>é€šè¿‡WATCHå‘½ä»¤åœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰ç›‘æ§äº†å¤šä¸ªKeysï¼Œå€˜è‹¥åœ¨WATCHä¹‹åæœ‰ä»»ä½•Keyçš„å€¼å‘ç”Ÿäº†å˜åŒ–ï¼ŒEXECå‘½ä»¤æ‰§è¡Œçš„äº‹åŠ¡éƒ½å°†è¢«æ”¾å¼ƒï¼ŒåŒæ—¶è¿”å›Nullmulti-bulkåº”ç­”ä»¥é€šçŸ¥è°ƒç”¨è€…äº‹åŠ¡æ‰§è¡Œå¤±è´¥</p><ul><li>Redis é‡‡ç”¨äº†ä¹è§‚é”ç­–ç•¥ï¼ˆé€šè¿‡ watch æ“ä½œï¼‰ã€‚ä¹è§‚é”æ”¯æŒè¯»æ“ä½œï¼Œé€‚ç”¨äºå¤šè¯»å°‘å†™çš„æƒ…å†µï¼ </li><li>åœ¨äº‹åŠ¡ä¸­ï¼Œå¯ä»¥é€šè¿‡ watch å‘½ä»¤æ¥åŠ é”ï¼›ä½¿ç”¨ UNWATCH å¯ä»¥å–æ¶ˆåŠ é”ï¼› </li><li>å¦‚æœåœ¨äº‹åŠ¡ä¹‹å‰ï¼Œæ‰§è¡Œäº† WATCHï¼ˆåŠ é”ï¼‰ï¼Œé‚£ä¹ˆæ‰§è¡Œ EXEC å‘½ä»¤æˆ– DISCARD å‘½ä»¤åï¼Œé”å¯¹è‡ªåŠ¨é‡Šæ”¾ï¼Œå³ä¸ éœ€è¦å†æ‰§è¡Œ UNWATCH äº†</li></ul><p>3é˜¶æ®µï¼š</p><ul><li>å¼€å¯ï¼šä»¥MULTIå¼€å§‹ä¸€ä¸ªäº‹åŠ¡</li><li>å…¥é˜Ÿï¼šå°†å¤šä¸ªå‘½ä»¤å…¥é˜Ÿåˆ°äº‹åŠ¡ä¸­ï¼Œæ¥åˆ°è¿™äº›å‘½ä»¤å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æ”¾åˆ°ç­‰å¾…æ‰§è¡Œçš„äº‹åŠ¡é˜Ÿåˆ—é‡Œé¢</li><li>æ‰§è¡Œï¼šç”±EXECå‘½ä»¤è§¦å‘äº‹åŠ¡</li></ul><p>3ç‰¹æ€§ï¼š</p><ul><li>å•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</li><li>æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µï¼šé˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…çš„è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œï¼Œä¹Ÿå°±ä¸å­˜åœ¨â€äº‹åŠ¡å†…çš„æŸ¥è¯¢è¦çœ‹åˆ°äº‹åŠ¡é‡Œçš„æ›´æ–°ï¼Œåœ¨äº‹åŠ¡å¤–æŸ¥è¯¢ä¸èƒ½çœ‹åˆ°â€è¿™ä¸ªè®©äººä¸‡åˆ†å¤´ç—›çš„é—®é¢˜</li><li>ä¸ä¿è¯åŸå­æ€§ï¼šredisåŒä¸€ä¸ªäº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»š</li></ul>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RedisæŒä¹…åŒ–</title>
      <link href="/2020/01/21/Redis%E6%8C%81%E4%B9%85%E5%8C%96/"/>
      <url>/2020/01/21/Redis%E6%8C%81%E4%B9%85%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€æ€»ä½“ä»‹ç»"><a href="#ä¸€ã€æ€»ä½“ä»‹ç»" class="headerlink" title="ä¸€ã€æ€»ä½“ä»‹ç»"></a>ä¸€ã€æ€»ä½“ä»‹ç»</h2><p><img src="/var/folders/_j/q4f8xqqd0mb_m4vpcb61zxnh0000gn/T/com.apple.MindMaster/f181d36d22/bin/F113FF9F-A358-438B-9C12-446815A9E6F0.png" alt="img"> </p><h2 id="äºŒã€RDBï¼ˆRedis-DataBaseï¼‰"><a href="#äºŒã€RDBï¼ˆRedis-DataBaseï¼‰" class="headerlink" title="äºŒã€RDBï¼ˆRedis DataBaseï¼‰"></a>äºŒã€RDBï¼ˆRedis DataBaseï¼‰</h2><h3 id="1ã€å®˜ç½‘ä»‹ç»"><a href="#1ã€å®˜ç½‘ä»‹ç»" class="headerlink" title="1ã€å®˜ç½‘ä»‹ç»"></a>1ã€å®˜ç½‘ä»‹ç»</h3><p><img src="/var/folders/_j/q4f8xqqd0mb_m4vpcb61zxnh0000gn/T/com.apple.MindMaster/f181d36d22/bin/8B6B4288-FE43-486B-8146-75D567B22B91.png" alt="img"> </p><h3 id="2ã€æ˜¯ä»€ä¹ˆï¼š"><a href="#2ã€æ˜¯ä»€ä¹ˆï¼š" class="headerlink" title="2ã€æ˜¯ä»€ä¹ˆï¼š"></a>2ã€æ˜¯ä»€ä¹ˆï¼š</h3><p>åœ¨æŒ‡å®šçš„<strong>æ—¶é—´é—´éš”</strong>å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œä¹Ÿå°±æ˜¯è¡Œè¯è®²çš„Snapshotå¿«ç…§ï¼Œå®ƒæ¢å¤æ—¶æ˜¯å°†å¿«ç…§æ–‡ä»¶ç›´æ¥è¯»åˆ°å†…å­˜é‡Œã€‚</p><p>Redisä¼šå•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½•IOæ“ä½œçš„ï¼Œè¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ã€‚</p><p>å¦‚æœéœ€è¦è¿›è¡Œ<strong>å¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿ</strong>ï¼Œé‚£RDBæ–¹å¼è¦æ¯”AOFæ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚RDBçš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚</p><h3 id="3ã€Fork"><a href="#3ã€Fork" class="headerlink" title="3ã€Fork"></a>3ã€Fork</h3><p>forkçš„ä½œç”¨æ˜¯å¤åˆ¶ä¸€ä¸ªä¸å½“å‰è¿›ç¨‹ä¸€æ ·çš„è¿›ç¨‹ã€‚æ–°è¿›ç¨‹çš„æ‰€æœ‰æ•°æ®ï¼ˆå˜é‡ã€ç¯å¢ƒå˜é‡ã€ç¨‹åºè®¡æ•°å™¨ç­‰ï¼‰æ•°å€¼éƒ½å’ŒåŸè¿›ç¨‹ä¸€è‡´ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹ï¼Œå¹¶ä½œä¸ºåŸè¿›ç¨‹çš„å­è¿›ç¨‹ã€‚</p><h3 id="4ã€rdb-ä¿å­˜çš„æ˜¯dump-rdbæ–‡ä»¶"><a href="#4ã€rdb-ä¿å­˜çš„æ˜¯dump-rdbæ–‡ä»¶" class="headerlink" title="4ã€rdb ä¿å­˜çš„æ˜¯dump.rdbæ–‡ä»¶"></a>4ã€rdb ä¿å­˜çš„æ˜¯dump.rdbæ–‡ä»¶</h3><p>RDBï¼šåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œä¹Ÿå°±æ˜¯è¡Œè¯è®²çš„ Snapshot å¿«ç…§ï¼Œå®ƒæ¢å¤æ—¶æ˜¯å°†å¿« ç…§æ–‡ä»¶ç›´æ¥è¯»åˆ°å†…å­˜é‡Œã€‚ </p><p>å·¥ä½œæœºåˆ¶ï¼šæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå°±æŠŠå†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šçš„æŒ‡å®šæ–‡ä»¶ä¸­ã€‚ </p><p>RDB æ˜¯é»˜è®¤å¼€å¯çš„ï¼ </p><p>Redis ä¼šå•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸ äº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½• IO æ“ä½œçš„ï¼Œè¿™å°±ç¡®ä¿äº†æé«˜ çš„æ€§èƒ½å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£ RDB æ–¹å¼è¦æ¯” AOF æ–¹å¼æ›´åŠ  çš„é«˜æ•ˆã€‚</p><p>RDB çš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚</p><p>ä¼˜åŠ¿ï¼šé€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤ï¼›å¯¹æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§è¦æ±‚ä¸é«˜</p><p>åŠ£åŠ¿ï¼šåœ¨ä¸€å®šé—´éš”æ—¶é—´åšä¸€æ¬¡å¤‡ä»½ï¼Œæ‰€ä»¥å¦‚æœredisæ„å¤–downæ‰çš„è¯ï¼Œå°±ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§åçš„æ‰€æœ‰ä¿®æ”¹forkçš„æ—¶å€™ï¼Œå†…å­˜ä¸­çš„æ•°æ®è¢«å…‹éš†äº†ä¸€ä»½ï¼Œå¤§è‡´2å€çš„è†¨èƒ€æ€§éœ€è¦è€ƒè™‘</p><h3 id="5ã€é…ç½®ä½ç½®"><a href="#5ã€é…ç½®ä½ç½®" class="headerlink" title="5ã€é…ç½®ä½ç½®"></a>5ã€é…ç½®ä½ç½®</h3><p><img src="/var/folders/_j/q4f8xqqd0mb_m4vpcb61zxnh0000gn/T/com.apple.MindMaster/f181d36d22/bin/BDB3F8B0-CF95-470A-8F3B-76DB3E72F9A2.png" alt="img"> </p><p>ç­–ç•¥ï¼š</p><ul><li>save 900 1 900 ç§’å†…å¦‚æœè‡³å°‘æœ‰ 1 ä¸ª key çš„å€¼å˜åŒ–ï¼Œåˆ™ä¿å­˜ </li><li>save 300 10 300 ç§’å†…å¦‚æœè‡³å°‘æœ‰ 10 ä¸ª key çš„å€¼å˜åŒ–ï¼Œåˆ™ä¿å­˜ </li><li>save 60 10000 60 ç§’å†…å¦‚æœè‡³å°‘æœ‰ 10000 ä¸ª key çš„å€¼å˜åŒ–ï¼Œåˆ™ä¿å­˜</li></ul><h3 id="6ã€å¦‚ä½•è§¦å‘RDBå¿«ç…§"><a href="#6ã€å¦‚ä½•è§¦å‘RDBå¿«ç…§" class="headerlink" title="6ã€å¦‚ä½•è§¦å‘RDBå¿«ç…§"></a>6ã€å¦‚ä½•è§¦å‘RDBå¿«ç…§</h3><p>â‘ åŸºäºè‡ªåŠ¨ä¿å­˜çš„ç­–ç•¥ </p><p>â‘¡æ‰§è¡Œ saveï¼Œæˆ–è€… bgsave å‘½ä»¤ï¼æ‰§è¡Œæ—¶ï¼Œæ˜¯é˜»å¡çŠ¶æ€ã€‚ </p><p>â‘¢æ‰§è¡Œ flushdb å‘½ä»¤ï¼Œä¹Ÿä¼šäº§ç”Ÿ dump.rdbï¼Œä½†é‡Œé¢æ˜¯ç©ºçš„ï¼Œæ²¡æœ‰æ„ä¹‰ã€‚ </p><p>â‘£å½“æ‰§è¡Œ shutdown å‘½ä»¤æ—¶ï¼Œä¹Ÿä¼šä¸»åŠ¨åœ°å¤‡ä»½æ•°æ®ã€‚</p><ul><li>é…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„å¿«ç…§é…ç½®</li></ul><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb46fr3mylj30gg0c1q3i.jpg" alt="img"> <img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb46fuahipj30fl0at0t6.jpg" alt="img"> </p><ul><li><p>å†·æ‹·è´åé‡æ–°ä½¿ç”¨:    å¯ä»¥cp dump.rdb dump_new.rdb</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb46fw95kuj30wm0c83zo.jpg" alt="img"> </p></li><li><p>å‘½ä»¤saveæˆ–è€…æ˜¯bgsave</p><p>Saveï¼šsaveæ—¶åªç®¡ä¿å­˜ï¼Œå…¶å®ƒä¸ç®¡ï¼Œå…¨éƒ¨é˜»å¡</p><p>BGSAVEï¼šRedisä¼šåœ¨åå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œå¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚å¯ä»¥é€šè¿‡lastsaveå‘½ä»¤è·å–æœ€åä¸€æ¬¡æˆåŠŸæ‰§è¡Œå¿«ç…§çš„æ—¶é—´</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb46h9sdzmj30fh0a4t90.jpg" alt="img"> </p></li><li><p>æ‰§è¡Œflushallå‘½ä»¤ï¼Œä¹Ÿä¼šäº§ç”Ÿdump.rdbæ–‡ä»¶ï¼Œä½†é‡Œé¢æ˜¯ç©ºçš„ï¼Œæ— æ„ä¹‰</p></li></ul><h3 id="7ã€å¦‚ä½•æ¢å¤"><a href="#7ã€å¦‚ä½•æ¢å¤" class="headerlink" title="7ã€å¦‚ä½•æ¢å¤"></a>7ã€å¦‚ä½•æ¢å¤</h3><p>å°†å¤‡ä»½æ–‡ä»¶ (dump.rdb) ç§»åŠ¨åˆ° redis å®‰è£…ç›®å½•å¹¶å¯åŠ¨æœåŠ¡å³å¯</p><p>CONFIG GET dirè·å–ç›®å½•</p><h3 id="8ã€å¦‚ä½•åœæ­¢"><a href="#8ã€å¦‚ä½•åœæ­¢" class="headerlink" title="8ã€å¦‚ä½•åœæ­¢"></a>8ã€å¦‚ä½•åœæ­¢</h3><p>åŠ¨æ€æ‰€æœ‰åœæ­¢RDBä¿å­˜è§„åˆ™çš„æ–¹æ³•ï¼šredis-cli config set save â€œâ€</p><h3 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb46n8oizij30o20ftq4e.jpg" alt="img"> </p><h2 id="ä¸‰ã€AOFï¼ˆAppend-Only-Fileï¼‰"><a href="#ä¸‰ã€AOFï¼ˆAppend-Only-Fileï¼‰" class="headerlink" title="ä¸‰ã€AOFï¼ˆAppend Only Fileï¼‰"></a>ä¸‰ã€AOFï¼ˆAppend Only Fileï¼‰</h2><h3 id="1ã€å®˜ç½‘ä»‹ç»-1"><a href="#1ã€å®˜ç½‘ä»‹ç»-1" class="headerlink" title="1ã€å®˜ç½‘ä»‹ç»"></a>1ã€å®˜ç½‘ä»‹ç»</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb46nazwamj30lg0hvmyy.jpg" alt="img"> </p><h3 id="2ã€æ˜¯ä»€ä¹ˆï¼š-1"><a href="#2ã€æ˜¯ä»€ä¹ˆï¼š-1" class="headerlink" title="2ã€æ˜¯ä»€ä¹ˆï¼š"></a>2ã€æ˜¯ä»€ä¹ˆï¼š</h3><p>ä»¥æ—¥å¿—çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œï¼Œå°†Redisæ‰§è¡Œè¿‡çš„æ‰€æœ‰å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥(è¯»æ“ä½œä¸è®°å½•)ï¼Œåªè®¸è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶ï¼Œrediså¯åŠ¨ä¹‹åˆä¼šè¯»å–è¯¥æ–‡ä»¶é‡æ–°æ„å»ºæ•°æ®ï¼Œæ¢è¨€ä¹‹ï¼Œredisé‡å¯çš„è¯å°±æ ¹æ®æ—¥å¿—æ–‡ä»¶çš„å†…å®¹å°†å†™æŒ‡ä»¤ä»å‰åˆ°åæ‰§è¡Œä¸€æ¬¡ä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œ</p><h3 id="3ã€Aofä¿å­˜çš„æ˜¯appendonly-aofæ–‡ä»¶"><a href="#3ã€Aofä¿å­˜çš„æ˜¯appendonly-aofæ–‡ä»¶" class="headerlink" title="3ã€Aofä¿å­˜çš„æ˜¯appendonly.aofæ–‡ä»¶"></a>3ã€Aofä¿å­˜çš„æ˜¯appendonly.aofæ–‡ä»¶</h3><ul><li><p>AOF æ˜¯ä»¥æ—¥å¿—çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œï¼Œå°†æ¯ä¸€æ¬¡å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œéƒ½æŠŠæ–°å»ºã€ä¿®æ”¹æ•°æ®çš„å‘½ä»¤ä¿å­˜åˆ°æŒ‡ å®šæ–‡ä»¶ä¸­ã€‚Redis é‡æ–°å¯åŠ¨æ—¶è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œé‡æ–°æ‰§è¡Œæ–°å»ºã€ä¿®æ”¹æ•°æ®çš„å‘½ä»¤æ¢å¤æ•°æ®ã€‚ </p></li><li><p>é»˜è®¤ä¸å¼€å¯ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯</p></li><li><p>AOF æ–‡ä»¶çš„ä¿å­˜è·¯å¾„ï¼ŒåŒ RDB çš„è·¯å¾„ä¸€è‡´ã€‚ </p></li><li><p>AOF åœ¨ä¿å­˜å‘½ä»¤çš„æ—¶å€™ï¼Œåªä¼šä¿å­˜å¯¹æ•°æ®æœ‰ä¿®æ”¹çš„å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯å†™æ“ä½œï¼ </p></li><li><p>å½“ RDB å’Œ AOF å­˜çš„ä¸ä¸€è‡´çš„æƒ…å†µä¸‹ï¼ŒæŒ‰ç…§ AOF æ¥æ¢å¤ã€‚å› ä¸º AOF æ˜¯å¯¹ RDB çš„è¡¥å……ã€‚å¤‡ä»½å‘¨æœŸæ›´çŸ­ï¼Œä¹Ÿå°±æ›´ </p><p>å¯é ã€‚</p></li></ul><h3 id="4ã€é…ç½®ä½ç½®"><a href="#4ã€é…ç½®ä½ç½®" class="headerlink" title="4ã€é…ç½®ä½ç½®"></a>4ã€é…ç½®ä½ç½®</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb46osdca8j30im0czgm5.jpg" alt="img"> </p><h3 id="5ã€AOFå¯åŠ¨-ä¿®å¤-æ¢å¤"><a href="#5ã€AOFå¯åŠ¨-ä¿®å¤-æ¢å¤" class="headerlink" title="5ã€AOFå¯åŠ¨/ä¿®å¤/æ¢å¤"></a>5ã€AOFå¯åŠ¨/ä¿®å¤/æ¢å¤</h3><ul><li><p>æ­£å¸¸æ¢å¤</p><p>å¯åŠ¨ï¼šè®¾ç½®Yes ï¼›ä¿®æ”¹é»˜è®¤çš„appendonly noï¼Œæ”¹ä¸ºyes</p><p>å°†æœ‰æ•°æ®çš„aofæ–‡ä»¶å¤åˆ¶ä¸€ä»½ä¿å­˜åˆ°å¯¹åº”ç›®å½•(config get dir)</p><p>æ¢å¤ï¼šé‡å¯redisç„¶åé‡æ–°åŠ è½½</p></li><li><p>å¼‚å¸¸æ¢å¤</p><p>å¤‡ä»½è¢«å†™åçš„AOFæ–‡ä»¶</p><p>ä¿®å¤ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb46qiat1lj310c0emgo2.jpg" alt="img"> </p></li></ul><p>â€‹     redis-check-aof â€”fixè¿›è¡Œä¿®å¤ï¼Œ</p><p>â€‹     æ¢å¤ï¼šé‡å¯redisç„¶åé‡æ–°åŠ è½½</p><h3 id="6ã€ä¿æŒç­–ç•¥"><a href="#6ã€ä¿æŒç­–ç•¥" class="headerlink" title="6ã€ä¿æŒç­–ç•¥"></a>6ã€ä¿æŒç­–ç•¥</h3><ul><li>appendfsync alwaysï¼šæ¯æ¬¡äº§ç”Ÿä¸€æ¡æ–°çš„ä¿®æ”¹æ•°æ®çš„å‘½ä»¤éƒ½æ‰§è¡Œä¿å­˜æ“ä½œï¼›æ•ˆç‡ä½ï¼Œä½†æ˜¯å®‰å…¨ï¼ </li><li>appendfsync everysecï¼šæ¯ç§’æ‰§è¡Œä¸€æ¬¡ä¿å­˜æ“ä½œã€‚å¦‚æœåœ¨æœªä¿å­˜å½“å‰ç§’å†…æ“ä½œæ—¶å‘ç”Ÿäº†æ–­ç”µï¼Œä»ç„¶ä¼šå¯¼è‡´ä¸€éƒ¨åˆ†æ•°æ® ä¸¢å¤±ï¼ˆå³ 1 ç§’é’Ÿçš„æ•°æ®ï¼‰ã€‚ </li><li>appendfsync noï¼šä»ä¸ä¿å­˜ï¼Œå°†æ•°æ®äº¤ç»™æ“ä½œç³»ç»Ÿæ¥å¤„ç†ã€‚æ›´å¿«ï¼Œä¹Ÿæ›´ä¸å®‰å…¨çš„é€‰æ‹©ã€‚ </li><li>æ¨èï¼ˆå¹¶ä¸”ä¹Ÿæ˜¯é»˜è®¤ï¼‰çš„æªæ–½ä¸ºæ¯ç§’ fsync ä¸€æ¬¡ï¼Œ è¿™ç§ fsync ç­–ç•¥å¯ä»¥å…¼é¡¾é€Ÿåº¦å’Œå®‰å…¨æ€§ã€‚</li></ul><h3 id="7ã€rewrite"><a href="#7ã€rewrite" class="headerlink" title="7ã€rewrite"></a>7ã€rewrite</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb47sm8sxhj30ra0fqmyt.jpg" alt="img"> </p><ul><li><p>æ˜¯ä»€ä¹ˆï¼š</p><p>AOFé‡‡ç”¨æ–‡ä»¶è¿½åŠ æ–¹å¼ï¼Œæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ä¸ºé¿å…å‡ºç°æ­¤ç§æƒ…å†µï¼Œæ–°å¢äº†é‡å†™æœºåˆ¶,å½“AOFæ–‡ä»¶çš„å¤§å°è¶…è¿‡æ‰€è®¾å®šçš„é˜ˆå€¼æ—¶ï¼ŒRediså°±ä¼šå¯åŠ¨AOFæ–‡ä»¶çš„å†…å®¹å‹ç¼©ï¼Œåªä¿ç•™å¯ä»¥æ¢å¤æ•°æ®çš„æœ€å°æŒ‡ä»¤é›†.å¯ä»¥ä½¿ç”¨å‘½ä»¤bgrewriteaof</p></li><li><p>é‡å†™åŸç†ï¼š</p><p>AOFæ–‡ä»¶æŒç»­å¢é•¿è€Œè¿‡å¤§æ—¶ï¼Œä¼šforkå‡ºä¸€æ¡æ–°è¿›ç¨‹æ¥å°†æ–‡ä»¶é‡å†™(ä¹Ÿæ˜¯å…ˆå†™ä¸´æ—¶æ–‡ä»¶æœ€åå†rename)ï¼Œéå†æ–°è¿›ç¨‹çš„å†…å­˜ä¸­æ•°æ®ï¼Œæ¯æ¡è®°å½•æœ‰ä¸€æ¡çš„Setè¯­å¥ã€‚é‡å†™aofæ–‡ä»¶çš„æ“ä½œï¼Œå¹¶æ²¡æœ‰è¯»å–æ—§çš„aofæ–‡ä»¶ï¼Œè€Œæ˜¯å°†æ•´ä¸ªå†…å­˜ä¸­çš„æ•°æ®åº“å†…å®¹ç”¨å‘½ä»¤çš„æ–¹å¼é‡å†™äº†ä¸€ä¸ªæ–°çš„aofæ–‡ä»¶ï¼Œè¿™ç‚¹å’Œå¿«ç…§æœ‰ç‚¹ç±»ä¼¼</p></li><li><p>è§¦å‘æœºåˆ¶ï¼š</p><p>Redisä¼šè®°å½•ä¸Šæ¬¡é‡å†™æ—¶çš„AOFå¤§å°ï¼Œé»˜è®¤é…ç½®æ˜¯å½“AOFæ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡rewriteåå¤§å°çš„ä¸€å€ä¸”æ–‡ä»¶å¤§äº64Mæ—¶è§¦å‘</p></li></ul><h2 id="å››ã€ä¼˜ç¼ºç‚¹"><a href="#å››ã€ä¼˜ç¼ºç‚¹" class="headerlink" title="å››ã€ä¼˜ç¼ºç‚¹"></a>å››ã€ä¼˜ç¼ºç‚¹</h2><h3 id="1ã€ä¼˜åŠ¿"><a href="#1ã€ä¼˜åŠ¿" class="headerlink" title="1ã€ä¼˜åŠ¿"></a>1ã€ä¼˜åŠ¿</h3><p>æ¯ä¿®æ”¹åŒæ­¥ï¼šappendfsync always   åŒæ­¥æŒä¹…åŒ– æ¯æ¬¡å‘ç”Ÿæ•°æ®å˜æ›´ä¼šè¢«ç«‹å³è®°å½•åˆ°ç£ç›˜  æ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½</p><p>æ¯ç§’åŒæ­¥ï¼šappendfsync everysec    å¼‚æ­¥æ“ä½œï¼Œæ¯ç§’è®°å½•   å¦‚æœä¸€ç§’å†…å®•æœºï¼Œæœ‰æ•°æ®ä¸¢å¤±</p><p>ä¸åŒæ­¥ï¼šappendfsync no   ä»ä¸åŒæ­¥</p><h3 id="2ã€åŠ£åŠ¿"><a href="#2ã€åŠ£åŠ¿" class="headerlink" title="2ã€åŠ£åŠ¿"></a>2ã€åŠ£åŠ¿</h3><p>ç›¸åŒæ•°æ®é›†çš„æ•°æ®è€Œè¨€aofæ–‡ä»¶è¦è¿œå¤§äºrdbæ–‡ä»¶ï¼Œæ¢å¤é€Ÿåº¦æ…¢äºrdb</p><p>aofè¿è¡Œæ•ˆç‡è¦æ…¢äºrdb,æ¯ç§’åŒæ­¥ç­–ç•¥æ•ˆç‡è¾ƒå¥½ï¼Œä¸åŒæ­¥æ•ˆç‡å’Œrdbç›¸åŒ</p><h3 id="3ã€å°æ€»ç»“ï¼š"><a href="#3ã€å°æ€»ç»“ï¼š" class="headerlink" title="3ã€å°æ€»ç»“ï¼š"></a>3ã€å°æ€»ç»“ï¼š</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb47sirutfj30o20gzq46.jpg" alt="img"> </p><h2 id="äº”ã€æ€»ç»“-Which-one"><a href="#äº”ã€æ€»ç»“-Which-one" class="headerlink" title="äº”ã€æ€»ç»“(Which one)"></a>äº”ã€æ€»ç»“(Which one)</h2><h3 id="1ã€å®˜ç½‘å»ºè®®"><a href="#1ã€å®˜ç½‘å»ºè®®" class="headerlink" title="1ã€å®˜ç½‘å»ºè®®"></a>1ã€å®˜ç½‘å»ºè®®</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb47sghw2lj30pi0e8q41.jpg" alt="img"> </p><ul><li><p>RDBæŒä¹…åŒ–æ–¹å¼èƒ½å¤Ÿåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”èƒ½å¯¹ä½ çš„æ•°æ®è¿›è¡Œå¿«ç…§å­˜å‚¨</p></li><li><p>AOFæŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨å†™çš„æ“ä½œ,å½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤åŸå§‹çš„æ•°æ®,AOFå‘½ä»¤ä»¥redisåè®®è¿½åŠ ä¿å­˜æ¯æ¬¡å†™çš„æ“ä½œåˆ°æ–‡ä»¶æœ«å°¾.Redisè¿˜èƒ½å¯¹AOFæ–‡ä»¶è¿›è¡Œåå°é‡å†™,ä½¿å¾—AOFæ–‡ä»¶çš„ä½“ç§¯ä¸è‡³äºè¿‡å¤§</p></li><li><p>åªåšç¼“å­˜ï¼šå¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨,ä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼.</p></li><li><p>åŒæ—¶å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼š</p><p> åœ¨è¿™ç§æƒ…å†µä¸‹,å½“redisé‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥AOFæ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®,å› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯”RDBæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´.</p><p>RDBçš„æ•°æ®ä¸å®æ—¶ï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤è€…æ—¶æœåŠ¡å™¨é‡å¯ä¹Ÿåªä¼šæ‰¾AOFæ–‡ä»¶ã€‚é‚£è¦ä¸è¦åªä½¿ç”¨AOFå‘¢ï¼Ÿä½œè€…å»ºè®®ä¸è¦ï¼Œå› ä¸ºRDBæ›´é€‚åˆç”¨äºå¤‡ä»½æ•°æ®åº“(AOFåœ¨ä¸æ–­å˜åŒ–ä¸å¥½å¤‡ä»½)ï¼Œå¿«é€Ÿé‡å¯ï¼Œè€Œä¸”ä¸ä¼šæœ‰AOFå¯èƒ½æ½œåœ¨çš„bugï¼Œç•™ç€ä½œä¸ºä¸€ä¸ªä¸‡ä¸€çš„æ‰‹æ®µã€‚</p></li><li><p>æ€§èƒ½å»ºè®®ï¼š</p><p>å› ä¸ºRDBæ–‡ä»¶åªç”¨ä½œåå¤‡ç”¨é€”ï¼Œå»ºè®®åªåœ¨Slaveä¸ŠæŒä¹…åŒ–RDBæ–‡ä»¶ï¼Œè€Œä¸”åªè¦15åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡å°±å¤Ÿäº†ï¼Œ</p><p>åªä¿ç•™save 900 1è¿™æ¡è§„åˆ™ã€‚</p><p>å¦‚æœEnalbe AOFï¼Œå¥½å¤„æ˜¯åœ¨æœ€æ¶åŠ£æƒ…å†µä¸‹ä¹Ÿåªä¼šä¸¢å¤±ä¸è¶…è¿‡ä¸¤ç§’æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬è¾ƒç®€å•åªloadè‡ªå·±çš„AOFæ–‡ä»¶å°±å¯ä»¥äº†ã€‚ä»£ä»·ä¸€æ˜¯å¸¦æ¥äº†æŒç»­çš„IOï¼ŒäºŒæ˜¯AOF rewriteçš„æœ€åå°†rewriteè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–°æ•°æ®å†™åˆ°æ–°æ–‡ä»¶é€ æˆçš„é˜»å¡å‡ ä¹æ˜¯ä¸å¯é¿å…çš„ã€‚åªè¦ç¡¬ç›˜è®¸å¯ï¼Œåº”è¯¥å°½é‡å‡å°‘AOF rewriteçš„é¢‘ç‡ï¼ŒAOFé‡å†™çš„åŸºç¡€å¤§å°é»˜è®¤å€¼64Må¤ªå°äº†ï¼Œå¯ä»¥è®¾åˆ°5Gä»¥ä¸Šã€‚é»˜è®¤è¶…è¿‡åŸå¤§å°100%å¤§å°æ—¶é‡å†™å¯ä»¥æ”¹åˆ°é€‚å½“çš„æ•°å€¼ã€‚</p><p>å¦‚æœä¸Enable AOF ï¼Œä»…é Master-Slave Replication å®ç°é«˜å¯ç”¨æ€§ä¹Ÿå¯ä»¥ã€‚èƒ½çœæ‰ä¸€å¤§ç¬”IOä¹Ÿå‡å°‘äº†rewriteæ—¶å¸¦æ¥çš„ç³»ç»Ÿæ³¢åŠ¨ã€‚ä»£ä»·æ˜¯å¦‚æœMaster/SlaveåŒæ—¶å€’æ‰ï¼Œä¼šä¸¢å¤±åå‡ åˆ†é’Ÿçš„æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬ä¹Ÿè¦æ¯”è¾ƒä¸¤ä¸ªMaster/Slaveä¸­çš„RDBæ–‡ä»¶ï¼Œè½½å…¥è¾ƒæ–°çš„é‚£ä¸ªã€‚æ–°æµªå¾®åšå°±é€‰ç”¨äº†è¿™ç§æ¶æ„ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisè§£æé…ç½®æ–‡ä»¶redis.conf</title>
      <link href="/2020/01/21/Redis%E8%A7%A3%E6%9E%90%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6redis-conf/"/>
      <url>/2020/01/21/Redis%E8%A7%A3%E6%9E%90%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6redis-conf/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€redis-confçš„ä½ç½®"><a href="#ä¸€ã€redis-confçš„ä½ç½®" class="headerlink" title="ä¸€ã€redis.confçš„ä½ç½®"></a>ä¸€ã€redis.confçš„ä½ç½®</h2><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb3zl9r7qcj30gj0cjgmq.jpg" alt="img"> </p><h2 id="äºŒã€unitså•ä½"><a href="#äºŒã€unitså•ä½" class="headerlink" title="äºŒã€unitså•ä½"></a>äºŒã€unitså•ä½</h2><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb3zlaem5nj30i00650sp.jpg" alt="img"> </p><p>  1  é…ç½®å¤§å°å•ä½,å¼€å¤´å®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„åº¦é‡å•ä½ï¼Œåªæ”¯æŒbytesï¼Œä¸æ”¯æŒbit</p><p>  2  å¯¹å¤§å°å†™ä¸æ•æ„Ÿ units are case insensitive so 1GB 1Gb 1gB are all the same.</p><h2 id="ä¸‰ã€INCLUDESåŒ…å«"><a href="#ä¸‰ã€INCLUDESåŒ…å«" class="headerlink" title="ä¸‰ã€INCLUDESåŒ…å«"></a>ä¸‰ã€INCLUDESåŒ…å«</h2><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb40m2q433j30i807vt8w.jpg" alt="img"> </p><p>å’Œæˆ‘ä»¬çš„Struts2é…ç½®æ–‡ä»¶ç±»ä¼¼ï¼Œå¯ä»¥é€šè¿‡includesåŒ…å«ï¼Œredis.confå¯ä»¥ä½œä¸ºæ€»é—¸ï¼ŒåŒ…å«å…¶ä»–</p><p>å¯ä»¥å°†å…¬å…±çš„é…ç½®æ”¾å…¥åˆ°ä¸€ä¸ªå…¬å…±çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡å­é…ç½®æ–‡ä»¶å¼•å…¥çˆ¶é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ï¼ </p><p>å°†é…ç½®æŒ‰ç…§æ¨¡å—åˆ†å¼€ï¼</p><h2 id="å››ã€GENERALé€šç”¨"><a href="#å››ã€GENERALé€šç”¨" class="headerlink" title="å››ã€GENERALé€šç”¨"></a>å››ã€GENERALé€šç”¨</h2><div class="table-container"><table><thead><tr><th>å±æ€§</th><th>å«ä¹‰</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>daemonize</td><td>æ˜¯å¦ä¸ºå®ˆæŠ¤è¿›ç¨‹æ¨¡å¼è¿è¡Œ</td><td>å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼å¯ä»¥åœ¨åå°è¿è¡Œ</td></tr><tr><td>pidfile</td><td>è¿›ç¨‹ id</td><td>æ–‡ä»¶ä¿å­˜çš„è·¯å¾„ é…ç½® PID æ–‡ä»¶è·¯å¾„ï¼Œå½“ redis ä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šæŠŠ pidé»˜è®¤å†™åˆ° /var/redis/run/redis_6379.pid æ–‡ä»¶é‡Œé¢</td></tr><tr><td>loglevel</td><td>å®šä¹‰æ—¥å¿—çº§åˆ«</td><td>debugï¼ˆè®°å½•å¤§é‡æ—¥å¿—ä¿¡æ¯ï¼Œé€‚ç”¨äºå¼€å‘ã€æµ‹è¯•é˜¶æ®µï¼‰ ,verboseï¼ˆè¾ƒå¤šæ—¥å¿—ä¿¡æ¯ï¼‰,noticeï¼ˆé€‚é‡æ—¥å¿—ä¿¡æ¯ï¼Œä½¿ç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰,warningï¼ˆä»…æœ‰éƒ¨åˆ†é‡è¦ã€å…³é”®ä¿¡æ¯æ‰ä¼šè¢«è®°å½•ï¼‰</td></tr><tr><td>logfile</td><td>æ—¥å¿—æ–‡ä»¶çš„ä½ç½®</td><td>å½“æŒ‡å®šä¸ºç©ºå­—ç¬¦ä¸²æ—¶ï¼Œä¸ºæ ‡å‡†è¾“å‡ºï¼Œå¦‚æœ redis ä»¥å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼è¿è¡Œï¼Œ é‚£ä¹ˆæ—¥å¿—å°†ä¼šè¾“å‡ºåˆ°/dev/null</td></tr><tr><td>syslog-enabled</td><td>æ˜¯å¦è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—</td><td>è¦æƒ³æŠŠæ—¥å¿—è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—æœåŠ¡ä¸­ï¼Œå°±æŠŠå®ƒæ”¹æˆ yes</td></tr><tr><td>syslog-ident</td><td>è®¾ç½®ç³»ç»Ÿæ—¥å¿—çš„</td><td></td></tr><tr><td>syslog-facility</td><td>æŒ‡å®šç³»ç»Ÿæ—¥å¿—è®¾ç½®</td><td>å¿…é¡»æ˜¯ USER æˆ–è€…æ˜¯ LOCAL0-LOCAL7 ä¹‹é—´çš„å€¼</td></tr><tr><td>tcp-keepalive</td><td></td><td>å•ä½ä¸ºç§’ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™ä¸ä¼šè¿›è¡ŒKeepaliveæ£€æµ‹ï¼Œå»ºè®®è®¾ç½®æˆ60</td></tr><tr><td>tcp-backlog</td><td></td><td>è®¾ç½®tcpçš„backlogï¼Œbacklogå…¶å®æ˜¯ä¸€ä¸ªè¿æ¥é˜Ÿåˆ—ï¼Œbacklogé˜Ÿåˆ—æ€»å’Œ=æœªå®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ— + å·²ç»å®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ—ã€‚</td></tr><tr><td>databases</td><td>è®¾ç½®æ•°æ®åº“æ•°é‡</td></tr></tbody></table></div><h2 id="äº”ã€SNAPSHOTTINGå¿«ç…§"><a href="#äº”ã€SNAPSHOTTINGå¿«ç…§" class="headerlink" title="äº”ã€SNAPSHOTTINGå¿«ç…§"></a>äº”ã€SNAPSHOTTINGå¿«ç…§</h2><h3 id="1ã€-save-ä¿å­˜ç­–ç•¥-ç§’é’Ÿ-å†™æ“ä½œæ¬¡æ•°"><a href="#1ã€-save-ä¿å­˜ç­–ç•¥-ç§’é’Ÿ-å†™æ“ä½œæ¬¡æ•°" class="headerlink" title="1ã€ save ä¿å­˜ç­–ç•¥  ç§’é’Ÿ å†™æ“ä½œæ¬¡æ•°"></a>1ã€ save ä¿å­˜ç­–ç•¥  ç§’é’Ÿ å†™æ“ä½œæ¬¡æ•°</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb40ly5di7j30fh0520so.jpg" alt="img"> </p><p>RDBæ˜¯æ•´ä¸ªå†…å­˜çš„å‹ç¼©è¿‡çš„Snapshotï¼ŒRDBçš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é…ç½®å¤åˆçš„å¿«ç…§è§¦å‘æ¡ä»¶ï¼Œ</p><p>é»˜è®¤ï¼š</p><ul><li>æ˜¯1åˆ†é’Ÿå†…æ”¹äº†1ä¸‡æ¬¡ï¼Œ</li><li>æˆ–5åˆ†é’Ÿå†…æ”¹äº†10æ¬¡ï¼Œ</li><li>æˆ–15åˆ†é’Ÿå†…æ”¹äº†1æ¬¡ã€‚</li></ul><h3 id="2ã€stop-writes-on-bgsave-error-æ˜¯å¦åœ¨å¤‡ä»½å‡ºé”™æ—¶ï¼Œç»§ç»­æ¥å—å†™æ“ä½œ"><a href="#2ã€stop-writes-on-bgsave-error-æ˜¯å¦åœ¨å¤‡ä»½å‡ºé”™æ—¶ï¼Œç»§ç»­æ¥å—å†™æ“ä½œ" class="headerlink" title="2ã€stop-writes-on-bgsave-error æ˜¯å¦åœ¨å¤‡ä»½å‡ºé”™æ—¶ï¼Œç»§ç»­æ¥å—å†™æ“ä½œ"></a>2ã€stop-writes-on-bgsave-error æ˜¯å¦åœ¨å¤‡ä»½å‡ºé”™æ—¶ï¼Œç»§ç»­æ¥å—å†™æ“ä½œ</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb40lz8zr0j30hn02na9y.jpg" alt="img"> </p><p>å¦‚æœé…ç½®æˆnoï¼Œè¡¨ç¤ºä½ ä¸åœ¨ä¹æ•°æ®ä¸ä¸€è‡´æˆ–è€…æœ‰å…¶ä»–çš„æ‰‹æ®µå‘ç°å’Œæ§åˆ¶ï¼Œå¦‚æœç”¨æˆ·å¼€å¯äº† RDB å¿«ç…§åŠŸèƒ½ï¼Œé‚£ä¹ˆåœ¨ redis æŒä¹…åŒ–æ•°æ® åˆ°ç£ç›˜æ—¶å¦‚æœå‡ºç°å¤±è´¥ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œredis ä¼šåœæ­¢æ¥å—æ‰€ æœ‰çš„å†™è¯·æ±‚</p><h3 id="3ã€-rdbcompression-å¯¹äºå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥-è®¾ç½®æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚"><a href="#3ã€-rdbcompression-å¯¹äºå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥-è®¾ç½®æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚" class="headerlink" title="3ã€ rdbcompression å¯¹äºå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥ è®¾ç½®æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚"></a>3ã€ rdbcompression å¯¹äºå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥ è®¾ç½®æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb45f1jfmpj30hq02qdfq.jpg" alt="img"> </p><p>å¦‚æœæ˜¯çš„è¯ï¼Œredis ä¼šé‡‡ç”¨ LZF ç®—æ³•è¿›è¡Œå‹ç¼©ã€‚å¦‚æœä½ ä¸æƒ³æ¶ˆè€— CPU æ¥è¿›è¡Œå‹ç¼©çš„è¯ï¼Œ å¯ä»¥è®¾ç½®ä¸ºå…³é—­æ­¤åŠŸèƒ½ï¼Œä½†æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„å¿«ç…§ä¼š </p><p>æ¯”è¾ƒå¤§ã€‚</p><h3 id="4ã€-rdbchecksum-æ˜¯å¦è¿›è¡Œæ•°æ®æ ¡éªŒ"><a href="#4ã€-rdbchecksum-æ˜¯å¦è¿›è¡Œæ•°æ®æ ¡éªŒ" class="headerlink" title="4ã€ rdbchecksum æ˜¯å¦è¿›è¡Œæ•°æ®æ ¡éªŒ"></a>4ã€ rdbchecksum æ˜¯å¦è¿›è¡Œæ•°æ®æ ¡éªŒ</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb45ezsh74j30iq03w3yh.jpg" alt="img"> </p><p>rdbchecksumï¼šåœ¨å­˜å‚¨å¿«ç…§åï¼Œè¿˜å¯ä»¥è®©redisä½¿ç”¨CRC64ç®—æ³•æ¥è¿›è¡Œæ•°æ®æ ¡éªŒï¼Œä½†æ˜¯è¿™æ ·åšä¼šå¢åŠ å¤§çº¦</p><p>10%çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¦‚æœå¸Œæœ›è·å–åˆ°æœ€å¤§çš„æ€§èƒ½æå‡ï¼Œå¯ä»¥å…³é—­æ­¤åŠŸèƒ½</p><h3 id="5ã€-dbfilename"><a href="#5ã€-dbfilename" class="headerlink" title="5ã€ dbfilename"></a>5ã€ dbfilename</h3><p>RDB å¿«ç…§æ–‡ä»¶å</p><h3 id="6ã€dir-RDB-å¿«ç…§ä¿å­˜çš„ç›®å½•"><a href="#6ã€dir-RDB-å¿«ç…§ä¿å­˜çš„ç›®å½•" class="headerlink" title="6ã€dir   RDB å¿«ç…§ä¿å­˜çš„ç›®å½•"></a>6ã€dir   RDB å¿«ç…§ä¿å­˜çš„ç›®å½•</h3><p>å¿…é¡»æ˜¯ä¸€ä¸ªç›®å½•ï¼Œä¸èƒ½æ˜¯æ–‡ä»¶åã€‚æœ€å¥½æ”¹ä¸ºå›ºå®šç›®å½•ã€‚é»˜è®¤ä¸º./ä»£è¡¨æ‰§è¡Œ redis-server å‘½ä»¤æ—¶çš„å½“å‰ç›®å½•ï¼</p><h2 id="å…­ã€REPLICATION-å¤åˆ¶"><a href="#å…­ã€REPLICATION-å¤åˆ¶" class="headerlink" title="å…­ã€REPLICATION å¤åˆ¶"></a>å…­ã€REPLICATION å¤åˆ¶</h2><h2 id="ä¸ƒã€SECURITY-å®‰å…¨"><a href="#ä¸ƒã€SECURITY-å®‰å…¨" class="headerlink" title="ä¸ƒã€SECURITY å®‰å…¨"></a>ä¸ƒã€SECURITY å®‰å…¨</h2><p>è®¿é—®å¯†ç çš„æŸ¥çœ‹ã€è®¾ç½®å’Œå–æ¶ˆ</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb45ew0wvwj30m40dmaaz.jpg" alt="img"> </p><h2 id="å…«ã€LIMITS-é™åˆ¶"><a href="#å…«ã€LIMITS-é™åˆ¶" class="headerlink" title="å…«ã€LIMITS é™åˆ¶"></a>å…«ã€LIMITS é™åˆ¶</h2><h3 id="1ã€maxclients"><a href="#1ã€maxclients" class="headerlink" title="1ã€maxclients"></a>1ã€maxclients</h3><p>è®¾ç½®redisåŒæ—¶å¯ä»¥ä¸å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ä¸º10000ä¸ªå®¢æˆ·ç«¯ã€‚å½“ä½ æ— æ³•è®¾ç½®è¿›ç¨‹æ–‡ä»¶å¥æŸ„é™åˆ¶æ—¶ï¼Œredisä¼šè®¾ç½®ä¸ºå½“å‰çš„æ–‡ä»¶å¥æŸ„é™åˆ¶å€¼å‡å»32ï¼Œå› ä¸ºredisä¼šä¸ºè‡ªèº«å†…éƒ¨å¤„ç†é€»è¾‘ç•™ä¸€äº›å¥æŸ„å‡ºæ¥ã€‚å¦‚æœè¾¾åˆ°äº†æ­¤é™åˆ¶ï¼Œredisåˆ™ä¼šæ‹’ç»æ–°çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶ä¸”å‘è¿™äº›è¿æ¥è¯·æ±‚æ–¹å‘å‡ºâ€œmax number of clients reachedâ€ä»¥ä½œå›åº”ã€‚</p><h3 id="2ã€maxmemory"><a href="#2ã€maxmemory" class="headerlink" title="2ã€maxmemory"></a>2ã€maxmemory</h3><p>è®¾ç½®rediså¯ä»¥ä½¿ç”¨çš„å†…å­˜é‡ã€‚</p><p>ä¸€æ—¦åˆ°è¾¾å†…å­˜ä½¿ç”¨ä¸Šé™ï¼Œrediså°†ä¼šè¯•å›¾ç§»é™¤å†…éƒ¨æ•°æ®ï¼Œç§»é™¤è§„åˆ™å¯ä»¥é€šè¿‡maxmemory-policyæ¥æŒ‡å®šã€‚å¦‚æœredisæ— æ³•æ ¹æ®ç§»é™¤è§„åˆ™æ¥ç§»é™¤å†…å­˜ä¸­çš„æ•°æ®ï¼Œæˆ–è€…è®¾ç½®äº†â€œä¸å…è®¸ç§»é™¤â€ï¼Œé‚£ä¹ˆredisåˆ™ä¼šé’ˆå¯¹é‚£äº›éœ€è¦ç”³è¯·å†…å­˜çš„æŒ‡ä»¤è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚SETã€LPUSHç­‰ã€‚</p><p>ä½†æ˜¯å¯¹äºæ— å†…å­˜ç”³è¯·çš„æŒ‡ä»¤ï¼Œä»ç„¶ä¼šæ­£å¸¸å“åº”ï¼Œæ¯”å¦‚GETç­‰ã€‚å¦‚æœä½ çš„redisæ˜¯ä¸»redisï¼ˆè¯´æ˜ä½ çš„redisæœ‰ä»redisï¼‰ï¼Œé‚£ä¹ˆåœ¨è®¾ç½®å†…å­˜ä½¿ç”¨ä¸Šé™æ—¶ï¼Œéœ€è¦åœ¨ç³»ç»Ÿä¸­ç•™å‡ºä¸€äº›å†…å­˜ç©ºé—´ç»™åŒæ­¥é˜Ÿåˆ—ç¼“å­˜ï¼Œåªæœ‰åœ¨ä½ è®¾ç½®çš„æ˜¯â€œä¸ç§»é™¤â€çš„æƒ…å†µä¸‹ï¼Œæ‰ä¸ç”¨è€ƒè™‘è¿™ä¸ªå› ç´ </p><h3 id="3ã€maxmemory-policy"><a href="#3ã€maxmemory-policy" class="headerlink" title="3ã€maxmemory-policy"></a>3ã€maxmemory-policy</h3><p>MAXMEMORY POLICY: how Redis will select what to remove when maxmemoryis reached. You can select among five behaviors:</p><p>volatile-lru -&gt; Evict using approximated LRU among the keys with an expire set.</p><p>allkeys-lru -&gt; Evict any key using approximated LRU.</p><p>volatile-lfu -&gt; Evict using approximated LFU among the keys with an expire set.</p><p>allkeys-lfu -&gt; Evict any key using approximated LFU.</p><p>volatile-random -&gt; Remove a random key among the ones with an expire set.ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªæ•°æ®è¿›è¡Œé‡Šæ”¾ã€‚</p><p>allkeys-random -&gt; Remove a random key, any key.ä»æ•°æ®é›†ä¸­(åŒ…æ‹¬äº†è®¾ç½®è¿‡æœŸæ—¶é—´ä»¥åŠæœªè®¾ç½®è¿‡æœŸæ—¶é—´)éšæœºé€‰æ‹©ä¸€ä¸ªæ•°æ®è¿›è¡Œå…¥é‡Šæ”¾ã€‚</p><p>volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­ï¼Œé€‰æ‹©é©¬ä¸Šå°±è¦è¿‡æœŸçš„æ•°æ®è¿›è¡Œé‡Šæ”¾æ“ä½œã€‚</p><p>noeviction -&gt; Donâ€™t evict anything, just return an error on write operations.ä¸åˆ é™¤ä»»æ„æ•°æ®(ä½†redisè¿˜ä¼šæ ¹æ®å¼•ç”¨è®¡æ•°å™¨è¿›è¡Œé‡Šæ”¾å‘¦~),è¿™æ—¶å¦‚æœå†…å­˜ä¸å¤Ÿæ—¶ï¼Œä¼šç›´æ¥è¿”å›é”™è¯¯ã€‚</p><p>LRU means Least Recently Used. æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œå¦‚æœæ•°æ®æœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„å‡ ç‡ä¹Ÿæ›´é«˜ã€‚</p><p>LFU means Least Frequently Used. æœ€ä¸ç»å¸¸ä½¿ç”¨ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®åœ¨æœ€è¿‘ä¸€æ®µæ—¶é—´å†…ä½¿ç”¨æ¬¡æ•°å¾ˆå°‘ï¼Œé‚£ä¹ˆåœ¨å°†æ¥ä¸€æ®µæ—¶é—´å†…è¢«ä½¿ç”¨çš„å¯èƒ½æ€§ä¹Ÿå¾ˆå°ã€‚</p><h3 id="4ã€maxmemory-samples"><a href="#4ã€maxmemory-samples" class="headerlink" title="4ã€maxmemory-samples"></a>4ã€maxmemory-samples</h3><p>è®¾ç½®æ ·æœ¬æ•°é‡ï¼ŒLRUç®—æ³•å’Œæœ€å°TTLç®—æ³•éƒ½å¹¶éæ˜¯ç²¾ç¡®çš„ç®—æ³•ï¼Œè€Œæ˜¯ä¼°ç®—å€¼ï¼Œæ‰€ä»¥ä½ å¯ä»¥è®¾ç½®æ ·æœ¬çš„å¤§å°ï¼Œredisé»˜è®¤ä¼šæ£€æŸ¥è¿™ä¹ˆå¤šä¸ªkeyå¹¶é€‰æ‹©å…¶ä¸­LRUçš„é‚£ä¸ª</p><h3 id="ä¹ã€APPEND-ONLY-MODEè¿½åŠ "><a href="#ä¹ã€APPEND-ONLY-MODEè¿½åŠ " class="headerlink" title="ä¹ã€APPEND ONLY MODEè¿½åŠ "></a>ä¹ã€APPEND ONLY MODEè¿½åŠ </h3><p> 1ã€appendonly</p><p> 2ã€appendfilename</p><p>3ã€appendfsync</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb45es28q1j30i40743yn.jpg" alt="img"> </p><p>alwaysï¼šåŒæ­¥æŒä¹…åŒ– æ¯æ¬¡å‘ç”Ÿæ•°æ®å˜æ›´ä¼šè¢«ç«‹å³è®°å½•åˆ°ç£ç›˜  æ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½</p><p>everysecï¼šå‡ºå‚é»˜è®¤æ¨èï¼Œå¼‚æ­¥æ“ä½œï¼Œæ¯ç§’è®°å½•   å¦‚æœä¸€ç§’å†…å®•æœºï¼Œæœ‰æ•°æ®ä¸¢å¤±</p><p>4ã€no-appendfsync-on-rewriteï¼šé‡å†™æ—¶æ˜¯å¦å¯ä»¥è¿ç”¨Appendfsyncï¼Œç”¨é»˜è®¤noå³å¯ï¼Œä¿è¯æ•°æ®å®‰å…¨æ€§ã€‚</p><p>5ã€auto-aof-rewrite-min-sizeï¼šè®¾ç½®é‡å†™çš„åŸºå‡†å€¼</p><p>6ã€auto-aof-rewrite-percentageï¼šè®¾ç½®é‡å†™çš„åŸºå‡†å€¼</p><h3 id="åã€å¸¸è§é…ç½®redis-confä»‹ç»"><a href="#åã€å¸¸è§é…ç½®redis-confä»‹ç»" class="headerlink" title="åã€å¸¸è§é…ç½®redis.confä»‹ç»"></a>åã€å¸¸è§é…ç½®redis.confä»‹ç»</h3><p>å‚æ•°è¯´æ˜</p><p>redis.conf é…ç½®é¡¹è¯´æ˜å¦‚ä¸‹ï¼š</p><ol><li><p>Redisé»˜è®¤ä¸æ˜¯ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œå¯ä»¥é€šè¿‡è¯¥é…ç½®é¡¹ä¿®æ”¹ï¼Œä½¿ç”¨yeså¯ç”¨å®ˆæŠ¤è¿›ç¨‹</p><p>daemonize no</p></li><li><p>å½“Redisä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œæ—¶ï¼ŒRedisé»˜è®¤ä¼šæŠŠpidå†™å…¥/var/run/redis.pidæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡pidfileæŒ‡å®š</p><p>pidfile /var/run/redis.pid</p></li><li><p>æŒ‡å®šRedisç›‘å¬ç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º6379ï¼Œä½œè€…åœ¨è‡ªå·±çš„ä¸€ç¯‡åšæ–‡ä¸­è§£é‡Šäº†ä¸ºä»€ä¹ˆé€‰ç”¨6379ä½œä¸ºé»˜è®¤ç«¯å£ï¼Œå› ä¸º6379åœ¨æ‰‹æœºæŒ‰é”®ä¸ŠMERZå¯¹åº”çš„å·ç ï¼Œè€ŒMERZå–è‡ªæ„å¤§åˆ©æ­Œå¥³Alessia Merzçš„åå­—</p><p>port 6379</p></li><li><p>ç»‘å®šçš„ä¸»æœºåœ°å€</p><p>bind 127.0.0.1</p></li><li><p>å½“å®¢æˆ·ç«¯é—²ç½®å¤šé•¿æ—¶é—´åå…³é—­è¿æ¥ï¼Œå¦‚æœæŒ‡å®šä¸º0ï¼Œè¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½</p><p>timeout 300</p></li><li><p>æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼ŒRedisæ€»å…±æ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugã€verboseã€noticeã€warningï¼Œé»˜è®¤ä¸ºverbose</p><p>loglevel verbose</p></li><li><p>æ—¥å¿—è®°å½•æ–¹å¼ï¼Œé»˜è®¤ä¸ºæ ‡å‡†è¾“å‡ºï¼Œå¦‚æœé…ç½®Redisä¸ºå®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œï¼Œè€Œè¿™é‡Œåˆé…ç½®ä¸ºæ—¥å¿—è®°å½•æ–¹å¼ä¸ºæ ‡å‡†è¾“å‡ºï¼Œåˆ™æ—¥å¿—å°†ä¼šå‘é€ç»™/dev/null</p><p>logfile stdout</p></li><li><p>è®¾ç½®æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤æ•°æ®åº“ä¸º0ï¼Œå¯ä»¥ä½¿ç”¨SELECT å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ®åº“id</p><p>databases 16</p></li><li><p>æŒ‡å®šåœ¨å¤šé•¿æ—¶é—´å†…ï¼Œæœ‰å¤šå°‘æ¬¡æ›´æ–°æ“ä½œï¼Œå°±å°†æ•°æ®åŒæ­¥åˆ°æ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥å¤šä¸ªæ¡ä»¶é…åˆ</p><p>save </p><p>Redisé»˜è®¤é…ç½®æ–‡ä»¶ä¸­æä¾›äº†ä¸‰ä¸ªæ¡ä»¶ï¼š</p></li></ol><ul><li>save 900 1</li><li>save 300 10</li><li><p>save 60 10000</p><p>åˆ†åˆ«è¡¨ç¤º900ç§’ï¼ˆ15åˆ†é’Ÿï¼‰å†…æœ‰1ä¸ªæ›´æ”¹ï¼Œ300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰å†…æœ‰10ä¸ªæ›´æ”¹ä»¥åŠ60ç§’å†…æœ‰10000ä¸ªæ›´æ”¹ã€‚</p></li></ul><ol><li><p>æŒ‡å®šå­˜å‚¨è‡³æœ¬åœ°æ•°æ®åº“æ—¶æ˜¯å¦å‹ç¼©æ•°æ®ï¼Œé»˜è®¤ä¸ºyesï¼ŒRedisé‡‡ç”¨LZFå‹ç¼©ï¼Œå¦‚æœä¸ºäº†èŠ‚çœCPUæ—¶é—´ï¼Œå¯ä»¥å…³é—­è¯¥é€‰é¡¹ï¼Œä½†ä¼šå¯¼è‡´æ•°æ®åº“æ–‡ä»¶å˜çš„å·¨å¤§</p><p>rdbcompression yes</p></li><li><p>æŒ‡å®šæœ¬åœ°æ•°æ®åº“æ–‡ä»¶åï¼Œé»˜è®¤å€¼ä¸ºdump.rdb</p><p>dbfilename dump.rdb</p></li><li><p>æŒ‡å®šæœ¬åœ°æ•°æ®åº“å­˜æ”¾ç›®å½•</p><p>dir ./</p></li><li><p>è®¾ç½®å½“æœ¬æœºä¸ºslavæœåŠ¡æ—¶ï¼Œè®¾ç½®masteræœåŠ¡çš„IPåœ°å€åŠç«¯å£ï¼Œåœ¨Rediså¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ä»masterè¿›è¡Œæ•°æ®åŒæ­¥</p><p>slaveof </p></li><li><p>å½“masteræœåŠ¡è®¾ç½®äº†å¯†ç ä¿æŠ¤æ—¶ï¼ŒslavæœåŠ¡è¿æ¥masterçš„å¯†ç </p><p>masterauth </p></li><li><p>è®¾ç½®Redisè¿æ¥å¯†ç ï¼Œå¦‚æœé…ç½®äº†è¿æ¥å¯†ç ï¼Œå®¢æˆ·ç«¯åœ¨è¿æ¥Redisæ—¶éœ€è¦é€šè¿‡AUTH å‘½ä»¤æä¾›å¯†ç ï¼Œé»˜è®¤å…³é—­</p><p>requirepass foobared</p></li><li><p>è®¾ç½®åŒä¸€æ—¶é—´æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œé»˜è®¤æ— é™åˆ¶ï¼ŒRediså¯ä»¥åŒæ—¶æ‰“å¼€çš„å®¢æˆ·ç«¯è¿æ¥æ•°ä¸ºRedisè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°ï¼Œå¦‚æœè®¾ç½® maxclients 0ï¼Œè¡¨ç¤ºä¸ä½œé™åˆ¶ã€‚å½“å®¢æˆ·ç«¯è¿æ¥æ•°åˆ°è¾¾é™åˆ¶æ—¶ï¼ŒRedisä¼šå…³é—­æ–°çš„è¿æ¥å¹¶å‘å®¢æˆ·ç«¯è¿”å›max number of clients reachedé”™è¯¯ä¿¡æ¯</p><p>maxclients 128</p></li><li><p>æŒ‡å®šRedisæœ€å¤§å†…å­˜é™åˆ¶ï¼ŒRedisåœ¨å¯åŠ¨æ—¶ä¼šæŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¾¾åˆ°æœ€å¤§å†…å­˜åï¼ŒRedisä¼šå…ˆå°è¯•æ¸…é™¤å·²åˆ°æœŸæˆ–å³å°†åˆ°æœŸçš„Keyï¼Œå½“æ­¤æ–¹æ³•å¤„ç† åï¼Œä»ç„¶åˆ°è¾¾æœ€å¤§å†…å­˜è®¾ç½®ï¼Œå°†æ— æ³•å†è¿›è¡Œå†™å…¥æ“ä½œï¼Œä½†ä»ç„¶å¯ä»¥è¿›è¡Œè¯»å–æ“ä½œã€‚Redisæ–°çš„vmæœºåˆ¶ï¼Œä¼šæŠŠKeyå­˜æ”¾å†…å­˜ï¼ŒValueä¼šå­˜æ”¾åœ¨swapåŒº</p><p>maxmemory </p></li><li><p>æŒ‡å®šæ˜¯å¦åœ¨æ¯æ¬¡æ›´æ–°æ“ä½œåè¿›è¡Œæ—¥å¿—è®°å½•ï¼ŒRedisåœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼‚æ­¥çš„æŠŠæ•°æ®å†™å…¥ç£ç›˜ï¼Œå¦‚æœä¸å¼€å¯ï¼Œå¯èƒ½ä¼šåœ¨æ–­ç”µæ—¶å¯¼è‡´ä¸€æ®µæ—¶é—´å†…çš„æ•°æ®ä¸¢å¤±ã€‚å› ä¸º redisæœ¬èº«åŒæ­¥æ•°æ®æ–‡ä»¶æ˜¯æŒ‰ä¸Šé¢saveæ¡ä»¶æ¥åŒæ­¥çš„ï¼Œæ‰€ä»¥æœ‰çš„æ•°æ®ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…åªå­˜åœ¨äºå†…å­˜ä¸­ã€‚é»˜è®¤ä¸ºno</p><p>appendonly no</p></li><li><p>æŒ‡å®šæ›´æ–°æ—¥å¿—æ–‡ä»¶åï¼Œé»˜è®¤ä¸ºappendonly.aof</p><p>appendfilename appendonly.aof</p></li><li><p>æŒ‡å®šæ›´æ–°æ—¥å¿—æ¡ä»¶ï¼Œå…±æœ‰3ä¸ªå¯é€‰å€¼ï¼š </p></li></ol><ul><li>noï¼šè¡¨ç¤ºç­‰æ“ä½œç³»ç»Ÿè¿›è¡Œæ•°æ®ç¼“å­˜åŒæ­¥åˆ°ç£ç›˜ï¼ˆå¿«ï¼‰ </li><li>alwaysï¼šè¡¨ç¤ºæ¯æ¬¡æ›´æ–°æ“ä½œåæ‰‹åŠ¨è°ƒç”¨fsync()å°†æ•°æ®å†™åˆ°ç£ç›˜ï¼ˆæ…¢ï¼Œå®‰å…¨ï¼‰ </li><li>everysecï¼šè¡¨ç¤ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼ˆæŠ˜è¡·ï¼Œé»˜è®¤å€¼ï¼‰</li><li>appendfsync everysec</li></ul><ol><li><p>æŒ‡å®šæ˜¯å¦å¯ç”¨è™šæ‹Ÿå†…å­˜æœºåˆ¶ï¼Œé»˜è®¤å€¼ä¸ºnoï¼Œç®€å•çš„ä»‹ç»ä¸€ä¸‹ï¼ŒVMæœºåˆ¶å°†æ•°æ®åˆ†é¡µå­˜æ”¾ï¼Œç”±Rediså°†è®¿é—®é‡è¾ƒå°‘çš„é¡µå³å†·æ•°æ®swapåˆ°ç£ç›˜ä¸Šï¼Œè®¿é—®å¤šçš„é¡µé¢ç”±ç£ç›˜è‡ªåŠ¨æ¢å‡ºåˆ°å†…å­˜ä¸­ï¼ˆåœ¨åé¢çš„æ–‡ç« æˆ‘ä¼šä»”ç»†åˆ†æRedisçš„VMæœºåˆ¶ï¼‰</p><p>vm-enabled no</p></li><li><p>è™šæ‹Ÿå†…å­˜æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º/tmp/redis.swapï¼Œä¸å¯å¤šä¸ªRediså®ä¾‹å…±äº«</p><p>vm-swap-file /tmp/redis.swap</p></li><li><p>å°†æ‰€æœ‰å¤§äºvm-max-memoryçš„æ•°æ®å­˜å…¥è™šæ‹Ÿå†…å­˜,æ— è®ºvm-max-memoryè®¾ç½®å¤šå°,æ‰€æœ‰ç´¢å¼•æ•°æ®éƒ½æ˜¯å†…å­˜å­˜å‚¨çš„(Redisçš„ç´¢å¼•æ•°æ® å°±æ˜¯keys),ä¹Ÿå°±æ˜¯è¯´,å½“vm-max-memoryè®¾ç½®ä¸º0çš„æ—¶å€™,å…¶å®æ˜¯æ‰€æœ‰valueéƒ½å­˜åœ¨äºç£ç›˜ã€‚é»˜è®¤å€¼ä¸º0</p><p>vm-max-memory 0</p></li><li><p>Redis swapæ–‡ä»¶åˆ†æˆäº†å¾ˆå¤šçš„pageï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥ä¿å­˜åœ¨å¤šä¸ªpageä¸Šé¢ï¼Œä½†ä¸€ä¸ªpageä¸Šä¸èƒ½è¢«å¤šä¸ªå¯¹è±¡å…±äº«ï¼Œvm-page-sizeæ˜¯è¦æ ¹æ®å­˜å‚¨çš„æ•°æ®å¤§å°æ¥è®¾å®šçš„ï¼Œä½œè€…å»ºè®®å¦‚æœå­˜å‚¨å¾ˆå¤šå°å¯¹è±¡ï¼Œpageå¤§å°æœ€å¥½è®¾ç½®ä¸º32æˆ–è€…64bytesï¼›å¦‚æœå­˜å‚¨å¾ˆå¤§å¤§å¯¹è±¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ›´å¤§çš„pageï¼Œå¦‚æœä¸ ç¡®å®šï¼Œå°±ä½¿ç”¨é»˜è®¤å€¼</p><p>vm-page-size 32</p></li><li><p>è®¾ç½®swapæ–‡ä»¶ä¸­çš„pageæ•°é‡ï¼Œç”±äºé¡µè¡¨ï¼ˆä¸€ç§è¡¨ç¤ºé¡µé¢ç©ºé—²æˆ–ä½¿ç”¨çš„bitmapï¼‰æ˜¯åœ¨æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œï¼Œåœ¨ç£ç›˜ä¸Šæ¯8ä¸ªpageså°†æ¶ˆè€—1byteçš„å†…å­˜ã€‚</p><p>vm-pages 134217728</p></li><li><p>è®¾ç½®è®¿é—®swapæ–‡ä»¶çš„çº¿ç¨‹æ•°,æœ€å¥½ä¸è¦è¶…è¿‡æœºå™¨çš„æ ¸æ•°,å¦‚æœè®¾ç½®ä¸º0,é‚£ä¹ˆæ‰€æœ‰å¯¹swapæ–‡ä»¶çš„æ“ä½œéƒ½æ˜¯ä¸²è¡Œçš„ï¼Œå¯èƒ½ä¼šé€ æˆæ¯”è¾ƒé•¿æ—¶é—´çš„å»¶è¿Ÿã€‚é»˜è®¤å€¼ä¸º4</p><p>vm-max-threads 4</p></li><li><p>è®¾ç½®åœ¨å‘å®¢æˆ·ç«¯åº”ç­”æ—¶ï¼Œæ˜¯å¦æŠŠè¾ƒå°çš„åŒ…åˆå¹¶ä¸ºä¸€ä¸ªåŒ…å‘é€ï¼Œé»˜è®¤ä¸ºå¼€å¯</p><p>glueoutputbuf yes</p></li><li><p>æŒ‡å®šåœ¨è¶…è¿‡ä¸€å®šçš„æ•°é‡æˆ–è€…æœ€å¤§çš„å…ƒç´ è¶…è¿‡æŸä¸€ä¸´ç•Œå€¼æ—¶ï¼Œé‡‡ç”¨ä¸€ç§ç‰¹æ®Šçš„å“ˆå¸Œç®—æ³•</p><p>hash-max-zipmap-entries 64</p><p>hash-max-zipmap-value 512</p></li><li><p>æŒ‡å®šæ˜¯å¦æ¿€æ´»é‡ç½®å“ˆå¸Œï¼Œé»˜è®¤ä¸ºå¼€å¯ï¼ˆåé¢åœ¨ä»‹ç»Redisçš„å“ˆå¸Œç®—æ³•æ—¶å…·ä½“ä»‹ç»ï¼‰</p><p>activerehashing yes</p></li><li><p>æŒ‡å®šåŒ…å«å…¶å®ƒçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨åŒä¸€ä¸»æœºä¸Šå¤šä¸ªRediså®ä¾‹ä¹‹é—´ä½¿ç”¨åŒä¸€ä»½é…ç½®æ–‡ä»¶ï¼Œè€ŒåŒæ—¶å„ä¸ªå®ä¾‹åˆæ‹¥æœ‰è‡ªå·±çš„ç‰¹å®šé…ç½®æ–‡ä»¶</p><p>include /path/to/local.conf</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisçš„äº”å¤§æ•°æ®ç±»å‹</title>
      <link href="/2020/01/14/Redis%E7%9A%84%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
      <url>/2020/01/14/Redis%E7%9A%84%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€Redisçš„äº”å¤§æ•°æ®ç±»å‹"><a href="#ä¸€ã€Redisçš„äº”å¤§æ•°æ®ç±»å‹" class="headerlink" title="ä¸€ã€Redisçš„äº”å¤§æ•°æ®ç±»å‹"></a>ä¸€ã€Redisçš„äº”å¤§æ•°æ®ç±»å‹</h2><ul><li><p>Stringï¼ˆå­—ç¬¦ä¸²ï¼‰</p><p>stringæ˜¯redisæœ€åŸºæœ¬çš„ç±»å‹ï¼Œå¯ä»¥ç†è§£ä¸ºMemcachedä¸€æ ·çš„ç±»å‹ï¼Œä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueã€‚</p><p>stringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œæ„æ€æ˜¯redisçš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚ipgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚</p><p>stringç±»å‹æ˜¯Redisæœ€åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼Œä¸€ä¸ªredisä¸­å­—ç¬¦ä¸²valueæœ€å¤šå¯ä»¥æ˜¯512Mã€‚</p></li><li><p>Hashï¼ˆå“ˆå¸Œï¼Œç±»ä¼¼javaé‡Œçš„Mapï¼‰</p><p>Redis hashæ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆã€‚</p><p>Redis hashæ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚</p><p>ç±»ä¼¼javaé‡Œé¢çš„Map<String,Object></p></li><li><p>Listï¼ˆåˆ—è¡¨ï¼‰</p><p>Redisåˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚</p><p>å®ƒçš„åº•å±‚æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚</p></li><li><p>Setï¼ˆé›†åˆ)</p><p>Redisçš„Setæ˜¯stringç±»å‹çš„æ— åºé›†åˆã€‚å®ƒæ˜¯é€šè¿‡HashTableå®ç°çš„ã€‚</p></li><li><p>Zsetï¼ˆsorted setï¼šæœ‰åºé›†åˆï¼‰</p><p>Redis zset å’Œ set ä¸€æ ·ä¹Ÿæ˜¯stringç±»å‹å…ƒç´ çš„é›†åˆ,ä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚</p><p>ä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„åˆ†æ•°ã€‚</p><p>redisæ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚zsetçš„æˆå‘˜æ˜¯å”¯ä¸€çš„,ä½†åˆ†æ•°(score)å´å¯ä»¥é‡å¤ã€‚</p></li></ul><p>å“ªé‡Œå»è·å¾—rediså¸¸è§æ•°æ®ç±»å‹æ“ä½œå‘½ä»¤: <a href="http://redisdoc.com/" target="_blank" rel="noopener">http://redisdoc.com/</a></p><h2 id="äºŒã€Redis-é”®-key"><a href="#äºŒã€Redis-é”®-key" class="headerlink" title="äºŒã€Redis é”®(key)"></a>äºŒã€Redis é”®(key)</h2><p>å¸¸ç”¨</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahedgtxgxj30hv0iogmu.jpg" alt="img"> </p><p>æ¡ˆä¾‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">keys *</span><br><span class="line">exists keyçš„åå­—,åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨</span><br><span class="line">move key db --&gt;å½“å‰åº“å°±æ²¡æœ‰äº†ï¼Œè¢«ç§»å‡ºäº†</span><br><span class="line">expire key ç§’é’Ÿï¼šä¸ºç»™å®šçš„keyè®¾ç½®è¿‡æœŸæ—¶é—´</span><br><span class="line">ttl keyæŸ¥çœ‹è¿˜æœ‰å¤šå°‘ç§’è¿‡æœŸï¼Œ-1è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼Œ-2è¡¨ç¤ºå·²è¿‡æœŸ</span><br><span class="line">type key æŸ¥çœ‹ä½ çš„keyæ˜¯ä»€ä¹ˆç±»å‹</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€Rediså­—ç¬¦ä¸²-String-ï¼Œå•å€¼å•value"><a href="#ä¸‰ã€Rediså­—ç¬¦ä¸²-String-ï¼Œå•å€¼å•value" class="headerlink" title="ä¸‰ã€Rediså­—ç¬¦ä¸²(String)ï¼Œå•å€¼å•value"></a>ä¸‰ã€Rediså­—ç¬¦ä¸²(String)ï¼Œå•å€¼å•value</h2><p>å¸¸ç”¨</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahef8wrbpj30ma0hi75m.jpg" alt="img"> </p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahefabmn4j30mb07f0t5.jpg" alt="img"> </p><p>æ¡ˆä¾‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set/get/del/append/strlen</span><br><span class="line">Incr/decr/incrby/decrby,ä¸€å®šè¦æ˜¯æ•°å­—æ‰èƒ½è¿›è¡ŒåŠ å‡</span><br><span class="line">getrange/setrange</span><br><span class="line">setex(set with expire)é”®ç§’å€¼/setnx(set if not exist)</span><br><span class="line">mset/mget/msetnx</span><br><span class="line">getset(å…ˆgetåœ¨set)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">append: çš„ä½¿ç”¨ï¼š</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; set k1 hello</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; append k1 h</span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;helloh&quot;</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><p>getrange:è·å–æŒ‡å®šåŒºé—´èŒƒå›´å†…çš„å€¼ï¼Œç±»ä¼¼betweenâ€¦â€¦andçš„å…³ç³»</p><ul><li>ä»é›¶åˆ°è´Ÿä¸€è¡¨ç¤ºå…¨éƒ¨:</li></ul><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahep76q5wj308r049mx5.jpg" alt="img"> </p><p>setrangeè®¾ç½®æŒ‡å®šåŒºé—´èŒƒå›´å†…çš„å€¼ï¼Œæ ¼å¼æ˜¯setrange keyå€¼ å…·ä½“å€¼</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahep8fc4dj309r043dft.jpg" alt="img"> </p><h2 id="å››ã€Redisåˆ—è¡¨-List-ï¼Œå•å€¼å¤švalue"><a href="#å››ã€Redisåˆ—è¡¨-List-ï¼Œå•å€¼å¤švalue" class="headerlink" title="å››ã€Redisåˆ—è¡¨(List)ï¼Œå•å€¼å¤švalue"></a>å››ã€Redisåˆ—è¡¨(List)ï¼Œå•å€¼å¤švalue</h2><p>å¸¸ç”¨</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gaheq787trj30mb0cwwfg.jpg" alt="img"> </p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gaheq8lhguj30md08s0t7.jpg" alt="img"> </p><p>æ¡ˆä¾‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">lpush/rpush/lrange</span><br><span class="line">lpop/rpop</span><br><span class="line">lindex,æŒ‰ç…§ç´¢å¼•ä¸‹è¡¨è·å¾—å…ƒç´ ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰</span><br><span class="line">llen</span><br><span class="line">lren key åˆ Nä¸ªvalue</span><br><span class="line">ltrim key å¼€å§‹index ç»“æŸindexï¼Œæˆªå–æŒ‡å®šèŒƒå›´çš„å€¼åå†èµ‹å€¼ç»™key</span><br><span class="line">rpoplpush æºåˆ—è¡¨ ç›®çš„åˆ—è¡¨</span><br><span class="line">lset key index value</span><br><span class="line">linsert key before/after å€¼1 å€¼2</span><br><span class="line">æ€§èƒ½æ€»ç»“</span><br><span class="line">å®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦é“¾è¡¨ï¼Œleftï¼Œrightéƒ½å¯ä»¥æ’å…¥æ·»åŠ ã€‚</span><br><span class="line">å¦‚æœé”®ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„é“¾è¡¨ã€‚</span><br><span class="line">å¦‚æœé”®å·²ç»å­˜åœ¨ï¼Œæ–°å¢å†…å®¹ã€‚</span><br><span class="line">å¦‚æœå€¼å…¨ç§»é™¤ï¼Œå¯¹åº”çš„é”®ä¹Ÿå°±æ¶ˆå¤±äº†ã€‚</span><br><span class="line">é“¾è¡¨çš„æ“ä½œæ— è®ºæ˜¯å¤´å’Œå°¾æ•ˆç‡éƒ½æé«˜ï¼Œä½†å‡å¦‚æ˜¯å¯¹ä¸­é—´å…ƒç´ è¿›è¡Œæ“ä½œï¼Œæ•ˆç‡å°±å¾ˆæƒ¨æ·¡äº†ã€‚</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahessv0whj30a80b3jrn.jpg" alt="img"> é€šè¿‡ç´¢å¼•è·å–åˆ—è¡¨ä¸­çš„å…ƒç´  lindex key index</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahet8sto5j309b03a0sn.jpg" alt="img"> </p><ul><li><p>ä»leftå¾€rightåˆ é™¤2ä¸ªå€¼ç­‰äºv1çš„å…ƒç´ ï¼Œè¿”å›çš„å€¼ä¸ºå®é™…åˆ é™¤çš„æ•°é‡</p></li><li><p>LREM list3 0 å€¼ï¼Œè¡¨ç¤ºåˆ é™¤å…¨éƒ¨ç»™å®šçš„å€¼ã€‚</p></li></ul><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahetnaoaej30em0cy74p.jpg" alt="img"> </p><ul><li>ltrimï¼šæˆªå–æŒ‡å®šç´¢å¼•åŒºé—´çš„å…ƒç´ ï¼Œæ ¼å¼æ˜¯ltrim listçš„key èµ·å§‹ç´¢å¼• ç»“æŸç´¢å¼•</li></ul><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gaheu8ut4pj30do0cpgm0.jpg" alt="img"> a </p><ul><li><p>ç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†è¯¥å…ƒç´ æ·»åŠ åˆ°å¦ä¸€ä¸ªåˆ—è¡¨å¹¶è¿”å›:</p><p>Rpoplpush list2 list3</p></li></ul><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gaheugs9e4j30a1066jrd.jpg" alt="img"> </p><ul><li>Lset list3 2 c++  é€šè¿‡ç´¢å¼•è®¾ç½®åˆ—è¡¨çš„å…ƒç´ çš„å€¼</li></ul><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gaheuqkspuj309t0fd0t1.jpg" alt="img"> </p><ul><li>åœ¨listæŸä¸ªå·²æœ‰å€¼çš„å‰åå†æ·»åŠ å…·ä½“å€¼</li></ul><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gaheuz2lsgj30dx0g1t9c.jpg" alt="img"> </p><h2 id="äº”ã€Redisé›†åˆ-Set-ï¼Œå•å€¼å¤švalue"><a href="#äº”ã€Redisé›†åˆ-Set-ï¼Œå•å€¼å¤švalue" class="headerlink" title="äº”ã€Redisé›†åˆ(Set)ï¼Œå•å€¼å¤švalue"></a>äº”ã€Redisé›†åˆ(Set)ï¼Œå•å€¼å¤švalue</h2><ul><li>å¸¸ç”¨</li></ul><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahf9sda8ej30cy0iimya.jpg" alt="img"> s</p><p>æ¡ˆä¾‹</p><ul><li>sadd/smembers/sismember</li></ul><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahfbi56gxj30av09pwep.jpg" alt="img"> </p><ul><li><p>scardï¼Œè·å–é›†åˆé‡Œé¢çš„å…ƒç´ ä¸ªæ•°</p><p>è·å–é›†åˆé‡Œé¢çš„å…ƒç´ ä¸ªæ•°</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahfblc0dyj30ao02xwee.jpg" alt="img"> </p></li><li><p>srem key value åˆ é™¤é›†åˆä¸­å…ƒç´ </p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahfbo6porj307q01x744.jpg" alt="img"> </p></li><li><p>srandmember key æŸä¸ªæ•´æ•°(éšæœºå‡ºå‡ ä¸ªæ•°)</p><p>*  ä»seté›†åˆé‡Œé¢éšæœºå–å‡º2ä¸ª</p><p>*  å¦‚æœè¶…è¿‡æœ€å¤§æ•°é‡å°±å…¨éƒ¨å–å‡ºï¼Œ</p><p>*  å¦‚æœå†™çš„å€¼æ˜¯è´Ÿæ•°ï¼Œæ¯”å¦‚-3 ï¼Œè¡¨ç¤ºéœ€è¦å–å‡º3ä¸ªï¼Œä½†æ˜¯å¯èƒ½ä¼šæœ‰é‡å¤å€¼ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahfchmmonj30970diwev.jpg" alt="img"> </p></li><li><p>spop key éšæœºå‡ºæ ˆ</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahfd7ypxkj307v07x74b.jpg" alt="img"> </p></li><li><p>smove key1 key2 åœ¨key1é‡ŒæŸä¸ªå€¼      ä½œç”¨æ˜¯å°†key1é‡Œçš„æŸä¸ªå€¼èµ‹ç»™key2</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahfdt5vwcj308s07laa3.jpg" alt="img"> </p></li><li><p>æ•°å­¦é›†åˆç±»</p><p>å·®é›†ï¼šsdiff</p><p>åœ¨ç¬¬ä¸€ä¸ªseté‡Œé¢è€Œä¸åœ¨åé¢ä»»ä½•ä¸€ä¸ªseté‡Œé¢çš„é¡¹</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahfgn46iqj309s07nwek.jpg" alt="img"> </p><p>äº¤é›†ï¼šsinter</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahfgl5p8qj309v0bbt8x.jpg" alt="img"> </p><p>å¹¶é›†ï¼šsunion</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahfghfbktj30a3057745.jpg" alt="img"> </p></li></ul><h2 id="å…­ã€Rediså“ˆå¸Œ-Hash-KVæ¨¡å¼ä¸å˜ï¼Œä½†Væ˜¯ä¸€ä¸ªé”®å€¼å¯¹"><a href="#å…­ã€Rediså“ˆå¸Œ-Hash-KVæ¨¡å¼ä¸å˜ï¼Œä½†Væ˜¯ä¸€ä¸ªé”®å€¼å¯¹" class="headerlink" title="å…­ã€Rediså“ˆå¸Œ(Hash) KVæ¨¡å¼ä¸å˜ï¼Œä½†Væ˜¯ä¸€ä¸ªé”®å€¼å¯¹"></a>å…­ã€Rediså“ˆå¸Œ(Hash) KVæ¨¡å¼ä¸å˜ï¼Œä½†Væ˜¯ä¸€ä¸ªé”®å€¼å¯¹</h2><p>å¸¸ç”¨</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38a94plyj30b50gq0un.jpg" alt="img"> </p><p>KVæ¨¡å¼ä¸å˜ï¼Œä½†Væ˜¯ä¸€ä¸ªé”®å€¼å¯¹</p><p>  hset/hget/hmset/hmget/hgetall/hdel</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38a796ilj30cx0dk754.jpg" alt="img"> </p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38a3yb7tj30er06s74o.jpg" alt="img"> </p><p>hlen</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb3z4y6ycaj30f40a2dgl.jpg"/></p><p> hexists key åœ¨keyé‡Œé¢çš„æŸä¸ªå€¼çš„key</p><p> hkeys/hvals</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38a13prwj307x06g3yj.jpg" alt="img"> </p><p> hincrby/hincrbyfloat</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb389zdij1j30b407pdg1.jpg" alt="img"> </p><p> hsetnx   </p><p>ä¸å­˜åœ¨èµ‹å€¼ï¼Œ</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38al6colj309604b3yi.jpg" alt="img"> </p><h2 id="ä¸ƒã€Redisæœ‰åºé›†åˆZset-sorted-set-åœ¨setåŸºç¡€ä¸Šï¼ŒåŠ ä¸€ä¸ªscoreå€¼"><a href="#ä¸ƒã€Redisæœ‰åºé›†åˆZset-sorted-set-åœ¨setåŸºç¡€ä¸Šï¼ŒåŠ ä¸€ä¸ªscoreå€¼" class="headerlink" title="ä¸ƒã€Redisæœ‰åºé›†åˆZset(sorted set),åœ¨setåŸºç¡€ä¸Šï¼ŒåŠ ä¸€ä¸ªscoreå€¼"></a>ä¸ƒã€Redisæœ‰åºé›†åˆZset(sorted set),åœ¨setåŸºç¡€ä¸Šï¼ŒåŠ ä¸€ä¸ªscoreå€¼</h2><p>åœ¨setåŸºç¡€ä¸Šï¼ŒåŠ ä¸€ä¸ªscoreå€¼ã€‚ä¹‹å‰setæ˜¯k1 v1 v2 v3ï¼Œç°åœ¨zsetæ˜¯k1 score1 v1 score2 v2</p><p>å¸¸ç”¨</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38aiv0ocj30mc0ckdgs.jpg" alt="img"> </p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38aglg17j30me0cpwfl.jpg" alt="img"> </p><p> zadd/zrange. æ–°å»º/æŸ¥æ‰¾</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38aeqqryj30cu0anaab.jpg" alt="img"> </p><p> zrangebyscore key å¼€å§‹score ç»“æŸscore æ˜¾ç¤ºåˆ†æ•°withscores, â€œ(â€œ è¡¨ç¤ºå°äº</p><p>zrangebyscore zset1 (70 (90 withscores           (â€œ è¡¨ç¤ºå°äº</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38az5uwwj30bt0d8mxh.jpg" alt="img"> </p><p>zrangebyscore zset1 60 -inf withscores        å¤§äºç­‰äº60åˆ†çš„</p><p>zrangebyscore zset1 (60 -inf withscores      å¤§äº60åˆ†çš„</p><p>zrangebyscore zset1 (60 +inf withscores limit 0 2     ä¸‹æ ‡ä½ç½®limitåœ¨0åˆ°2</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38b0svy1j30dw0ebwex.jpg" alt="img"> </p><p> withscores</p><p>limit ä½œç”¨æ˜¯è¿”å›é™åˆ¶  limit å¼€å§‹ä¸‹æ ‡æ­¥ å¤šå°‘æ­¥</p><p>zrem key æŸscoreä¸‹å¯¹åº”çš„valueå€¼ï¼Œä½œç”¨æ˜¯åˆ é™¤å…ƒç´ ï¼Œæ ¼å¼æ˜¯zrem zsetçš„key é¡¹çš„å€¼ï¼Œé¡¹çš„å€¼å¯ä»¥æ˜¯å¤šä¸ª zrem key scoreæŸä¸ªå¯¹åº”å€¼ï¼Œå¯ä»¥æ˜¯å¤šä¸ªå€¼</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38c33s46j30ch08gglr.jpg" alt="img"> </p><p> zcard/zcount key scoreåŒºé—´/zrank key valueså€¼ï¼Œä½œç”¨æ˜¯è·å¾—ä¸‹æ ‡å€¼/zscore key å¯¹åº”å€¼,è·å¾—åˆ†æ•°</p><p>zcard ï¼šè·å–é›†åˆä¸­å…ƒç´ ä¸ªæ•°</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38c76yfvj308f023wec.jpg" alt="img"> </p><p>zcount ï¼šè·å–åˆ†æ•°åŒºé—´å†…å…ƒç´ ä¸ªæ•°ï¼Œzcount key å¼€å§‹åˆ†æ•°åŒºé—´ ç»“æŸåˆ†æ•°åŒºé—´</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38cbjolrj30ah027745.jpg" alt="img"> </p><p>zrankï¼š è·å–valueåœ¨zsetä¸­çš„ä¸‹æ ‡ä½ç½®</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38cdft2wj30cv0ap3ys.jpg" alt="img"> </p><p>zscoreï¼šæŒ‰ç…§å€¼è·å¾—å¯¹åº”çš„åˆ†æ•°</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38cg5ii6j30d30dmwew.jpg" alt="img"> </p><p> zrevrank key valueså€¼ï¼Œä½œç”¨æ˜¯é€†åºè·å¾—ä¸‹æ ‡å€¼</p><p>æ­£åºã€é€†åºè·å¾—ä¸‹æ ‡ç´¢å¼•å€¼</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38df9wofj30b303e3yg.jpg" alt="img"> </p><p> zrevrange</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38ddi9b9j30dz0cf74n.jpg" alt="img"> </p><p> zrevrangebyscore  key ç»“æŸscore å¼€å§‹score</p><p>zrevrangebyscore zset1 90 60 withscores  åˆ†æ•°æ˜¯åç€æ¥çš„</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb38dc1xtgj30gk0d03yz.jpg" alt="img"> </p>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rediså…¥é—¨ä»‹ç»</title>
      <link href="/2020/01/14/Redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/"/>
      <url>/2020/01/14/Redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<h2 id="Rediså…¥é—¨ä»‹ç»"><a href="#Rediså…¥é—¨ä»‹ç»" class="headerlink" title="Rediså…¥é—¨ä»‹ç»"></a>Rediså…¥é—¨ä»‹ç»</h2><h2 id="Rediså…¥é—¨ä»‹ç»-1"><a href="#Rediså…¥é—¨ä»‹ç»-1" class="headerlink" title="Rediså…¥é—¨ä»‹ç»"></a>Rediså…¥é—¨ä»‹ç»</h2><h3 id="1-æ˜¯ä»€ä¹ˆ"><a href="#1-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1. æ˜¯ä»€ä¹ˆ"></a>1. æ˜¯ä»€ä¹ˆ</h3><p>Redisï¼šREmote DIctionary Serverï¼ˆè¿œç¨‹å­—å…¸æœåŠ¡å™¨ï¼‰ï¼Œæ˜¯å®Œå…¨å¼€æºå…è´¹çš„ï¼Œç”¨Cè¯­è¨€ç¼–å†™çš„ï¼Œéµå®ˆBSDåè®®ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ï¼ˆkey/valueï¼‰åˆ†å¸ƒå¼å†…å­˜æ•°æ®åº“ï¼ŒåŸºäºå†…å­˜è¿è¡Œå¹¶æ”¯æŒæŒä¹…åŒ–çš„NoSQLæ•°æ®åº“ï¼Œè¢«ç§°ä¸ºæ•°æ®ç»“æ„æ•°æ®åº“ã€‚</p><p>Redisä¸å…¶ä»–key-valueç¼“å­˜äº§å“æœ‰ä¸€ä¸‹ä¸‰ä¸ªç‰¹ç‚¹ï¼š</p><ul><li>Redisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨</li><li>Redisä¸ä»…ä»…æ”¯æŒç®€å•çš„key-valueç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾›listï¼Œsetï¼Œzsetï¼Œhashç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨</li><li>Redisæ”¯æŒæ•°æ®çš„å¤‡ä»½ï¼Œå³master-slaveæ¨¡å¼çš„æ•°æ®å¤‡ä»½ã€‚</li></ul><h3 id="2-èƒ½å¹²å˜›"><a href="#2-èƒ½å¹²å˜›" class="headerlink" title="2. èƒ½å¹²å˜›"></a>2. èƒ½å¹²å˜›</h3><ul><li>å†…å­˜å­˜å‚¨å’ŒæŒä¹…åŒ–ï¼šredisæ”¯æŒå¼‚æ­¥å°†å†…å­˜ä¸­çš„æ•°æ®å†™åˆ°ç¡¬ç›˜ä¸Šï¼ŒåŒæ—¶ä¸å½±å“ç»§ç»­æœåŠ¡ã€‚</li><li>å–æœ€æ–°Nä¸ªæ•°æ®çš„æ“ä½œï¼Œå¦‚ï¼šå¯ä»¥å°†æœ€æ–°çš„10æ¡è¯„è®ºçš„IDæ”¾åœ¨Redisçš„Listé›†åˆé‡Œé¢</li><li>æ¨¡æ‹Ÿç±»ä¼¼äºHttpSessionè¿™ç§éœ€è¦è®¾å®šè¿‡æœŸæ—¶é—´çš„åŠŸèƒ½ã€‚</li><li>å‘å¸ƒã€è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ</li><li>å®šæ—¶å™¨ã€è®¡æ•°å™¨</li></ul><h3 id="3-å»å“ªä¸‹"><a href="#3-å»å“ªä¸‹" class="headerlink" title="3. å»å“ªä¸‹"></a>3. å»å“ªä¸‹</h3><p><a href="http://redis.io/" target="_blank" rel="noopener">http://redis.io/</a><br><a href="http://www.redis.cn/" target="_blank" rel="noopener">http://www.redis.cn/</a></p><h3 id="4ã€æ€ä¹ˆç©"><a href="#4ã€æ€ä¹ˆç©" class="headerlink" title="4ã€æ€ä¹ˆç©"></a>4ã€æ€ä¹ˆç©</h3><p>æ•°æ®ç±»å‹ã€åŸºæœ¬æ“ä½œå’Œé…ç½®ã€æŒä¹…åŒ–å’Œå¤åˆ¶ï¼ŒRDB/AOFã€äº‹åŠ¡çš„æ§åˆ¶ã€å¤åˆ¶â€¦â€¦â€¦</p><h3 id="5ã€Redisçš„å®‰è£…"><a href="#5ã€Redisçš„å®‰è£…" class="headerlink" title="5ã€Redisçš„å®‰è£…"></a>5ã€Redisçš„å®‰è£…</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹è½½è·å¾—redis-3.0.4.tar.gzåå°†å®ƒæ”¾å…¥æˆ‘ä»¬çš„Linuxç›®å½•/root</span><br><span class="line">/optç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤ï¼štar -zxvf redis-3.0.4.tar.gz</span><br><span class="line">è§£å‹å®Œæˆåå‡ºç°æ–‡ä»¶å¤¹ï¼šredis-3.0.4</span><br><span class="line">åœ¨redis-3.0.4ç›®å½•ä¸‹æ‰§è¡Œmakeå‘½ä»¤</span><br><span class="line">è¿è¡Œmakeå‘½ä»¤æ˜¯æ•…æ„å‡ºç°çš„é”™è¯¯çš„è§£æï¼š</span><br><span class="line">å®‰è£…gcc</span><br><span class="line">èƒ½ä¸Šç½‘ï¼šyum install gcc-c++</span><br><span class="line">ä¸èƒ½ä¸Šç½‘ï¼š</span><br><span class="line">äºŒæ¬¡make</span><br><span class="line">Jemalloc/jemalloc.hï¼šæ²¡æœ‰é‚£ä¸ªæ–‡ä»¶ç›®å½•</span><br><span class="line">è¿è¡Œmake distcleanä¹‹åå†make</span><br><span class="line">Redis Testï¼ˆå¯ä»¥ä¸ç”¨æ‰§è¡Œï¼‰</span><br><span class="line">å¦‚æœmakeå®Œæˆåç»§ç»­æ‰§è¡Œmake install</span><br><span class="line">æŸ¥çœ‹é»˜è®¤å®‰è£…ç›®å½•ï¼šusr/local/bin</span><br><span class="line">å¯åŠ¨</span><br><span class="line">redis-server</span><br><span class="line">å…³é—­</span><br><span class="line">ctrl+c</span><br></pre></td></tr></table></figure><h4 id="5-1-æŸ¥çœ‹é»˜è®¤å®‰è£…ç›®å½•ï¼šusr-local-bin"><a href="#5-1-æŸ¥çœ‹é»˜è®¤å®‰è£…ç›®å½•ï¼šusr-local-bin" class="headerlink" title="5.1 æŸ¥çœ‹é»˜è®¤å®‰è£…ç›®å½•ï¼šusr/local/bin"></a>5.1 æŸ¥çœ‹é»˜è®¤å®‰è£…ç›®å½•ï¼šusr/local/bin</h4><ul><li>redis-benchmark:æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥åœ¨è‡ªå·±æœ¬å­è¿è¡Œï¼Œçœ‹çœ‹è‡ªå·±æœ¬å­æ€§èƒ½å¦‚ä½•</li><li>redis-check-aofï¼šä¿®å¤æœ‰é—®é¢˜çš„AOFæ–‡ä»¶ï¼Œrdbå’Œaofåé¢è®²</li><li>redis-check-dumpï¼šä¿®å¤æœ‰é—®é¢˜çš„dump.rdbæ–‡ä»¶</li><li>redis-cliï¼šå®¢æˆ·ç«¯ï¼Œæ“ä½œå…¥å£</li><li>redis-sentinelï¼šredisé›†ç¾¤ä½¿ç”¨</li><li>redis-serverï¼šRedisæœåŠ¡å™¨å¯åŠ¨å‘½ä»¤</li></ul><h4 id="5-2-å¯åŠ¨"><a href="#5-2-å¯åŠ¨" class="headerlink" title="5.2 å¯åŠ¨"></a>5.2 å¯åŠ¨</h4><ul><li>ä¿®æ”¹redis.confæ–‡ä»¶å°†é‡Œé¢çš„daemonize no æ”¹æˆ yesï¼Œè®©æœåŠ¡åœ¨åå°å¯åŠ¨ redis-server redis.conf</li><li>å°†é»˜è®¤çš„redis.confæ‹·è´åˆ°è‡ªå·±å®šä¹‰å¥½çš„ä¸€ä¸ªè·¯å¾„ä¸‹ï¼Œæ¯”å¦‚/myconf</li><li>å¯åŠ¨ï¼š redis-server /Users/chenyawei/myredis/redis.confï¼Œè¿è¡Œæ‹·è´å‡ºå­˜æ”¾äº†è‡ªå®šä¹‰confæ–‡ä»¶ç›®å½•ä¸‹çš„redis.confæ–‡ä»¶</li><li>è¿é€šæµ‹è¯•ï¼š</li><li><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb333dfulmj31ei0eo46v.jpg" alt="image-20200120155956561"></li></ul><h4 id="5-3-å…³é—­"><a href="#5-3-å…³é—­" class="headerlink" title="5.3 å…³é—­"></a>5.3 å…³é—­</h4><ul><li>å•å®ä¾‹å…³é—­ï¼šredis-cli shutdown</li><li>å¤šå®ä¾‹å…³é—­ï¼ŒæŒ‡å®šç«¯å£å…³é—­:redis-cli -p 6379 shutdown</li></ul><h3 id="6ã€Rediså¯åŠ¨åæ‚é¡¹åŸºç¡€çŸ¥è¯†è®²è§£"><a href="#6ã€Rediså¯åŠ¨åæ‚é¡¹åŸºç¡€çŸ¥è¯†è®²è§£" class="headerlink" title="6ã€Rediså¯åŠ¨åæ‚é¡¹åŸºç¡€çŸ¥è¯†è®²è§£"></a>6ã€Rediså¯åŠ¨åæ‚é¡¹åŸºç¡€çŸ¥è¯†è®²è§£</h3><p>Redisæ˜¯å•è¿›ç¨‹çš„</p><ul><li>å•è¿›ç¨‹æ¨¡å‹æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å¯¹è¯»å†™ç­‰æ—¶é—´çš„å“åº”æ˜¯é€šè¿‡å¯¹epollå‡½æ•°çš„åŒ…è£…æ¥åšåˆ°çš„ã€‚Redisçš„å®é™…å¤„ç†é€Ÿåº¦å®Œå…¨ä¾é ä¸»è¿›ç¨‹çš„æ‰§è¡Œæ•ˆç‡ã€‚</li><li>Epollæ˜¯Linuxå†…æ ¸ä¸ºå¤„ç†å¤§æ‰¹é‡æ–‡ä»¶æè¿°ç¬¦è€Œä½œäº†æ”¹è¿›çš„epollï¼Œæ˜¯Linuxä¸‹å¤šè·¯å¤ç”¨IOæ¥å£select/pollçš„å¢å¼ºç‰ˆæœ¬ï¼Œå®ƒèƒ½æ˜¾è‘—æé«˜ç¨‹åºåœ¨å¤§é‡å¹¶å‘è¿æ¥ä¸­åªæœ‰å°‘é‡æ´»è·ƒæƒ…å†µä¸‹çš„ç³»ç»ŸCPUåˆ©ç”¨ç‡ã€‚</li><li>é»˜è®¤16ä¸ªæ•°æ®åº“ï¼Œç±»ä¼¼æ•°ç»„ä¸‹è¡¨ä»é›¶å¼€å§‹ï¼Œåˆå§‹é»˜è®¤ä½¿ç”¨é›¶å·åº“</li><li>Selectå‘½ä»¤åˆ‡æ¢æ•°æ®åº“</li><li>DbsizeæŸ¥çœ‹å½“å‰æ•°æ®åº“çš„keyçš„æ•°é‡</li><li>Flushdbï¼šæ¸…ç©ºå½“å‰åº“</li><li>Flushallï¼šé€šæ€å…¨éƒ¨åº“</li><li>åŒä¸€å¯†ç ç®¡ç†ï¼Œ16ä¸ªåº“éƒ½æ˜¯åŒæ ·å¯†ç ï¼Œè¦ä¹ˆéƒ½okè¦ä¹ˆä¸€ä¸ªä¹Ÿè¿ä¸ä¸Š</li><li>Redisç´¢å¼•éƒ½æ˜¯ä»é›¶å¼€å§‹</li><li>é»˜è®¤ç«¯å£æ˜¯6379</li></ul>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NoSqlå…¥é—¨å’Œæ¦‚è¿°</title>
      <link href="/2020/01/14/NoSql%E6%A6%82%E8%BF%B0/"/>
      <url>/2020/01/14/NoSql%E6%A6%82%E8%BF%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€NoSqlå…¥é—¨å’Œæ¦‚è¿°"><a href="#ä¸€ã€NoSqlå…¥é—¨å’Œæ¦‚è¿°" class="headerlink" title="ä¸€ã€NoSqlå…¥é—¨å’Œæ¦‚è¿°"></a>ä¸€ã€NoSqlå…¥é—¨å’Œæ¦‚è¿°</h2><h3 id="1ã€äº’è”ç½‘æ—¶ä»£èƒŒæ™¯ä¸‹å¤§æœºé‡ï¼Œä¸ºä»€ä¹ˆç”¨nosql"><a href="#1ã€äº’è”ç½‘æ—¶ä»£èƒŒæ™¯ä¸‹å¤§æœºé‡ï¼Œä¸ºä»€ä¹ˆç”¨nosql" class="headerlink" title="1ã€äº’è”ç½‘æ—¶ä»£èƒŒæ™¯ä¸‹å¤§æœºé‡ï¼Œä¸ºä»€ä¹ˆç”¨nosql"></a>1ã€äº’è”ç½‘æ—¶ä»£èƒŒæ™¯ä¸‹å¤§æœºé‡ï¼Œä¸ºä»€ä¹ˆç”¨nosql</h3><ol><li><p>å•æœºMySQLçš„ç¾å¥½æ—¶ä»£</p><p>ä¸€ä¸ªç½‘ç«™çš„è®¿é—®é‡ä¸€èˆ¬éƒ½ä¸å¤§ï¼Œè€Œä¸”æ›´å¤šçš„æ˜¯é™æ€é¡µé¢ï¼ŒåŠ¨æ€äº¤äº’ç±»å‹çš„ç½‘ç«™ä¸å¤šï¼Œç”¨å•ä¸ªæ•°æ®åº“å®Œå…¨å¯ä»¥è½»æ¾åº”å¯¹ã€‚ä¸Šè¿°æ¶æ„ä¸‹ï¼Œæ•°æ®å­˜å‚¨çš„ç“¶é¢ˆæ˜¯ä»€ä¹ˆï¼Ÿæ•°æ®é‡çš„æ€»å¤§å°ä¸€ä¸ªæœºå™¨æ”¾ä¸ä¸‹æ—¶ï¼Œæ•°æ®çš„ç´¢å¼•ï¼ˆB+Treeï¼‰ä¸€ä¸ªæœºå™¨çš„å†…å­˜æ”¾ä¸ä¸‹æ—¶ï¼Œè®¿é—®é‡ï¼ˆè¯»å†™æ··åˆï¼‰ä¸€ä¸ªå®ä¾‹ä¸èƒ½æ‰¿å—ã€‚</p></li><li><p>Memcachedï¼ˆç¼“å­˜ï¼‰+MySQL+å‚ç›´æ‹†åˆ†</p><p>éšç€è®¿é—®é‡çš„ä¸Šå‡ï¼Œå‡ ä¹å‘éƒ¨åˆ†ä½¿ç”¨MySQLæ¶æ„çš„ç½‘ç«™åœ¨æ•°æ®åº“ä¸Šéƒ½å¼€å§‹å‡ºç°æ€§èƒ½é—®é¢˜ï¼Œwebç¨‹åºä¸å†ä»…ä»…ä¸“æ³¨åœ¨åŠŸèƒ½ä¸Šï¼ŒåŒæ—¶ä¹Ÿåœ¨è¿½æ±‚æ€§èƒ½ã€‚ç¨‹åºå‘˜ä»¬å¼€å§‹å¤§é‡çš„ä½¿ç”¨ç¼“å­˜æŠ€æœ¯æ¥ç¼“è§£æ•°æ®åº“çš„å‹åŠ›ï¼Œä¼˜åŒ–æ•°æ®åº“çš„ç»“æ„å’Œç´¢å¼•ã€‚å¼€å§‹æ¯”è¾ƒæµè¡Œçš„æ˜¯é€šè¿‡æ–‡ä»¶ç¼“å­˜æ¥ç¼“è§£æ•°æ®åº“å‹åŠ›ï¼Œä½†æ˜¯è®¿é—®é‡ç»§ç»­å¢å¤§çš„æ—¶å€™ï¼Œå¤šå°webæœºå™¨é€šè¿‡æ–‡ä»¶ç¼“å­˜ä¸èƒ½å…±äº«ï¼Œå¤§é‡çš„å°æ–‡ä»¶ç¼“å­˜ä¹Ÿå¸¦æ¥äº†æ¯”è¾ƒé«˜çš„IOå‹åŠ›ã€‚å› æ­¤ï¼Œ<strong>Memcachedå°±æˆä¸ºäº†ä¸€ä¸ªéå¸¸æ—¶å°šçš„æŠ€æœ¯äº§å“</strong>ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahbqczbgrj31fg0pak42.jpg" alt="image-20200101201621062"></p></li><li><p>Mysqlä¸»ä»è¯»å†™åˆ†ç¦»</p><p>ç”±äºæ•°æ®åº“çš„å†™å…¥å‹åŠ›å¢åŠ ï¼Œ<strong>Memcached</strong>åªèƒ½ç¼“è§£æ•°æ®åº“çš„è¯»å–å‹åŠ›ã€‚è¯»å†™é›†ä¸­åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸Šè®©æ•°æ®åº“ä¸å ªè´Ÿï¼Œå¤§éƒ¨åˆ†ç½‘ç«™å¼€å§‹ä½¿ç”¨<strong>ä¸»ä»å¤åˆ¶</strong>æŠ€æœ¯æ¥è¾¾åˆ°è¯»å†™åˆ†ç¦»ï¼Œä»¥æé«˜è¯»å†™æ€§èƒ½å’Œè¯»åº“çš„å¯æ‰©å±•æ€§ã€‚Mysqlçš„master-slaveæ¨¡å¼æˆä¸ºè¿™ä¸ªæ—¶å€™çš„ç½‘ç«™æ ‡é…ã€‚</p></li><li><p>åˆ†è¡¨åˆ†åº“+æ°´å¹³æ‹†åˆ†+mysqlé›†ç¾¤</p><p>åœ¨<strong>Memcached</strong>çš„é«˜é€Ÿç¼“å­˜ï¼ŒMySQLçš„ä¸»ä»å¤åˆ¶è¯»å†™åˆ†ç¦»çš„åŸºç¡€ä¹‹ä¸Šï¼Œè¿™æ˜¯MySQLçš„ä¸»åº“çš„å†™å‹åŠ›å¼€å§‹å‡ºç°ç“¶é¢ˆï¼Œè€Œæ•°æ®é‡çš„æŒç»­çŒ›å¢ï¼Œç”±äº<strong>MyISAM</strong>ä½¿ç”¨è¡¨é”ï¼Œåœ¨é«˜å¹¶å‘ä¸‹ä¼šå‡ºç°ä¸¥é‡çš„é”é—®é¢˜ï¼Œå¤§é‡çš„é«˜å¹¶å‘MySQLåº”ç”¨å¼€å§‹ä½¿ç”¨<strong>InnoDB</strong>å¼•æ“ä»£æ›¿MyISQMã€‚åŒæ—¶å¼€å§‹æµè¡Œä½¿ç”¨åˆ†è¡¨åˆ†åº“æ¥ç¼“è§£å†™å‹åŠ›å’Œæ•°æ®å¢é•¿çš„æ‰©å±•é—®é¢˜ã€‚è¿™ä¸ªæ—¶å€™ï¼Œåˆ†è¡¨åˆ†åº“æˆäº†ä¸€ä¸ªçƒ­é—¨æŠ€æœ¯ï¼Œæ˜¯é¢è¯•çš„çƒ­é—¨é—®é¢˜ä¹Ÿæ˜¯ä¸šç•Œè®¨è®ºçš„çƒ­é—¨æŠ€æœ¯é—®é¢˜ã€‚ä¹Ÿå°±æ˜¯åœ¨è¿™ä¸ªæ—¶å€™ï¼ŒMySQLæ¨å‡ºäº†è¿˜ä¸å¤ªç¨³å®šçš„è¡¨åˆ†åŒºï¼Œè™½ç„¶MySQLæ¨å‡ºäº†MySQL Clusteré›†ç¾¤ï¼Œä½†æ€§èƒ½ä¹Ÿä¸èƒ½å¾ˆå¥½æ»¡è¶³äº’è”ç½‘çš„è¦æ±‚ï¼Œåªèƒ½åœ¨é«˜å¯é æ€§ä¸Šæä¾›äº†éå¸¸å¤§çš„ä¿è¯ã€‚</p></li><li><p>MySQLçš„æ‰©å±•æ€§ç“¶é¢ˆ</p><p>MySQLæ•°æ®åº“ä¹Ÿç»å¸¸å­˜å‚¨ä¸€äº›å¤§æ–‡æœ¬å­—æ®µï¼Œå¯¼è‡´æ•°æ®åº“è¡¨éå¸¸çš„å¤§ï¼Œåœ¨åšæ•°æ®åº“æ¢å¤çš„æ—¶å€™å°±å¯¼è‡´éå¸¸çš„æ…¢ï¼Œä¸å®¹æ˜“å¿«é€Ÿå›å¤æ•°æ®åº“ã€‚æ¯”å¦‚1000ä¸‡4KBå¤§å°çš„æ–‡æœ¬å°±æ¥è¿‘40GBçš„å¤§å°ï¼Œå¦‚æœèƒ½æŠŠè¿™äº›æ•°æ®ä»MySQLçœå»ï¼ŒMySQLå°†å˜å¾—éå¸¸çš„å°ã€‚å…³ç³»æ•°æ®åº“å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯å®ƒå¹¶ä¸èƒ½å¾ˆå¥½çš„åº”ä»˜æ‰€æœ‰çš„åº”ç”¨åœºæ™¯ã€‚MySQLçš„æ‰©å±•æ€§å·®ï¼ˆéœ€è¦å¤æ‚çš„æŠ€æœ¯æ¥å®ç°ï¼‰ï¼Œå¤§æ•°æ®ä¸‹IOå‹åŠ›å¤§ï¼Œè¡¨ç»“æ„æ›´æ”¹å›°éš¾ï¼Œæ­£å¼å½“å‰ä½¿ç”¨MySQLçš„å¼€å‘äººå‘˜é¢ä¸´çš„é—®é¢˜ã€‚</p></li><li><p>ä»Šå¤©æ˜¯ä»€ä¹ˆæ ·å­</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gahbynkfsoj31a00u07wj.jpg" alt="image-20200101202416020"></p></li><li><p>ä¸ºä»€ä¹ˆä½¿ç”¨NoSQLï¼Ÿ</p><p>ä»Šå¤©æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹å¹³å°ï¼ˆå¦‚Googleï¼ŒFacebookç­‰ï¼‰å¯ä»¥å¾ˆå®¹æ˜“çš„è®¿é—®å’ŒæŠ“å–æ•°æ®ã€‚ç”¨æˆ·ä¸ªäººä¿¡æ¯ï¼Œç¤¾äº¤ç½‘ç»œï¼Œåœ°ç†ä½ç½®ï¼Œç”¨æˆ·äº§ç”Ÿçš„æ•°æ®å’Œç”¨æˆ·æ“ä½œæ—¥å¿—å·²ç»æˆå€çš„å¢åŠ ã€‚<strong>æˆ‘ä»¬å¦‚æœè¦å¯¹è¿™äº›ç”¨æˆ·æ•°æ®è¿›è¡ŒæŒ–æ˜ï¼Œé‚£SQLæ•°æ®åº“å·²ç»ä¸é€‚åˆè¿™äº›åº”ç”¨äº†</strong>ï¼ŒNoSQLæ•°æ®åº“çš„å‘å±•å´èƒ½å¾ˆå¥½çš„å¤„ç†è¿™äº›å¤§çš„æ•°æ®ã€‚</p></li></ol><h3 id="2ã€NoSQLæ˜¯ä»€ä¹ˆ"><a href="#2ã€NoSQLæ˜¯ä»€ä¹ˆ" class="headerlink" title="2ã€NoSQLæ˜¯ä»€ä¹ˆ"></a>2ã€NoSQLæ˜¯ä»€ä¹ˆ</h3><p>NoSQLï¼ˆNoSQL = Not Only SQLï¼‰ï¼Œæ„æ€æ˜¯ä¸ä»…ä»…æ˜¯SQLï¼Œ<strong>æ³›æŒ‡éå…³ç³»å‹çš„æ•°æ®åº“ã€‚</strong></p><p>éšç€äº’è”ç½‘web2.0ç½‘ç«™çš„å…´èµ·ï¼Œä¼ ç»Ÿçš„å…³ç³»æ•°æ®åº“åœ¨åº”ä»˜web2.0ç½‘ç«™ï¼Œç‰¹åˆ«æ˜¯è¶…å¤§è§„æ¨¡å’Œé«˜å¹¶å‘çš„SNSç±»å‹çš„web2.0çº¯åŠ¨æ€ç½‘ç«™å·²ç»æ˜¾å¾—åŠ›ä¸ä»å¿ƒï¼Œæš´éœ²äº†å¾ˆå¤šéš¾ä»¥å…‹æœçš„é—®é¢˜ï¼Œè€Œéå…³ç³»å‹çš„æ•°æ®åº“åˆ™ç”±äºå…¶æœ¬èº«çš„ç‰¹ç‚¹å¾—åˆ°äº†éå¸¸è¿…é€Ÿçš„å‘å±•ã€‚NoSQLæ•°æ®åº“çš„äº§ç”Ÿå°±æ˜¯ä¸ºäº†è§£å†³å¤§è§„æ¨¡æ•°æ®é›†åˆå¤šé‡æ•°æ®ç§ç±»å¸¦æ¥çš„æŒ‘æˆ˜ï¼Œå°¤å…¶æ˜¯å¤§æ•°æ®åº”ç”¨éš¾é¢˜ï¼ŒåŒ…å«è¶…å¤§è§„æ¨¡æ•°æ®çš„å­˜å‚¨ã€‚ï¼ˆä¾‹å¦‚å¤æ²³æˆ–Facebookæ¯å¤©ä¸ºä»–ä»¬çš„ç”¨æˆ·æ‰‹æœºä¸‡äº¿æ¯”ç‰¹çš„æ•°æ®ï¼‰ã€‚<strong>è¿™äº›ç±»å‹çš„æ•°æ®å­˜å‚¨ä¸éœ€è¦å›ºå®šçš„æ¨¡å¼ï¼Œæ— éœ€å¤šä½™æ“ä½œå°±å¯ä»¥æ¨ªå‘æ‰©å±•ã€‚</strong></p><h3 id="3-èƒ½å¹²å˜›ï¼ŒNoSQL-æ•°æ®åº“çš„ä¼˜åŠ¿"><a href="#3-èƒ½å¹²å˜›ï¼ŒNoSQL-æ•°æ®åº“çš„ä¼˜åŠ¿" class="headerlink" title="3.  èƒ½å¹²å˜›ï¼ŒNoSQL æ•°æ®åº“çš„ä¼˜åŠ¿"></a>3.  èƒ½å¹²å˜›ï¼ŒNoSQL æ•°æ®åº“çš„ä¼˜åŠ¿</h3><ul><li><p>æ˜“æ‰©å±•</p><p>NoSQLæ•°æ®åº“ç§ç±»ç¹å¤šï¼Œä½†æ˜¯ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹éƒ½æ˜¯<strong>å»æ‰å…³ç³»æ•°æ®åº“çš„å…³ç³»å‹ç‰¹æ€§ã€‚</strong>æ•°æ®ä¹‹é—´æ— å…³ç³»ï¼Œè¿™æ ·å°±éå¸¸å®¹æ˜“æ‰©å±•ã€‚ä¹Ÿæ— å½¢ä¹‹é—´ï¼Œåœ¨æ¶æ„çš„å±‚é¢ä¸Šå¸¦æ¥äº†å¯æ‰©å±•çš„èƒ½åŠ›ã€‚</p></li><li><p>å¤§æ•°æ®é‡é«˜æ€§èƒ½</p><p>NoSQLæ•°æ®é‡Œéƒ½å…·æœ‰éå¸¸é«˜çš„è¯»å†™æ€§èƒ½ï¼Œå°¤å…¶åœ¨å¤§æ•°æ®é‡ä¸‹ï¼ŒåŒæ ·è¡¨ç°ä¼˜ç§€ã€‚è¿™å¾—ç›Šäºå®ƒçš„æ— å…³ç³»æ€§ï¼Œæ•°æ®åº“çš„ç»“æ„ç®€å•ã€‚ä¸€èˆ¬MySQLä½¿ç”¨<strong>Query Cache</strong>ï¼Œæ¯æ¬¡è¡¨çš„æ›´æ–°Cacheå°±å¤±æ•ˆï¼Œæ˜¯ä¸€ç§å¤§ç²’åº¦çš„Cacheï¼Œåœ¨é’ˆå¯¹web2.0çš„äº¤äº’é¢‘ç¹çš„åº”ç”¨ï¼ŒCacheæ€§èƒ½ä¸é«˜ã€‚è€ŒNoSQLçš„Cacheæ˜¯è®°å½•çº§çš„ï¼Œæ˜¯ä¸€ç§ç»†ç²’åº¦çš„Cacheï¼Œæ‰€ä»¥NoSQLåœ¨è¿™ä¸ªå±‚é¢ä¸Šæ¥è¯´å°±è¦æ€§èƒ½é«˜å¾ˆå¤šäº†ã€‚</p></li><li><p>å¤šæ ·çµæ´»çš„æ•°æ®æ¨¡å‹</p><p>NoSQLæ— éœ€äº‹å…ˆä¸ºè¦å­˜å‚¨çš„æ•°æ®å»ºç«‹å­—æ®µï¼Œéšæ—¶å¯ä»¥å­˜å‚¨è‡ªå®šä¹‰çš„æ•°æ®æ ¼å¼ã€‚è€Œåœ¨å…³ç³»æ•°æ®åº“é‡Œï¼Œ<strong>å¢åˆ å­—æ®µ</strong></p><p>æ˜¯ä¸€ä»¶éå¸¸éº»çƒ¦çš„äº‹æƒ…ã€‚å¦‚æœæ˜¯éå¸¸å¤§æ•°æ®é‡çš„è¡¨ï¼Œå¢åŠ å­—æ®µç®€ç›´å°±æ˜¯ä¸€ä¸ªå™©æ¢¦ã€‚</p></li><li><p>ä¼ ç»ŸRDBMS VS NOSQL</p><p>RDBMSï¼ˆå…³ç³»å‹æ•°æ®åº“ï¼‰</p><ul><li><p>é«˜åº¦ç»„ç»‡åŒ–ç»“æ„åŒ–æ•°æ®</p></li><li><p>ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼ˆSQLï¼‰</p></li><li><p>æ•°æ®å’Œå…³ç³»éƒ½å­˜å‚¨åœ¨å•ç‹¬çš„è¡¨ä¸­ã€‚</p></li><li><p>æ•°æ®æ“çºµè¯­è¨€ï¼Œæ•°æ®å®šä¹‰è¯­è¨€</p></li><li><p>ä¸¥æ ¼çš„ä¸€è‡´æ€§</p></li><li><p>åŸºç¡€äº‹åŠ¡</p></li></ul><p>NoSQL</p><ul><li><p>ä»£è¡¨ç€ä¸ä»…ä»…æ˜¯SQL</p></li><li><p>æ²¡æœ‰å£°æ˜æ€§æŸ¥è¯¢è¯­è¨€</p></li><li><p>æ²¡æœ‰é¢„å®šä¹‰çš„æ¨¡å¼</p></li><li><p><strong>é”®å€¼å¯¹å­˜å‚¨</strong>ï¼Œåˆ—å­˜å‚¨ï¼Œæ–‡æ¡£å­˜å‚¨ï¼Œå›¾å½¢æ•°æ®åº“</p></li><li><p>æœ€ç»ˆä¸€è‡´æ€§ï¼Œè€ŒéACIDå±æ€§</p></li><li><p>éç»“æ„åŒ–å’Œä¸å¯é¢„çŸ¥çš„æ•°æ®</p></li><li><p>CAPå®šç†</p></li><li><p>é«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨å’Œå¯ä¼¸ç¼©æ€§</p></li></ul></li></ul><h3 id="4-å¸¸ç”¨çš„nosql"><a href="#4-å¸¸ç”¨çš„nosql" class="headerlink" title="4. å¸¸ç”¨çš„nosql"></a>4. å¸¸ç”¨çš„nosql</h3><p>â€‹    Redis / Memcache / Mongdb</p><h3 id="5-æ€ä¹ˆç©"><a href="#5-æ€ä¹ˆç©" class="headerlink" title="5. æ€ä¹ˆç©"></a>5. æ€ä¹ˆç©</h3><p>KV<br>Cache<br>Persistence</p><h3 id="6ã€ç›®å‰äº’è”ç½‘çš„æ–°è¦æ±‚ï¼š3V-å’Œ3-é«˜"><a href="#6ã€ç›®å‰äº’è”ç½‘çš„æ–°è¦æ±‚ï¼š3V-å’Œ3-é«˜" class="headerlink" title="6ã€ç›®å‰äº’è”ç½‘çš„æ–°è¦æ±‚ï¼š3V å’Œ3 é«˜"></a>6ã€<strong>ç›®å‰äº’è”ç½‘çš„æ–°è¦æ±‚ï¼š3V </strong>å’Œ<strong>3</strong> <strong>é«˜</strong></h3><p>å¤§æ•°æ®æ—¶ä»£çš„ 3V </p><ul><li><p>Volumeï¼šæµ·é‡ï¼Œæ•°æ®é‡æå¤§ </p></li><li><p>Varietyï¼šå¤šæ · </p><p>æ•°æ®ç±»å‹ï¼šæ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘â€¦â€¦ </p><p>ç»ˆç«¯è®¾å¤‡ï¼šPCã€ç§»åŠ¨ç«¯ã€åµŒå…¥å¼è®¾å¤‡â€¦â€¦ </p></li><li><p>Velocityï¼šå®æ—¶ </p><p>ç›´æ’­ï¼Œé‡‘èè¯åˆ¸â€¦â€¦ </p></li></ul><p>äº’è”ç½‘æ—¶ä»£çš„ 3 é«˜ </p><ul><li><p>é«˜å¯æ‰©</p><p>ä¸æ–­ä¼˜åŒ–ç°æœ‰çš„åŠŸèƒ½ï¼Œä¸æ–­å¼€å‘æ–°çš„åŠŸèƒ½ï¼› </p></li><li><p>é«˜æ€§èƒ½ </p><p>ä¸èƒ½è®©ç”¨æˆ·æ„Ÿè§‰åˆ°ç­‰å¾…çš„æ—¶é—´ï¼› </p></li><li><p>é«˜å¹¶å‘</p><p>åŒæ—¶å¤„ç†å¹¶å‘è¯·æ±‚çš„èƒ½åŠ›ï¼Œå¦‚åŒåä¸€çš„ç§’æ€ã€æŠ¢è´­ç«è½¦ç¥¨ï¼› </p><p>æå‡ç¡¬ä»¶ï¼Œä¼˜åŒ–ç³»ç»Ÿï¼Œä¼˜åŒ–é¡¹ç›®ï¼Œå°†è´¹æ—¶çš„æ“ä½œè¿›å…¥å¼‚æ­¥å¤„ç†ï¼›</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUCå¤šçº¿ç¨‹</title>
      <link href="/2019/12/15/JUC%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
      <url>/2019/12/15/JUC%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€-çº¿ç¨‹â€”æ“ä½œâ€”èµ„æºç±»-2-é«˜å†…èšâ€”ä½è€¦åˆ"><a href="#ä¸€-çº¿ç¨‹â€”æ“ä½œâ€”èµ„æºç±»-2-é«˜å†…èšâ€”ä½è€¦åˆ" class="headerlink" title="ä¸€.çº¿ç¨‹â€”æ“ä½œâ€”èµ„æºç±». 2.é«˜å†…èšâ€”ä½è€¦åˆ"></a>ä¸€.çº¿ç¨‹â€”æ“ä½œâ€”èµ„æºç±». 2.é«˜å†…èšâ€”ä½è€¦åˆ</h2><p>çº¿ç¨‹æ“ä½œèµ„æºç±»ï¼Œå¹¶ä¿è¯é«˜å†…èšã€ä½è€¦åˆã€‚</p><p>æ ¹æ®ä¸‹é¢çš„demoåˆ†æä»€ä¹ˆæ˜¯çº¿ç¨‹æ“ä½œèµ„æºç±»ï¼Œå¹¶ä¿è¯é«˜å†…èšã€ä½è€¦åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.juc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Ticket ä¸ºå”®ç¥¨çš„æ“ä½œï¼Œå†…éƒ¨æœ‰30å¼ ç¥¨å¾…å‡ºå”®ï¼Œä¸ºèµ„æºç±»ï¼Œ</span></span><br><span class="line"><span class="comment">//class Ticket implements Runnable&#123; å¦‚æœåœ¨èµ„æºç±»ä¸Šå®ç°çº¿ç¨‹æ¥å£ï¼Œèµ„æºå’Œçº¿ç¨‹å°±è€¦åˆåˆ°ä¸€å—äº†ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ticket</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">30</span>; <span class="comment">//ç¥¨æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sail</span><span class="params">()</span></span>&#123;</span><br><span class="line">        lock.lock(); <span class="comment">// block until condition holds</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(number &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"å‡ºå”®äº†ç¬¬"</span> + number-- + <span class="string">"å¼ ç¥¨ï¼Œè¿˜å‰©ä½™"</span> + number + <span class="string">"å¼ ç¥¨ã€‚"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  <span class="comment">//mainæ–¹æ³•è‡ªå·±å¸¦èµ„æºå¯¹å¤–æä¾›æœåŠ¡</span></span><br><span class="line">        Ticket ticket = <span class="keyword">new</span> Ticket();</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸è¦åœ¨èµ„æºç±»ä¸Šå®ç°Runnble,è€Œæ˜¯åœ¨åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™æ¥æ“ä½œã€‚ä¸ºçº¿ç¨‹ä¸èµ„æºç±»çš„ä½è€¦åˆ</span></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123; <span class="comment">//åŒ¿åå†…éƒ¨ç±»æ–¹å¼</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; i++)&#123;</span><br><span class="line">                    ticket.sail();<span class="comment">//çº¿ç¨‹æ“ä½œèµ„æºç±»</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">"A"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; i++)&#123;</span><br><span class="line">                    ticket.sail();<span class="comment">//çº¿ç¨‹æ“ä½œèµ„æºç±»</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"B"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; i++)&#123;</span><br><span class="line">                    ticket.sail();<span class="comment">//çº¿ç¨‹æ“ä½œèµ„æºç±»</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">"C"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Lambdaè¯­æ³•æ–¹å¼ï¼Œå†™æ³•ï¼ˆå¼€å‘ä¸­æ¨èä½¿ç”¨è¿™ç§ç®€æ´çš„ä»£ç ï¼‰</span></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; i++)&#123; ticket.sail();&#125; &#125;,<span class="string">"AA"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; i++)&#123; ticket.sail();&#125; &#125;,<span class="string">"BB"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; i++)&#123; ticket.sail();&#125; &#125;,<span class="string">"CC"</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 1. implements æ¥å®ç° ï¼ˆæ•ˆç‡ä½ï¼Œéä½è€¦åˆï¼Œä¸æ¨èï¼‰</span></span><br><span class="line"><span class="comment">* 2. åŒ¿åå†…éƒ¨ç±»  ï¼ˆæ¨èï¼‰</span></span><br><span class="line"><span class="comment">* 3. Lambdaæ–¹å¼  (éå¸¸æ¨è)</span></span><br><span class="line"><span class="comment">**/</span></span><br></pre></td></tr></table></figure><h2 id="äºŒ-Callbale-ä¸-Runnable-ä¸¤ä¸ªæ¥å£çš„åŒºåˆ«"><a href="#äºŒ-Callbale-ä¸-Runnable-ä¸¤ä¸ªæ¥å£çš„åŒºåˆ«" class="headerlink" title="äºŒ. Callbale ä¸ Runnable ä¸¤ä¸ªæ¥å£çš„åŒºåˆ«"></a>äºŒ. Callbale ä¸ Runnable ä¸¤ä¸ªæ¥å£çš„åŒºåˆ«</h2><h3 id="1-Callbale-ä¸-Runnable-ä¸¤ä¸ªæ¥å£çš„åŒºåˆ«"><a href="#1-Callbale-ä¸-Runnable-ä¸¤ä¸ªæ¥å£çš„åŒºåˆ«" class="headerlink" title="1. Callbale ä¸ Runnable ä¸¤ä¸ªæ¥å£çš„åŒºåˆ«"></a>1. Callbale ä¸ Runnable ä¸¤ä¸ªæ¥å£çš„åŒºåˆ«</h3><p>Runnableçš„é™æ€æ–¹æ³•run()æ²¡æœ‰è¿”å›å€¼ã€‚</p><p>Callbaleçš„é™æ€æ–¹æ³•call()æœ‰æ³›å‹è¿”å›å€¼,å¹¶ä¸”æœ‰throwsæŠ›å‡ºå¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyFoo</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Myfoo2</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-Callbaleåº”ç”¨å®ä¾‹ï¼šä¸FutureTaskç±»é…åˆä½¿ç”¨"><a href="#2-Callbaleåº”ç”¨å®ä¾‹ï¼šä¸FutureTaskç±»é…åˆä½¿ç”¨" class="headerlink" title="2.Callbaleåº”ç”¨å®ä¾‹ï¼šä¸FutureTaskç±»é…åˆä½¿ç”¨"></a>2.Callbaleåº”ç”¨å®ä¾‹ï¼šä¸FutureTaskç±»é…åˆä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learnjava.JUC;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.FutureTask;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCallable</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"çº¿ç¨‹çš„call......"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Cabllable</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019-12-14 20:56</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        FutureTask&lt;Integer&gt; futureTask = <span class="keyword">new</span> FutureTask&lt;Integer&gt;(<span class="keyword">new</span> MyCallable());</span><br><span class="line">        <span class="keyword">new</span> Thread(futureTask,<span class="string">"AA"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Lambdaå®ç°æ–¹å¼</span></span><br><span class="line">        FutureTask&lt;Integer&gt; futureTask1 = <span class="keyword">new</span> FutureTask&lt;Integer&gt;(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"çº¿ç¨‹çš„call......"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">300</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">new</span> Thread(futureTask1,<span class="string">"BB"</span>).start();</span><br><span class="line">        System.out.println(<span class="string">"futureTask1.get() = "</span>+futureTask1.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸»çº¿ç¨‹ä¸­éœ€è¦æ‰§è¡Œæ¯”è¾ƒè€—æ—¶çš„æ“ä½œæ—¶ï¼Œä½†åˆä¸æƒ³é˜»å¡ä¸»çº¿ç¨‹æ—¶ï¼Œå¯ä»¥æŠŠè¿™äº›ä½œä¸šäº¤ç»™Futureå¯¹è±¡åœ¨åå°å®Œæˆï¼Œå½“ä¸»çº¿ç¨‹å°†æ¥éœ€è¦æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡Futureå¯¹è±¡è·å¾—åå°ä½œä¸šçš„è®¡ç®—æˆ–è€…æ‰§è¡ŒçŠ¶æ€ã€‚</p><p>ä¸€èˆ¬FutureTaskç±»å¤šç”¨äºè€—æ—¶è®¡ç®—ï¼Œä¸»çº¿ç¨‹å¯ä»¥åœ¨å®Œæˆè‡ªå·±çš„ä»»åŠ¡åï¼Œå†å»è·å–ç»“æœã€‚</p><p>ä»…åœ¨è®¡ç®—å®Œæˆæ—¶æ‰èƒ½æ£€ç´¢ç»“æœï¼›å¦‚æœè®¡ç®—å°šæœªå®Œæˆï¼Œåˆ™é˜»å¡getæ–¹æ³•ã€‚ä¸€æ—¦è®¡ç®—å®Œæˆï¼Œå°±ä¸èƒ½å†é‡æ–°å¼€å§‹æˆ–å–æ¶ˆè®¡ç®—ã€‚getæ–¹æ³•è·å–ç»“æœåªæœ‰åœ¨è®¡ç®—å®Œæˆæ—¶è·å–ï¼Œå¦åˆ™ä¼šä¸€ç›´é˜»å¡ç›´åˆ°ä»»åŠ¡è½¬å…¥å®ŒæˆçŠ¶æ€ï¼Œç„¶åä¼šè¿”å›ç»“æœæˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚æ‰€æœ‰getæ–¹æ³•ä¸€èˆ¬æ”¾åœ¨æœ€åã€‚</p><h2 id="ä¸‰-notifyå’Œwait"><a href="#ä¸‰-notifyå’Œwait" class="headerlink" title="ä¸‰. notifyå’Œwait"></a>ä¸‰. notifyå’Œwait</h2><p>waitä½¿ç”¨å‰ä¸€å®šè¦æœ‰åŒæ­¥é”synchronizedï¼Œå®ƒä»¬æ˜¯ä¸€å¥—å…¨å®¶ç¦ï¼Œä¸”wait() ä¸ notify(), æˆ– wait() ä¸ notifyAll(),å¿…é¡»æˆå¯¹ä½¿ç”¨ï¼Œ</p><h3 id="ç‰ˆæœ¬1-Demoï¼š"><a href="#ç‰ˆæœ¬1-Demoï¼š" class="headerlink" title="ç‰ˆæœ¬1 Demoï¼š"></a>ç‰ˆæœ¬1 Demoï¼š</h3><p>æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œå®ç°å¯¹åˆå§‹å€¼ä¸º0çš„ä¸€ä¸ªå˜é‡æ“ä½œï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹å˜é‡åŠ ä¸€ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯¹å˜é‡å‡ä¸€ï¼Œå¾ªç¯4è½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learnjava.JUC;</span><br><span class="line"></span><br><span class="line"><span class="comment">//èµ„æºç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShareData</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//æ¶ˆè´¹è€…</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(number != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        ++number;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"\t"</span> + number);</span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//æ¶ˆè´¹è€…æ¨¡å¼</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">decrement</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(number == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        --number;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"\t"</span> + number);</span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *é¢˜ç›®ï¼šæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œå®ç°å¯¹åˆå§‹å€¼ä¸º0çš„ä¸€ä¸ªå˜é‡æ“ä½œï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹å˜é‡åŠ ä¸€ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯¹å˜é‡å‡ä¸€ï¼Œå¾ªç¯4è½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019-12-14 20:56</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ShareData shareData = <span class="keyword">new</span> ShareData();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    shareData.increment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"AA"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    shareData.decrement();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"BB"</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ä¸¤ä¸ªæ‰§è¡Œç»“æœä¸º<span class="number">4</span>æ¬¡è½®æ¢ï¼š</span><br><span class="line">AA<span class="number">1</span></span><br><span class="line">BB<span class="number">0</span></span><br><span class="line">AA<span class="number">1</span></span><br><span class="line">BB<span class="number">0</span></span><br><span class="line">  </span><br><span class="line"><span class="number">0</span>ä¸<span class="number">1</span>è½®æ¢æ‰§è¡Œï¼Œçœ‹è¿™æ²¡æœ‰é—®é¢˜</span><br></pre></td></tr></table></figure><h3 id="ç‰ˆæœ¬2-Demoï¼š"><a href="#ç‰ˆæœ¬2-Demoï¼š" class="headerlink" title="ç‰ˆæœ¬2 Demoï¼š"></a>ç‰ˆæœ¬2 Demoï¼š</h3><p>æœ‰2ä¸ªçº¿ç¨‹æ”¹ä¸º4ä¸ªçº¿ç¨‹ï¼Œå®ç°ä¸Šé¢çš„åŠŸèƒ½ï¼Œä¼šå‡ºç°è¿è¡Œç»“æœä¸º2çš„æƒ…å†µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learnjava.JUC;</span><br><span class="line"></span><br><span class="line"><span class="comment">//èµ„æºç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShareData</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//æ¶ˆè´¹è€…</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(number != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        ++number;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"\t"</span> + number);</span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//æ¶ˆè´¹è€…æ¨¡å¼</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">decrement</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(number == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        --number;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"\t"</span> + number);</span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ShareData shareData = <span class="keyword">new</span> ShareData();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">200</span>);  <span class="comment">//ç¡çœ 0.2ç§’æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ</span></span><br><span class="line">                    shareData.increment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"AA"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">300</span>);  <span class="comment">//ç¡çœ æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ</span></span><br><span class="line">                    shareData.decrement();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"BB"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">400</span>); <span class="comment">//ç¡çœ æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ</span></span><br><span class="line">                    shareData.increment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"CC"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">500</span>); <span class="comment">//ç¡çœ æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ</span></span><br><span class="line">                    shareData.decrement();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"DD"</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">4</span>ä¸ªæ‰§è¡Œç»“æœä¸º<span class="number">4</span>æ¬¡è½®æ¢ï¼šå‘ç°ç»“æœå‡ºç°äº† <span class="number">2</span> çš„æƒ…å†µï¼Œç­”æ¡ˆé”™è¯¯äº†ã€‚</span><br><span class="line">AA<span class="number">1</span></span><br><span class="line">BB<span class="number">0</span></span><br><span class="line">AA<span class="number">1</span></span><br><span class="line">DD<span class="number">0</span></span><br><span class="line">CC<span class="number">1</span></span><br><span class="line">BB<span class="number">0</span></span><br><span class="line">AA<span class="number">1</span></span><br><span class="line">BB<span class="number">0</span></span><br><span class="line">CC<span class="number">1</span></span><br><span class="line">AA<span class="number">2</span></span><br><span class="line">DD<span class="number">1</span></span><br><span class="line">BB<span class="number">0</span></span><br><span class="line">CC<span class="number">1</span></span><br><span class="line">DD<span class="number">0</span></span><br><span class="line">CC<span class="number">1</span></span><br><span class="line">DD<span class="number">0</span></span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µå³ä¸ºçº¿ç¨‹çš„è™šå‡å”¤é†’ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9xj28fhwkj31px0u0q83.jpg" alt="image-20191215171843863" style="zoom:25%;" /></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">API Note:</span><br><span class="line">The recommended approach to waiting is to check the condition being awaited in a <span class="keyword">while</span> loop around the call to wait, as shown in the example below. Among other things, <span class="keyword">this</span> approach avoids problems that can be caused by spurious wakeups.</span><br><span class="line"></span><br><span class="line">     <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">         <span class="keyword">while</span> (&lt;condition does not hold&gt; and &lt;timeout not exceeded&gt;) &#123;</span><br><span class="line">             <span class="keyword">long</span> timeoutMillis = ... ; <span class="comment">// recompute timeout values</span></span><br><span class="line">             <span class="keyword">int</span> nanos = ... ;</span><br><span class="line">             obj.wait(timeoutMillis, nanos);</span><br><span class="line">         &#125;</span><br><span class="line">         ... <span class="comment">// Perform action appropriate to condition or timeout</span></span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">Parameters:</span><br><span class="line">timeoutMillis - the maximum time to wait, in milliseconds</span><br><span class="line">nanos - additional time, in nanoseconds, in the range range <span class="number">0</span>-<span class="number">999999</span> inclusive</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯JDK çš„ API æ–‡æ¡£æç¤ºï¼Œå¤šçº¿ç¨‹å˜é‡é‡Œé¢ä¸èƒ½ç”¨ if åˆ¤æ–­ åªèƒ½ç”¨while å¾ªç¯åˆ¤æ–­ï¼Œ æ‰€æœ‰çš„æ‹‰å›æ¥é‡æ–°è¿‡å®‰æ£€ã€‚é—®é¢˜å°±å¯ä»¥è§£å†³äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(number != <span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">this</span>.wait();</span><br><span class="line">&#125;</span><br><span class="line">ä¿®æ”¹ä¸ºï¼š </span><br><span class="line"><span class="keyword">while</span> (number != <span class="number">0</span>)&#123;</span><br><span class="line">  <span class="keyword">this</span>.wait();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å››-lock"><a href="#å››-lock" class="headerlink" title="å››. lock"></a>å››. lock</h2><p>Lock api æ–‡æ¡£ï¼šlock å¿…é¡» ä¸ Conditionæ¥å£é…å¥—ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Lock</span></span></span><br><span class="line"><span class="class"><span class="title">Lock</span> <span class="title">implementations</span> <span class="title">provide</span> <span class="title">more</span> <span class="title">extensive</span> <span class="title">locking</span> <span class="title">operations</span> <span class="title">than</span> <span class="title">can</span> <span class="title">be</span> <span class="title">obtained</span> <span class="title">using</span> <span class="title">synchronized</span> <span class="title">methods</span> <span class="title">and</span> <span class="title">statements</span>. <span class="title">They</span> <span class="title">allow</span> <span class="title">more</span> <span class="title">flexible</span> <span class="title">structuring</span>, <span class="title">may</span> <span class="title">have</span> <span class="title">quite</span> <span class="title">different</span> <span class="title">properties</span>, <span class="title">and</span> <span class="title">may</span> <span class="title">support</span> <span class="title">multiple</span> <span class="title">associated</span> <span class="title">Condition</span> <span class="title">objects</span>.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">å…¬å…±æ¥å£é”</span></span><br><span class="line"><span class="class">ä¸ä½¿ç”¨åŒæ­¥æ–¹æ³•å’Œè¯­å¥ç›¸æ¯”ï¼Œé”å®ç°æä¾›äº†æ›´å¹¿æ³›çš„é”æ“ä½œã€‚ å®ƒä»¬å…è®¸æ›´çµæ´»çš„ç»“æ„ï¼Œå¯ä»¥å…·æœ‰å®Œå…¨ä¸åŒçš„å±æ€§ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒå¤šä¸ªå…³è”çš„<span class="title">Condition</span>å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">Condition</span></span></span><br><span class="line"><span class="class"><span class="title">Condition</span> <span class="title">factors</span> <span class="title">out</span> <span class="title">the</span> <span class="title">Object</span> <span class="title">monitor</span> <span class="title">methods</span> (<span class="title">wait</span>, <span class="title">notify</span> <span class="title">and</span> <span class="title">notifyAll</span>) <span class="title">into</span> <span class="title">distinct</span> <span class="title">objects</span> <span class="title">to</span> <span class="title">give</span> <span class="title">the</span> <span class="title">effect</span> <span class="title">of</span> <span class="title">having</span> <span class="title">multiple</span> <span class="title">wait</span>-<span class="title">sets</span> <span class="title">per</span> <span class="title">object</span>, <span class="title">by</span> <span class="title">combining</span> <span class="title">them</span> <span class="title">with</span> <span class="title">the</span> <span class="title">use</span> <span class="title">of</span> <span class="title">arbitrary</span> <span class="title">Lock</span> <span class="title">implementations</span>. <span class="title">Where</span> <span class="title">a</span> <span class="title">Lock</span> <span class="title">replaces</span> <span class="title">the</span> <span class="title">use</span> <span class="title">of</span> <span class="title">synchronized</span> <span class="title">methods</span> <span class="title">and</span> <span class="title">statements</span>, <span class="title">a</span> <span class="title">Condition</span> <span class="title">replaces</span> <span class="title">the</span> <span class="title">use</span> <span class="title">of</span> <span class="title">the</span> <span class="title">Object</span> <span class="title">monitor</span> <span class="title">methods</span>.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">Condition</span>å¯¹è±¡å…¬å…±æ¥å£æ¡ä»¶</span></span><br><span class="line"><span class="class">æ¡ä»¶å°†å¯¹è±¡ç›‘è§†æ–¹æ³•ï¼ˆ<span class="title">wait</span>ï¼Œ<span class="title">notify</span>å’Œ<span class="title">notifyAll</span>ï¼‰åˆ†è§£ä¸ºä¸åŒçš„å¯¹è±¡ï¼Œä»è€Œé€šè¿‡ä¸ä»»æ„<span class="title">Lock</span>å®ç°ç»“åˆä½¿ç”¨ï¼Œä»è€Œä½¿æ¯ä¸ªå¯¹è±¡å…·æœ‰å¤šä¸ªç­‰å¾…é›†ã€‚ å¦‚æœ<span class="title">Lock</span>æ›¿æ¢äº†åŒæ­¥æ–¹æ³•å’Œè¯­å¥çš„ä½¿ç”¨ï¼Œè€Œ<span class="title">Condition</span>æ›¿æ¢äº†<span class="title">Object</span>ç›‘è§†å™¨æ–¹æ³•çš„ä½¿ç”¨ã€‚</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//èµ„æºç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShareData</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();  </span><br><span class="line">    <span class="keyword">private</span> Condition condition = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”Ÿäº§è€…</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">0</span>)&#123;</span><br><span class="line">                condition.await();  <span class="comment">//ä½¿ç”¨conditionçš„await()æ–¹æ³•ä»£æ›¿ wait() </span></span><br><span class="line">            &#125;</span><br><span class="line">            ++number;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"\t"</span> + number);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¶ˆè´¹è€…æ¨¡å¼</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">decrement</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (number == <span class="number">0</span>)&#123;</span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            --number;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"\t"</span> + number);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="å…­-çº¿ç¨‹8é”-synchronized"><a href="#å…­-çº¿ç¨‹8é”-synchronized" class="headerlink" title="å…­.çº¿ç¨‹8é” synchronized"></a>å…­.çº¿ç¨‹8é” synchronized</h2><h4 id="æ€»è¿°ï¼š"><a href="#æ€»è¿°ï¼š" class="headerlink" title="æ€»è¿°ï¼š"></a>æ€»è¿°ï¼š</h4><p>èµ„æºç±»é‡Œé¢æœ‰å¤šä¸ªsynchronizedæ–¹æ³•çš„æ—¶å€™ï¼ŒæŸä¸€æ—¶åˆ»åªè¦æœ‰ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨synchronizedæ–¹æ³•äº†ï¼Œå…¶ä»–çš„çº¿ç¨‹éƒ½åªèƒ½ç­‰å¾…ï¼Œæ¢å¥è¯è¯´ï¼ŒæŸä¸€æ—¶åˆ»å†…ï¼Œåªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®è¿™äº›synchronizedæ–¹æ³•ã€‚</p><p>é”æ˜¯å½“å‰å¯¹è±¡this,è¢«é”å®šåï¼Œå…¶ä»–çº¿ç¨‹éƒ½ä¸èƒ½è¿›å…¥åˆ°å½“å‰å¯¹è±¡çš„å…¶ä»–çš„synchronizedæ–¹æ³•äº†ã€‚æ‰€ä»¥é™æ€æ–¹æ³•ï¼Œæ ¹å‡ ä¸ªå¯¹è±¡æ²¡æœ‰å…³ç³»ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºé”çš„æ˜¯æ¨¡ç‰ˆclassã€‚</p><h4 id="1-æ ‡å‡†è®¿é—®-æ‰“å°é¡ºåº"><a href="#1-æ ‡å‡†è®¿é—®-æ‰“å°é¡ºåº" class="headerlink" title="1. æ ‡å‡†è®¿é—® æ‰“å°é¡ºåº"></a>1. æ ‡å‡†è®¿é—® æ‰“å°é¡ºåº</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learnjava.JUC;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">getIOS</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"***getIOS"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">getAndroid</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"***getAndriod"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * é¢˜ç›® ï¼š çº¿ç¨‹8 é”</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019-12-14 20:56</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo4</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                phone.getIOS();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"AA"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                phone.getAndroid();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"BB"</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼šä¸€èˆ¬éƒ½ä¼šæŒ‰çº¿ç¨‹ä¸Šä¸‹é¡ºåºæ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">***getIOS</span><br><span class="line">***getAndriod</span><br></pre></td></tr></table></figure><h4 id="2-è®©getIOS-ç¡-4-ç§’-ï¼Œæ‰“å°é¡ºåºæ˜¯ï¼Ÿ"><a href="#2-è®©getIOS-ç¡-4-ç§’-ï¼Œæ‰“å°é¡ºåºæ˜¯ï¼Ÿ" class="headerlink" title="2. è®©getIOS()ç¡ 4 ç§’ ï¼Œæ‰“å°é¡ºåºæ˜¯ï¼Ÿ"></a>2. è®©getIOS()ç¡ 4 ç§’ ï¼Œæ‰“å°é¡ºåºæ˜¯ï¼Ÿ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">getIOS</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">        System.out.println(<span class="string">"***getIOS"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">getAndroid</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"***getAndriod"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š ç»“æœå’Œæ ‡å‡†é¡ºåºä¸€æ ·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">***getIOS</span><br><span class="line">***getAndriod</span><br></pre></td></tr></table></figure><h4 id="3-æ–°å¢æ™®é€šæ–¹æ³•-getHello-è®©getIOS-ç¡-4ç§’-æŸ¥çœ‹æ‰“å°é¡ºåº"><a href="#3-æ–°å¢æ™®é€šæ–¹æ³•-getHello-è®©getIOS-ç¡-4ç§’-æŸ¥çœ‹æ‰“å°é¡ºåº" class="headerlink" title="3. æ–°å¢æ™®é€šæ–¹æ³• getHello() ,è®©getIOS()ç¡ 4ç§’ , æŸ¥çœ‹æ‰“å°é¡ºåº"></a>3. æ–°å¢æ™®é€šæ–¹æ³• getHello() ,è®©getIOS()ç¡ 4ç§’ , æŸ¥çœ‹æ‰“å°é¡ºåº</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">getIOS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">        System.out.println(<span class="string">"***getIOS"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">getAndroid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"***getAndriod"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"***getHello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo4</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                phone.getIOS();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"AA"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//                phone.getAndroid();</span></span><br><span class="line">                phone.getHello();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"BB"</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š é¡ºåºæœ‰å˜ï¼Œæ™®é€šæ–¹æ³•åœ¨å‰é¢äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">***getHello</span><br><span class="line">***getIOS</span><br></pre></td></tr></table></figure><h4 id="4-æœ‰ä¸¤éƒ¨æ‰‹æœºï¼ˆæœ‰ä¸¤ä¸ªèµ„æºç±»ï¼‰å°±æ˜¯ä¸¤ä¸ªå¯¹è±¡ï¼Œçœ‹æ‰“å°é¡ºåº"><a href="#4-æœ‰ä¸¤éƒ¨æ‰‹æœºï¼ˆæœ‰ä¸¤ä¸ªèµ„æºç±»ï¼‰å°±æ˜¯ä¸¤ä¸ªå¯¹è±¡ï¼Œçœ‹æ‰“å°é¡ºåº" class="headerlink" title="4.æœ‰ä¸¤éƒ¨æ‰‹æœºï¼ˆæœ‰ä¸¤ä¸ªèµ„æºç±»ï¼‰å°±æ˜¯ä¸¤ä¸ªå¯¹è±¡ï¼Œçœ‹æ‰“å°é¡ºåº"></a>4.æœ‰ä¸¤éƒ¨æ‰‹æœºï¼ˆæœ‰ä¸¤ä¸ªèµ„æºç±»ï¼‰å°±æ˜¯ä¸¤ä¸ªå¯¹è±¡ï¼Œçœ‹æ‰“å°é¡ºåº</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learnjava.JUC;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">getIOS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">        System.out.println(<span class="string">"***getIOS"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">getAndroid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"***getAndriod"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"***getHello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo4</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">        Phone phone2 = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                phone.getIOS();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"AA"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                phone2.getAndroid();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"BB"</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">***getAndriod</span><br><span class="line">***getIOS</span><br></pre></td></tr></table></figure><h4 id="5-ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œä¸€éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº"><a href="#5-ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œä¸€éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº" class="headerlink" title="5.ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œä¸€éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº"></a>5.ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œä¸€éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learnjava.JUC;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">getIOS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">        System.out.println(<span class="string">"***getIOS"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">getAndroid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"***getAndriod"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"***getHello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * é¢˜ç›® ï¼š çº¿ç¨‹8 é”</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019-12-14 20:56</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo4</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                phone.getIOS();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"AA"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                phone.getAndroid();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"BB"</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">***getIOS</span><br><span class="line">***getAndriod</span><br></pre></td></tr></table></figure><h4 id="6-ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œä¸¤éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº"><a href="#6-ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œä¸¤éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº" class="headerlink" title="6.ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œä¸¤éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº"></a>6.ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œä¸¤éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learnjava.JUC;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">getIOS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">        System.out.println(<span class="string">"***getIOS"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">getAndroid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"***getAndriod"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"***getHello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * é¢˜ç›® ï¼š çº¿ç¨‹8 é”</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019-12-14 20:56</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo4</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">        Phone phone2 = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                phone.getIOS();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"AA"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                phone2.getAndroid();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"BB"</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">***getIOS</span><br><span class="line">***getAndriod</span><br></pre></td></tr></table></figure><h4 id="7-ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œä¸€éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº"><a href="#7-ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œä¸€éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº" class="headerlink" title="7.ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œä¸€éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº"></a>7.ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œä¸€éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº</h4><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">***getAndriod</span><br><span class="line">***getIOS</span><br></pre></td></tr></table></figure><h4 id="8-ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œä¸¤éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº"><a href="#8-ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œä¸¤éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº" class="headerlink" title="8.ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œä¸¤éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº"></a>8.ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œä¸¤éƒ¨æ‰‹æœºï¼Œæ‰“å°é¡ºåº</h4><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">***getAndriod</span><br><span class="line">***getIOS</span><br></pre></td></tr></table></figure><h2 id="ä¸ƒ-Lock-ä¹‹-Condition"><a href="#ä¸ƒ-Lock-ä¹‹-Condition" class="headerlink" title="ä¸ƒ. Lock ä¹‹ Condition"></a>ä¸ƒ. Lock ä¹‹ Condition</h2><p>Lock ä¼˜äºåŒæ­¥é”synchronizedçš„ç‚¹ä¸ºï¼Œå¯ä»¥æŒ‡å®šå”¤é†’çš„çº¿ç¨‹ã€‚æ²¡æœ‰æŒ‡å®šçš„æƒ…å†µä¸‹å’Œsynchronizedä¸€æ ·éƒ½æ˜¯ç–¯æŠ¢æ¨¡å¼ã€‚</p><p>Demoï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learnjava.JUC;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShareResource</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> flag = <span class="number">1</span>; <span class="comment">// 1-A, 2-B, 3-C</span></span><br><span class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">private</span> Condition condition1 = lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> Condition condition2 = lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> Condition condition3 = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print5</span><span class="params">(<span class="keyword">int</span> totalLoop)</span></span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">while</span> (flag != <span class="number">1</span>)&#123;</span><br><span class="line">                condition1.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¹²æ´»</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"\t"</span> + i + <span class="string">"\ttotalLoop: "</span> + totalLoop);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//é€šçŸ¥+å”¤é†’</span></span><br><span class="line">            flag = <span class="number">2</span>;</span><br><span class="line">            condition2.signal();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print10</span><span class="params">(<span class="keyword">int</span> totalLoop)</span></span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">while</span> (flag != <span class="number">2</span>)&#123;</span><br><span class="line">                condition2.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¹²æ´»</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"\t"</span> + i + <span class="string">"\ttotalLoop: "</span> + totalLoop);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//é€šçŸ¥+å”¤é†’</span></span><br><span class="line">            flag = <span class="number">3</span>;</span><br><span class="line">            condition3.signal();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print15</span><span class="params">(<span class="keyword">int</span> totalLoop)</span></span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">while</span> (flag != <span class="number">3</span>)&#123;</span><br><span class="line">                condition3.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¹²æ´»</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">15</span>; i++)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"\t"</span> + i + <span class="string">"\ttotalLoop: "</span> + totalLoop);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//é€šçŸ¥+å”¤é†’</span></span><br><span class="line">            flag = <span class="number">1</span>;</span><br><span class="line">            condition1.signal();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¢˜ç›®ï¼šæœ‰ABCä¸‰ä¸ªçº¿ç¨‹ï¼ŒAçº¿ç¨‹æ‰“å°5æ¬¡ï¼ŒBçº¿ç¨‹æ‰“å°10æ¬¡ï¼ŒCçº¿ç¨‹æ‰“å°15æ¬¡ï¼Œç„¶åï¼Œåœ¨åŒæ ·çš„é¡ºåºæ‰“å°ç¬¬2è½®ï¼Œæ€»å…±æ‰“å°10è½®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019-12-15 19:24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo5</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ShareResource shareResource = <span class="keyword">new</span> ShareResource();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++)&#123;</span><br><span class="line">                shareResource.print5(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"AA"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++)&#123;</span><br><span class="line">                shareResource.print10(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"BB"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++)&#123;</span><br><span class="line">                shareResource.print15(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"CC"</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å…«-lockä¹‹è¯»å†™é”ReentrantReadWriteLock"><a href="#å…«-lockä¹‹è¯»å†™é”ReentrantReadWriteLock" class="headerlink" title="å…«.lockä¹‹è¯»å†™é”ReentrantReadWriteLock"></a>å…«.lockä¹‹è¯»å†™é”ReentrantReadWriteLock</h4><p>ReentrantReadWriteLock çš„ä½¿ç”¨demoï¼š</p><p>wrlock.writeLock().lock();      wrlock.readLock().lock();</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learnjava.JUC;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyReadWrite</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object object;</span><br><span class="line">    <span class="keyword">private</span> ReentrantReadWriteLock wrlock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(Object obj)</span></span>&#123;</span><br><span class="line">        wrlock.writeLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.object = obj;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"\t"</span> + object);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            wrlock.writeLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">        wrlock.readLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"\t"</span> + object);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            wrlock.readLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¢˜ç›®ï¼š 100ä¸ªçº¿ç¨‹è¯»å–ï¼Œ1ä¸ªçº¿ç¨‹å†™</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019-12-15 20:08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreadDemo6</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        MyReadWrite myReadWrite = <span class="keyword">new</span> MyReadWrite();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            myReadWrite.write(<span class="string">"writie......"</span>);</span><br><span class="line">        &#125;,<span class="string">"myReadWrite"</span>).start();</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">100</span>); <span class="comment">//é˜²æ­¢è¿˜æ²¡æœ‰å†™çš„æ—¶å€™å°±è¯»</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                myReadWrite.read();</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¹-çº¿ç¨‹æ± -Executor"><a href="#ä¹-çº¿ç¨‹æ± -Executor" class="headerlink" title="ä¹.çº¿ç¨‹æ±  Executor"></a>ä¹.çº¿ç¨‹æ±  Executor</h2><p>æ¨é€ä½¿ç”¨Executorså·¥å…·ç±»åˆ›å»ºExecutorServiceå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learnjava.JUC;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: chenyawei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019-12-15 21:03</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo7</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//threadPool();</span></span><br><span class="line">        ScheduledExecutorService executorService = Executors.newScheduledThreadPool(<span class="number">5</span>);</span><br><span class="line">        ScheduledFuture&lt;Integer&gt; future = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++)&#123;</span><br><span class="line">                future = executorService.schedule(() -&gt; &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName());</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> Random().nextInt(<span class="number">50</span>);</span><br><span class="line">                &#125;,<span class="number">2</span>,TimeUnit.SECONDS);</span><br><span class="line">                System.out.println(<span class="string">"**"</span> + future.get());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            executorService.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">threadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ExecutorService threadPool = Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">        ExecutorService threadPool2 = Executors.newSingleThreadExecutor(); <span class="comment">//ä¸€ç›´ä¿æŒä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">        ExecutorService threadPool3 = Executors.newCachedThreadPool();  <span class="comment">//æ ¹æ®éœ€è¦ç¨‹åºè‡ªå·±å¯åŠ¨çº¿ç¨‹æ•°</span></span><br><span class="line"></span><br><span class="line">        Future&lt;Integer&gt; result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= <span class="number">20</span>; i++)&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//                result = threadPool.submit(new Callable&lt;Integer&gt;() &#123;</span></span><br><span class="line"><span class="comment">//                    @Override</span></span><br><span class="line"><span class="comment">//                    public Integer call() throws Exception &#123;</span></span><br><span class="line"><span class="comment">//                        System.out.print(Thread.currentThread().getName());</span></span><br><span class="line"><span class="comment">//                        return new Random().nextInt(50);</span></span><br><span class="line"><span class="comment">//                    &#125;</span></span><br><span class="line"><span class="comment">//                &#125;);</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//Lambdaè¯­æ³•</span></span><br><span class="line">                result = threadPool3.submit(() -&gt; &#123;</span><br><span class="line">                    System.out.print(Thread.currentThread().getName());</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> Random().nextInt(<span class="number">50</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">                System.out.println(<span class="string">"**"</span> + result.get());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool3.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> åŸºç¡€ç†è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> åŸºç¡€ç†è§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HashMapæºç è§£æå’Œå®ç°åŸç†</title>
      <link href="/2019/12/15/HashMap%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E5%92%8C%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/"/>
      <url>/2019/12/15/HashMap%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E5%92%8C%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€-HashMapç®€ä»‹"><a href="#ä¸€-HashMapç®€ä»‹" class="headerlink" title="ä¸€.HashMapç®€ä»‹"></a>ä¸€.HashMapç®€ä»‹</h2><h3 id="1-1-å…ˆäº†è§£ä¸‹ä»€ä¹ˆæ˜¯hashè¡¨ï¼Œ"><a href="#1-1-å…ˆäº†è§£ä¸‹ä»€ä¹ˆæ˜¯hashè¡¨ï¼Œ" class="headerlink" title="1.1 å…ˆäº†è§£ä¸‹ä»€ä¹ˆæ˜¯hashè¡¨ï¼Œ"></a>1.1 å…ˆäº†è§£ä¸‹ä»€ä¹ˆæ˜¯hashè¡¨ï¼Œ</h3><p>å°†éœ€è¦æ£€ç´¢çš„å…ƒç´ æ˜ å°„æˆå¯ä»¥å¿«é€Ÿæ£€ç´¢çš„hashå€¼ï¼ŒhashCode = hash(key); å­˜å‚¨hashå€¼ï¼ˆå³ä¸ºhashæ¡¶ï¼‰åº•å±‚é€šå¸¸æ˜¯ç”¨æ•°ç»„å®ç°çš„ï¼Œå› ä¸ºæ•°ç»„çš„éšæœºå¯»å€æ—¶é—´æ˜¯O(1)å¸¸æ•°æ—¶é—´ï¼ˆåº•å±‚æ˜¯ç¡¬ä»¶ç”µè·¯çš„çº¿å½¢åœ°å€å˜æ¢ç›´æ¥æŸ¥æ‰¾è¿‡å»ï¼Œé€Ÿåº¦éå¸¸å¿«æ ¹é•¿åº¦æ— å…³ï¼‰ã€‚å¦‚æœå¤šä¸ªå…ƒç´ çš„hashå€¼ç›¸åŒï¼Œç§°ä¸ºhashç¢°æ’ã€‚æ ¸å¿ƒæ˜¯åŸºäºå“ˆå¸Œå€¼çš„æ¡¶å’Œé“¾è¡¨ã€‚</p><p>è‡´å‘½ç¼ºé™·å°±æ˜¯hashç¢°æ’ã€‚è§£å†³ç¢°æ’æ¯”è¾ƒå‡ºåçš„æœ‰å››ç§ ï¼š (1)å¼€æ”¾å®šå€æ³• (2)é“¾åœ°å€æ³• (3)å†å“ˆå¸Œæ³• (4)å…¬å…±æº¢å‡ºåŒºåŸŸæ³•</p><h3 id="1-2-åŸç†"><a href="#1-2-åŸç†" class="headerlink" title="1.2 åŸç†"></a>1.2 åŸç†</h3><p>åŸç†å›¾ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9xb6o4i3uj30wa0g0q5v.jpg" alt="image-20191215124612391"></p><p>HashMapé‡‡ç”¨Entryæ•°ç»„æ¥å­˜å‚¨key-valueå¯¹ï¼Œæ¯ä¸€ä¸ªé”®å€¼å¯¹ç»„æˆäº†ä¸€ä¸ªEntryå®ä½“ï¼ŒEntryç±»å®é™…ä¸Šæ˜¯ä¸€ä¸ªå•å‘çš„é“¾è¡¨ç»“æ„ï¼Œå®ƒå…·æœ‰NextæŒ‡é’ˆï¼Œå¯ä»¥è¿æ¥ä¸‹ä¸€ä¸ªEntryå®ä½“ã€‚ åªæ˜¯åœ¨JDK1.8ä¸­ï¼Œé“¾è¡¨é•¿åº¦å¤§äº8çš„æ—¶å€™ï¼Œé“¾è¡¨ä¼šè½¬æˆçº¢é»‘æ ‘ï¼ <em>ä¸ºä»€ä¹ˆç”¨æ•°ç»„+é“¾è¡¨ï¼Ÿ</em> æ•°ç»„æ˜¯ç”¨æ¥ç¡®å®šæ¡¶çš„ä½ç½®ï¼Œåˆ©ç”¨å…ƒç´ çš„keyçš„hashå€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡å¾—åˆ°. é“¾è¡¨æ˜¯ç”¨æ¥è§£å†³hashå†²çªé—®é¢˜ï¼Œå½“å‡ºç°hashå€¼ä¸€æ ·çš„æƒ…å½¢ï¼Œå°±åœ¨æ•°ç»„ä¸Šçš„å¯¹åº”ä½ç½®å½¢æˆä¸€æ¡é“¾è¡¨ã€‚</p><p><code>ps</code>:è¿™é‡Œçš„hashå€¼å¹¶ä¸æ˜¯æŒ‡hashcodeï¼Œè€Œæ˜¯å°†hashcodeé«˜ä½åå…­ä½å¼‚æˆ–è¿‡çš„ã€‚è‡³äºä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Œç»§ç»­å¾€ä¸‹çœ‹ã€‚</p><p><em>æˆ‘ç”¨LinkedListä»£æ›¿æ•°ç»„ç»“æ„å¯ä»¥ä¹ˆ?</em> è¿™é‡Œæˆ‘ç¨å¾®è¯´æ˜ä¸€ä¸‹ï¼Œæ­¤é¢˜çš„æ„æ€æ˜¯ï¼Œæºç ä¸­æ˜¯è¿™æ ·çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Entry[] table = new Entry[capacity];</span><br></pre></td></tr></table></figure><p><code>psï¼š</code>Entryå°±æ˜¯ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ã€‚ é‚£æˆ‘ç”¨ä¸‹é¢è¿™æ ·è¡¨ç¤º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Entry&gt; table = new LinkedList&lt;Entry&gt;();</span><br></pre></td></tr></table></figure><p>æ˜¯å¦å¯è¡Œ? </p><p>ç­”æ¡ˆå¾ˆæ˜æ˜¾ï¼Œå¿…é¡»æ˜¯å¯ä»¥çš„ã€‚ ä½†æ˜¯æ•ˆç‡ä¼šæ¯”æ•°ç»„æ…¢ã€‚</p><p><em>æ—¢ç„¶æ˜¯å¯ä»¥çš„,ä¸ºä»€ä¹ˆHashMapä¸ç”¨LinkedList,è€Œé€‰ç”¨æ•°ç»„?</em> </p><p>å› ä¸ºç”¨æ•°ç»„æ•ˆç‡æœ€é«˜ï¼ åœ¨HashMapä¸­ï¼Œå®šä½æ¡¶çš„ä½ç½®æ˜¯åˆ©ç”¨å…ƒç´ çš„keyçš„å“ˆå¸Œå€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡å¾—åˆ°ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å·²å¾—åˆ°æ¡¶çš„ä½ç½®ã€‚æ˜¾ç„¶æ•°ç»„çš„æŸ¥æ‰¾æ•ˆç‡æ¯”LinkedListå¤§ã€‚</p><p><em>é‚£ArrayListï¼Œåº•å±‚ä¹Ÿæ˜¯æ•°ç»„ï¼ŒæŸ¥æ‰¾ä¹Ÿå¿«å•Šï¼Œä¸ºå•¥ä¸ç”¨ArrayList?</em> </p><p>å› ä¸ºé‡‡ç”¨åŸºæœ¬æ•°ç»„ç»“æ„ï¼Œæ‰©å®¹æœºåˆ¶å¯ä»¥è‡ªå·±å®šä¹‰ï¼ŒHashMapä¸­æ•°ç»„æ‰©å®¹åˆšå¥½æ˜¯2çš„æ¬¡å¹‚ï¼Œåœ¨åšå–æ¨¡è¿ç®—çš„æ•ˆç‡é«˜ã€‚ è€ŒArrayListçš„æ‰©å®¹æœºåˆ¶æ˜¯1.5å€æ‰©å®¹ï¼Œé‚£ArrayListä¸ºä»€ä¹ˆæ˜¯1.5å€æ‰©å®¹è¿™å°±ä¸åœ¨æœ¬æ–‡è¯´æ˜äº†ã€‚</p><h3 id="1-3-HashMap-ä¸­-hash-å‡½æ•°æ€ä¹ˆæ˜¯å®ç°çš„"><a href="#1-3-HashMap-ä¸­-hash-å‡½æ•°æ€ä¹ˆæ˜¯å®ç°çš„" class="headerlink" title="1.3 HashMap ä¸­ hash å‡½æ•°æ€ä¹ˆæ˜¯å®ç°çš„?"></a>1.3 HashMap ä¸­ hash å‡½æ•°æ€ä¹ˆæ˜¯å®ç°çš„?</h3><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ hashmap ä¸­è¦æ‰¾åˆ°æŸä¸ªå…ƒç´ ï¼Œéœ€è¦æ ¹æ® key çš„ hash å€¼æ¥æ±‚å¾—å¯¹åº”æ•°ç»„ä¸­çš„ä½ç½®ã€‚å¦‚ä½•è®¡ç®—è¿™ä¸ªä½ç½®å°±æ˜¯ hash ç®—æ³•ã€‚</p><p>å‰é¢è¯´è¿‡ï¼Œhashmap çš„æ•°æ®ç»“æ„æ˜¯æ•°ç»„å’Œé“¾è¡¨çš„ç»“åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å½“ç„¶å¸Œæœ›è¿™ä¸ª hashmap é‡Œé¢çš„å…ƒç´ ä½ç½®å°½é‡çš„åˆ†å¸ƒå‡åŒ€äº›ï¼Œå°½é‡ä½¿å¾—æ¯ä¸ªä½ç½®ä¸Šçš„å…ƒç´ æ•°é‡åªæœ‰ä¸€ä¸ªã€‚é‚£ä¹ˆå½“æˆ‘ä»¬ç”¨ hash ç®—æ³•æ±‚å¾—è¿™ä¸ªä½ç½®çš„æ—¶å€™ï¼Œé©¬ä¸Šå°±å¯ä»¥çŸ¥é“å¯¹åº”ä½ç½®çš„å…ƒç´ å°±æ˜¯æˆ‘ä»¬è¦çš„ï¼Œè€Œä¸ç”¨å†å»éå†é“¾è¡¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æŠŠ hashcode å¯¹æ•°ç»„é•¿åº¦å–æ¨¡è¿ç®—ã€‚è¿™æ ·ä¸€æ¥ï¼Œå…ƒç´ çš„åˆ†å¸ƒç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚</p><p>ä½†æ˜¯â€œæ¨¡â€è¿ç®—çš„æ¶ˆè€—è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œèƒ½ä¸èƒ½æ‰¾ä¸€ç§æ›´å¿«é€Ÿã€æ¶ˆè€—æ›´å°çš„æ–¹å¼ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹ JDK1.8 æºç æ˜¯æ€ä¹ˆåšçš„ï¼ˆè¢«æ¥¼ä¸»ä¿®é¥°äº†ä¸€ä¸‹ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (key == <span class="keyword">null</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> h;</span><br><span class="line">  h = key.hashCode()ï¼›è¿”å›æ•£åˆ—å€¼ä¹Ÿå°±æ˜¯hashcode</span><br><span class="line">  <span class="keyword">return</span> (n-<span class="number">1</span>)&amp;(h ^ (h &gt;&gt;&gt; <span class="number">16</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9xbzt0bsmj317s0kydsg.jpg" alt="image-20191215131412249"></p><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼š</p><ul><li>é«˜16 bit ä¸å˜ï¼Œä½16 bit å’Œé«˜16 bit åšäº†ä¸€ä¸ªå¼‚æˆ–ï¼ˆå¾—åˆ°çš„ hashcode è½¬åŒ–ä¸º32ä½äºŒè¿›åˆ¶ï¼Œå‰16ä½å’Œå16ä½ä½16 bitå’Œé«˜16 bitåšäº†ä¸€ä¸ªå¼‚æˆ–ï¼‰</li><li>(nÂ·1) &amp; hash = -&gt; å¾—åˆ°ä¸‹æ ‡</li></ul><h3 id="1-4-æ‹‰é“¾æ³•å¯¼è‡´çš„é“¾è¡¨è¿‡æ·±ï¼Œä¸ºä»€ä¹ˆä¸ç”¨äºŒå‰æŸ¥æ‰¾æ ‘ä»£æ›¿è€Œé€‰æ‹©çº¢é»‘æ ‘ï¼Ÿä¸ºä»€ä¹ˆä¸ä¸€ç›´ä½¿ç”¨çº¢é»‘æ ‘ï¼Ÿ"><a href="#1-4-æ‹‰é“¾æ³•å¯¼è‡´çš„é“¾è¡¨è¿‡æ·±ï¼Œä¸ºä»€ä¹ˆä¸ç”¨äºŒå‰æŸ¥æ‰¾æ ‘ä»£æ›¿è€Œé€‰æ‹©çº¢é»‘æ ‘ï¼Ÿä¸ºä»€ä¹ˆä¸ä¸€ç›´ä½¿ç”¨çº¢é»‘æ ‘ï¼Ÿ" class="headerlink" title="1.4 æ‹‰é“¾æ³•å¯¼è‡´çš„é“¾è¡¨è¿‡æ·±ï¼Œä¸ºä»€ä¹ˆä¸ç”¨äºŒå‰æŸ¥æ‰¾æ ‘ä»£æ›¿è€Œé€‰æ‹©çº¢é»‘æ ‘ï¼Ÿä¸ºä»€ä¹ˆä¸ä¸€ç›´ä½¿ç”¨çº¢é»‘æ ‘ï¼Ÿ"></a>1.4 æ‹‰é“¾æ³•å¯¼è‡´çš„é“¾è¡¨è¿‡æ·±ï¼Œä¸ºä»€ä¹ˆä¸ç”¨äºŒå‰æŸ¥æ‰¾æ ‘ä»£æ›¿è€Œé€‰æ‹©çº¢é»‘æ ‘ï¼Ÿä¸ºä»€ä¹ˆä¸ä¸€ç›´ä½¿ç”¨çº¢é»‘æ ‘ï¼Ÿ</h3><p>ä¹‹æ‰€ä»¥é€‰æ‹©çº¢é»‘æ ‘æ˜¯ä¸ºäº†è§£å†³äºŒå‰æŸ¥æ‰¾æ ‘çš„ç¼ºé™·ï¼šäºŒå‰æŸ¥æ‰¾æ ‘åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ä¼šå˜æˆä¸€æ¡çº¿æ€§ç»“æ„ï¼ˆè¿™å°±è·ŸåŸæ¥ä½¿ç”¨é“¾è¡¨ç»“æ„ä¸€æ ·äº†ï¼Œé€ æˆå±‚æ¬¡å¾ˆæ·±çš„é—®é¢˜ï¼‰ï¼Œéå†æŸ¥æ‰¾ä¼šéå¸¸æ…¢ã€‚è€Œçº¢é»‘æ ‘åœ¨æ’å…¥æ–°æ•°æ®åå¯èƒ½éœ€è¦é€šè¿‡å·¦æ—‹ã€å³æ—‹ã€å˜è‰²è¿™äº›æ“ä½œæ¥ä¿æŒå¹³è¡¡ã€‚å¼•å…¥çº¢é»‘æ ‘å°±æ˜¯ä¸ºäº†æŸ¥æ‰¾æ•°æ®å¿«ï¼Œè§£å†³é“¾è¡¨æŸ¥è¯¢æ·±åº¦çš„é—®é¢˜ã€‚æˆ‘ä»¬çŸ¥é“çº¢é»‘æ ‘å±äºå¹³è¡¡äºŒå‰æ ‘ï¼Œä¸ºäº†ä¿æŒâ€œå¹³è¡¡â€æ˜¯éœ€è¦ä»˜å‡ºä»£ä»·çš„ï¼Œä½†æ˜¯è¯¥ä»£ä»·æ‰€æŸè€—çš„èµ„æºè¦æ¯”éå†çº¿æ€§é“¾è¡¨è¦å°‘ã€‚æ‰€ä»¥å½“é•¿åº¦å¤§äº8çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨çº¢é»‘æ ‘ï¼›å¦‚æœé“¾è¡¨é•¿åº¦å¾ˆçŸ­çš„è¯ï¼Œæ ¹æœ¬ä¸éœ€è¦å¼•å…¥çº¢é»‘æ ‘ï¼Œå¼•å…¥åè€Œä¼šæ…¢ã€‚</p><h3 id="1-5-CocurrentHashMap"><a href="#1-5-CocurrentHashMap" class="headerlink" title="1.5 CocurrentHashMap"></a>1.5 CocurrentHashMap</h3><h4 id="1-JDK-1-7"><a href="#1-JDK-1-7" class="headerlink" title="1). JDK 1.7"></a>1). JDK 1.7</h4><ul><li><p>CocurrentHashMap æ˜¯ç”± Segment æ•°ç»„å’Œ HashEntry æ•°ç»„å’Œé“¾è¡¨ç»„æˆ</p></li><li><p>Segment æ˜¯åŸºäºé‡å…¥é”ï¼ˆReentrantLockï¼‰ï¼š<br>ä¸€ä¸ªæ•°æ®æ®µç«äº‰é”ã€‚</p></li><li><p>æ¯ä¸ª HashEntry ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„å…ƒç´ ï¼Œåˆ©ç”¨ Hash ç®—æ³•å¾—åˆ°ç´¢å¼•ç¡®å®šå½’å±çš„æ•°æ®æ®µï¼Œä¹Ÿå°±æ˜¯å¯¹åº”åˆ°åœ¨ä¿®æ”¹æ—¶éœ€è¦ç«äº‰è·å–çš„é”ã€‚</p></li><li><p>ConcurrentHashMap æ”¯æŒ CurrencyLevelï¼ˆSegment æ•°ç»„æ•°é‡ï¼‰çš„çº¿ç¨‹å¹¶å‘ã€‚<br>æ¯å½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®ä¸€ä¸ª Segment æ—¶ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„ Segment</p></li><li><p>æ ¸å¿ƒæ•°æ®å¦‚ valueï¼Œä»¥åŠé“¾è¡¨éƒ½æ˜¯ volatile ä¿®é¥°çš„ï¼Œä¿è¯äº†è·å–æ—¶çš„å¯è§æ€§</p></li><li><p>é¦–å…ˆæ˜¯é€šè¿‡ key å®šä½åˆ° Segmentï¼Œä¹‹ååœ¨å¯¹åº”çš„ Segment ä¸­è¿›è¡Œå…·ä½“çš„ put æ“ä½œå¦‚ä¸‹ï¼š</p></li><li><ul><li>å°†å½“å‰ Segment ä¸­çš„ table é€šè¿‡ key çš„ hashcode å®šä½åˆ° HashEntryã€‚</li><li>éå†è¯¥ HashEntryï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™åˆ¤æ–­ä¼ å…¥çš„ key å’Œå½“å‰éå†çš„ key æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™è¦†ç›–æ—§çš„ value</li><li>ä¸ä¸ºç©ºåˆ™éœ€è¦æ–°å»ºä¸€ä¸ª HashEntry å¹¶åŠ å…¥åˆ° Segment ä¸­ï¼ŒåŒæ—¶ä¼šå…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</li><li>æœ€åä¼šè§£é™¤åœ¨ 1 ä¸­æ‰€è·å–å½“å‰ Segment çš„é”ã€‚</li></ul></li><li><p>è™½ç„¶ HashEntry ä¸­çš„ value æ˜¯ç”¨ volatile å…³é”®è¯ä¿®é¥°çš„ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å¹¶å‘çš„åŸå­æ€§ï¼Œæ‰€ä»¥ put æ“ä½œæ—¶ä»ç„¶éœ€è¦åŠ é”å¤„ç†</p></li></ul><p>é¦–å…ˆç¬¬ä¸€æ­¥çš„æ—¶å€™ä¼šå°è¯•è·å–é”ï¼Œå¦‚æœè·å–å¤±è´¥è‚¯å®šå°±æœ‰å…¶ä»–çº¿ç¨‹å­˜åœ¨ç«äº‰ï¼Œåˆ™åˆ©ç”¨ scanAndLockForPut() è‡ªæ—‹è·å–é”ã€‚</p><ul><li>å°è¯•è‡ªæ—‹è·å–é”</li><li>å¦‚æœé‡è¯•çš„æ¬¡æ•°è¾¾åˆ°äº† MAX_SCAN_RETRIES åˆ™æ”¹ä¸ºé˜»å¡é”è·å–ï¼Œä¿è¯èƒ½è·å–æˆåŠŸã€‚<br>æœ€åè§£é™¤å½“å‰ Segment çš„é”</li></ul><h4 id="2-ï¼ˆJDK-1-8ï¼‰"><a href="#2-ï¼ˆJDK-1-8ï¼‰" class="headerlink" title="2) ï¼ˆJDK 1.8ï¼‰"></a>2) ï¼ˆJDK 1.8ï¼‰</h4><p>CocurrentHashMap æŠ›å¼ƒäº†åŸæœ‰çš„ Segment åˆ†æ®µé”ï¼Œé‡‡ç”¨äº† <code>CAS + synchronized</code> æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚å…¶ä¸­çš„ <code>val next</code> éƒ½ç”¨äº† volatile ä¿®é¥°ï¼Œä¿è¯äº†å¯è§æ€§ã€‚</p><h2 id="äºŒ-HashMapé»˜è®¤å®¹é‡æ˜¯å¤šå°‘ï¼ŸHashMapçš„æ•°ç»„å¤§å°ä¸ºä»€ä¹ˆä¸€å®šè¦æ˜¯2çš„å¹‚ï¼Ÿ"><a href="#äºŒ-HashMapé»˜è®¤å®¹é‡æ˜¯å¤šå°‘ï¼ŸHashMapçš„æ•°ç»„å¤§å°ä¸ºä»€ä¹ˆä¸€å®šè¦æ˜¯2çš„å¹‚ï¼Ÿ" class="headerlink" title="äºŒ.HashMapé»˜è®¤å®¹é‡æ˜¯å¤šå°‘ï¼ŸHashMapçš„æ•°ç»„å¤§å°ä¸ºä»€ä¹ˆä¸€å®šè¦æ˜¯2çš„å¹‚ï¼Ÿ"></a>äºŒ.HashMapé»˜è®¤å®¹é‡æ˜¯å¤šå°‘ï¼ŸHashMapçš„æ•°ç»„å¤§å°ä¸ºä»€ä¹ˆä¸€å®šè¦æ˜¯2çš„å¹‚ï¼Ÿ</h2><h3 id="2-1HashMapé»˜è®¤å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ"><a href="#2-1HashMapé»˜è®¤å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="2.1HashMapé»˜è®¤å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ"></a>2.1HashMapé»˜è®¤å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The default initial capacity - MUST be a power of two.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br></pre></td></tr></table></figure><p>é»˜è®¤åˆå§‹å®¹é‡ä¸º16ï¼Œ1å·¦ç§»4ä½ç­‰äº16. å› ä¸ºå·¦ç§»ç­‰äºä¹˜äº2ï¼Œå³ä¸º2çš„å¹‚ã€‚å³ä¸ºhashæ¡¶çš„æ•°é‡å¿…é¡»æ˜¯2çš„næ¬¡æ–¹ã€‚</p><h3 id="2-2-å¦‚æœè‡ªå®šä¹‰ä¸æ˜¯2çš„å¹‚ä¼šæ€æ ·ï¼Ÿ"><a href="#2-2-å¦‚æœè‡ªå®šä¹‰ä¸æ˜¯2çš„å¹‚ä¼šæ€æ ·ï¼Ÿ" class="headerlink" title="2.2 å¦‚æœè‡ªå®šä¹‰ä¸æ˜¯2çš„å¹‚ä¼šæ€æ ·ï¼Ÿ"></a>2.2 å¦‚æœè‡ªå®šä¹‰ä¸æ˜¯2çš„å¹‚ä¼šæ€æ ·ï¼Ÿ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs an empty &lt;tt&gt;HashMap&lt;/tt&gt; with the specified initial</span></span><br><span class="line"><span class="comment"> * capacity and load factor.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  initialCapacity the initial capacity</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  loadFactor      the load factor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class="line"><span class="comment"> *         or the load factor is nonpositive</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal initial capacity: "</span> +</span><br><span class="line">                                           initialCapacity);</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">        initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line">    <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal load factor: "</span> +</span><br><span class="line">                                           loadFactor);</span><br><span class="line">    <span class="keyword">this</span>.loadFactor = loadFactor;</span><br><span class="line">    <span class="keyword">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹è¿™ä¸ªæ„é€ æ–¹æ³•çŸ¥é“ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥è‡ªå®šä¹‰åˆå§‹å®¹é‡çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a power of two size for the given target capacity.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tableSizeFor</span><span class="params">(<span class="keyword">int</span> cap)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = cap - <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡å¦‚æˆ‘ä»¬æŠŠinitialCapacityè°ƒæ•´ä¸º17ï¼Œä¸Šé¢ä»£ç å¯¹äºç»™å®šçš„ç›®æ ‡å®¹é‡ï¼Œè¿”å›ä¸¤å€å¤§å°çš„å¹‚ã€‚å¦‚æœæˆ‘ä»¬è°ƒæ•´ä¸º17å°±å¤§äº<script type="math/tex">2^4=16</script> å°±ä¼š4+1çš„æ“ä½œï¼Œè®¾ç½®åˆå§‹å€¼ä¸º<script type="math/tex">2^5=32</script>ã€‚</p><h3 id="2-3-ä¸ºä»€ä¹ˆä¸€å®šè¦æ˜¯2çš„å¹‚å‘¢ï¼Ÿ"><a href="#2-3-ä¸ºä»€ä¹ˆä¸€å®šè¦æ˜¯2çš„å¹‚å‘¢ï¼Ÿ" class="headerlink" title="2.3 ä¸ºä»€ä¹ˆä¸€å®šè¦æ˜¯2çš„å¹‚å‘¢ï¼Ÿ"></a>2.3 ä¸ºä»€ä¹ˆä¸€å®šè¦æ˜¯2çš„å¹‚å‘¢ï¼Ÿ</h3><p>é¦–å…ˆï¼ŒhashCodeæ˜¯intç±»å‹ï¼Œå–å€¼èŒƒå›´æ˜¯<script type="math/tex">-2^{31}</script>åˆ°<script type="math/tex">+2^{31}</script>ä¹‹é—´ï¼Œéœ€è¦è§£å†³æ€ä¹ˆæŠŠå–å€¼èŒƒå›´æ˜ å°„åˆ°(0ï½N)å¦‚0ï½15ä¸Šï¼ŒNç›¸å¯¹å¾ˆå°ã€‚tab[i = (n - 1) &amp; hash] å³ æ•°ç»„çš„é•¿åº¦nå‡å»1ä¸hash(k)çš„å€¼ &amp;ï¼ˆæŒ‰ä½ä¸ï¼‰è¿ç®—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Implements Map.put and related methods.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hash hash for key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value the value to put</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> onlyIfAbsent if true, don't change existing value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> evict if false, the table is in creation mode.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> previous value, or null if none</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">        <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">        <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>) <span class="comment">//æ•°ç»„çš„é•¿åº¦nå‡å»1ä¸hash(k)çš„å€¼ &amp;ï¼ˆæŒ‰ä½ä¸ï¼‰è¿ç®—</span></span><br><span class="line">            tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br></pre></td></tr></table></figure><p>(Length - 1) &amp; hashè¿™æ ·è¿ç®—çš„åŸå› ï¼Œå³ä¸ºä¸ºä»€ä¹ˆä¸€å®šæ˜¯2çš„å¹‚çš„åŸå› ï¼Ÿ</p><p><script type="math/tex">length=2^n</script> äºŒè¿›åˆ¶è¡¨ç¤ºä¸º100000â€¦ æœ€é«˜ä½æ˜¯1ä½ä½å…¨æ˜¯0ï¼Œæ‰€æœ‰length-1å°±èƒ½å¾—åˆ°å…¨éƒ¨æ˜¯1çš„äºŒè¿›åˆ¶ã€‚ä¾‹å¦‚ï¼š<script type="math/tex">2^4</script>äºŒè¿›åˆ¶ä½10000ï¼Œå‡1åäºŒè¿›åˆ¶æ˜¯1111ã€‚è¿™æ ·å¯¹1111æŒ‰ä½ä¸ï¼ˆ&amp;ï¼‰è¿ç®—èƒ½éå¸¸å¿«é€Ÿçš„æ‹¿åˆ°æ•°ç»„ä¸‹æ ‡ï¼Œå¹¶ä¸”åˆ†å¸ƒè¿˜æ˜¯å‡åŒ€çš„ã€‚</p><p>HashMapä¸ºäº†å­˜å–é«˜æ•ˆï¼Œè¦å°½é‡è¾ƒå°‘ç¢°æ’ï¼Œå°±æ˜¯è¦å°½é‡æŠŠæ•°æ®åˆ†é…å‡åŒ€ï¼Œæ¯ä¸ªé“¾è¡¨é•¿åº¦å¤§è‡´ç›¸åŒï¼Œè¿™ä¸ªå®ç°å°±åœ¨æŠŠæ•°æ®å­˜åˆ°å“ªä¸ªé“¾è¡¨ä¸­çš„ç®—æ³•ï¼›å› ä¸º2çš„næ¬¡æ–¹å®é™…å°±æ˜¯1åé¢nä¸ª0ï¼Œ2çš„næ¬¡æ–¹-1ï¼Œå®é™…å°±æ˜¯nä¸ª1ã€‚ ä¾‹å¦‚é•¿åº¦ä¸º8æ—¶å€™ï¼Œ3&amp;(8-1)=3  2&amp;(8-1)=2 ï¼Œä¸åŒä½ç½®ä¸Šï¼Œä¸ç¢°æ’ã€‚ è€Œé•¿åº¦ä¸º5çš„æ—¶å€™ï¼Œ3&amp;(5-1)=0  2&amp;(5-1)=0ï¼Œéƒ½åœ¨0ä¸Šï¼Œå‡ºç°ç¢°æ’äº†ã€‚ æ‰€ä»¥ï¼Œä¿è¯å®¹ç§¯æ˜¯2çš„næ¬¡æ–¹ï¼Œæ˜¯ä¸ºäº†ä¿è¯åœ¨åš(length-1)çš„æ—¶å€™ï¼Œæ¯ä¸€ä½éƒ½èƒ½&amp;1  ï¼Œä¹Ÿå°±æ˜¯å’Œ1111â€¦â€¦1111111è¿›è¡Œä¸è¿ç®—ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9x80nf6afj317e0q6gsy.jpg" alt="image-20191215105635360" style="zoom:50%;" /></p><h2 id="ä¸‰-é»˜è®¤è´Ÿè½½å› å­æ˜¯å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªå€¼ï¼Ÿ"><a href="#ä¸‰-é»˜è®¤è´Ÿè½½å› å­æ˜¯å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªå€¼ï¼Ÿ" class="headerlink" title="ä¸‰.é»˜è®¤è´Ÿè½½å› å­æ˜¯å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªå€¼ï¼Ÿ"></a>ä¸‰.é»˜è®¤è´Ÿè½½å› å­æ˜¯å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªå€¼ï¼Ÿ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The load factor used when none specified in constructor.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br></pre></td></tr></table></figure><p>æ˜¯æ—¶é—´å’Œç©ºé—´ä¸Šçš„ç»¼åˆè€ƒé‡ã€‚</p><h2 id="å››-HashMapå¦‚ä½•æ‰©å®¹ï¼Ÿ"><a href="#å››-HashMapå¦‚ä½•æ‰©å®¹ï¼Ÿ" class="headerlink" title="å››.HashMapå¦‚ä½•æ‰©å®¹ï¼Ÿ"></a>å››.HashMapå¦‚ä½•æ‰©å®¹ï¼Ÿ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Constructs an empty &lt;tt&gt;HashMap&lt;/tt&gt; with the default initial capacity</span></span><br><span class="line"><span class="comment">  * (16) and the default load factor (0.75).</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="comment">// all other fields defaulted</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>HashMapçš„æ„é€ æ–¹æ³•ï¼Œé»˜è®¤åˆå§‹å®¹é‡ä¸º16ï¼Œè´Ÿè½½å› å­ä¸º0.75.å½“putå€¼çš„æ—¶å€™æ‰ä¼šæœ‰ä¸€ä¸ª16å®¹é‡çš„æ¡¶ï¼Œç©ºé—´æ‰ä¼šå¼€è¾Ÿå‡ºæ¥ã€‚</p><p>å½“ä¸€ä¸ªhashæ¡¶ä¸­çš„å…ƒç´ çš„æ•°é‡ç­‰äº16*0.75=12çš„æ—¶å€™ï¼Œå°±ä¼šæ‰©å®¹ã€‚æ¯æ¬¡æ‰©å®¹ä¸€å€ï¼Œå½“å…ƒç´ å‡å°‘æ—¶ä¹Ÿä¸ç¼©å®¹ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9x8ugopekj31480oogql.jpg" alt="image-20191215112509858" style="zoom:50%;" /></p><h2 id="å››-HashMapä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Ÿ"><a href="#å››-HashMapä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Ÿ" class="headerlink" title="å››.HashMapä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Ÿ"></a>å››.HashMapä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Ÿ</h2><p>æ­¤é¢˜å¯ä»¥ç»„æˆå¦‚ä¸‹è¿ç¯ç‚®æ¥é—® </p><ul><li>HashMapåœ¨å¹¶å‘ç¼–ç¨‹ç¯å¢ƒä¸‹æœ‰ä»€ä¹ˆé—®é¢˜å•Š? </li><li>åœ¨jdk1.8ä¸­è¿˜æœ‰è¿™äº›é—®é¢˜ä¹ˆ? </li><li>ä½ ä¸€èˆ¬æ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜çš„ï¼Ÿ</li></ul><p><em>HashMapåœ¨å¹¶å‘ç¼–ç¨‹ç¯å¢ƒä¸‹æœ‰ä»€ä¹ˆé—®é¢˜å•Š?</em> </p><ul><li>(1)å¤šçº¿ç¨‹æ‰©å®¹ï¼Œå¼•èµ·çš„æ­»å¾ªç¯é—®é¢˜ </li><li>(2)å¤šçº¿ç¨‹putçš„æ—¶å€™å¯èƒ½å¯¼è‡´å…ƒç´ ä¸¢å¤± </li><li>(3)puténullå…ƒç´ ågetå‡ºæ¥çš„å´æ˜¯null</li></ul><p><em>åœ¨jdk1.8ä¸­è¿˜æœ‰è¿™äº›é—®é¢˜ä¹ˆ?</em></p><p>åœ¨jdk1.8ä¸­ï¼Œæ­»å¾ªç¯é—®é¢˜å·²ç»è§£å†³ã€‚å…¶ä»–ä¸¤ä¸ªé—®é¢˜è¿˜æ˜¯å­˜åœ¨ã€‚</p><p><em>ä½ ä¸€èˆ¬æ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜çš„ï¼Ÿ</em></p><p>æ¯”å¦‚ConcurrentHashmapï¼ŒHashtableç­‰çº¿ç¨‹å®‰å…¨ç­‰é›†åˆç±»ã€‚</p><h2 id="äº”-Java7åˆ°Java8åšäº†å“ªäº›æ”¹è¿›ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#äº”-Java7åˆ°Java8åšäº†å“ªäº›æ”¹è¿›ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="äº”.Java7åˆ°Java8åšäº†å“ªäº›æ”¹è¿›ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a>äº”.Java7åˆ°Java8åšäº†å“ªäº›æ”¹è¿›ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h2><h3 id="5-1-Java7ä¸­"><a href="#5-1-Java7ä¸­" class="headerlink" title="5.1 Java7ä¸­"></a>5.1 Java7ä¸­</h3><ul><li><p>éå¸¸å®¹æ˜“ç¢°åˆ°æ­»é”</p><p>é¦–å…ˆé€ æˆæ­»é”çš„åŸå› æ˜¯ç”¨æˆ·ä½¿ç”¨ä¸è§„èŒƒï¼Œå› ä¸ºhashMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¤šä¸ªçº¿ç¨‹è®¿é—®hashæ—¶å°±æœ‰å¯èƒ½æ­»é”ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9x955gk7yj312c0omgxb.jpg" alt="image-20191215113532801"></p><p>å½“ä»£ç æ­£å¥½è®¿é—®key:3æˆ–key:7æ—¶ï¼Œå°±ä¼šå‡ºç°æ­»å¾ªç¯ã€‚cpuä¼šçˆ†æ»¡ï¼Œé€ æˆæ­»æœºã€‚</p><p>æ­»é”çš„è¯¦ç»†åˆ†æï¼š<a href="https://coolshell.cn/articles/9606.html" target="_blank" rel="noopener">https://coolshell.cn/articles/9606.html</a></p></li><li><p>æœ‰æ½œåœ¨çš„å®‰å…¨é—®é¢˜</p><ul><li><p>CVE-2011-4858ï¼ŒTomcaté‚®ä»¶ç»„çš„è®¨è®º</p><p>é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„hashcodeç›¸åŒhttpè¯·æ±‚å‚æ•°ï¼Œä¼šæ”¾åˆ°åŒä¸€ä¸ªæ¡¶é‡Œé¢ï¼Œ ä¼šä½¿å…¶é€€åŒ–æˆé“¾è¡¨ï¼Œå®ƒçš„æŸ¥æ‰¾æ“ä½œå¤æ‚åº¦æ˜¯O(n),Nä¸ªå…ƒç´ çš„å¯èƒ½ä¸Šå‡åˆ°næ–¹ã€‚å¼•å‘DoS</p></li></ul></li></ul><h3 id="5-2-Java8ä¸­"><a href="#5-2-Java8ä¸­" class="headerlink" title="5.2 Java8ä¸­"></a>5.2 Java8ä¸­</h3><ul><li>ç”±<strong>æ•°ç»„+é“¾è¡¨</strong>çš„ç»“æ„æ”¹ä¸º<strong>æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</strong>ã€‚</li><li>ä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„hashç®—æ³•ï¼šh^(h&gt;&gt;&gt;16)</li><li>æ‰©å®¹åï¼Œå…ƒç´ è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ï¼Œä¸”é“¾è¡¨é¡ºåºä¸å˜ã€‚</li></ul><p>æœ€åä¸€æ¡æ˜¯é‡ç‚¹ï¼Œå› ä¸ºæœ€åä¸€æ¡çš„å˜åŠ¨ï¼Œhashmapåœ¨1.8ä¸­ï¼Œä¸ä¼šåœ¨å‡ºç°æ­»å¾ªç¯é—®é¢˜ã€‚</p><p><em>ä¸ºä»€ä¹ˆåœ¨è§£å†³hashå†²çªçš„æ—¶å€™ï¼Œä¸ç›´æ¥ç”¨çº¢é»‘æ ‘?è€Œé€‰æ‹©å…ˆç”¨é“¾è¡¨ï¼Œå†è½¬çº¢é»‘æ ‘?</em> </p><p>å› ä¸ºTreeNodeçš„å¤§å°çº¦ä¸ºå¸¸è§„èŠ‚ç‚¹çš„ä¸¤å€ï¼Œå› ä¸ºçº¢é»‘æ ‘éœ€è¦è¿›è¡Œå·¦æ—‹ï¼Œå³æ—‹ï¼Œå˜è‰²è¿™äº›æ“ä½œæ¥ä¿æŒå¹³è¡¡ï¼Œè€Œå•é“¾è¡¨ä¸éœ€è¦ã€‚ å½“å…ƒç´ å°äº8ä¸ªå½“æ—¶å€™ï¼Œæ­¤æ—¶åšæŸ¥è¯¢æ“ä½œï¼Œé“¾è¡¨ç»“æ„å·²ç»èƒ½ä¿è¯æŸ¥è¯¢æ€§èƒ½ã€‚å½“å…ƒç´ å¤§äº8ä¸ªçš„æ—¶å€™ï¼Œæ­¤æ—¶éœ€è¦çº¢é»‘æ ‘æ¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†æ˜¯æ–°å¢èŠ‚ç‚¹çš„æ•ˆç‡å˜æ…¢äº†ã€‚æ˜¯ä¸ç›´æ¥ç”¨çº¢é»‘æ ‘çš„åŸå› ã€‚</p><h4 id="5-2-1å½“hashæ¡¶é‡Œé¢æ˜¯é“¾è¡¨çš„æ—¶å€™ï¼Œç»“ç‚¹åœ¨æ¡¶é‡Œçš„æ•°é‡é¢„å€¼æ˜¯å¤šå°‘ï¼Œå®ƒä¼šå˜æˆçº¢é»‘æ ‘ï¼Ÿ"><a href="#5-2-1å½“hashæ¡¶é‡Œé¢æ˜¯é“¾è¡¨çš„æ—¶å€™ï¼Œç»“ç‚¹åœ¨æ¡¶é‡Œçš„æ•°é‡é¢„å€¼æ˜¯å¤šå°‘ï¼Œå®ƒä¼šå˜æˆçº¢é»‘æ ‘ï¼Ÿ" class="headerlink" title="5.2.1å½“hashæ¡¶é‡Œé¢æ˜¯é“¾è¡¨çš„æ—¶å€™ï¼Œç»“ç‚¹åœ¨æ¡¶é‡Œçš„æ•°é‡é¢„å€¼æ˜¯å¤šå°‘ï¼Œå®ƒä¼šå˜æˆçº¢é»‘æ ‘ï¼Ÿ"></a>5.2.1å½“hashæ¡¶é‡Œé¢æ˜¯é“¾è¡¨çš„æ—¶å€™ï¼Œç»“ç‚¹åœ¨æ¡¶é‡Œçš„æ•°é‡é¢„å€¼æ˜¯å¤šå°‘ï¼Œå®ƒä¼šå˜æˆçº¢é»‘æ ‘ï¼Ÿ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The bin count threshold for using a tree rather than list for a</span></span><br><span class="line"><span class="comment"> * bin.  Bins are converted to trees when adding an element to a</span></span><br><span class="line"><span class="comment"> * bin with at least this many nodes. The value must be greater</span></span><br><span class="line"><span class="comment"> * than 2 and should be at least 8 to mesh with assumptions in</span></span><br><span class="line"><span class="comment"> * tree removal about conversion back to plain bins upon</span></span><br><span class="line"><span class="comment"> * shrinkage.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TREEIFY_THRESHOLD = <span class="number">8</span>;</span><br></pre></td></tr></table></figure><p>ç­”æ¡ˆæ˜¯8</p><h4 id="5-2-2-ä¸ºä»€ä¹ˆé€‰æ‹©é˜€å€¼æ˜¯8ï¼Œæ‰è½¬çº¢é»‘æ ‘å‘¢ï¼Ÿ"><a href="#5-2-2-ä¸ºä»€ä¹ˆé€‰æ‹©é˜€å€¼æ˜¯8ï¼Œæ‰è½¬çº¢é»‘æ ‘å‘¢ï¼Ÿ" class="headerlink" title="5.2.2 ä¸ºä»€ä¹ˆé€‰æ‹©é˜€å€¼æ˜¯8ï¼Œæ‰è½¬çº¢é»‘æ ‘å‘¢ï¼Ÿ"></a>5.2.2 ä¸ºä»€ä¹ˆé€‰æ‹©é˜€å€¼æ˜¯8ï¼Œæ‰è½¬çº¢é»‘æ ‘å‘¢ï¼Ÿ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">     * Because TreeNodes are about twice the size of regular nodes, we</span><br><span class="line">     * use them only when bins contain enough nodes to warrant use</span><br><span class="line">     * (see TREEIFY_THRESHOLD). <span class="function">And when they become too <span class="title">small</span> <span class="params">(due to</span></span></span><br><span class="line"><span class="function"><span class="params">     * removal or resizing)</span> they are converted back to plain bins.  In</span></span><br><span class="line"><span class="function">     * usages with well-distributed user hashCodes, tree bins are</span></span><br><span class="line"><span class="function">     * rarely used.  Ideally, under random hashCodes, the frequency of</span></span><br><span class="line"><span class="function">     * nodes in bins follows a Poisson distribution</span></span><br><span class="line"><span class="function">     * <span class="params">(http://en.wikipedia.org/wiki/Poisson_distribution)</span> with a</span></span><br><span class="line"><span class="function">     * parameter of about 0.5 on average <span class="keyword">for</span> the <span class="keyword">default</span> resizing</span></span><br><span class="line"><span class="function">     * threshold of 0.75, although with a large variance because of</span></span><br><span class="line"><span class="function">     * resizing granularity. Ignoring variance, the expected</span></span><br><span class="line"><span class="function">     * occurrences of list size k <span class="title">are</span> <span class="params">(exp(<span class="number">-0.5</span>)</span> * <span class="title">pow</span><span class="params">(<span class="number">0.5</span>, k)</span> /</span></span><br><span class="line"><span class="function">     * <span class="title">factorial</span><span class="params">(k)</span>). The first values are:</span></span><br><span class="line"><span class="function">     *</span></span><br><span class="line"><span class="function">     * 0:    0.60653066</span></span><br><span class="line"><span class="function">     * 1:    0.30326533</span></span><br><span class="line"><span class="function">     * 2:    0.07581633</span></span><br><span class="line"><span class="function">     * 3:    0.01263606</span></span><br><span class="line"><span class="function">     * 4:    0.00157952</span></span><br><span class="line"><span class="function">     * 5:    0.00015795</span></span><br><span class="line"><span class="function">     * 6:    0.00001316</span></span><br><span class="line"><span class="function">     * 7:    0.00000094</span></span><br><span class="line"><span class="function">     * 8:    0.00000006</span></span><br><span class="line"><span class="function">     * more: less than 1 in ten million</span></span><br><span class="line"><span class="function">        </span></span><br><span class="line"><span class="function">å› ä¸ºTreeNodeçš„å¤§å°çº¦ä¸ºå¸¸è§„èŠ‚ç‚¹çš„ä¸¤å€ï¼Œæ‰€ä»¥æˆ‘ä»¬</span></span><br><span class="line"><span class="function">ä»…åœ¨åƒåœ¾ç®±åŒ…å«è¶³ä»¥ä¿è¯ä½¿ç”¨çš„èŠ‚ç‚¹æ—¶æ‰ä½¿ç”¨å®ƒä»¬</span></span><br><span class="line"><span class="function">ï¼ˆè¯·å‚é˜…TREEIFY_THRESHOLDï¼‰ã€‚ å½“å®ƒä»¬å˜å¾—å¤ªå°æ—¶ï¼ˆç”±äº</span></span><br><span class="line"><span class="function">ç§»é™¤æˆ–è°ƒæ•´å¤§å°ï¼‰ï¼Œå®ƒä»¬ä¼šè½¬æ¢å›æ™®é€šåƒåœ¾ç®±ã€‚ åœ¨</span></span><br><span class="line"><span class="function">åˆ†å¸ƒè‰¯å¥½çš„ç”¨æˆ·hashCodeçš„ç”¨æ³•</span></span><br><span class="line"><span class="function">å¾ˆå°‘ä½¿ç”¨ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œåœ¨éšæœºhashCodesä¸‹ï¼Œ</span></span><br><span class="line"><span class="function">ç®±ä¸­çš„èŠ‚ç‚¹éµå¾ªæ³Šæ¾åˆ†å¸ƒ</span></span><br><span class="line"><span class="function">ï¼ˆhttp:<span class="comment">//en.wikipedia.org/wiki/Poisson_distributionï¼‰ï¼Œ</span></span></span><br><span class="line"><span class="function">é»˜è®¤è°ƒæ•´å¤§å°çš„å¹³å‡å‚æ•°çº¦ä¸º0.5</span></span><br><span class="line"><span class="function">é˜ˆå€¼0.75ï¼Œå°½ç®¡ç”±äº</span></span><br><span class="line"><span class="function">è°ƒæ•´ç²’åº¦ã€‚ å¿½ç•¥å·®å¼‚ï¼Œé¢„æœŸ</span></span><br><span class="line"><span class="function">åˆ—è¡¨å¤§å°kçš„å‡ºç°æ˜¯ï¼ˆexpï¼ˆ-0.5ï¼‰* powï¼ˆ0.5ï¼Œkï¼‰/</span></span><br><span class="line"><span class="function">é˜¶ä¹˜ï¼ˆkï¼‰ï¼‰ã€‚ ç¬¬ä¸€ä¸ªå€¼æ˜¯ï¼š</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºï¼Œhashæ¡¶é‡Œé¢çš„èŠ‚ç‚¹ä¸ªæ•°æœä»æŸæ¾åˆ†å¸ƒï¼ˆå¹³å‡å‚æ•°<script type="math/tex">\lambda</script>çº¦ä¸º0.5ï¼‰,æ¡¶é‡Œæœ‰0ä¸ªçš„æ¦‚ç‡ä¸º0.60653066ï¼Œæœ‰1ä¸ªçš„æ¦‚ç‡ä¸º0.30326533ï¼Œæœ‰8ä¸ªå¤šæ¦‚ç‡ä¸º0.00000006ï¼Œå°äº10äº¿åˆ†å­1ï¼Œæ¦‚ç‡éå¸¸å°äº†ã€‚</p><h4 id="5-2-3-å½“é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘åï¼Œä»€ä¹ˆæ—¶å€™é€€åŒ–ä¸ºé“¾è¡¨"><a href="#5-2-3-å½“é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘åï¼Œä»€ä¹ˆæ—¶å€™é€€åŒ–ä¸ºé“¾è¡¨" class="headerlink" title="5.2.3 å½“é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘åï¼Œä»€ä¹ˆæ—¶å€™é€€åŒ–ä¸ºé“¾è¡¨?"></a>5.2.3 å½“é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘åï¼Œä»€ä¹ˆæ—¶å€™é€€åŒ–ä¸ºé“¾è¡¨?</h4><p>ä¸º6çš„æ—¶å€™é€€è½¬ä¸ºé“¾è¡¨ã€‚ä¸­é—´æœ‰ä¸ªå·®å€¼7å¯ä»¥é˜²æ­¢é“¾è¡¨å’Œæ ‘ä¹‹é—´é¢‘ç¹çš„è½¬æ¢ã€‚å‡è®¾ä¸€ä¸‹ï¼Œå¦‚æœè®¾è®¡æˆé“¾è¡¨ä¸ªæ•°è¶…è¿‡8åˆ™é“¾è¡¨è½¬æ¢æˆæ ‘ç»“æ„ï¼Œé“¾è¡¨ä¸ªæ•°å°äº8åˆ™æ ‘ç»“æ„è½¬æ¢æˆé“¾è¡¨ï¼Œå¦‚æœä¸€ä¸ªHashMapä¸åœçš„æ’å…¥ã€åˆ é™¤å…ƒç´ ï¼Œé“¾è¡¨ä¸ªæ•°åœ¨8å·¦å³å¾˜å¾Šï¼Œå°±ä¼šé¢‘ç¹çš„å‘ç”Ÿæ ‘è½¬é“¾è¡¨ã€é“¾è¡¨è½¬æ ‘ï¼Œæ•ˆç‡ä¼šå¾ˆä½ã€‚</p><h4 id="5-2-4-ä¸ºä»€ä¹ˆä¸ºä»€ä¹ˆè¦å…ˆé«˜16ä½å¼‚æˆ–ä½16ä½å†å–æ¨¡è¿ç®—"><a href="#5-2-4-ä¸ºä»€ä¹ˆä¸ºä»€ä¹ˆè¦å…ˆé«˜16ä½å¼‚æˆ–ä½16ä½å†å–æ¨¡è¿ç®—" class="headerlink" title="5.2.4 ä¸ºä»€ä¹ˆä¸ºä»€ä¹ˆè¦å…ˆé«˜16ä½å¼‚æˆ–ä½16ä½å†å–æ¨¡è¿ç®—?"></a>5.2.4 <em>ä¸ºä»€ä¹ˆä¸ºä»€ä¹ˆè¦å…ˆé«˜16ä½å¼‚æˆ–ä½16ä½å†å–æ¨¡è¿ç®—?</em></h4><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9xafc0hrqj30u00x47vv.jpg" alt="image-20191215121954442"></p><h2 id="å…­-hashmapçš„get-putçš„è¿‡ç¨‹"><a href="#å…­-hashmapçš„get-putçš„è¿‡ç¨‹" class="headerlink" title="å…­.hashmapçš„get/putçš„è¿‡ç¨‹?"></a>å…­.hashmapçš„get/putçš„è¿‡ç¨‹?</h2><h3 id="6-1-çŸ¥é“hashmapä¸­putå…ƒç´ çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·ä¹ˆ"><a href="#6-1-çŸ¥é“hashmapä¸­putå…ƒç´ çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·ä¹ˆ" class="headerlink" title="6.1 çŸ¥é“hashmapä¸­putå…ƒç´ çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·ä¹ˆ?"></a>6.1 çŸ¥é“hashmapä¸­putå…ƒç´ çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·ä¹ˆ?</h3><p>å¯¹keyçš„hashCode()åšhashè¿ç®—ï¼Œè®¡ç®—index; å¦‚æœæ²¡ç¢°æ’ç›´æ¥æ”¾åˆ°bucketé‡Œï¼› å¦‚æœç¢°æ’äº†ï¼Œä»¥é“¾è¡¨çš„å½¢å¼å­˜åœ¨bucketsåï¼› å¦‚æœç¢°æ’å¯¼è‡´é“¾è¡¨è¿‡é•¿(å¤§äºç­‰äºTREEIFY_THRESHOLD)ï¼Œå°±æŠŠé“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘(JDK1.8ä¸­çš„æ”¹åŠ¨)ï¼› å¦‚æœèŠ‚ç‚¹å·²ç»å­˜åœ¨å°±æ›¿æ¢old value(ä¿è¯keyçš„å”¯ä¸€æ€§) å¦‚æœbucketæ»¡äº†(è¶…è¿‡load factor*current capacity)ï¼Œå°±è¦resizeã€‚</p><h3 id="6-2-çŸ¥é“hashmapä¸­getå…ƒç´ çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·ä¹ˆï¼Ÿ"><a href="#6-2-çŸ¥é“hashmapä¸­getå…ƒç´ çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·ä¹ˆï¼Ÿ" class="headerlink" title="6.2 çŸ¥é“hashmapä¸­getå…ƒç´ çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·ä¹ˆï¼Ÿ"></a>6.2 çŸ¥é“hashmapä¸­getå…ƒç´ çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·ä¹ˆï¼Ÿ</h3><p>å¯¹keyçš„hashCode()åšhashè¿ç®—ï¼Œè®¡ç®—index; å¦‚æœåœ¨bucketé‡Œçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹é‡Œç›´æ¥å‘½ä¸­ï¼Œåˆ™ç›´æ¥è¿”å›ï¼› å¦‚æœæœ‰å†²çªï¼Œåˆ™é€šè¿‡key.equals(k)å»æŸ¥æ‰¾å¯¹åº”çš„Entry; </p><ul><li>è‹¥ä¸ºæ ‘ï¼Œåˆ™åœ¨æ ‘ä¸­é€šè¿‡key.equals(k)æŸ¥æ‰¾ï¼ŒO(logn)ï¼› </li><li>è‹¥ä¸ºé“¾è¡¨ï¼Œåˆ™åœ¨é“¾è¡¨ä¸­é€šè¿‡key.equals(k)æŸ¥æ‰¾ï¼ŒO(n)ã€‚</li></ul><h3 id="6-3-ä½ è¿˜çŸ¥é“å“ªäº›hashç®—æ³•ï¼Ÿ"><a href="#6-3-ä½ è¿˜çŸ¥é“å“ªäº›hashç®—æ³•ï¼Ÿ" class="headerlink" title="6.3 ä½ è¿˜çŸ¥é“å“ªäº›hashç®—æ³•ï¼Ÿ"></a>6.3 ä½ è¿˜çŸ¥é“å“ªäº›hashç®—æ³•ï¼Ÿ</h3><p>å…ˆè¯´ä¸€ä¸‹hashç®—æ³•å¹²å˜›çš„ï¼ŒHashå‡½æ•°æ˜¯æŒ‡æŠŠä¸€ä¸ªå¤§èŒƒå›´æ˜ å°„åˆ°ä¸€ä¸ªå°èŒƒå›´ã€‚æŠŠå¤§èŒƒå›´æ˜ å°„åˆ°ä¸€ä¸ªå°èŒƒå›´çš„ç›®çš„å¾€å¾€æ˜¯ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œä½¿å¾—æ•°æ®å®¹æ˜“ä¿å­˜ã€‚ æ¯”è¾ƒå‡ºåçš„æœ‰MurmurHashã€MD4ã€MD5ç­‰ç­‰</p><p><em>è¯´è¯´Stringä¸­hashcodeçš„å®ç°?(æ­¤é¢˜é¢‘ç‡å¾ˆé«˜)</em></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h = hash;</span><br><span class="line">    <span class="keyword">if</span> (h == <span class="number">0</span> &amp;&amp; value.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">char</span> val[] = value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; value.length; i++) &#123;</span><br><span class="line">            h = <span class="number">31</span> * h + val[i];</span><br><span class="line">        &#125;</span><br><span class="line">        hash = h;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Stringç±»ä¸­çš„hashCodeè®¡ç®—æ–¹æ³•è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå°±æ˜¯ä»¥31ä¸ºæƒï¼Œæ¯ä¸€ä½ä¸ºå­—ç¬¦çš„ASCIIå€¼è¿›è¡Œè¿ç®—ï¼Œç”¨è‡ªç„¶æº¢å‡ºæ¥ç­‰æ•ˆå–æ¨¡ã€‚</p><p>å“ˆå¸Œè®¡ç®—å…¬å¼å¯ä»¥è®¡ä¸º<code>s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]</code></p><p>é‚£ä¸ºä»€ä¹ˆä»¥31ä¸ºè´¨æ•°å‘¢?</p><p>ä¸»è¦æ˜¯å› ä¸º31æ˜¯ä¸€ä¸ªå¥‡è´¨æ•°ï¼Œæ‰€ä»¥<code>31*i=32*i-i=(i&lt;&lt;5)-i</code>ï¼Œè¿™ç§ä½ç§»ä¸å‡æ³•ç»“åˆçš„è®¡ç®—ç›¸æ¯”ä¸€èˆ¬çš„è¿ç®—å¿«å¾ˆå¤šã€‚</p><h3 id="6-4-è¯´è¯´Stringä¸­hashcodeçš„å®ç°-æ­¤é¢˜é¢‘ç‡å¾ˆé«˜"><a href="#6-4-è¯´è¯´Stringä¸­hashcodeçš„å®ç°-æ­¤é¢˜é¢‘ç‡å¾ˆé«˜" class="headerlink" title="6.4 è¯´è¯´Stringä¸­hashcodeçš„å®ç°?(æ­¤é¢˜é¢‘ç‡å¾ˆé«˜)"></a>6.4 è¯´è¯´Stringä¸­hashcodeçš„å®ç°?<em>(æ­¤é¢˜é¢‘ç‡å¾ˆé«˜)</em></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h = hash;</span><br><span class="line">    <span class="keyword">if</span> (h == <span class="number">0</span> &amp;&amp; value.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">char</span> val[] = value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; value.length; i++) &#123;</span><br><span class="line">            h = <span class="number">31</span> * h + val[i];</span><br><span class="line">        &#125;</span><br><span class="line">        hash = h;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸ƒ-ä½ ä¸€èˆ¬ç”¨ä»€ä¹ˆä½œä¸ºHashMapçš„key"><a href="#ä¸ƒ-ä½ ä¸€èˆ¬ç”¨ä»€ä¹ˆä½œä¸ºHashMapçš„key" class="headerlink" title="ä¸ƒ. ä½ ä¸€èˆ¬ç”¨ä»€ä¹ˆä½œä¸ºHashMapçš„key?"></a>ä¸ƒ. ä½ ä¸€èˆ¬ç”¨ä»€ä¹ˆä½œä¸ºHashMapçš„key?</h2><h3 id="7-1å¥å¯ä»¥ä¸ºNullå€¼ä¹ˆ"><a href="#7-1å¥å¯ä»¥ä¸ºNullå€¼ä¹ˆ" class="headerlink" title="7.1å¥å¯ä»¥ä¸ºNullå€¼ä¹ˆ?"></a>7.1<em>å¥å¯ä»¥ä¸ºNullå€¼ä¹ˆ?</em></h3><p>å¿…é¡»å¯ä»¥ï¼Œkeyä¸ºnullçš„æ—¶å€™ï¼Œhashç®—æ³•æœ€åçš„å€¼ä»¥0æ¥è®¡ç®—ï¼Œä¹Ÿå°±æ˜¯æ”¾åœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-2ä½ ä¸€èˆ¬ç”¨ä»€ä¹ˆä½œä¸ºHashMapçš„key"><a href="#7-2ä½ ä¸€èˆ¬ç”¨ä»€ä¹ˆä½œä¸ºHashMapçš„key" class="headerlink" title="7.2ä½ ä¸€èˆ¬ç”¨ä»€ä¹ˆä½œä¸ºHashMapçš„key?"></a>7.2<em>ä½ ä¸€èˆ¬ç”¨ä»€ä¹ˆä½œä¸ºHashMapçš„key?</em></h3><p>ä¸€èˆ¬ç”¨Integerã€Stringè¿™ç§ä¸å¯å˜ç±»å½“HashMapå½“keyï¼Œè€Œä¸”Stringæœ€ä¸ºå¸¸ç”¨ã€‚  </p><ul><li>(1)å› ä¸ºå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥åœ¨å®ƒåˆ›å»ºçš„æ—¶å€™hashcodeå°±è¢«ç¼“å­˜äº†ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®—ã€‚è¿™å°±ä½¿å¾—å­—ç¬¦ä¸²å¾ˆé€‚åˆä½œä¸ºMapä¸­çš„é”®ï¼Œå­—ç¬¦ä¸²çš„å¤„ç†é€Ÿåº¦è¦å¿«è¿‡å…¶å®ƒçš„é”®å¯¹è±¡ã€‚è¿™å°±æ˜¯HashMapä¸­çš„é”®å¾€å¾€éƒ½ä½¿ç”¨å­—ç¬¦ä¸²ã€‚ </li><li>(2)å› ä¸ºè·å–å¯¹è±¡çš„æ—¶å€™è¦ç”¨åˆ°equals()å’ŒhashCode()æ–¹æ³•ï¼Œé‚£ä¹ˆé”®å¯¹è±¡æ­£ç¡®çš„é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯éå¸¸é‡è¦çš„,è¿™äº›ç±»å·²ç»å¾ˆè§„èŒƒçš„è¦†å†™äº†hashCode()ä»¥åŠequals()æ–¹æ³•ã€‚</li></ul><h3 id="7-3-æˆ‘ç”¨å¯å˜ç±»å½“HashMapçš„keyæœ‰ä»€ä¹ˆé—®é¢˜"><a href="#7-3-æˆ‘ç”¨å¯å˜ç±»å½“HashMapçš„keyæœ‰ä»€ä¹ˆé—®é¢˜" class="headerlink" title="7.3 æˆ‘ç”¨å¯å˜ç±»å½“HashMapçš„keyæœ‰ä»€ä¹ˆé—®é¢˜?"></a>7.3 <em>æˆ‘ç”¨å¯å˜ç±»å½“HashMapçš„keyæœ‰ä»€ä¹ˆé—®é¢˜?</em></h3><p>hashcodeå¯èƒ½å‘ç”Ÿæ”¹å˜ï¼Œå¯¼è‡´putè¿›å»çš„å€¼ï¼Œæ— æ³•getå‡ºï¼Œå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HashMap&lt;List&lt;String&gt;, Object&gt; changeMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">list.add(<span class="string">"hello"</span>);</span><br><span class="line">Object objectValue = <span class="keyword">new</span> Object();</span><br><span class="line">changeMap.put(list, objectValue);</span><br><span class="line">System.out.println(changeMap.get(list));</span><br><span class="line">list.add(<span class="string">"hello world"</span>);<span class="comment">//hashcodeå‘ç”Ÿäº†æ”¹å˜</span></span><br><span class="line">System.out.println(changeMap.get(list));</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå€¼å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java.lang.Object@<span class="number">74</span>a14482</span><br><span class="line"><span class="keyword">null</span></span><br></pre></td></tr></table></figure><p>7.4 <em>å¦‚æœè®©ä½ å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„classä½œä¸ºHashMapçš„keyè¯¥å¦‚ä½•å®ç°ï¼Ÿ</em></p><p>æ­¤é¢˜è€ƒå¯Ÿä¸¤ä¸ªçŸ¥è¯†ç‚¹ </p><ul><li>é‡å†™hashcodeå’Œequalsæ–¹æ³•æ³¨æ„ä»€ä¹ˆ? </li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªä¸å˜ç±»</li></ul><p><strong>é’ˆå¯¹é—®é¢˜ä¸€ï¼Œè®°ä½ä¸‹é¢å››ä¸ªåŸåˆ™å³å¯</strong> </p><p>(1)ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œhashcodeä¸€å®šç›¸ç­‰ (2)ä¸¤ä¸ªå¯¹è±¡ä¸ç­‰ï¼Œhashcodeä¸ä¸€å®šä¸ç­‰ (3)hashcodeç›¸ç­‰ï¼Œä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šç›¸ç­‰ (4)hashcodeä¸ç­‰ï¼Œä¸¤ä¸ªå¯¹è±¡ä¸€å®šä¸ç­‰ </p><p><strong>é’ˆå¯¹é—®é¢˜äºŒï¼Œè®°ä½å¦‚ä½•å†™ä¸€ä¸ªä¸å¯å˜ç±»</strong> </p><p>(1)ç±»æ·»åŠ finalä¿®é¥°ç¬¦ï¼Œä¿è¯ç±»ä¸è¢«ç»§æ‰¿ã€‚ å¦‚æœç±»å¯ä»¥è¢«ç»§æ‰¿ä¼šç ´åç±»çš„ä¸å¯å˜æ€§æœºåˆ¶ï¼Œåªè¦ç»§æ‰¿ç±»è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•å¹¶ä¸”ç»§æ‰¿ç±»å¯ä»¥æ”¹å˜æˆå‘˜å˜é‡å€¼ï¼Œé‚£ä¹ˆä¸€æ—¦å­ç±»ä»¥çˆ¶ç±»çš„å½¢å¼å‡ºç°æ—¶ï¼Œä¸èƒ½ä¿è¯å½“å‰ç±»æ˜¯å¦å¯å˜ã€‚</p><p>(2)ä¿è¯æ‰€æœ‰æˆå‘˜å˜é‡å¿…é¡»ç§æœ‰ï¼Œå¹¶ä¸”åŠ ä¸Šfinalä¿®é¥° é€šè¿‡è¿™ç§æ–¹å¼ä¿è¯æˆå‘˜å˜é‡ä¸å¯æ”¹å˜ã€‚ä½†åªåšåˆ°è¿™ä¸€æ­¥è¿˜ä¸å¤Ÿï¼Œå› ä¸ºå¦‚æœæ˜¯å¯¹è±¡æˆå‘˜å˜é‡æœ‰å¯èƒ½å†å¤–éƒ¨æ”¹å˜å…¶å€¼ã€‚æ‰€ä»¥ç¬¬4ç‚¹å¼¥è¡¥è¿™ä¸ªä¸è¶³ã€‚</p><p>(3)ä¸æä¾›æ”¹å˜æˆå‘˜å˜é‡çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬setter é¿å…é€šè¿‡å…¶ä»–æ¥å£æ”¹å˜æˆå‘˜å˜é‡çš„å€¼ï¼Œç ´åä¸å¯å˜ç‰¹æ€§ã€‚</p><p>(4)é€šè¿‡æ„é€ å™¨åˆå§‹åŒ–æ‰€æœ‰æˆå‘˜ï¼Œè¿›è¡Œæ·±æ‹·è´(deep copy) å¦‚æœæ„é€ å™¨ä¼ å…¥çš„å¯¹è±¡ç›´æ¥èµ‹å€¼ç»™æˆå‘˜å˜é‡ï¼Œè¿˜æ˜¯å¯ä»¥é€šè¿‡å¯¹ä¼ å…¥å¯¹è±¡çš„ä¿®æ”¹è¿›è€Œå¯¼è‡´æ”¹å˜å†…éƒ¨å˜é‡çš„å€¼ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ImmutableDemo</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span>[] myArray;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImmutableDemo</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">this</span>.myArray = array; <span class="comment">// wrong  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ä¸èƒ½ä¿è¯ä¸å¯å˜æ€§ï¼ŒmyArrayå’ŒarrayæŒ‡å‘åŒä¸€å—å†…å­˜åœ°å€ï¼Œç”¨æˆ·å¯ä»¥åœ¨ImmutableDemoä¹‹å¤–é€šè¿‡ä¿®æ”¹arrayå¯¹è±¡çš„å€¼æ¥æ”¹å˜myArrayå†…éƒ¨çš„å€¼ã€‚ ä¸ºäº†ä¿è¯å†…éƒ¨çš„å€¼ä¸è¢«ä¿®æ”¹ï¼Œå¯ä»¥é‡‡ç”¨æ·±åº¦copyæ¥åˆ›å»ºä¸€ä¸ªæ–°å†…å­˜ä¿å­˜ä¼ å…¥çš„å€¼ã€‚æ­£ç¡®åšæ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MyImmutableDemo</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span>[] myArray;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyImmutableDemo</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">this</span>.myArray = array.clone();   </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(5)åœ¨getteræ–¹æ³•ä¸­ï¼Œä¸è¦ç›´æ¥è¿”å›å¯¹è±¡æœ¬èº«ï¼Œè€Œæ˜¯å…‹éš†å¯¹è±¡ï¼Œå¹¶è¿”å›å¯¹è±¡çš„æ‹·è´ è¿™ç§åšæ³•ä¹Ÿæ˜¯é˜²æ­¢å¯¹è±¡å¤–æ³„ï¼Œé˜²æ­¢é€šè¿‡getterè·å¾—å†…éƒ¨å¯å˜æˆå‘˜å¯¹è±¡åå¯¹æˆå‘˜å˜é‡ç›´æ¥æ“ä½œï¼Œå¯¼è‡´æˆå‘˜å˜é‡å‘ç”Ÿæ”¹å˜ã€‚</p><p>6.Resizeæ•ˆç‡å¾ˆä½ã€‚</p><hr><p>å‚è€ƒèµ„æ–™ï¼š</p><p><a href="https://zhuanlan.zhihu.com/p/76735726" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/76735726</a></p><p><a href="https://www.bilibili.com/video/av71408100?from=search&amp;seid=15190327219708388729" target="_blank" rel="noopener">https://www.bilibili.com/video/av71408100?from=search&amp;seid=15190327219708388729</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> åŸºç¡€ç†è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> åŸºç¡€ç†è§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot-è‡ªå®šä¹‰starter </title>
      <link href="/2019/12/11/SpringBoot-%E8%87%AA%E5%AE%9A%E4%B9%89starter/"/>
      <url>/2019/12/11/SpringBoot-%E8%87%AA%E5%AE%9A%E4%B9%89starter/</url>
      
        <content type="html"><![CDATA[<h1 id="è‡ªå®šä¹‰starter"><a href="#è‡ªå®šä¹‰starter" class="headerlink" title="è‡ªå®šä¹‰starter"></a>è‡ªå®šä¹‰starter</h1><p>starterï¼š</p><p>â€‹    1ã€è¿™ä¸ªåœºæ™¯éœ€è¦ä½¿ç”¨åˆ°çš„ä¾èµ–æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>â€‹    2ã€å¦‚ä½•ç¼–å†™è‡ªåŠ¨é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//æŒ‡å®šè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»</span></span><br><span class="line"><span class="meta">@ConditionalOnXXX</span>  <span class="comment">//åœ¨æŒ‡å®šæ¡ä»¶æˆç«‹çš„æƒ…å†µä¸‹è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter</span>  <span class="comment">//æŒ‡å®šè‡ªåŠ¨é…ç½®ç±»çš„é¡ºåº</span></span><br><span class="line"><span class="meta">@Bean</span>  <span class="comment">//ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationPropertie</span>ç»“åˆç›¸å…³xxxPropertiesç±»æ¥ç»‘å®šç›¸å…³çš„é…ç½®</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span> <span class="comment">//è®©xxxPropertiesç”Ÿæ•ˆåŠ å…¥åˆ°å®¹å™¨ä¸­</span></span><br><span class="line"></span><br><span class="line">è‡ªåŠ¨é…ç½®ç±»è¦èƒ½åŠ è½½</span><br><span class="line">å°†éœ€è¦å¯åŠ¨å°±åŠ è½½çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œé…ç½®åœ¨META-INF/spring.factories</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br></pre></td></tr></table></figure><p>â€‹    3ã€æ¨¡å¼ï¼š</p><p>å¯åŠ¨å™¨åªç”¨æ¥åšä¾èµ–å¯¼å…¥ï¼›</p><p>ä¸“é—¨æ¥å†™ä¸€ä¸ªè‡ªåŠ¨é…ç½®æ¨¡å—ï¼›</p><p>å¯åŠ¨å™¨ä¾èµ–è‡ªåŠ¨é…ç½®ï¼›åˆ«äººåªéœ€è¦å¼•å…¥å¯åŠ¨å™¨ï¼ˆstarterï¼‰</p><p>mybatis-spring-boot-starterï¼›è‡ªå®šä¹‰å¯åŠ¨å™¨å-spring-boot-starter</p><p>æ­¥éª¤ï¼š</p><p>1ï¼‰ã€å¯åŠ¨å™¨æ¨¡å—</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å¯åŠ¨å™¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--å¼•å…¥è‡ªåŠ¨é…ç½®æ¨¡å—--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2ï¼‰ã€è‡ªåŠ¨é…ç½®æ¨¡å—</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!--å¼•å…¥spring-boot-starterï¼›æ‰€æœ‰starterçš„åŸºæœ¬é…ç½®--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"atguigu.hello"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line">    <span class="keyword">private</span> String suffix;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPrefix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrefix</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.prefix = prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSuffix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSuffix</span><span class="params">(String suffix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.suffix = suffix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloProperties <span class="title">getHelloProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHelloProperties</span><span class="params">(HelloProperties helloProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.helloProperties = helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHellAtguigu</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties.getPrefix()+<span class="string">"-"</span> +name + helloProperties.getSuffix();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span> <span class="comment">//webåº”ç”¨æ‰ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(HelloProperties<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">HelloServiceAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloService <span class="title">helloService</span><span class="params">()</span></span>&#123;</span><br><span class="line">        HelloService service = <span class="keyword">new</span> HelloService();</span><br><span class="line">        service.setHelloProperties(helloProperties);</span><br><span class="line">        <span class="keyword">return</span> service;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ›´å¤šSpringBootæ•´åˆç¤ºä¾‹"><a href="#æ›´å¤šSpringBootæ•´åˆç¤ºä¾‹" class="headerlink" title="æ›´å¤šSpringBootæ•´åˆç¤ºä¾‹"></a>æ›´å¤šSpringBootæ•´åˆç¤ºä¾‹</h1><p><a href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples" target="_blank" rel="noopener">https://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples</a></p>]]></content>
      
      
      <categories>
          
          <category> SrpingBoot </category>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> SrpingBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot-æ•°æ®è®¿é—®</title>
      <link href="/2019/12/11/SpringBoot-%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/"/>
      <url>/2019/12/11/SpringBoot-%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBootä¸æ•°æ®è®¿é—®"><a href="#SpringBootä¸æ•°æ®è®¿é—®" class="headerlink" title="SpringBootä¸æ•°æ®è®¿é—®"></a>SpringBootä¸æ•°æ®è®¿é—®</h1><h2 id="1ã€JDBC"><a href="#1ã€JDBC" class="headerlink" title="1ã€JDBC"></a>1ã€JDBC</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.15.22:3306/jdbc</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><p>â€‹    é»˜è®¤æ˜¯ç”¨org.apache.tomcat.jdbc.pool.DataSourceä½œä¸ºæ•°æ®æºï¼›</p><p>â€‹    æ•°æ®æºçš„ç›¸å…³é…ç½®éƒ½åœ¨DataSourcePropertiesé‡Œé¢ï¼›</p><p>è‡ªåŠ¨é…ç½®åŸç†ï¼š</p><p>org.springframework.boot.autoconfigure.jdbcï¼š</p><p>1ã€å‚è€ƒDataSourceConfigurationï¼Œæ ¹æ®é…ç½®åˆ›å»ºæ•°æ®æºï¼Œé»˜è®¤ä½¿ç”¨Tomcatè¿æ¥æ± ï¼›å¯ä»¥ä½¿ç”¨spring.datasource.typeæŒ‡å®šè‡ªå®šä¹‰çš„æ•°æ®æºç±»å‹ï¼›</p><p>2ã€SpringBooté»˜è®¤å¯ä»¥æ”¯æŒï¼›</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.tomcat.jdbc.pool.DataSourceã€HikariDataSourceã€BasicDataSourceã€</span><br></pre></td></tr></table></figure><p>3ã€è‡ªå®šä¹‰æ•°æ®æºç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Generic DataSource configuration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(DataSource<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnProperty</span>(<span class="title">name</span> </span>= <span class="string">"spring.datasource.type"</span>)</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Generic</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">(DataSourceProperties properties)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//ä½¿ç”¨DataSourceBuilderåˆ›å»ºæ•°æ®æºï¼Œåˆ©ç”¨åå°„åˆ›å»ºå“åº”typeçš„æ•°æ®æºï¼Œå¹¶ä¸”ç»‘å®šç›¸å…³å±æ€§</span></span><br><span class="line">      <span class="keyword">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€<strong>DataSourceInitializerï¼šApplicationListener</strong>ï¼›</p><p>â€‹    ä½œç”¨ï¼š</p><p>â€‹        1ï¼‰ã€runSchemaScripts();è¿è¡Œå»ºè¡¨è¯­å¥ï¼›</p><p>â€‹        2ï¼‰ã€runDataScripts();è¿è¡Œæ’å…¥æ•°æ®çš„sqlè¯­å¥ï¼›</p><p>é»˜è®¤åªéœ€è¦å°†æ–‡ä»¶å‘½åä¸ºï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">schema-*.sqlã€data-*.sql</span></span><br><span class="line"><span class="attr">é»˜è®¤è§„åˆ™ï¼šschema.sqlï¼Œschema-all.sqlï¼›</span></span><br><span class="line"><span class="meta">å¯ä»¥ä½¿ç”¨</span>   <span class="string"></span></span><br><span class="line"><span class="attr">schema</span>:<span class="string"></span></span><br><span class="line">      <span class="meta">-</span> <span class="string">classpath:department.sql</span></span><br><span class="line">      <span class="attr">æŒ‡å®šä½ç½®</span></span><br></pre></td></tr></table></figure><p>5ã€æ“ä½œæ•°æ®åº“ï¼šè‡ªåŠ¨é…ç½®äº†JdbcTemplateæ“ä½œæ•°æ®åº“</p><h2 id="2ã€æ•´åˆDruidæ•°æ®æº"><a href="#2ã€æ•´åˆDruidæ•°æ®æº" class="headerlink" title="2ã€æ•´åˆDruidæ•°æ®æº"></a>2ã€æ•´åˆDruidæ•°æ®æº</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">å¯¼å…¥druidæ•°æ®æº</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druid</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span>  <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é…ç½®Druidçš„ç›‘æ§</span></span><br><span class="line">    <span class="comment">//1ã€é…ç½®ä¸€ä¸ªç®¡ç†åå°çš„Servlet</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">statViewServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ServletRegistrationBean bean = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> StatViewServlet(), <span class="string">"/druid/*"</span>);</span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        initParams.put(<span class="string">"loginUsername"</span>,<span class="string">"admin"</span>);</span><br><span class="line">        initParams.put(<span class="string">"loginPassword"</span>,<span class="string">"123456"</span>);</span><br><span class="line">        initParams.put(<span class="string">"allow"</span>,<span class="string">""</span>);<span class="comment">//é»˜è®¤å°±æ˜¯å…è®¸æ‰€æœ‰è®¿é—®</span></span><br><span class="line">        initParams.put(<span class="string">"deny"</span>,<span class="string">"192.168.15.21"</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2ã€é…ç½®ä¸€ä¸ªwebç›‘æ§çš„filter</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">webStatFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        FilterRegistrationBean bean = <span class="keyword">new</span> FilterRegistrationBean();</span><br><span class="line">        bean.setFilter(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line"></span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        initParams.put(<span class="string">"exclusions"</span>,<span class="string">"*.js,*.css,/druid/*"</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line"></span><br><span class="line">        bean.setUrlPatterns(Arrays.asList(<span class="string">"/*"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3ã€æ•´åˆMyBatis"><a href="#3ã€æ•´åˆMyBatis" class="headerlink" title="3ã€æ•´åˆMyBatis"></a>3ã€æ•´åˆMyBatis</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9soh7jj6ij30qd070weu.jpg" alt=""></p><p>æ­¥éª¤ï¼š</p><p>â€‹    1ï¼‰ã€é…ç½®æ•°æ®æºç›¸å…³å±æ€§ï¼ˆè§ä¸Šä¸€èŠ‚Druidï¼‰</p><p>â€‹    2ï¼‰ã€ç»™æ•°æ®åº“å»ºè¡¨</p><p>â€‹    3ï¼‰ã€åˆ›å»ºJavaBean</p><h3 id="4ï¼‰ã€æ³¨è§£ç‰ˆ"><a href="#4ï¼‰ã€æ³¨è§£ç‰ˆ" class="headerlink" title="4ï¼‰ã€æ³¨è§£ç‰ˆ"></a>4ï¼‰ã€æ³¨è§£ç‰ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŒ‡å®šè¿™æ˜¯ä¸€ä¸ªæ“ä½œæ•°æ®åº“çš„mapper</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DepartmentMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from department where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Department <span class="title">getDeptById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete</span>(<span class="string">"delete from department where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteDeptById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Options</span>(useGeneratedKeys = <span class="keyword">true</span>,keyProperty = <span class="string">"id"</span>)</span><br><span class="line">    <span class="meta">@Insert</span>(<span class="string">"insert into department(departmentName) values(#&#123;departmentName&#125;)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertDept</span><span class="params">(Department department)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update</span>(<span class="string">"update department set departmentName=#&#123;departmentName&#125; where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateDept</span><span class="params">(Department department)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜ï¼š</p><p>è‡ªå®šä¹‰MyBatisçš„é…ç½®è§„åˆ™ï¼›ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªConfigurationCustomizerï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.context.annotation.Configuration</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConfigurationCustomizer <span class="title">configurationCustomizer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConfigurationCustomizer()&#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(Configuration configuration)</span> </span>&#123;</span><br><span class="line">                configuration.setMapUnderscoreToCamelCase(<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨MapperScanæ‰¹é‡æ‰«ææ‰€æœ‰çš„Mapperæ¥å£ï¼›</span><br><span class="line"><span class="meta">@MapperScan</span>(value = <span class="string">"com.atguigu.springboot.mapper"</span>)</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBoot06DataMybatisApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">SpringApplication.run(SpringBoot06DataMybatisApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ï¼‰ã€é…ç½®æ–‡ä»¶ç‰ˆ"><a href="#5ï¼‰ã€é…ç½®æ–‡ä»¶ç‰ˆ" class="headerlink" title="5ï¼‰ã€é…ç½®æ–‡ä»¶ç‰ˆ"></a>5ï¼‰ã€é…ç½®æ–‡ä»¶ç‰ˆ</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span> <span class="string">æŒ‡å®šå…¨å±€é…ç½®æ–‡ä»¶çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span>  <span class="string">æŒ‡å®šsqlæ˜ å°„æ–‡ä»¶çš„ä½ç½®</span></span><br></pre></td></tr></table></figure><p>æ›´å¤šä½¿ç”¨å‚ç…§</p><p><a href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/" target="_blank" rel="noopener">http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/</a></p><h2 id="4ã€æ•´åˆSpringData-JPA"><a href="#4ã€æ•´åˆSpringData-JPA" class="headerlink" title="4ã€æ•´åˆSpringData JPA"></a>4ã€æ•´åˆSpringData JPA</h2><h3 id="1ï¼‰ã€SpringDataç®€ä»‹"><a href="#1ï¼‰ã€SpringDataç®€ä»‹" class="headerlink" title="1ï¼‰ã€SpringDataç®€ä»‹"></a>1ï¼‰ã€SpringDataç®€ä»‹</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9sohg6ijuj30rz0f6gmy.jpg" alt=""></p><h3 id="2ï¼‰ã€æ•´åˆSpringData-JPA"><a href="#2ï¼‰ã€æ•´åˆSpringData-JPA" class="headerlink" title="2ï¼‰ã€æ•´åˆSpringData JPA"></a>2ï¼‰ã€æ•´åˆSpringData JPA</h3><p>JPA:ORMï¼ˆObject Relational Mappingï¼‰ï¼›</p><p>1ï¼‰ã€ç¼–å†™ä¸€ä¸ªå®ä½“ç±»ï¼ˆbeanï¼‰å’Œæ•°æ®è¡¨è¿›è¡Œæ˜ å°„ï¼Œå¹¶ä¸”é…ç½®å¥½æ˜ å°„å…³ç³»ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨JPAæ³¨è§£é…ç½®æ˜ å°„å…³ç³»</span></span><br><span class="line"><span class="meta">@Entity</span> <span class="comment">//å‘Šè¯‰JPAè¿™æ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼ˆå’Œæ•°æ®è¡¨æ˜ å°„çš„ç±»ï¼‰</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tbl_user"</span>) <span class="comment">//@Tableæ¥æŒ‡å®šå’Œå“ªä¸ªæ•°æ®è¡¨å¯¹åº”;å¦‚æœçœç•¥é»˜è®¤è¡¨åå°±æ˜¯userï¼›</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span> <span class="comment">//è¿™æ˜¯ä¸€ä¸ªä¸»é”®</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)<span class="comment">//è‡ªå¢ä¸»é”®</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"last_name"</span>,length = <span class="number">50</span>) <span class="comment">//è¿™æ˜¯å’Œæ•°æ®è¡¨å¯¹åº”çš„ä¸€ä¸ªåˆ—</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="meta">@Column</span> <span class="comment">//çœç•¥é»˜è®¤åˆ—åå°±æ˜¯å±æ€§å</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br></pre></td></tr></table></figure><p>2ï¼‰ã€ç¼–å†™ä¸€ä¸ªDaoæ¥å£æ¥æ“ä½œå®ä½“ç±»å¯¹åº”çš„æ•°æ®è¡¨ï¼ˆRepositoryï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»§æ‰¿JpaRepositoryæ¥å®Œæˆå¯¹æ•°æ®åº“çš„æ“ä½œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰ã€åŸºæœ¬çš„é…ç½®JpaProperties</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line"> <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line"><span class="comment">#     æ›´æ–°æˆ–è€…åˆ›å»ºæ•°æ®è¡¨ç»“æ„</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line"><span class="comment">#    æ§åˆ¶å°æ˜¾ç¤ºSQL</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> SrpingBoot </category>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> SrpingBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot-å¯åŠ¨é…ç½®åŸç†</title>
      <link href="/2019/12/11/SpringBoot-%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/"/>
      <url>/2019/12/11/SpringBoot-%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="å¯åŠ¨é…ç½®åŸç†"><a href="#å¯åŠ¨é…ç½®åŸç†" class="headerlink" title="å¯åŠ¨é…ç½®åŸç†"></a>å¯åŠ¨é…ç½®åŸç†</h1><p>å‡ ä¸ªé‡è¦çš„äº‹ä»¶å›è°ƒæœºåˆ¶</p><p>é…ç½®åœ¨META-INF/spring.factories</p><p><strong>ApplicationContextInitializer</strong></p><p><strong>SpringApplicationRunListener</strong></p><p>åªéœ€è¦æ”¾åœ¨iocå®¹å™¨ä¸­</p><p><strong>ApplicationRunner</strong></p><p><strong>CommandLineRunner</strong></p><p>å¯åŠ¨æµç¨‹ï¼š</p><h2 id="1ã€åˆ›å»ºSpringApplicationå¯¹è±¡"><a href="#1ã€åˆ›å»ºSpringApplicationå¯¹è±¡" class="headerlink" title="1ã€åˆ›å»ºSpringApplicationå¯¹è±¡"></a><strong>1ã€åˆ›å»ºSpringApplicationå¯¹è±¡</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">initialize(sources);</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(Object[] sources)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ä¿å­˜ä¸»é…ç½®ç±»</span></span><br><span class="line">    <span class="keyword">if</span> (sources != <span class="keyword">null</span> &amp;&amp; sources.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.sources.addAll(Arrays.asList(sources));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­å½“å‰æ˜¯å¦ä¸€ä¸ªwebåº”ç”¨</span></span><br><span class="line">    <span class="keyword">this</span>.webEnvironment = deduceWebEnvironment();</span><br><span class="line">    <span class="comment">//ä»ç±»è·¯å¾„ä¸‹æ‰¾åˆ°META-INF/spring.factoriesé…ç½®çš„æ‰€æœ‰ApplicationContextInitializerï¼›ç„¶åä¿å­˜èµ·æ¥</span></span><br><span class="line">    setInitializers((Collection) getSpringFactoriesInstances(</span><br><span class="line">        ApplicationContextInitializer<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line">    <span class="comment">//ä»ç±»è·¯å¾„ä¸‹æ‰¾åˆ°ETA-INF/spring.factoriesé…ç½®çš„æ‰€æœ‰ApplicationListener</span></span><br><span class="line">    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line">    <span class="comment">//ä»å¤šä¸ªé…ç½®ç±»ä¸­æ‰¾åˆ°æœ‰mainæ–¹æ³•çš„ä¸»é…ç½®ç±»</span></span><br><span class="line">    <span class="keyword">this</span>.mainApplicationClass = deduceMainApplicationClass();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9sofv72poj30dm04h74b.jpg" alt=""></p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9sofzc13tj30dm06zjrj.jpg" alt=""></p><h2 id="2ã€è¿è¡Œrunæ–¹æ³•"><a href="#2ã€è¿è¡Œrunæ–¹æ³•" class="headerlink" title="2ã€è¿è¡Œrunæ–¹æ³•"></a>2ã€è¿è¡Œrunæ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">   StopWatch stopWatch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">   stopWatch.start();</span><br><span class="line">   ConfigurableApplicationContext context = <span class="keyword">null</span>;</span><br><span class="line">   FailureAnalyzers analyzers = <span class="keyword">null</span>;</span><br><span class="line">   configureHeadlessProperty();</span><br><span class="line">    </span><br><span class="line">   <span class="comment">//è·å–SpringApplicationRunListenersï¼›ä»ç±»è·¯å¾„ä¸‹META-INF/spring.factories</span></span><br><span class="line">   SpringApplicationRunListeners listeners = getRunListeners(args);</span><br><span class="line">    <span class="comment">//å›è°ƒæ‰€æœ‰çš„è·å–SpringApplicationRunListener.starting()æ–¹æ³•</span></span><br><span class="line">   listeners.starting();</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="comment">//å°è£…å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line">      ApplicationArguments applicationArguments = <span class="keyword">new</span> DefaultApplicationArguments(</span><br><span class="line">            args);</span><br><span class="line">      <span class="comment">//å‡†å¤‡ç¯å¢ƒ</span></span><br><span class="line">      ConfigurableEnvironment environment = prepareEnvironment(listeners,</span><br><span class="line">            applicationArguments);</span><br><span class="line">       <span class="comment">//åˆ›å»ºç¯å¢ƒå®Œæˆåå›è°ƒSpringApplicationRunListener.environmentPrepared()ï¼›è¡¨ç¤ºç¯å¢ƒå‡†å¤‡å®Œæˆ</span></span><br><span class="line">       </span><br><span class="line">      Banner printedBanner = printBanner(environment);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//åˆ›å»ºApplicationContextï¼›å†³å®šåˆ›å»ºwebçš„iocè¿˜æ˜¯æ™®é€šçš„ioc</span></span><br><span class="line">      context = createApplicationContext();</span><br><span class="line">       </span><br><span class="line">      analyzers = <span class="keyword">new</span> FailureAnalyzers(context);</span><br><span class="line">       <span class="comment">//å‡†å¤‡ä¸Šä¸‹æ–‡ç¯å¢ƒ;å°†environmentä¿å­˜åˆ°iocä¸­ï¼›è€Œä¸”applyInitializers()ï¼›</span></span><br><span class="line">       <span class="comment">//applyInitializers()ï¼šå›è°ƒä¹‹å‰ä¿å­˜çš„æ‰€æœ‰çš„ApplicationContextInitializerçš„initializeæ–¹æ³•</span></span><br><span class="line">       <span class="comment">//å›è°ƒæ‰€æœ‰çš„SpringApplicationRunListenerçš„contextPrepared()ï¼›</span></span><br><span class="line">       <span class="comment">//</span></span><br><span class="line">      prepareContext(context, environment, listeners, applicationArguments,</span><br><span class="line">            printedBanner);</span><br><span class="line">       <span class="comment">//prepareContextè¿è¡Œå®Œæˆä»¥åå›è°ƒæ‰€æœ‰çš„SpringApplicationRunListenerçš„contextLoadedï¼ˆï¼‰ï¼›</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">//såˆ·æ–°å®¹å™¨ï¼›iocå®¹å™¨åˆå§‹åŒ–ï¼ˆå¦‚æœæ˜¯webåº”ç”¨è¿˜ä¼šåˆ›å»ºåµŒå…¥å¼çš„Tomcatï¼‰ï¼›Springæ³¨è§£ç‰ˆ</span></span><br><span class="line">       <span class="comment">//æ‰«æï¼Œåˆ›å»ºï¼ŒåŠ è½½æ‰€æœ‰ç»„ä»¶çš„åœ°æ–¹ï¼›ï¼ˆé…ç½®ç±»ï¼Œç»„ä»¶ï¼Œè‡ªåŠ¨é…ç½®ï¼‰</span></span><br><span class="line">      refreshContext(context);</span><br><span class="line">       <span class="comment">//ä»iocå®¹å™¨ä¸­è·å–æ‰€æœ‰çš„ApplicationRunnerå’ŒCommandLineRunnerè¿›è¡Œå›è°ƒ</span></span><br><span class="line">       <span class="comment">//ApplicationRunnerå…ˆå›è°ƒï¼ŒCommandLineRunnerå†å›è°ƒ</span></span><br><span class="line">      afterRefresh(context, applicationArguments);</span><br><span class="line">       <span class="comment">//æ‰€æœ‰çš„SpringApplicationRunListenerå›è°ƒfinishedæ–¹æ³•</span></span><br><span class="line">      listeners.finished(context, <span class="keyword">null</span>);</span><br><span class="line">      stopWatch.stop();</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">         <span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass)</span><br><span class="line">               .logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="comment">//æ•´ä¸ªSpringBootåº”ç”¨å¯åŠ¨å®Œæˆä»¥åè¿”å›å¯åŠ¨çš„iocå®¹å™¨ï¼›</span></span><br><span class="line">      <span class="keyword">return</span> context;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">      handleRunFailure(context, listeners, analyzers, ex);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3ã€äº‹ä»¶ç›‘å¬æœºåˆ¶"><a href="#3ã€äº‹ä»¶ç›‘å¬æœºåˆ¶" class="headerlink" title="3ã€äº‹ä»¶ç›‘å¬æœºåˆ¶"></a>3ã€äº‹ä»¶ç›‘å¬æœºåˆ¶</h2><p>é…ç½®åœ¨META-INF/spring.factories</p><p><strong>ApplicationContextInitializer</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloApplicationContextInitializer</span> <span class="keyword">implements</span> <span class="title">ApplicationContextInitializer</span>&lt;<span class="title">ConfigurableApplicationContext</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(ConfigurableApplicationContext applicationContext)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ApplicationContextInitializer...initialize..."</span>+applicationContext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>SpringApplicationRunListener</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloSpringApplicationRunListener</span> <span class="keyword">implements</span> <span class="title">SpringApplicationRunListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¿…é¡»æœ‰çš„æ„é€ å™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloSpringApplicationRunListener</span><span class="params">(SpringApplication application, String[] args)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">starting</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...starting..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">environmentPrepared</span><span class="params">(ConfigurableEnvironment environment)</span> </span>&#123;</span><br><span class="line">        Object o = environment.getSystemProperties().get(<span class="string">"os.name"</span>);</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...environmentPrepared.."</span>+o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextPrepared</span><span class="params">(ConfigurableApplicationContext context)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...contextPrepared..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoaded</span><span class="params">(ConfigurableApplicationContext context)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...contextLoaded..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finished</span><span class="params">(ConfigurableApplicationContext context, Throwable exception)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...finished..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®ï¼ˆMETA-INF/spring.factoriesï¼‰</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">org.springframework.context.ApplicationContextInitializer</span>=<span class="string">\</span></span><br><span class="line"><span class="attr">com.atguigu.springboot.listener.HelloApplicationContextInitializer</span></span><br><span class="line"></span><br><span class="line"><span class="meta">org.springframework.boot.SpringApplicationRunListener</span>=<span class="string">\</span></span><br><span class="line"><span class="attr">com.atguigu.springboot.listener.HelloSpringApplicationRunListener</span></span><br></pre></td></tr></table></figure><p>åªéœ€è¦æ”¾åœ¨iocå®¹å™¨ä¸­</p><p><strong>ApplicationRunner</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloApplicationRunner</span> <span class="keyword">implements</span> <span class="title">ApplicationRunner</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ApplicationRunner...run...."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>CommandLineRunner</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloCommandLineRunner</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"CommandLineRunner...run..."</span>+ Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> SrpingBoot </category>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> SrpingBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot-é…ç½®æ–‡ä»¶</title>
      <link href="/2019/12/11/SpringBoot-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"/>
      <url>/2019/12/11/SpringBoot-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h1><h2 id="1ã€é…ç½®æ–‡ä»¶"><a href="#1ã€é…ç½®æ–‡ä»¶" class="headerlink" title="1ã€é…ç½®æ–‡ä»¶"></a>1ã€é…ç½®æ–‡ä»¶</h2><p>SpringBootä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶åæ˜¯å›ºå®šçš„ï¼›</p><p>â€¢application.properties</p><p>â€¢application.yml</p><p>é…ç½®æ–‡ä»¶çš„ä½œç”¨ï¼šä¿®æ”¹SpringBootè‡ªåŠ¨é…ç½®çš„é»˜è®¤å€¼ï¼›SpringBootåœ¨åº•å±‚éƒ½ç»™æˆ‘ä»¬è‡ªåŠ¨é…ç½®å¥½ï¼›</p><p>YAMLï¼ˆYAML Ainâ€™t Markup Languageï¼‰</p><p>â€‹    YAML  A Markup Languageï¼šæ˜¯ä¸€ä¸ªæ ‡è®°è¯­è¨€</p><p>â€‹    YAML   isnâ€™t Markup Languageï¼šä¸æ˜¯ä¸€ä¸ªæ ‡è®°è¯­è¨€ï¼›</p><p>æ ‡è®°è¯­è¨€ï¼š</p><p>â€‹    ä»¥å‰çš„é…ç½®æ–‡ä»¶ï¼›å¤§å¤šéƒ½ä½¿ç”¨çš„æ˜¯  <strong>xxxx.xml</strong>æ–‡ä»¶ï¼›</p><p>â€‹    YAMLï¼š<strong>ä»¥æ•°æ®ä¸ºä¸­å¿ƒ</strong>ï¼Œæ¯”jsonã€xmlç­‰æ›´é€‚åˆåšé…ç½®æ–‡ä»¶ï¼›</p><p>â€‹    YAMLï¼šé…ç½®ä¾‹å­</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br></pre></td></tr></table></figure><p>â€‹    XMLï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">port</span>&gt;</span>8081<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2ã€YAMLè¯­æ³•ï¼š"><a href="#2ã€YAMLè¯­æ³•ï¼š" class="headerlink" title="2ã€YAMLè¯­æ³•ï¼š"></a>2ã€YAMLè¯­æ³•ï¼š</h2><h3 id="1ã€åŸºæœ¬è¯­æ³•"><a href="#1ã€åŸºæœ¬è¯­æ³•" class="headerlink" title="1ã€åŸºæœ¬è¯­æ³•"></a>1ã€åŸºæœ¬è¯­æ³•</h3><p>k:(ç©ºæ ¼)vï¼šè¡¨ç¤ºä¸€å¯¹é”®å€¼å¯¹ï¼ˆç©ºæ ¼å¿…é¡»æœ‰ï¼‰ï¼›</p><p>ä»¥<strong>ç©ºæ ¼</strong>çš„ç¼©è¿›æ¥æ§åˆ¶å±‚çº§å…³ç³»ï¼›åªè¦æ˜¯å·¦å¯¹é½çš„ä¸€åˆ—æ•°æ®ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªå±‚çº§çš„</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/hello</span></span><br></pre></td></tr></table></figure><p>å±æ€§å’Œå€¼ä¹Ÿæ˜¯å¤§å°å†™æ•æ„Ÿï¼›</p><h3 id="2ã€å€¼çš„å†™æ³•"><a href="#2ã€å€¼çš„å†™æ³•" class="headerlink" title="2ã€å€¼çš„å†™æ³•"></a>2ã€å€¼çš„å†™æ³•</h3><h4 id="å­—é¢é‡ï¼šæ™®é€šçš„å€¼ï¼ˆæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”ï¼‰"><a href="#å­—é¢é‡ï¼šæ™®é€šçš„å€¼ï¼ˆæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”ï¼‰" class="headerlink" title="å­—é¢é‡ï¼šæ™®é€šçš„å€¼ï¼ˆæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”ï¼‰"></a>å­—é¢é‡ï¼šæ™®é€šçš„å€¼ï¼ˆæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”ï¼‰</h4><p>â€‹    k: vï¼šå­—é¢ç›´æ¥æ¥å†™ï¼›</p><p>â€‹        å­—ç¬¦ä¸²é»˜è®¤ä¸ç”¨åŠ ä¸Šå•å¼•å·æˆ–è€…åŒå¼•å·ï¼›</p><p>â€‹        â€œâ€ï¼šåŒå¼•å·ï¼›ä¸ä¼šè½¬ä¹‰å­—ç¬¦ä¸²é‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦ï¼›ç‰¹æ®Šå­—ç¬¦ä¼šä½œä¸ºæœ¬èº«æƒ³è¡¨ç¤ºçš„æ„æ€</p><p>â€‹                name:   â€œzhangsan \n lisiâ€ï¼šè¾“å‡ºï¼›zhangsan æ¢è¡Œ  lisi</p><p>â€‹        â€˜â€™ï¼šå•å¼•å·ï¼›ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œç‰¹æ®Šå­—ç¬¦æœ€ç»ˆåªæ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²æ•°æ®</p><p>â€‹                name:   â€˜zhangsan \n lisiâ€™ï¼šè¾“å‡ºï¼›zhangsan \n  lisi</p><h4 id="å¯¹è±¡ã€Mapï¼ˆå±æ€§å’Œå€¼ï¼‰ï¼ˆé”®å€¼å¯¹ï¼‰ï¼š"><a href="#å¯¹è±¡ã€Mapï¼ˆå±æ€§å’Œå€¼ï¼‰ï¼ˆé”®å€¼å¯¹ï¼‰ï¼š" class="headerlink" title="å¯¹è±¡ã€Mapï¼ˆå±æ€§å’Œå€¼ï¼‰ï¼ˆé”®å€¼å¯¹ï¼‰ï¼š"></a>å¯¹è±¡ã€Mapï¼ˆå±æ€§å’Œå€¼ï¼‰ï¼ˆé”®å€¼å¯¹ï¼‰ï¼š</h4><p>â€‹    k: vï¼šåœ¨ä¸‹ä¸€è¡Œæ¥å†™å¯¹è±¡çš„å±æ€§å’Œå€¼çš„å…³ç³»ï¼›æ³¨æ„ç¼©è¿›</p><p>â€‹        å¯¹è±¡è¿˜æ˜¯k: vçš„æ–¹å¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">friends:</span></span><br><span class="line"><span class="attr">lastName:</span> <span class="string">zhangsan</span></span><br><span class="line"><span class="attr">age:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure><p>è¡Œå†…å†™æ³•ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">friends:</span> <span class="string">&#123;lastName:</span> <span class="string">zhangsan,age:</span> <span class="number">18</span><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="æ•°ç»„ï¼ˆListã€Setï¼‰ï¼š"><a href="#æ•°ç»„ï¼ˆListã€Setï¼‰ï¼š" class="headerlink" title="æ•°ç»„ï¼ˆListã€Setï¼‰ï¼š"></a>æ•°ç»„ï¼ˆListã€Setï¼‰ï¼š</h4><p>ç”¨- å€¼è¡¨ç¤ºæ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pets:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">dog</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">pig</span></span><br></pre></td></tr></table></figure><p>è¡Œå†…å†™æ³•</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pets:</span> <span class="string">[cat,dog,pig]</span></span><br></pre></td></tr></table></figure><h2 id="3ã€é…ç½®æ–‡ä»¶å€¼æ³¨å…¥"><a href="#3ã€é…ç½®æ–‡ä»¶å€¼æ³¨å…¥" class="headerlink" title="3ã€é…ç½®æ–‡ä»¶å€¼æ³¨å…¥"></a>3ã€é…ç½®æ–‡ä»¶å€¼æ³¨å…¥</h2><p>é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">    <span class="attr">lastName:</span> <span class="string">hello</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">18</span></span><br><span class="line">    <span class="attr">boss:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">birth:</span> <span class="number">2017</span><span class="string">/12/12</span></span><br><span class="line">    <span class="attr">maps:</span> <span class="string">&#123;k1:</span> <span class="string">v1,k2:</span> <span class="number">12</span><span class="string">&#125;</span></span><br><span class="line">    <span class="attr">lists:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">lisi</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zhaoliu</span></span><br><span class="line">    <span class="attr">dog:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">å°ç‹—</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">12</span></span><br></pre></td></tr></table></figure><p>javaBeanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ConfigurationProperties</span>ï¼šå‘Šè¯‰SpringBootå°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®šï¼›</span></span><br><span class="line"><span class="comment"> *      prefix = "person"ï¼šé…ç½®æ–‡ä»¶ä¸­å“ªä¸ªä¸‹é¢çš„æ‰€æœ‰å±æ€§è¿›è¡Œä¸€ä¸€æ˜ å°„</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½å®¹å™¨æä¾›çš„<span class="doctag">@ConfigurationProperties</span>åŠŸèƒ½ï¼›</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"person"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œä»¥åç¼–å†™é…ç½®å°±æœ‰æç¤ºäº†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œé…ç½®æ–‡ä»¶è¿›è¡Œç»‘å®šå°±ä¼šæœ‰æç¤º--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="1ã€propertiesé…ç½®æ–‡ä»¶åœ¨ideaä¸­é»˜è®¤utf-8å¯èƒ½ä¼šä¹±ç "><a href="#1ã€propertiesé…ç½®æ–‡ä»¶åœ¨ideaä¸­é»˜è®¤utf-8å¯èƒ½ä¼šä¹±ç " class="headerlink" title="1ã€propertiesé…ç½®æ–‡ä»¶åœ¨ideaä¸­é»˜è®¤utf-8å¯èƒ½ä¼šä¹±ç "></a>1ã€propertiesé…ç½®æ–‡ä»¶åœ¨ideaä¸­é»˜è®¤utf-8å¯èƒ½ä¼šä¹±ç </h4><p>è°ƒæ•´</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9sobgh1jwj30rz0ilq3n.jpg" alt="ideaé…ç½®ä¹±ç "></p><h4 id="2ã€-Valueè·å–å€¼å’Œ-ConfigurationPropertiesè·å–å€¼æ¯”è¾ƒ"><a href="#2ã€-Valueè·å–å€¼å’Œ-ConfigurationPropertiesè·å–å€¼æ¯”è¾ƒ" class="headerlink" title="2ã€@Valueè·å–å€¼å’Œ@ConfigurationPropertiesè·å–å€¼æ¯”è¾ƒ"></a>2ã€@Valueè·å–å€¼å’Œ@ConfigurationPropertiesè·å–å€¼æ¯”è¾ƒ</h4><div class="table-container"><table><thead><tr><th></th><th>@ConfigurationProperties</th><th>@Value</th></tr></thead><tbody><tr><td>åŠŸèƒ½</td><td>æ‰¹é‡æ³¨å…¥é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§</td><td>ä¸€ä¸ªä¸ªæŒ‡å®š</td></tr><tr><td>æ¾æ•£ç»‘å®šï¼ˆæ¾æ•£è¯­æ³•ï¼‰</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>SpEL</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>JSR303æ•°æ®æ ¡éªŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>å¤æ‚ç±»å‹å°è£…</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table></div><p>é…ç½®æ–‡ä»¶ymlè¿˜æ˜¯propertiesä»–ä»¬éƒ½èƒ½è·å–åˆ°å€¼ï¼›</p><p>å¦‚æœè¯´ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨æŸä¸ªä¸šåŠ¡é€»è¾‘ä¸­éœ€è¦è·å–ä¸€ä¸‹é…ç½®æ–‡ä»¶ä¸­çš„æŸé¡¹å€¼ï¼Œä½¿ç”¨@Valueï¼›</p><p>å¦‚æœè¯´ï¼Œæˆ‘ä»¬ä¸“é—¨ç¼–å†™äº†ä¸€ä¸ªjavaBeanæ¥å’Œé…ç½®æ–‡ä»¶è¿›è¡Œæ˜ å°„ï¼Œæˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨@ConfigurationPropertiesï¼›</p><h4 id="3ã€é…ç½®æ–‡ä»¶æ³¨å…¥å€¼æ•°æ®æ ¡éªŒ"><a href="#3ã€é…ç½®æ–‡ä»¶æ³¨å…¥å€¼æ•°æ®æ ¡éªŒ" class="headerlink" title="3ã€é…ç½®æ–‡ä»¶æ³¨å…¥å€¼æ•°æ®æ ¡éªŒ"></a>3ã€é…ç½®æ–‡ä»¶æ³¨å…¥å€¼æ•°æ®æ ¡éªŒ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"person"</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;bean class="Person"&gt;</span></span><br><span class="line"><span class="comment">     *      &lt;property name="lastName" value="å­—é¢é‡/$&#123;key&#125;ä»ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼/#&#123;SpEL&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     * &lt;bean/&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//lastNameå¿…é¡»æ˜¯é‚®ç®±æ ¼å¼</span></span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="comment">//@Value("$&#123;person.last-name&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="comment">//@Value("#&#123;11*2&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//@Value("true")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br></pre></td></tr></table></figure><h4 id="4ã€-PropertySource-amp-ImportResource-amp-Bean"><a href="#4ã€-PropertySource-amp-ImportResource-amp-Bean" class="headerlink" title="4ã€@PropertySource&amp;@ImportResource&amp;@Bean"></a>4ã€@PropertySource&amp;@ImportResource&amp;@Bean</h4><p>@<strong>PropertySource</strong>ï¼šåŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ConfigurationProperties</span>ï¼šå‘Šè¯‰SpringBootå°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®šï¼›</span></span><br><span class="line"><span class="comment"> *      prefix = "person"ï¼šé…ç½®æ–‡ä»¶ä¸­å“ªä¸ªä¸‹é¢çš„æ‰€æœ‰å±æ€§è¿›è¡Œä¸€ä¸€æ˜ å°„</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½å®¹å™¨æä¾›çš„<span class="doctag">@ConfigurationProperties</span>åŠŸèƒ½ï¼›</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@ConfigurationProperties</span>(prefix = "person")é»˜è®¤ä»å…¨å±€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼ï¼›</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PropertySource</span>(value = &#123;<span class="string">"classpath:person.properties"</span>&#125;)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"person"</span>)</span><br><span class="line"><span class="comment">//@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;bean class="Person"&gt;</span></span><br><span class="line"><span class="comment">     *      &lt;property name="lastName" value="å­—é¢é‡/$&#123;key&#125;ä»ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼/#&#123;SpEL&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     * &lt;bean/&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//lastNameå¿…é¡»æ˜¯é‚®ç®±æ ¼å¼</span></span><br><span class="line">   <span class="comment">// @Email</span></span><br><span class="line">    <span class="comment">//@Value("$&#123;person.last-name&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="comment">//@Value("#&#123;11*2&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//@Value("true")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br></pre></td></tr></table></figure><p>@<strong>ImportResource</strong>ï¼šå¯¼å…¥Springçš„é…ç½®æ–‡ä»¶ï¼Œè®©é…ç½®æ–‡ä»¶é‡Œé¢çš„å†…å®¹ç”Ÿæ•ˆï¼›</p><p>Spring Booté‡Œé¢æ²¡æœ‰Springçš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½è‡ªåŠ¨è¯†åˆ«ï¼›</p><p>æƒ³è®©Springçš„é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼ŒåŠ è½½è¿›æ¥ï¼›@<strong>ImportResource</strong>æ ‡æ³¨åœ¨ä¸€ä¸ªé…ç½®ç±»ä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ImportResource</span>(locations = &#123;<span class="string">"classpath:beans.xml"</span>&#125;)</span><br><span class="line">å¯¼å…¥Springçš„é…ç½®æ–‡ä»¶è®©å…¶ç”Ÿæ•ˆ</span><br></pre></td></tr></table></figure><p>ä¸æ¥ç¼–å†™Springçš„é…ç½®æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloService"</span> <span class="attr">class</span>=<span class="string">"com.atguigu.springboot.service.HelloService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>SpringBootæ¨èç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶çš„æ–¹å¼ï¼›æ¨èä½¿ç”¨å…¨æ³¨è§£çš„æ–¹å¼</p><p>1ã€é…ç½®ç±»<strong>@Configuration</strong>â€”â€”â€”&gt;Springé…ç½®æ–‡ä»¶</p><p>2ã€ä½¿ç”¨<strong>@Bean</strong>ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Configuration</span>ï¼šæŒ‡æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼›å°±æ˜¯æ¥æ›¿ä»£ä¹‹å‰çš„Springé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * åœ¨é…ç½®æ–‡ä»¶ä¸­ç”¨&lt;bean&gt;&lt;bean/&gt;æ ‡ç­¾æ·»åŠ ç»„ä»¶</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†æ–¹æ³•çš„è¿”å›å€¼æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼›å®¹å™¨ä¸­è¿™ä¸ªç»„ä»¶é»˜è®¤çš„idå°±æ˜¯æ–¹æ³•å</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloService <span class="title">helloService02</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"é…ç½®ç±»@Beanç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶äº†..."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HelloService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4ã€é…ç½®æ–‡ä»¶å ä½ç¬¦"><a href="#4ã€é…ç½®æ–‡ä»¶å ä½ç¬¦" class="headerlink" title="4ã€é…ç½®æ–‡ä»¶å ä½ç¬¦"></a>4ã€é…ç½®æ–‡ä»¶å ä½ç¬¦</h2><h3 id="1ã€éšæœºæ•°"><a href="#1ã€éšæœºæ•°" class="headerlink" title="1ã€éšæœºæ•°"></a>1ã€éšæœºæ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;random.value&#125;ã€$&#123;random.<span class="keyword">int</span>&#125;ã€$&#123;random.<span class="keyword">long</span>&#125;</span><br><span class="line">$&#123;random.<span class="keyword">int</span>(<span class="number">10</span>)&#125;ã€$&#123;random.<span class="keyword">int</span>[<span class="number">1024</span>,<span class="number">65536</span>]&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€å ä½ç¬¦è·å–ä¹‹å‰é…ç½®çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥æ˜¯ç”¨-æŒ‡å®šé»˜è®¤å€¼"><a href="#2ã€å ä½ç¬¦è·å–ä¹‹å‰é…ç½®çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥æ˜¯ç”¨-æŒ‡å®šé»˜è®¤å€¼" class="headerlink" title="2ã€å ä½ç¬¦è·å–ä¹‹å‰é…ç½®çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥æ˜¯ç”¨:æŒ‡å®šé»˜è®¤å€¼"></a>2ã€å ä½ç¬¦è·å–ä¹‹å‰é…ç½®çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥æ˜¯ç”¨:æŒ‡å®šé»˜è®¤å€¼</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">person.last-name</span>=<span class="string">å¼ ä¸‰$&#123;random.uuid&#125;</span></span><br><span class="line"><span class="meta">person.age</span>=<span class="string">$&#123;random.int&#125;</span></span><br><span class="line"><span class="meta">person.birth</span>=<span class="string">2017/12/15</span></span><br><span class="line"><span class="meta">person.boss</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">person.maps.k1</span>=<span class="string">v1</span></span><br><span class="line"><span class="meta">person.maps.k2</span>=<span class="string">14</span></span><br><span class="line"><span class="meta">person.lists</span>=<span class="string">a,b,c</span></span><br><span class="line"><span class="meta">person.dog.name</span>=<span class="string">$&#123;person.hello:hello&#125;_dog</span></span><br><span class="line"><span class="meta">person.dog.age</span>=<span class="string">15</span></span><br></pre></td></tr></table></figure><h2 id="5ã€Profile"><a href="#5ã€Profile" class="headerlink" title="5ã€Profile"></a>5ã€Profile</h2><h3 id="1ã€å¤šProfileæ–‡ä»¶"><a href="#1ã€å¤šProfileæ–‡ä»¶" class="headerlink" title="1ã€å¤šProfileæ–‡ä»¶"></a>1ã€å¤šProfileæ–‡ä»¶</h3><p>æˆ‘ä»¬åœ¨ä¸»é…ç½®æ–‡ä»¶ç¼–å†™çš„æ—¶å€™ï¼Œæ–‡ä»¶åå¯ä»¥æ˜¯   application-{profile}.properties/yml</p><p>é»˜è®¤ä½¿ç”¨application.propertiesçš„é…ç½®ï¼›</p><h3 id="2ã€ymlæ”¯æŒå¤šæ–‡æ¡£å—æ–¹å¼"><a href="#2ã€ymlæ”¯æŒå¤šæ–‡æ¡£å—æ–¹å¼" class="headerlink" title="2ã€ymlæ”¯æŒå¤šæ–‡æ¡£å—æ–¹å¼"></a>2ã€ymlæ”¯æŒå¤šæ–‡æ¡£å—æ–¹å¼</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">prod</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8084</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span>  <span class="comment">#æŒ‡å®šå±äºå“ªä¸ªç¯å¢ƒ</span></span><br></pre></td></tr></table></figure><h3 id="3ã€æ¿€æ´»æŒ‡å®šprofile-ç¯å¢ƒéš”ç¦»"><a href="#3ã€æ¿€æ´»æŒ‡å®šprofile-ç¯å¢ƒéš”ç¦»" class="headerlink" title="3ã€æ¿€æ´»æŒ‡å®šprofile(ç¯å¢ƒéš”ç¦»)"></a>3ã€æ¿€æ´»æŒ‡å®šprofile(ç¯å¢ƒéš”ç¦»)</h3><p>â€‹    1ã€åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š  spring.profiles.active=dev</p><p>â€‹    2ã€å‘½ä»¤è¡Œï¼š</p><p>â€‹        java -jar spring-boot-02-config-0.0.1-SNAPSHOT.jar â€”spring.profiles.active=devï¼›</p><p>â€‹        å¯ä»¥ç›´æ¥åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œé…ç½®ä¼ å…¥å‘½ä»¤è¡Œå‚æ•°</p><p>â€‹    3ã€è™šæ‹Ÿæœºå‚æ•°ï¼›</p><p>â€‹        -Dspring.profiles.active=dev</p><h2 id="6ã€é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®"><a href="#6ã€é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®" class="headerlink" title="6ã€é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®"></a>6ã€é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®</h2><p>springboot å¯åŠ¨ä¼šæ‰«æä»¥ä¸‹ä½ç½®çš„application.propertiesæˆ–è€…application.ymlæ–‡ä»¶ä½œä¸ºSpring bootçš„é»˜è®¤é…ç½®æ–‡ä»¶</p><p>â€“file:./config/</p><p>â€“file:./</p><p>â€“classpath:/config/</p><p>â€“classpath:/</p><p>ä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ï¼Œé«˜ä¼˜å…ˆçº§çš„é…ç½®ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½®ï¼›</p><p>SpringBootä¼šä»è¿™å››ä¸ªä½ç½®å…¨éƒ¨åŠ è½½ä¸»é…ç½®æ–‡ä»¶ï¼›<strong>äº’è¡¥é…ç½®</strong>ï¼›</p><p>==æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡spring.config.locationæ¥æ”¹å˜é»˜è®¤çš„é…ç½®æ–‡ä»¶ä½ç½®==</p><p><strong>é¡¹ç›®æ‰“åŒ…å¥½ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°çš„å½¢å¼ï¼Œå¯åŠ¨é¡¹ç›®çš„æ—¶å€™æ¥æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–°ä½ç½®ï¼›æŒ‡å®šé…ç½®æ–‡ä»¶å’Œé»˜è®¤åŠ è½½çš„è¿™äº›é…ç½®æ–‡ä»¶å…±åŒèµ·ä½œç”¨å½¢æˆäº’è¡¥é…ç½®ï¼›</strong></p><p>java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar â€”spring.config.location=G:/application.properties</p><h2 id="7ã€å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº"><a href="#7ã€å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº" class="headerlink" title="7ã€å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº"></a>7ã€å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº</h2><p><strong>==SpringBootä¹Ÿå¯ä»¥ä»ä»¥ä¸‹ä½ç½®åŠ è½½é…ç½®ï¼› ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼›é«˜ä¼˜å…ˆçº§çš„é…ç½®è¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½®ï¼Œæ‰€æœ‰çš„é…ç½®ä¼šå½¢æˆäº’è¡¥é…ç½®==</strong></p><p><strong>1.å‘½ä»¤è¡Œå‚æ•°</strong></p><p>æ‰€æœ‰çš„é…ç½®éƒ½å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šè¿›è¡ŒæŒ‡å®š</p><p>java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar â€”server.port=8087  â€”server.context-path=/abc</p><p>å¤šä¸ªé…ç½®ç”¨ç©ºæ ¼åˆ†å¼€ï¼› â€”é…ç½®é¡¹=å€¼</p><p>2.æ¥è‡ªjava:comp/envçš„JNDIå±æ€§</p><p>3.Javaç³»ç»Ÿå±æ€§ï¼ˆSystem.getProperties()ï¼‰</p><p>4.æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡</p><p>5.RandomValuePropertySourceé…ç½®çš„random.*å±æ€§å€¼</p><p>==<strong>ç”±jaråŒ…å¤–å‘jaråŒ…å†…è¿›è¡Œå¯»æ‰¾ï¼›</strong>==</p><p>==<strong>ä¼˜å…ˆåŠ è½½å¸¦profile</strong>==</p><p><strong>6.jaråŒ…å¤–éƒ¨çš„application-{profile}.propertiesæˆ–application.yml(å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></p><p><strong>7.jaråŒ…å†…éƒ¨çš„application-{profile}.propertiesæˆ–application.yml(å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></p><p>==<strong>å†æ¥åŠ è½½ä¸å¸¦profile</strong>==</p><p><strong>8.jaråŒ…å¤–éƒ¨çš„application.propertiesæˆ–application.yml(ä¸å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></p><p><strong>9.jaråŒ…å†…éƒ¨çš„application.propertiesæˆ–application.yml(ä¸å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></p><p>10.@Configurationæ³¨è§£ç±»ä¸Šçš„@PropertySource</p><p>11.é€šè¿‡SpringApplication.setDefaultPropertiesæŒ‡å®šçš„é»˜è®¤å±æ€§</p><p>æ‰€æœ‰æ”¯æŒçš„é…ç½®åŠ è½½æ¥æºï¼›</p><p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#boot-features-external-config" target="_blank" rel="noopener">å‚è€ƒå®˜æ–¹æ–‡æ¡£</a></p><h2 id="8ã€è‡ªåŠ¨é…ç½®åŸç†"><a href="#8ã€è‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="8ã€è‡ªåŠ¨é…ç½®åŸç†"></a>8ã€è‡ªåŠ¨é…ç½®åŸç†</h2><p>é…ç½®æ–‡ä»¶åˆ°åº•èƒ½å†™ä»€ä¹ˆï¼Ÿæ€ä¹ˆå†™ï¼Ÿè‡ªåŠ¨é…ç½®åŸç†ï¼›</p><p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#common-application-properties" target="_blank" rel="noopener">é…ç½®æ–‡ä»¶èƒ½é…ç½®çš„å±æ€§å‚ç…§</a></p><h3 id="1ã€è‡ªåŠ¨é…ç½®åŸç†ï¼š"><a href="#1ã€è‡ªåŠ¨é…ç½®åŸç†ï¼š" class="headerlink" title="1ã€è‡ªåŠ¨é…ç½®åŸç†ï¼š"></a>1ã€<strong>è‡ªåŠ¨é…ç½®åŸç†ï¼š</strong></h3><p>1ï¼‰ã€SpringBootå¯åŠ¨çš„æ—¶å€™åŠ è½½ä¸»é…ç½®ç±»ï¼Œå¼€å¯äº†è‡ªåŠ¨é…ç½®åŠŸèƒ½ ==@EnableAutoConfiguration==</p><p><strong>2ï¼‰ã€@EnableAutoConfiguration ä½œç”¨ï¼š</strong></p><ul><li>åˆ©ç”¨EnableAutoConfigurationImportSelectorç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€äº›ç»„ä»¶ï¼Ÿ</li></ul><ul><li><p>åœ¨EnableAutoConfigurationImportSelectorçš„çˆ¶ç±»AutoConfigurationImportSelectoré‡Œå¯ä»¥æŸ¥çœ‹selectImports()æ–¹æ³•çš„å†…å®¹ï¼šList<String> configurations = getCandidateConfigurations(annotationMetadata,      attributes);è·å–å€™é€‰çš„é…ç½®ï¼Œæœ€ç»ˆè¿”å›</p><ul><li>```java<br>SpringFactoriesLoader.loadFactoryNames()<br>//åœ¨loadFactoryNames()æ–¹æ³•ä¸­ï¼Œ<br>  Enumeration<URL> urls = (classLoader != null ? classLoader.getResources(FACTORIES_RESOURCE_LOCATION) :<pre><code>                ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));</code></pre>//é€šè¿‡ä¸‹é¢FACTORIES_RESOURCE_LOCATION<br>public static final String FACTORIES_RESOURCE_LOCATION = â€œMETA-INF/spring.factoriesâ€;<br>æ‰«ææ‰€æœ‰jaråŒ…ç±»è·¯å¾„ä¸‹   META-INF/spring.factories<br>æŠŠæ‰«æåˆ°çš„è¿™äº›æ–‡ä»¶çš„å†…å®¹åŒ…è£…æˆpropertieså¯¹è±¡<br>ä»propertiesä¸­è·å–åˆ°EnableAutoConfiguration.classç±»ï¼ˆç±»åï¼‰å¯¹åº”çš„å€¼ï¼Œç„¶åæŠŠä»–ä»¬æ·»åŠ åœ¨å®¹å™¨ä¸­</li></ul></li></ul><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    ![](https://tva1.sinaimg.cn/large/006tNbRwly1g9rfnozzchj31n50u04qp.jpg) </span><br><span class="line"></span><br><span class="line">**==å°† ç±»è·¯å¾„ä¸‹  META-INF/spring.factories é‡Œé¢é…ç½®çš„æ‰€æœ‰EnableAutoConfigurationçš„å€¼åŠ å…¥åˆ°äº†å®¹å™¨ä¸­ï¼›==**</span><br><span class="line"></span><br><span class="line">```properties</span><br><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cloud.CloudAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.solr.SolrRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.elasticsearch.jest.JestAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.DeviceResolverAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.DeviceDelegatingViewResolverAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.SitePreferenceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.reactor.ReactorAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.SecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.SecurityFilterAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.FallbackWebSecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.oauth2.OAuth2AutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.session.SessionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.SocialWebAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.FacebookAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.LinkedInAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.TwitterAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.DispatcherServletAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.EmbeddedServletContainerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.ErrorMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.HttpEncodingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.HttpMessageConvertersAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.MultipartAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.ServerPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.WebClientAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.WebMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.WebSocketAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.WebSocketMessagingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration</span><br></pre></td></tr></table></figure></code></pre><p>æ¯ä¸€ä¸ªè¿™æ ·çš„  xxxAutoConfigurationç±»éƒ½æ˜¯å®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œéƒ½åŠ å…¥åˆ°å®¹å™¨ä¸­ï¼›ç”¨ä»–ä»¬æ¥åšè‡ªåŠ¨é…ç½®ï¼›</p><p>3ï¼‰ã€æ¯ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»è¿›è¡Œè‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼›</p><p>4ï¼‰ã€ä»¥<strong>HttpEncodingAutoConfigurationï¼ˆHttpç¼–ç è‡ªåŠ¨é…ç½®ï¼‰</strong>ä¸ºä¾‹è§£é‡Šè‡ªåŠ¨é…ç½®åŸç†ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>   <span class="comment">//è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œä»¥å‰ç¼–å†™çš„é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(HttpEncodingProperties<span class="class">.<span class="keyword">class</span>)  //å¯åŠ¨æŒ‡å®šç±»çš„<span class="title">ConfigurationProperties</span>åŠŸèƒ½ï¼›å°†é…ç½®æ–‡ä»¶ä¸­å¯¹åº”çš„å€¼å’Œ<span class="title">HttpEncodingProperties</span>ç»‘å®šèµ·æ¥ï¼›å¹¶æŠŠ<span class="title">HttpEncodingProperties</span>åŠ å…¥åˆ°<span class="title">ioc</span>å®¹å™¨ä¸­</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnWebApplication</span> //<span class="title">Spring</span>åº•å±‚@<span class="title">Conditional</span>æ³¨è§£ï¼ˆ<span class="title">Spring</span>æ³¨è§£ç‰ˆï¼‰ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³æŒ‡å®šçš„æ¡ä»¶ï¼Œæ•´ä¸ªé…ç½®ç±»é‡Œé¢çš„é…ç½®å°±ä¼šç”Ÿæ•ˆï¼›    åˆ¤æ–­å½“å‰åº”ç”¨æ˜¯å¦æ˜¯<span class="title">web</span>åº”ç”¨ï¼Œå¦‚æœæ˜¯ï¼Œå½“å‰é…ç½®ç±»ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnClass</span>(<span class="title">CharacterEncodingFilter</span>.<span class="title">class</span>)  //åˆ¤æ–­å½“å‰é¡¹ç›®æœ‰æ²¡æœ‰è¿™ä¸ªç±»<span class="title">CharacterEncodingFilter</span>ï¼›<span class="title">SpringMVC</span>ä¸­è¿›è¡Œä¹±ç è§£å†³çš„è¿‡æ»¤å™¨ï¼›</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnProperty</span>(<span class="title">prefix</span> </span>= <span class="string">"spring.http.encoding"</span>, value = <span class="string">"enabled"</span>, matchIfMissing = <span class="keyword">true</span>)  <span class="comment">//åˆ¤æ–­é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªé…ç½®  spring.http.encoding.enabledï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ¤æ–­ä¹Ÿæ˜¯æˆç«‹çš„</span></span><br><span class="line"><span class="comment">//å³ä½¿æˆ‘ä»¬é…ç½®æ–‡ä»¶ä¸­ä¸é…ç½®pring.http.encoding.enabled=trueï¼Œä¹Ÿæ˜¯é»˜è®¤ç”Ÿæ•ˆçš„ï¼›</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpEncodingAutoConfiguration</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//ä»–å·²ç»å’ŒSpringBootçš„é…ç½®æ–‡ä»¶æ˜ å°„äº†</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> HttpEncodingProperties properties;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">//åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨çš„æƒ…å†µä¸‹ï¼Œå‚æ•°çš„å€¼å°±ä¼šä»å®¹å™¨ä¸­æ‹¿</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">HttpEncodingAutoConfiguration</span><span class="params">(HttpEncodingProperties properties)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.properties = properties;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Bean</span>   <span class="comment">//ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶çš„æŸäº›å€¼éœ€è¦ä»propertiesä¸­è·å–</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(CharacterEncodingFilter<span class="class">.<span class="keyword">class</span>) //åˆ¤æ–­å®¹å™¨æ²¡æœ‰è¿™ä¸ªç»„ä»¶ï¼Ÿ</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">CharacterEncodingFilter</span> <span class="title">characterEncodingFilter</span>() </span>&#123;</span><br><span class="line">CharacterEncodingFilter filter = <span class="keyword">new</span> OrderedCharacterEncodingFilter();</span><br><span class="line">filter.setEncoding(<span class="keyword">this</span>.properties.getCharset().name());</span><br><span class="line">filter.setForceRequestEncoding(<span class="keyword">this</span>.properties.shouldForce(Type.REQUEST));</span><br><span class="line">filter.setForceResponseEncoding(<span class="keyword">this</span>.properties.shouldForce(Type.RESPONSE));</span><br><span class="line"><span class="keyword">return</span> filter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®å½“å‰ä¸åŒçš„æ¡ä»¶åˆ¤æ–­ï¼Œå†³å®šè¿™ä¸ªé…ç½®ç±»æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ</p><p>ä¸€ä½†è¿™ä¸ªé…ç½®ç±»ç”Ÿæ•ˆï¼›è¿™ä¸ªé…ç½®ç±»å°±ä¼šç»™å®¹å™¨ä¸­æ·»åŠ å„ç§ç»„ä»¶ï¼›è¿™äº›ç»„ä»¶çš„å±æ€§æ˜¯ä»å¯¹åº”çš„propertiesç±»ä¸­è·å–çš„ï¼Œè¿™äº›ç±»é‡Œé¢çš„æ¯ä¸€ä¸ªå±æ€§åˆæ˜¯å’Œé…ç½®æ–‡ä»¶ç»‘å®šçš„ï¼›</p><p>5ï¼‰ã€æ‰€æœ‰åœ¨é…ç½®æ–‡ä»¶ä¸­èƒ½é…ç½®çš„å±æ€§éƒ½æ˜¯åœ¨xxxxPropertiesç±»ä¸­å°è£…è€…â€˜ï¼›é…ç½®æ–‡ä»¶èƒ½é…ç½®ä»€ä¹ˆå°±å¯ä»¥å‚ç…§æŸä¸ªåŠŸèƒ½å¯¹åº”çš„è¿™ä¸ªå±æ€§ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.http.encoding"</span>)  <span class="comment">//ä»é…ç½®æ–‡ä»¶ä¸­è·å–æŒ‡å®šçš„å€¼å’Œbeançš„å±æ€§è¿›è¡Œç»‘å®š</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpEncodingProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_CHARSET = Charset.forName(<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure><p><strong>ç²¾é«“ï¼š</strong></p><p>â€‹    <strong>1ï¼‰ã€SpringBootå¯åŠ¨ä¼šåŠ è½½å¤§é‡çš„è‡ªåŠ¨é…ç½®ç±»</strong></p><p>â€‹    <strong>2ï¼‰ã€æˆ‘ä»¬çœ‹æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½æœ‰æ²¡æœ‰SpringBooté»˜è®¤å†™å¥½çš„è‡ªåŠ¨é…ç½®ç±»ï¼›</strong></p><p>â€‹    <strong>3ï¼‰ã€æˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸­åˆ°åº•é…ç½®äº†å“ªäº›ç»„ä»¶ï¼›ï¼ˆåªè¦æˆ‘ä»¬è¦ç”¨çš„ç»„ä»¶æœ‰ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†æ¥é…ç½®äº†ï¼‰</strong></p><p>â€‹    <strong>4ï¼‰ã€ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç±»æ·»åŠ ç»„ä»¶çš„æ—¶å€™ï¼Œä¼šä»propertiesç±»ä¸­è·å–æŸäº›å±æ€§ã€‚æˆ‘ä»¬å°±å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè¿™äº›å±æ€§çš„å€¼ï¼›</strong></p><p>xxxxAutoConfigurartionï¼šè‡ªåŠ¨é…ç½®ç±»ï¼›</p><p>ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</p><p>xxxxProperties:å°è£…é…ç½®æ–‡ä»¶ä¸­ç›¸å…³å±æ€§ï¼›</p><h3 id="2ã€ç»†èŠ‚"><a href="#2ã€ç»†èŠ‚" class="headerlink" title="2ã€ç»†èŠ‚"></a>2ã€ç»†èŠ‚</h3><h4 id="1ã€-Conditionalæ´¾ç”Ÿæ³¨è§£ï¼ˆSpringæ³¨è§£ç‰ˆåŸç”Ÿçš„-Conditionalä½œç”¨ï¼‰"><a href="#1ã€-Conditionalæ´¾ç”Ÿæ³¨è§£ï¼ˆSpringæ³¨è§£ç‰ˆåŸç”Ÿçš„-Conditionalä½œç”¨ï¼‰" class="headerlink" title="1ã€@Conditionalæ´¾ç”Ÿæ³¨è§£ï¼ˆSpringæ³¨è§£ç‰ˆåŸç”Ÿçš„@Conditionalä½œç”¨ï¼‰"></a>1ã€@Conditionalæ´¾ç”Ÿæ³¨è§£ï¼ˆSpringæ³¨è§£ç‰ˆåŸç”Ÿçš„@Conditionalä½œç”¨ï¼‰</h4><p>ä½œç”¨ï¼šå¿…é¡»æ˜¯@ConditionalæŒ‡å®šçš„æ¡ä»¶æˆç«‹ï¼Œæ‰ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ï¼Œé…ç½®é…é‡Œé¢çš„æ‰€æœ‰å†…å®¹æ‰ç”Ÿæ•ˆï¼›</p><div class="table-container"><table><thead><tr><th>@Conditionalæ‰©å±•æ³¨è§£</th><th>ä½œç”¨ï¼ˆåˆ¤æ–­æ˜¯å¦æ»¡è¶³å½“å‰æŒ‡å®šæ¡ä»¶ï¼‰</th></tr></thead><tbody><tr><td>@ConditionalOnJava</td><td>ç³»ç»Ÿçš„javaç‰ˆæœ¬æ˜¯å¦ç¬¦åˆè¦æ±‚</td></tr><tr><td>@ConditionalOnBean</td><td>å®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šBeanï¼›</td></tr><tr><td>@ConditionalOnMissingBean</td><td>å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šBeanï¼›</td></tr><tr><td>@ConditionalOnExpression</td><td>æ»¡è¶³SpELè¡¨è¾¾å¼æŒ‡å®š</td></tr><tr><td>@ConditionalOnClass</td><td>ç³»ç»Ÿä¸­æœ‰æŒ‡å®šçš„ç±»</td></tr><tr><td>@ConditionalOnMissingClass</td><td>ç³»ç»Ÿä¸­æ²¡æœ‰æŒ‡å®šçš„ç±»</td></tr><tr><td>@ConditionalOnSingleCandidate</td><td>å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªæŒ‡å®šçš„Beanï¼Œæˆ–è€…è¿™ä¸ªBeanæ˜¯é¦–é€‰Bean</td></tr><tr><td>@ConditionalOnProperty</td><td>ç³»ç»Ÿä¸­æŒ‡å®šçš„å±æ€§æ˜¯å¦æœ‰æŒ‡å®šçš„å€¼</td></tr><tr><td>@ConditionalOnResource</td><td>ç±»è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨æŒ‡å®šèµ„æºæ–‡ä»¶</td></tr><tr><td>@ConditionalOnWebApplication</td><td>å½“å‰æ˜¯webç¯å¢ƒ</td></tr><tr><td>@ConditionalOnNotWebApplication</td><td>å½“å‰ä¸æ˜¯webç¯å¢ƒ</td></tr><tr><td>@ConditionalOnJndi</td><td>JNDIå­˜åœ¨æŒ‡å®šé¡¹</td></tr></tbody></table></div><p><strong>è‡ªåŠ¨é…ç½®ç±»å¿…é¡»åœ¨ä¸€å®šçš„æ¡ä»¶ä¸‹æ‰èƒ½ç”Ÿæ•ˆï¼›</strong></p><p>æˆ‘ä»¬æ€ä¹ˆçŸ¥é“å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆï¼›</p><p><strong>==æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯ç”¨  debug=trueå±æ€§ï¼›æ¥è®©æ§åˆ¶å°æ‰“å°è‡ªåŠ¨é…ç½®æŠ¥å‘Š==</strong>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„çŸ¥é“å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">=========================</span><br><span class="line">AUTO-CONFIGURATION REPORT</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Positive matches:ï¼ˆè‡ªåŠ¨é…ç½®ç±»å¯ç”¨çš„ï¼‰</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">   DispatcherServletAutoConfiguration matched:</span><br><span class="line">      - <span class="meta">@ConditionalOnClass</span> found required <span class="class"><span class="keyword">class</span> '<span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">servlet</span>.<span class="title">DispatcherServlet</span>'</span>; <span class="meta">@ConditionalOnMissingClass</span> <span class="function">did not find unwanted <span class="title">class</span> <span class="params">(OnClassCondition)</span></span></span><br><span class="line"><span class="function">      - @<span class="title">ConditionalOnWebApplication</span> <span class="params">(required)</span> found <span class="title">StandardServletEnvironment</span> <span class="params">(OnWebApplicationCondition)</span></span></span><br><span class="line"><span class="function">        </span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">Negative matches:ï¼ˆæ²¡æœ‰å¯åŠ¨ï¼Œæ²¡æœ‰åŒ¹é…æˆåŠŸçš„è‡ªåŠ¨é…ç½®ç±»ï¼‰</span></span><br><span class="line"><span class="function">-----------------</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">   ActiveMQAutoConfiguration:</span></span><br><span class="line"><span class="function">      Did not match:</span></span><br><span class="line"><span class="function">         - @ConditionalOnClass did not find required classes 'javax.jms.ConnectionFactory', 'org.apache.activemq.ActiveMQConnectionFactory' <span class="params">(OnClassCondition)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">   AopAutoConfiguration:</span></span><br><span class="line"><span class="function">      Did not match:</span></span><br><span class="line"><span class="function">         - @ConditionalOnClass did not find required classes 'org.aspectj.lang.annotation.Aspect', 'org.aspectj.lang.reflect.Advice' <span class="params">(OnClassCondition)</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> SrpingBoot </category>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> SrpingBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot-Webå¼€å‘</title>
      <link href="/2019/12/11/SpringBoot-Web%E5%BC%80%E5%8F%91/"/>
      <url>/2019/12/11/SpringBoot-Web%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h1 id="Webå¼€å‘"><a href="#Webå¼€å‘" class="headerlink" title="Webå¼€å‘"></a>Webå¼€å‘</h1><h2 id="1ã€ç®€ä»‹"><a href="#1ã€ç®€ä»‹" class="headerlink" title="1ã€ç®€ä»‹"></a>1ã€ç®€ä»‹</h2><p>ä½¿ç”¨SpringBootï¼›</p><p><strong>1ï¼‰ã€åˆ›å»ºSpringBootåº”ç”¨ï¼Œé€‰ä¸­æˆ‘ä»¬éœ€è¦çš„æ¨¡å—ï¼›</strong></p><p><strong>2ï¼‰ã€SpringBootå·²ç»é»˜è®¤å°†è¿™äº›åœºæ™¯é…ç½®å¥½äº†ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå°‘é‡é…ç½®å°±å¯ä»¥è¿è¡Œèµ·æ¥</strong></p><p><strong>3ï¼‰ã€è‡ªå·±ç¼–å†™ä¸šåŠ¡ä»£ç ï¼›</strong></p><p><strong>è‡ªåŠ¨é…ç½®åŸç†ï¼Ÿ</strong></p><p>è¿™ä¸ªåœºæ™¯SpringBootå¸®æˆ‘ä»¬é…ç½®äº†ä»€ä¹ˆï¼Ÿèƒ½ä¸èƒ½ä¿®æ”¹ï¼Ÿèƒ½ä¿®æ”¹å“ªäº›é…ç½®ï¼Ÿèƒ½ä¸èƒ½æ‰©å±•ï¼Ÿxxx</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxAutoConfigurationï¼šå¸®æˆ‘ä»¬ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç»„ä»¶ï¼›</span><br><span class="line">xxxxProperties:é…ç½®ç±»æ¥å°è£…é…ç½®æ–‡ä»¶çš„å†…å®¹ï¼›</span><br></pre></td></tr></table></figure><h2 id="2ã€SpringBootå¯¹é™æ€èµ„æºçš„æ˜ å°„è§„åˆ™ï¼›"><a href="#2ã€SpringBootå¯¹é™æ€èµ„æºçš„æ˜ å°„è§„åˆ™ï¼›" class="headerlink" title="2ã€SpringBootå¯¹é™æ€èµ„æºçš„æ˜ å°„è§„åˆ™ï¼›"></a>2ã€SpringBootå¯¹é™æ€èµ„æºçš„æ˜ å°„è§„åˆ™ï¼›</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.resources"</span>, ignoreUnknownFields = <span class="keyword">false</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceProperties</span> <span class="keyword">implements</span> <span class="title">ResourceLoaderAware</span> </span>&#123;</span><br><span class="line">  <span class="comment">//å¯ä»¥è®¾ç½®å’Œé™æ€èµ„æºæœ‰å…³çš„å‚æ•°ï¼Œç¼“å­˜æ—¶é—´ç­‰</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">WebMvcAuotConfigurationï¼š</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">logger.debug(<span class="string">"Default resource handling disabled"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">Integer cachePeriod = <span class="keyword">this</span>.resourceProperties.getCachePeriod();</span><br><span class="line"><span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">"/webjars/**"</span>)) &#123;</span><br><span class="line">customizeResourceHandlerRegistration(</span><br><span class="line">registry.addResourceHandler(<span class="string">"/webjars/**"</span>)</span><br><span class="line">.addResourceLocations(</span><br><span class="line"><span class="string">"classpath:/META-INF/resources/webjars/"</span>)</span><br><span class="line">.setCachePeriod(cachePeriod));</span><br><span class="line">&#125;</span><br><span class="line">String staticPathPattern = <span class="keyword">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">         <span class="comment">//é™æ€èµ„æºæ–‡ä»¶å¤¹æ˜ å°„</span></span><br><span class="line"><span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">customizeResourceHandlerRegistration(</span><br><span class="line">registry.addResourceHandler(staticPathPattern)</span><br><span class="line">.addResourceLocations(</span><br><span class="line"><span class="keyword">this</span>.resourceProperties.getStaticLocations())</span><br><span class="line">.setCachePeriod(cachePeriod));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//é…ç½®æ¬¢è¿é¡µæ˜ å°„</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title">welcomePageHandlerMapping</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">ResourceProperties resourceProperties)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> WelcomePageHandlerMapping(resourceProperties.getWelcomePage(),</span><br><span class="line"><span class="keyword">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//é…ç½®å–œæ¬¢çš„å›¾æ ‡</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(value = <span class="string">"spring.mvc.favicon.enabled"</span>, matchIfMissing = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FaviconConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ResourceProperties resourceProperties;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FaviconConfiguration</span><span class="params">(ResourceProperties resourceProperties)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.resourceProperties = resourceProperties;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SimpleUrlHandlerMapping <span class="title">faviconHandlerMapping</span><span class="params">()</span> </span>&#123;</span><br><span class="line">SimpleUrlHandlerMapping mapping = <span class="keyword">new</span> SimpleUrlHandlerMapping();</span><br><span class="line">mapping.setOrder(Ordered.HIGHEST_PRECEDENCE + <span class="number">1</span>);</span><br><span class="line">             <span class="comment">//æ‰€æœ‰  **/favicon.ico </span></span><br><span class="line">mapping.setUrlMap(Collections.singletonMap(<span class="string">"**/favicon.ico"</span>,</span><br><span class="line">faviconRequestHandler()));</span><br><span class="line"><span class="keyword">return</span> mapping;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResourceHttpRequestHandler <span class="title">faviconRequestHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ResourceHttpRequestHandler requestHandler = <span class="keyword">new</span> ResourceHttpRequestHandler();</span><br><span class="line">requestHandler</span><br><span class="line">.setLocations(<span class="keyword">this</span>.resourceProperties.getFaviconLocations());</span><br><span class="line"><span class="keyword">return</span> requestHandler;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>==1ï¼‰ã€æ‰€æœ‰ /webjars/** ï¼Œéƒ½å» classpath:/META-INF/resources/webjars/ æ‰¾èµ„æºï¼›==</p><p>â€‹    webjarsï¼šä»¥jaråŒ…çš„æ–¹å¼å¼•å…¥é™æ€èµ„æºï¼›</p><p><a href="http://www.webjars.org/" target="_blank" rel="noopener">http://www.webjars.org/</a></p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9so5qy31nj308g073dfs.jpg" alt=""></p><p>localhost:8080/webjars/jquery/3.3.1/jquery.js</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¼•å…¥jquery-webjar--&gt;</span>åœ¨è®¿é—®çš„æ—¶å€™åªéœ€è¦å†™webjarsä¸‹é¢èµ„æºçš„åç§°å³å¯</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>==2ï¼‰ã€ResourceProperties.class ç±»é‡Œé¢â€/**â€ è®¿é—®å½“å‰é¡¹ç›®çš„ä»»ä½•èµ„æºï¼Œéƒ½å»ï¼ˆé™æ€èµ„æºçš„æ–‡ä»¶å¤¹ï¼‰æ‰¾æ˜ å°„==</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;classpath:/META-INF/resources/&quot;, </span><br><span class="line">&quot;classpath:/resources/&quot;,</span><br><span class="line">&quot;classpath:/static/&quot;, </span><br><span class="line">&quot;classpath:/public/&quot; </span><br><span class="line">&quot;/&quot;ï¼šå½“å‰é¡¹ç›®çš„æ ¹è·¯å¾„</span><br></pre></td></tr></table></figure><p>localhost:8080/abc ===  å»é™æ€èµ„æºæ–‡ä»¶å¤¹é‡Œé¢æ‰¾abc</p><p>==3ï¼‰ã€æ¬¢è¿é¡µï¼› é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰index.htmlé¡µé¢ï¼›è¢«â€/**â€æ˜ å°„ï¼›==</p><p>â€‹    localhost:8080/   æ‰¾indexé¡µé¢</p><p>==4ï¼‰ã€æ‰€æœ‰çš„ **/favicon.ico  éƒ½æ˜¯åœ¨é™æ€èµ„æºæ–‡ä»¶ä¸‹æ‰¾ï¼›==</p><h2 id="3ã€æ¨¡æ¿å¼•æ“"><a href="#3ã€æ¨¡æ¿å¼•æ“" class="headerlink" title="3ã€æ¨¡æ¿å¼•æ“"></a>3ã€æ¨¡æ¿å¼•æ“</h2><p>JSPã€Velocityã€Freemarkerã€Thymeleaf</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9so6wis16j30mb0am3yn.jpg" alt=""></p><p>SpringBootæ¨èçš„Thymeleafï¼›</p><p>è¯­æ³•æ›´ç®€å•ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼›</p><h3 id="1ã€å¼•å…¥thymeleafï¼›"><a href="#1ã€å¼•å…¥thymeleafï¼›" class="headerlink" title="1ã€å¼•å…¥thymeleafï¼›"></a>1ã€å¼•å…¥thymeleafï¼›</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          2.1.6</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">åˆ‡æ¢thymeleafç‰ˆæœ¬</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">thymeleaf.version</span>&gt;</span>3.0.9.RELEASE<span class="tag">&lt;/<span class="name">thymeleaf.version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¸ƒå±€åŠŸèƒ½çš„æ”¯æŒç¨‹åº  thymeleaf3ä¸»ç¨‹åº  layout2ä»¥ä¸Šç‰ˆæœ¬ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- thymeleaf2   layout1--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2ã€Thymeleafä½¿ç”¨"><a href="#2ã€Thymeleafä½¿ç”¨" class="headerlink" title="2ã€Thymeleafä½¿ç”¨"></a>2ã€Thymeleafä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.thymeleaf"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThymeleafProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_ENCODING = Charset.forName(<span class="string">"UTF-8"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> MimeType DEFAULT_CONTENT_TYPE = MimeType.valueOf(<span class="string">"text/html"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">"classpath:/templates/"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">".html"</span>;</span><br><span class="line">  <span class="comment">//</span></span><br></pre></td></tr></table></figure><p>åªè¦æˆ‘ä»¬æŠŠHTMLé¡µé¢æ”¾åœ¨classpath:/templates/ï¼Œthymeleafå°±èƒ½è‡ªåŠ¨æ¸²æŸ“ï¼›</p><p>ä½¿ç”¨ï¼š</p><p>1ã€å¯¼å…¥thymeleafçš„åç§°ç©ºé—´</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2ã€ä½¿ç”¨thymeleafè¯­æ³•ï¼›</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>æˆåŠŸï¼<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--th:text å°†divé‡Œé¢çš„æ–‡æœ¬å†…å®¹è®¾ç½®ä¸º --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">"$&#123;hello&#125;"</span>&gt;</span>è¿™æ˜¯æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3ã€è¯­æ³•è§„åˆ™"><a href="#3ã€è¯­æ³•è§„åˆ™" class="headerlink" title="3ã€è¯­æ³•è§„åˆ™"></a>3ã€è¯­æ³•è§„åˆ™</h3><p>1ï¼‰ã€th:textï¼›æ”¹å˜å½“å‰å…ƒç´ é‡Œé¢çš„æ–‡æœ¬å†…å®¹ï¼›</p><p>â€‹    thï¼šä»»æ„htmlå±æ€§ï¼›æ¥æ›¿æ¢åŸç”Ÿå±æ€§çš„å€¼</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9so9eeguoj30os0gswfw.jpg" alt=""></p><p>2ï¼‰ã€è¡¨è¾¾å¼ï¼Ÿ</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Simple</span> <span class="string">expressions:ï¼ˆè¡¨è¾¾å¼è¯­æ³•ï¼‰</span></span><br><span class="line">    <span class="attr">Variable</span> <span class="string">Expressions: $&#123;...&#125;ï¼šè·å–å˜é‡å€¼ï¼›OGNLï¼›</span></span><br><span class="line">    <span class="attr">1ï¼‰ã€è·å–å¯¹è±¡çš„å±æ€§ã€è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">    <span class="attr">2ï¼‰ã€ä½¿ç”¨å†…ç½®çš„åŸºæœ¬å¯¹è±¡ï¼š</span></span><br><span class="line"><span class="comment">    #ctx : the context object.</span></span><br><span class="line"><span class="comment">    #vars: the context variables.</span></span><br><span class="line"><span class="comment">                #locale : the context locale.</span></span><br><span class="line"><span class="comment">                #request : (only in Web Contexts) the HttpServletRequest object.</span></span><br><span class="line"><span class="comment">                #response : (only in Web Contexts) the HttpServletResponse object.</span></span><br><span class="line"><span class="comment">                #session : (only in Web Contexts) the HttpSession object.</span></span><br><span class="line"><span class="comment">                #servletContext : (only in Web Contexts) the ServletContext object.</span></span><br><span class="line">                </span><br><span class="line">                <span class="attr">$&#123;session.foo&#125;</span></span><br><span class="line">            <span class="attr">3ï¼‰ã€å†…ç½®çš„ä¸€äº›å·¥å…·å¯¹è±¡ï¼š</span></span><br><span class="line"><span class="comment">#execInfo : information about the template being processed.</span></span><br><span class="line"><span class="comment">#messages : methods for obtaining externalized messages inside variables expressions, in the same way as they would be obtained using #&#123;â€¦&#125; syntax.</span></span><br><span class="line"><span class="comment">#uris : methods for escaping parts of URLs/URIs</span></span><br><span class="line"><span class="comment">#conversions : methods for executing the configured conversion service (if any).</span></span><br><span class="line"><span class="comment">#dates : methods for java.util.Date objects: formatting, component extraction, etc.</span></span><br><span class="line"><span class="comment">#calendars : analogous to #dates , but for java.util.Calendar objects.</span></span><br><span class="line"><span class="comment">#numbers : methods for formatting numeric objects.</span></span><br><span class="line"><span class="comment">#strings : methods for String objects: contains, startsWith, prepending/appending, etc.</span></span><br><span class="line"><span class="comment">#objects : methods for objects in general.</span></span><br><span class="line"><span class="comment">#bools : methods for boolean evaluation.</span></span><br><span class="line"><span class="comment">#arrays : methods for arrays.</span></span><br><span class="line"><span class="comment">#lists : methods for lists.</span></span><br><span class="line"><span class="comment">#sets : methods for sets.</span></span><br><span class="line"><span class="comment">#maps : methods for maps.</span></span><br><span class="line"><span class="comment">#aggregates : methods for creating aggregates on arrays or collections.</span></span><br><span class="line"><span class="comment">#ids : methods for dealing with id attributes that might be repeated (for example, as a result of an iteration).</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">Selection</span> <span class="string">Variable Expressions: *&#123;...&#125;ï¼šé€‰æ‹©è¡¨è¾¾å¼ï¼šå’Œ$&#123;&#125;åœ¨åŠŸèƒ½ä¸Šæ˜¯ä¸€æ ·ï¼›</span></span><br><span class="line">    <span class="meta">è¡¥å……ï¼šé…åˆ</span> <span class="string">th:object="$&#123;session.user&#125;ï¼š</span></span><br><span class="line">   <span class="meta">&lt;div</span> <span class="string">th:object="$&#123;session.user&#125;"&gt;</span></span><br><span class="line">    <span class="meta">&lt;p&gt;Name</span>: <span class="string">&lt;span th:text="*&#123;firstName&#125;"&gt;Sebastian&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="meta">&lt;p&gt;Surname</span>: <span class="string">&lt;span th:text="*&#123;lastName&#125;"&gt;Pepper&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="meta">&lt;p&gt;Nationality</span>: <span class="string">&lt;span th:text="*&#123;nationality&#125;"&gt;Saturn&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="attr">&lt;/div&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">Message</span> <span class="string">Expressions: #&#123;...&#125;ï¼šè·å–å›½é™…åŒ–å†…å®¹</span></span><br><span class="line">    <span class="attr">Link</span> <span class="string">URL Expressions: @&#123;...&#125;ï¼šå®šä¹‰URLï¼›</span></span><br><span class="line">    <span class="meta">@&#123;/order/process(execId</span>=<span class="string">$&#123;execId&#125;,execType='FAST')&#125;</span></span><br><span class="line">    <span class="attr">Fragment</span> <span class="string">Expressions: ~&#123;...&#125;ï¼šç‰‡æ®µå¼•ç”¨è¡¨è¾¾å¼</span></span><br><span class="line">    <span class="meta">&lt;div</span> <span class="string">th:insert="~&#123;commons :: main&#125;"&gt;...&lt;/div&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">Literalsï¼ˆå­—é¢é‡ï¼‰</span></span><br><span class="line">      <span class="attr">Text</span> <span class="string">literals: 'one text' , 'Another one!' ,â€¦</span></span><br><span class="line">      <span class="attr">Number</span> <span class="string">literals: 0 , 34 , 3.0 , 12.3 ,â€¦</span></span><br><span class="line">      <span class="attr">Boolean</span> <span class="string">literals: true , false</span></span><br><span class="line">      <span class="attr">Null</span> <span class="string">literal: null</span></span><br><span class="line">      <span class="attr">Literal</span> <span class="string">tokens: one , sometext , main ,â€¦</span></span><br><span class="line"><span class="attr">Text</span> <span class="string">operations:ï¼ˆæ–‡æœ¬æ“ä½œï¼‰</span></span><br><span class="line">    <span class="attr">String</span> <span class="string">concatenation: +</span></span><br><span class="line">    <span class="attr">Literal</span> <span class="string">substitutions: |The name is $&#123;name&#125;|</span></span><br><span class="line"><span class="attr">Arithmetic</span> <span class="string">operations:ï¼ˆæ•°å­¦è¿ç®—ï¼‰</span></span><br><span class="line">    <span class="attr">Binary</span> <span class="string">operators: + , - , * , / , %</span></span><br><span class="line">    <span class="attr">Minus</span> <span class="string">sign (unary operator): -</span></span><br><span class="line"><span class="attr">Boolean</span> <span class="string">operations:ï¼ˆå¸ƒå°”è¿ç®—ï¼‰</span></span><br><span class="line">    <span class="attr">Binary</span> <span class="string">operators: and , or</span></span><br><span class="line">    <span class="attr">Boolean</span> <span class="string">negation (unary operator): ! , not</span></span><br><span class="line"><span class="attr">Comparisons</span> <span class="string">and equality:ï¼ˆæ¯”è¾ƒè¿ç®—ï¼‰</span></span><br><span class="line">    <span class="attr">Comparators</span>: <span class="string">&gt; , &lt; , &gt;= , &lt;= ( gt , lt , ge , le )</span></span><br><span class="line">    <span class="attr">Equality</span> <span class="string">operators: == , != ( eq , ne )</span></span><br><span class="line"><span class="attr">Conditional</span> <span class="string">operators:æ¡ä»¶è¿ç®—ï¼ˆä¸‰å…ƒè¿ç®—ç¬¦ï¼‰</span></span><br><span class="line">    <span class="meta">If-then</span>: <span class="string">(if) ? (then)</span></span><br><span class="line">    <span class="meta">If-then-else</span>: <span class="string">(if) ? (then) : (else)</span></span><br><span class="line">    <span class="attr">Default</span>: <span class="string">(value) ?: (defaultvalue)</span></span><br><span class="line"><span class="attr">Special</span> <span class="string">tokens:</span></span><br><span class="line">    <span class="meta">No-Operation</span>: <span class="string">_</span></span><br></pre></td></tr></table></figure><h2 id="4ã€SpringMVCè‡ªåŠ¨é…ç½®"><a href="#4ã€SpringMVCè‡ªåŠ¨é…ç½®" class="headerlink" title="4ã€SpringMVCè‡ªåŠ¨é…ç½®"></a>4ã€SpringMVCè‡ªåŠ¨é…ç½®</h2><p><a href="https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications</a></p><h3 id="1-Spring-MVC-auto-configuration"><a href="#1-Spring-MVC-auto-configuration" class="headerlink" title="1. Spring MVC auto-configuration"></a>1. Spring MVC auto-configuration</h3><p>Spring Boot è‡ªåŠ¨é…ç½®å¥½äº†SpringMVC</p><p>ä»¥ä¸‹æ˜¯SpringBootå¯¹SpringMVCçš„é»˜è®¤é…ç½®:<strong>==ï¼ˆWebMvcAutoConfigurationï¼‰==</strong></p><ul><li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p><ul><li>è‡ªåŠ¨é…ç½®äº†ViewResolverï¼ˆè§†å›¾è§£æå™¨ï¼šæ ¹æ®æ–¹æ³•çš„è¿”å›å€¼å¾—åˆ°è§†å›¾å¯¹è±¡ï¼ˆViewï¼‰ï¼Œè§†å›¾å¯¹è±¡å†³å®šå¦‚ä½•æ¸²æŸ“ï¼ˆè½¬å‘ï¼Ÿé‡å®šå‘ï¼Ÿï¼‰ï¼‰</li><li>ContentNegotiatingViewResolverï¼šç»„åˆæ‰€æœ‰çš„è§†å›¾è§£æå™¨çš„ï¼›</li><li>==å¦‚ä½•å®šåˆ¶ï¼šæˆ‘ä»¬å¯ä»¥è‡ªå·±ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªè§†å›¾è§£æå™¨ï¼›è‡ªåŠ¨çš„å°†å…¶ç»„åˆè¿›æ¥ï¼›==</li></ul></li><li><p>Support for serving static resources, including support for WebJars (see below).é™æ€èµ„æºæ–‡ä»¶å¤¹è·¯å¾„,webjars</p></li><li><p>Static <code>index.html</code> support. é™æ€é¦–é¡µè®¿é—®</p></li><li><p>Custom <code>Favicon</code> support (see below).  favicon.ico</p></li></ul><ul><li><p>è‡ªåŠ¨æ³¨å†Œäº† of <code>Converter</code>, <code>GenericConverter</code>, <code>Formatter</code> beans.</p><ul><li>Converterï¼šè½¬æ¢å™¨ï¼›  public String hello(User user)ï¼šç±»å‹è½¬æ¢ä½¿ç”¨Converter</li><li><code>Formatter</code>  æ ¼å¼åŒ–å™¨ï¼›  2017.12.17===Dateï¼›</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"spring.mvc"</span>, name = <span class="string">"date-format"</span>)<span class="comment">//åœ¨æ–‡ä»¶ä¸­é…ç½®æ—¥æœŸæ ¼å¼åŒ–çš„è§„åˆ™</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Formatter&lt;Date&gt; <span class="title">dateFormatter</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> DateFormatter(<span class="keyword">this</span>.mvcProperties.getDateFormat());<span class="comment">//æ—¥æœŸæ ¼å¼åŒ–ç»„ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    ==è‡ªå·±æ·»åŠ çš„æ ¼å¼åŒ–å™¨è½¬æ¢å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦æ”¾åœ¨å®¹å™¨ä¸­å³å¯==</p><ul><li><p>Support for <code>HttpMessageConverters</code> (see below).</p><ul><li><p>HttpMessageConverterï¼šSpringMVCç”¨æ¥è½¬æ¢Httpè¯·æ±‚å’Œå“åº”çš„ï¼›Userâ€”-Jsonï¼›</p></li><li><p><code>HttpMessageConverters</code> æ˜¯ä»å®¹å™¨ä¸­ç¡®å®šï¼›è·å–æ‰€æœ‰çš„HttpMessageConverterï¼›</p><p>==è‡ªå·±ç»™å®¹å™¨ä¸­æ·»åŠ HttpMessageConverterï¼Œåªéœ€è¦å°†è‡ªå·±çš„ç»„ä»¶æ³¨å†Œå®¹å™¨ä¸­ï¼ˆ@Bean,@Componentï¼‰==</p></li></ul></li></ul><ul><li><p>Automatic registration of <code>MessageCodesResolver</code> (see below).å®šä¹‰é”™è¯¯ä»£ç ç”Ÿæˆè§„åˆ™</p></li><li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (see below).</p><p>==æˆ‘ä»¬å¯ä»¥é…ç½®ä¸€ä¸ªConfigurableWebBindingInitializeræ¥æ›¿æ¢é»˜è®¤çš„ï¼›ï¼ˆæ·»åŠ åˆ°å®¹å™¨ï¼‰==</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åˆå§‹åŒ–WebDataBinderï¼›</span><br><span class="line">è¯·æ±‚æ•°æ®=====JavaBeanï¼›</span><br></pre></td></tr></table></figure></li></ul><p><strong>org.springframework.boot.autoconfigure.webï¼šwebçš„æ‰€æœ‰è‡ªåŠ¨åœºæ™¯ï¼›</strong></p><p>If you want to keep Spring Boot MVC features, and you just want to add additional <a href="https://docs.spring.io/spring/docs/4.3.14.RELEASE/spring-framework-reference/htmlsingle#mvc" target="_blank" rel="noopener">MVC configuration</a> (interceptors, formatters, view controllers etc.) you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurerAdapter</code>, but <strong>without</strong> <code>@EnableWebMvc</code>. If you wish to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code> or <code>ExceptionHandlerExceptionResolver</code> you can declare a <code>WebMvcRegistrationsAdapter</code> instance providing such components.</p><p>If you want to take complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code>.</p><h3 id="2ã€æ‰©å±•SpringMVC"><a href="#2ã€æ‰©å±•SpringMVC" class="headerlink" title="2ã€æ‰©å±•SpringMVC"></a>2ã€æ‰©å±•SpringMVC</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">"/hello"</span> <span class="attr">view-name</span>=<span class="string">"success"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/hello"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>==ç¼–å†™ä¸€ä¸ªé…ç½®ç±»ï¼ˆ@Configurationï¼‰ï¼Œæ˜¯WebMvcConfigurerAdapterç±»å‹ï¼›ä¸èƒ½æ ‡æ³¨@EnableWebMvc==</strong>;</p><p>æ—¢ä¿ç•™äº†æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ï¼Œä¹Ÿèƒ½ç”¨æˆ‘ä»¬æ‰©å±•çš„é…ç½®ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨WebMvcConfigurerAdapterå¯ä»¥æ¥æ‰©å±•SpringMVCçš„åŠŸèƒ½</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//æµè§ˆå™¨å‘é€ /atguigu è¯·æ±‚æ¥åˆ° success</span></span><br><span class="line">        registry.addViewController(<span class="string">"/atguigu"</span>).setViewName(<span class="string">"success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸç†ï¼š</p><p>â€‹    1ï¼‰ã€WebMvcAutoConfigurationæ˜¯SpringMVCçš„è‡ªåŠ¨é…ç½®ç±»</p><p>â€‹    2ï¼‰ã€åœ¨åšå…¶ä»–è‡ªåŠ¨é…ç½®æ—¶ä¼šå¯¼å…¥ï¼›@Import(<strong>EnableWebMvcConfiguration</strong>.class)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EnableWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">DelegatingWebMvcConfiguration</span> </span>&#123;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> WebMvcConfigurerComposite configurers = <span class="keyword">new</span> WebMvcConfigurerComposite();</span><br><span class="line"></span><br><span class="line"> <span class="comment">//ä»å®¹å™¨ä¸­è·å–æ‰€æœ‰çš„WebMvcConfigurer</span></span><br><span class="line">     <span class="meta">@Autowired</span>(required = <span class="keyword">false</span>)</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) &#123;</span><br><span class="line">             <span class="keyword">this</span>.configurers.addWebMvcConfigurers(configurers);</span><br><span class="line">           <span class="comment">//ä¸€ä¸ªå‚è€ƒå®ç°ï¼›å°†æ‰€æœ‰çš„WebMvcConfigurerç›¸å…³é…ç½®éƒ½æ¥ä¸€èµ·è°ƒç”¨ï¼›  </span></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">            <span class="comment">// public void addViewControllers(ViewControllerRegistry registry) &#123;</span></span><br><span class="line">             <span class="comment">//    for (WebMvcConfigurer delegate : this.delegates) &#123;</span></span><br><span class="line">              <span class="comment">//       delegate.addViewControllers(registry);</span></span><br><span class="line">              <span class="comment">//   &#125;</span></span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    3ï¼‰ã€å®¹å™¨ä¸­æ‰€æœ‰çš„WebMvcConfigureréƒ½ä¼šä¸€èµ·èµ·ä½œç”¨ï¼›</p><p>â€‹    4ï¼‰ã€æˆ‘ä»¬çš„é…ç½®ç±»ä¹Ÿä¼šè¢«è°ƒç”¨ï¼›</p><p>â€‹    æ•ˆæœï¼šSpringMVCçš„è‡ªåŠ¨é…ç½®å’Œæˆ‘ä»¬çš„æ‰©å±•é…ç½®éƒ½ä¼šèµ·ä½œç”¨ï¼›</p><h3 id="3ã€å…¨é¢æ¥ç®¡SpringMVCï¼›"><a href="#3ã€å…¨é¢æ¥ç®¡SpringMVCï¼›" class="headerlink" title="3ã€å…¨é¢æ¥ç®¡SpringMVCï¼›"></a>3ã€å…¨é¢æ¥ç®¡SpringMVCï¼›</h3><p>SpringBootå¯¹SpringMVCçš„è‡ªåŠ¨é…ç½®ä¸éœ€è¦äº†ï¼Œæ‰€æœ‰éƒ½æ˜¯æˆ‘ä»¬è‡ªå·±é…ç½®ï¼›æ‰€æœ‰çš„SpringMVCçš„è‡ªåŠ¨é…ç½®éƒ½å¤±æ•ˆäº†</p><p><strong>æˆ‘ä»¬éœ€è¦åœ¨é…ç½®ç±»ä¸­æ·»åŠ @EnableWebMvcå³å¯ï¼›</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨WebMvcConfigurerAdapterå¯ä»¥æ¥æ‰©å±•SpringMVCçš„åŠŸèƒ½</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//æµè§ˆå™¨å‘é€ /atguigu è¯·æ±‚æ¥åˆ° success</span></span><br><span class="line">        registry.addViewController(<span class="string">"/atguigu"</span>).setViewName(<span class="string">"success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸç†ï¼š</p><p>ä¸ºä»€ä¹ˆ@EnableWebMvcè‡ªåŠ¨é…ç½®å°±å¤±æ•ˆäº†ï¼›</p><p>1ï¼‰@EnableWebMvcçš„æ ¸å¿ƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import</span>(DelegatingWebMvcConfiguration<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">EnableWebMvc</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>2ï¼‰ã€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>3ï¼‰ã€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123; Servlet<span class="class">.<span class="keyword">class</span>, <span class="title">DispatcherServlet</span>.<span class="title">class</span>,</span></span><br><span class="line"><span class="class"><span class="title">WebMvcConfigurerAdapter</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class">//å®¹å™¨ä¸­æ²¡æœ‰è¿™ä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»æ‰ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnMissingBean</span>(<span class="title">WebMvcConfigurationSupport</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureOrder</span>(<span class="title">Ordered</span>.<span class="title">HIGHEST_PRECEDENCE</span> + 10)</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureAfter</span>(</span>&#123; DispatcherServletAutoConfiguration<span class="class">.<span class="keyword">class</span>,</span></span><br><span class="line"><span class="class"><span class="title">ValidationAutoConfiguration</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">WebMvcAutoConfiguration</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>4ï¼‰ã€@EnableWebMvcå°†WebMvcConfigurationSupportç»„ä»¶å¯¼å…¥è¿›æ¥ï¼›</p><p>5ï¼‰ã€å¯¼å…¥çš„WebMvcConfigurationSupportåªæ˜¯SpringMVCæœ€åŸºæœ¬çš„åŠŸèƒ½ï¼›</p><h2 id="5ã€å¦‚ä½•ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®"><a href="#5ã€å¦‚ä½•ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®" class="headerlink" title="5ã€å¦‚ä½•ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®"></a>5ã€å¦‚ä½•ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®</h2><p>æ¨¡å¼ï¼š</p><p>â€‹    1ï¼‰ã€SpringBootåœ¨è‡ªåŠ¨é…ç½®å¾ˆå¤šç»„ä»¶çš„æ—¶å€™ï¼Œå…ˆçœ‹å®¹å™¨ä¸­æœ‰æ²¡æœ‰ç”¨æˆ·è‡ªå·±é…ç½®çš„ï¼ˆ@Beanã€@Componentï¼‰å¦‚æœæœ‰å°±ç”¨ç”¨æˆ·é…ç½®çš„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ‰è‡ªåŠ¨é…ç½®ï¼›å¦‚æœæœ‰äº›ç»„ä»¶å¯ä»¥æœ‰å¤šä¸ªï¼ˆViewResolverï¼‰å°†ç”¨æˆ·é…ç½®çš„å’Œè‡ªå·±é»˜è®¤çš„ç»„åˆèµ·æ¥ï¼›</p><p>â€‹    2ï¼‰ã€åœ¨SpringBootä¸­ä¼šæœ‰éå¸¸å¤šçš„xxxConfigurerå¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ‰©å±•é…ç½®</p><p>â€‹    3ï¼‰ã€åœ¨SpringBootä¸­ä¼šæœ‰å¾ˆå¤šçš„xxxCustomizerå¸®åŠ©æˆ‘ä»¬è¿›è¡Œå®šåˆ¶é…ç½®</p><h2 id="6ã€RestfulCRUD"><a href="#6ã€RestfulCRUD" class="headerlink" title="6ã€RestfulCRUD"></a>6ã€RestfulCRUD</h2><h3 id="1ï¼‰ã€é»˜è®¤è®¿é—®é¦–é¡µ"><a href="#1ï¼‰ã€é»˜è®¤è®¿é—®é¦–é¡µ" class="headerlink" title="1ï¼‰ã€é»˜è®¤è®¿é—®é¦–é¡µ"></a>1ï¼‰ã€é»˜è®¤è®¿é—®é¦–é¡µ</h3><p><a href="http://localhost:8083/crud/" target="_blank" rel="noopener">http://localhost:8083/crud/</a>  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨WebMvcConfigurerAdapterå¯ä»¥æ¥æ‰©å±•SpringMVCçš„åŠŸèƒ½</span></span><br><span class="line"><span class="comment">//@EnableWebMvc   ä¸è¦æ¥ç®¡SpringMVC</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//æµè§ˆå™¨å‘é€ /atguigu è¯·æ±‚æ¥åˆ° success</span></span><br><span class="line">        registry.addViewController(<span class="string">"/atguigu"</span>).setViewName(<span class="string">"success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰€æœ‰çš„WebMvcConfigurerAdapterç»„ä»¶éƒ½ä¼šä¸€èµ·èµ·ä½œç”¨</span></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">//å°†ç»„ä»¶æ³¨å†Œåœ¨å®¹å™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebMvcConfigurerAdapter <span class="title">webMvcConfigurerAdapter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        WebMvcConfigurerAdapter adapter = <span class="keyword">new</span> WebMvcConfigurerAdapter() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">                registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">                registry.addViewController(<span class="string">"/index.html"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> adapter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ï¼‰ã€å›½é™…åŒ–"><a href="#2ï¼‰ã€å›½é™…åŒ–" class="headerlink" title="2ï¼‰ã€å›½é™…åŒ–"></a>2ï¼‰ã€å›½é™…åŒ–</h3><p><strong>1ï¼‰ã€ç¼–å†™å›½é™…åŒ–é…ç½®æ–‡ä»¶ï¼›</strong></p><p>2ï¼‰ã€ä½¿ç”¨ResourceBundleMessageSourceç®¡ç†å›½é™…åŒ–èµ„æºæ–‡ä»¶</p><p>3ï¼‰ã€åœ¨é¡µé¢ä½¿ç”¨fmt:messageå–å‡ºå›½é™…åŒ–å†…å®¹</p><p>æ­¥éª¤ï¼š</p><p>1ï¼‰ã€ç¼–å†™å›½é™…åŒ–é…ç½®æ–‡ä»¶ï¼ŒæŠ½å–é¡µé¢éœ€è¦æ˜¾ç¤ºçš„å›½é™…åŒ–æ¶ˆæ¯</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9so9qo8xyj30ng09qq37.jpg" alt=""></p><p>2ï¼‰ã€SpringBootè‡ªåŠ¨é…ç½®å¥½äº†ç®¡ç†å›½é™…åŒ–èµ„æºæ–‡ä»¶çš„ç»„ä»¶ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.messages"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageSourceAutoConfiguration</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Comma-separated list of basenames (essentially a fully-qualified classpath</span></span><br><span class="line"><span class="comment"> * location), each following the ResourceBundle convention with relaxed support for</span></span><br><span class="line"><span class="comment"> * slash based locations. If it doesn't contain a package qualifier (such as</span></span><br><span class="line"><span class="comment"> * "org.mypackage"), it will be resolved from the classpath root.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String basename = <span class="string">"messages"</span>;  </span><br><span class="line">    <span class="comment">//æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶å¯ä»¥ç›´æ¥æ”¾åœ¨ç±»è·¯å¾„ä¸‹å«messages.propertiesï¼›</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MessageSource <span class="title">messageSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ResourceBundleMessageSource messageSource = <span class="keyword">new</span> ResourceBundleMessageSource();</span><br><span class="line"><span class="keyword">if</span> (StringUtils.hasText(<span class="keyword">this</span>.basename)) &#123;</span><br><span class="line">            <span class="comment">//è®¾ç½®å›½é™…åŒ–èµ„æºæ–‡ä»¶çš„åŸºç¡€åï¼ˆå»æ‰è¯­è¨€å›½å®¶ä»£ç çš„ï¼‰</span></span><br><span class="line">messageSource.setBasenames(StringUtils.commaDelimitedListToStringArray(</span><br><span class="line">StringUtils.trimAllWhitespace(<span class="keyword">this</span>.basename)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.encoding != <span class="keyword">null</span>) &#123;</span><br><span class="line">messageSource.setDefaultEncoding(<span class="keyword">this</span>.encoding.name());</span><br><span class="line">&#125;</span><br><span class="line">messageSource.setFallbackToSystemLocale(<span class="keyword">this</span>.fallbackToSystemLocale);</span><br><span class="line">messageSource.setCacheSeconds(<span class="keyword">this</span>.cacheSeconds);</span><br><span class="line">messageSource.setAlwaysUseMessageFormat(<span class="keyword">this</span>.alwaysUseMessageFormat);</span><br><span class="line"><span class="keyword">return</span> messageSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰ã€å»é¡µé¢è·å–å›½é™…åŒ–çš„å€¼ï¼›</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9soa1gnfcj30s70fojrx.jpg" alt=""></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>  <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Signin Template for Bootstrap<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"asserts/css/bootstrap.min.css"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/webjars/bootstrap/4.0.0/css/bootstrap.css&#125;"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Custom styles for this template --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"asserts/css/signin.css"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/asserts/css/signin.css&#125;"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-signin"</span> <span class="attr">action</span>=<span class="string">"dashboard.html"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"mb-4"</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/asserts/img/bootstrap-solid.svg&#125;"</span> <span class="attr">src</span>=<span class="string">"asserts/img/bootstrap-solid.svg"</span> <span class="attr">alt</span>=<span class="string">""</span> <span class="attr">width</span>=<span class="string">"72"</span> <span class="attr">height</span>=<span class="string">"72"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"h3 mb-3 font-weight-normal"</span> <span class="attr">th:text</span>=<span class="string">"#&#123;login.tip&#125;"</span>&gt;</span>Please sign in<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"sr-only"</span> <span class="attr">th:text</span>=<span class="string">"#&#123;login.username&#125;"</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span> <span class="attr">th:placeholder</span>=<span class="string">"#&#123;login.username&#125;"</span> <span class="attr">required</span>=<span class="string">""</span> <span class="attr">autofocus</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"sr-only"</span> <span class="attr">th:text</span>=<span class="string">"#&#123;login.password&#125;"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">th:placeholder</span>=<span class="string">"#&#123;login.password&#125;"</span> <span class="attr">required</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"checkbox mb-3"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"remember-me"</span>/&gt;</span> [[#&#123;login.remember&#125;]]</span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-lg btn-primary btn-block"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">th:text</span>=<span class="string">"#&#123;login.btn&#125;"</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"mt-5 mb-3 text-muted"</span>&gt;</span>Â© 2017-2018<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span>&gt;</span>ä¸­æ–‡<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span>&gt;</span>English<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼šæ ¹æ®æµè§ˆå™¨è¯­è¨€è®¾ç½®çš„ä¿¡æ¯åˆ‡æ¢äº†å›½é™…åŒ–ï¼›</p><p>åŸç†ï¼š</p><p>â€‹    å›½é™…åŒ–Localeï¼ˆåŒºåŸŸä¿¡æ¯å¯¹è±¡ï¼‰ï¼›LocaleResolverï¼ˆè·å–åŒºåŸŸä¿¡æ¯å¯¹è±¡ï¼‰ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"spring.mvc"</span>, name = <span class="string">"locale"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.mvcProperties</span><br><span class="line">.getLocaleResolver() == WebMvcProperties.LocaleResolver.FIXED) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> FixedLocaleResolver(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">&#125;</span><br><span class="line">AcceptHeaderLocaleResolver localeResolver = <span class="keyword">new</span> AcceptHeaderLocaleResolver();</span><br><span class="line">localeResolver.setDefaultLocale(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line"><span class="keyword">return</span> localeResolver;</span><br><span class="line">&#125;</span><br><span class="line">é»˜è®¤çš„å°±æ˜¯æ ¹æ®è¯·æ±‚å¤´å¸¦æ¥çš„åŒºåŸŸä¿¡æ¯è·å–Localeè¿›è¡Œå›½é™…åŒ–</span><br></pre></td></tr></table></figure><p>4ï¼‰ã€ç‚¹å‡»é“¾æ¥åˆ‡æ¢å›½é™…åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯ä»¥åœ¨è¿æ¥ä¸Šæºå¸¦åŒºåŸŸä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        String l = request.getParameter(<span class="string">"l"</span>);</span><br><span class="line">        Locale locale = Locale.getDefault();</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(l))&#123;</span><br><span class="line">            String[] split = l.split(<span class="string">"_"</span>);</span><br><span class="line">            locale = <span class="keyword">new</span> Locale(split[<span class="number">0</span>],split[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Locale locale)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyLocaleResolver();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ï¼‰ã€ç™»é™†"><a href="#3ï¼‰ã€ç™»é™†" class="headerlink" title="3ï¼‰ã€ç™»é™†"></a>3ï¼‰ã€ç™»é™†</h3><p>å¼€å‘æœŸé—´æ¨¡æ¿å¼•æ“é¡µé¢ä¿®æ”¹ä»¥åï¼Œè¦å®æ—¶ç”Ÿæ•ˆ</p><p>1ï¼‰ã€ç¦ç”¨æ¨¡æ¿å¼•æ“çš„ç¼“å­˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ç¦ç”¨ç¼“å­˜</span><br><span class="line">spring.thymeleaf.cache=false</span><br></pre></td></tr></table></figure><p>2ï¼‰ã€é¡µé¢ä¿®æ”¹å®Œæˆä»¥åctrl+f9ï¼šé‡æ–°ç¼–è¯‘ï¼›</p><p>ç™»é™†é”™è¯¯æ¶ˆæ¯çš„æ˜¾ç¤º</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color: red"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;msg&#125;"</span> <span class="attr">th:if</span>=<span class="string">"$&#123;not #strings.isEmpty(msg)&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4ï¼‰ã€æ‹¦æˆªå™¨è¿›è¡Œç™»é™†æ£€æŸ¥"><a href="#4ï¼‰ã€æ‹¦æˆªå™¨è¿›è¡Œç™»é™†æ£€æŸ¥" class="headerlink" title="4ï¼‰ã€æ‹¦æˆªå™¨è¿›è¡Œç™»é™†æ£€æŸ¥"></a>4ï¼‰ã€æ‹¦æˆªå™¨è¿›è¡Œç™»é™†æ£€æŸ¥</h3><p>æ‹¦æˆªå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç™»é™†æ£€æŸ¥ï¼Œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Object user = request.getSession().getAttribute(<span class="string">"loginUser"</span>);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//æœªç™»é™†ï¼Œè¿”å›ç™»é™†é¡µé¢</span></span><br><span class="line">            request.setAttribute(<span class="string">"msg"</span>,<span class="string">"æ²¡æœ‰æƒé™è¯·å…ˆç™»é™†"</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/index.html"</span>).forward(request,response);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//å·²ç™»é™†ï¼Œæ”¾è¡Œè¯·æ±‚</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨å†Œæ‹¦æˆªå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰€æœ‰çš„WebMvcConfigurerAdapterç»„ä»¶éƒ½ä¼šä¸€èµ·èµ·ä½œç”¨</span></span><br><span class="line">  <span class="meta">@Bean</span> <span class="comment">//å°†ç»„ä»¶æ³¨å†Œåœ¨å®¹å™¨</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> WebMvcConfigurerAdapter <span class="title">webMvcConfigurerAdapter</span><span class="params">()</span></span>&#123;</span><br><span class="line">      WebMvcConfigurerAdapter adapter = <span class="keyword">new</span> WebMvcConfigurerAdapter() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">              registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">              registry.addViewController(<span class="string">"/index.html"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">              registry.addViewController(<span class="string">"/main.html"</span>).setViewName(<span class="string">"dashboard"</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">//æ³¨å†Œæ‹¦æˆªå™¨</span></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">              <span class="comment">//super.addInterceptors(registry);</span></span><br><span class="line">              <span class="comment">//é™æ€èµ„æºï¼›  *.css , *.js</span></span><br><span class="line">              <span class="comment">//SpringBootå·²ç»åšå¥½äº†é™æ€èµ„æºæ˜ å°„</span></span><br><span class="line">              registry.addInterceptor(<span class="keyword">new</span> LoginHandlerInterceptor()).addPathPatterns(<span class="string">"/**"</span>)</span><br><span class="line">                      .excludePathPatterns(<span class="string">"/index.html"</span>,<span class="string">"/"</span>,<span class="string">"/user/login"</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">return</span> adapter;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="5ï¼‰ã€CRUD-å‘˜å·¥åˆ—è¡¨"><a href="#5ï¼‰ã€CRUD-å‘˜å·¥åˆ—è¡¨" class="headerlink" title="5ï¼‰ã€CRUD-å‘˜å·¥åˆ—è¡¨"></a>5ï¼‰ã€CRUD-å‘˜å·¥åˆ—è¡¨</h3><p>å®éªŒè¦æ±‚ï¼š</p><p>1ï¼‰ã€RestfulCRUDï¼šCRUDæ»¡è¶³Resté£æ ¼ï¼›</p><p>URIï¼š  /èµ„æºåç§°/èµ„æºæ ‡è¯†       HTTPè¯·æ±‚æ–¹å¼åŒºåˆ†å¯¹èµ„æºCRUDæ“ä½œ</p><div class="table-container"><table><thead><tr><th></th><th>æ™®é€šCRUDï¼ˆuriæ¥åŒºåˆ†æ“ä½œï¼‰</th><th>RestfulCRUD</th></tr></thead><tbody><tr><td>æŸ¥è¯¢</td><td>getEmp</td><td>empâ€”-GET</td></tr><tr><td>æ·»åŠ </td><td>addEmp?xxx</td><td>empâ€”-POST</td></tr><tr><td>ä¿®æ”¹</td><td>updateEmp?id=xxx&amp;xxx=xx</td><td>emp/{id}â€”-PUT</td></tr><tr><td>åˆ é™¤</td><td>deleteEmp?id=1</td><td>emp/{id}â€”-DELETE</td></tr></tbody></table></div><p>2ï¼‰ã€å®éªŒçš„è¯·æ±‚æ¶æ„;</p><div class="table-container"><table><thead><tr><th>å®éªŒåŠŸèƒ½</th><th>è¯·æ±‚URI</th><th>è¯·æ±‚æ–¹å¼</th></tr></thead><tbody><tr><td>æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥</td><td>emps</td><td>GET</td></tr><tr><td>æŸ¥è¯¢æŸä¸ªå‘˜å·¥(æ¥åˆ°ä¿®æ”¹é¡µé¢)</td><td>emp/1</td><td>GET</td></tr><tr><td>æ¥åˆ°æ·»åŠ é¡µé¢</td><td>emp</td><td>GET</td></tr><tr><td>æ·»åŠ å‘˜å·¥</td><td>emp</td><td>POST</td></tr><tr><td>æ¥åˆ°ä¿®æ”¹é¡µé¢ï¼ˆæŸ¥å‡ºå‘˜å·¥è¿›è¡Œä¿¡æ¯å›æ˜¾ï¼‰</td><td>emp/1</td><td>GET</td></tr><tr><td>ä¿®æ”¹å‘˜å·¥</td><td>emp</td><td>PUT</td></tr><tr><td>åˆ é™¤å‘˜å·¥</td><td>emp/1</td><td>DELETE</td></tr></tbody></table></div><p>3ï¼‰ã€å‘˜å·¥åˆ—è¡¨ï¼š</p><h4 id="thymeleafå…¬å…±é¡µé¢å…ƒç´ æŠ½å–"><a href="#thymeleafå…¬å…±é¡µé¢å…ƒç´ æŠ½å–" class="headerlink" title="thymeleafå…¬å…±é¡µé¢å…ƒç´ æŠ½å–"></a>thymeleafå…¬å…±é¡µé¢å…ƒç´ æŠ½å–</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1ã€æŠ½å–å…¬å…±ç‰‡æ®µ</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">"copy"</span>&gt;</span></span><br><span class="line">&amp;copy; 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">2ã€å¼•å…¥å…¬å…±ç‰‡æ®µ</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">"~&#123;footer :: copy&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">~&#123;templatename::selector&#125;ï¼šæ¨¡æ¿å::é€‰æ‹©å™¨</span><br><span class="line">~&#123;templatename::fragmentname&#125;:æ¨¡æ¿å::ç‰‡æ®µå</span><br><span class="line"></span><br><span class="line">3ã€é»˜è®¤æ•ˆæœï¼š</span><br><span class="line">insertçš„å…¬å…±ç‰‡æ®µåœ¨divæ ‡ç­¾ä¸­</span><br><span class="line">å¦‚æœä½¿ç”¨th:insertç­‰å±æ€§è¿›è¡Œå¼•å…¥ï¼Œå¯ä»¥ä¸ç”¨å†™~&#123;&#125;ï¼š</span><br><span class="line">è¡Œå†…å†™æ³•å¯ä»¥åŠ ä¸Šï¼š[[~&#123;&#125;]];[(~&#123;&#125;)]ï¼›</span><br></pre></td></tr></table></figure><p>ä¸‰ç§å¼•å…¥å…¬å…±ç‰‡æ®µçš„thå±æ€§ï¼š</p><p><strong>th:insert</strong>ï¼šå°†å…¬å…±ç‰‡æ®µæ•´ä¸ªæ’å…¥åˆ°å£°æ˜å¼•å…¥çš„å…ƒç´ ä¸­</p><p><strong>th:replace</strong>ï¼šå°†å£°æ˜å¼•å…¥çš„å…ƒç´ æ›¿æ¢ä¸ºå…¬å…±ç‰‡æ®µ</p><p><strong>th:include</strong>ï¼šå°†è¢«å¼•å…¥çš„ç‰‡æ®µçš„å†…å®¹åŒ…å«è¿›è¿™ä¸ªæ ‡ç­¾ä¸­</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">th:fragment</span>=<span class="string">"copy"</span>&gt;</span></span><br><span class="line">&amp;copy; 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line">å¼•å…¥æ–¹å¼</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:include</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">æ•ˆæœ</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">    &amp;copy; 2011 The Good Thymes Virtual Grocery</span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">&amp;copy; 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">&amp;copy; 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¼•å…¥ç‰‡æ®µçš„æ—¶å€™ä¼ å…¥å‚æ•°ï¼š </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"col-md-2 d-none d-md-block bg-light sidebar"</span> <span class="attr">id</span>=<span class="string">"sidebar"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sidebar-sticky"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav flex-column"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link active"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">th:class</span>=<span class="string">"$&#123;activeUri=='main.html'?'nav-link active':'nav-link'&#125;"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/main.html&#125;"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">width</span>=<span class="string">"24"</span> <span class="attr">height</span>=<span class="string">"24"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 24 24"</span> <span class="attr">fill</span>=<span class="string">"none"</span> <span class="attr">stroke</span>=<span class="string">"currentColor"</span> <span class="attr">stroke-width</span>=<span class="string">"2"</span> <span class="attr">stroke-linecap</span>=<span class="string">"round"</span> <span class="attr">stroke-linejoin</span>=<span class="string">"round"</span> <span class="attr">class</span>=<span class="string">"feather feather-home"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">polyline</span> <span class="attr">points</span>=<span class="string">"9 22 9 12 15 12 15 22"</span>&gt;</span><span class="tag">&lt;/<span class="name">polyline</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">                    Dashboard <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>(current)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--å¼•å…¥ä¾§è¾¹æ ;ä¼ å…¥å‚æ•°--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">"commons/bar::#sidebar(activeUri='emps')"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6ï¼‰ã€CRUD-å‘˜å·¥æ·»åŠ "><a href="#6ï¼‰ã€CRUD-å‘˜å·¥æ·»åŠ " class="headerlink" title="6ï¼‰ã€CRUD-å‘˜å·¥æ·»åŠ "></a>6ï¼‰ã€CRUD-å‘˜å·¥æ·»åŠ </h3><p>æ·»åŠ é¡µé¢</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>LastName<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan@atguigu.com"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Gender<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span>  <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>ç”·<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span>  <span class="attr">value</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>å¥³<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>department<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>4<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>5<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Birth<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æäº¤çš„æ•°æ®æ ¼å¼ä¸å¯¹ï¼šç”Ÿæ—¥ï¼šæ—¥æœŸï¼›</p><p>2017-12-12ï¼›2017/12/12ï¼›2017.12.12ï¼›</p><p>æ—¥æœŸçš„æ ¼å¼åŒ–ï¼›SpringMVCå°†é¡µé¢æäº¤çš„å€¼éœ€è¦è½¬æ¢ä¸ºæŒ‡å®šçš„ç±»å‹;</p><p>2017-12-12â€”-Dateï¼› ç±»å‹è½¬æ¢ï¼Œæ ¼å¼åŒ–;</p><p>é»˜è®¤æ—¥æœŸæ˜¯æŒ‰ç…§/çš„æ–¹å¼ï¼›</p><h3 id="7ï¼‰ã€CRUD-å‘˜å·¥ä¿®æ”¹"><a href="#7ï¼‰ã€CRUD-å‘˜å·¥ä¿®æ”¹" class="headerlink" title="7ï¼‰ã€CRUD-å‘˜å·¥ä¿®æ”¹"></a>7ï¼‰ã€CRUD-å‘˜å·¥ä¿®æ”¹</h3><p>ä¿®æ”¹æ·»åŠ äºŒåˆä¸€è¡¨å•</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--éœ€è¦åŒºåˆ†æ˜¯å‘˜å·¥ä¿®æ”¹è¿˜æ˜¯æ·»åŠ ï¼›--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">"@&#123;/emp&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å‘é€putè¯·æ±‚ä¿®æ”¹å‘˜å·¥æ•°æ®--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">htmlçš„formæ ‡ç­¾åªæ”¯æŒä¸¤ç§æäº¤æ–¹æ³•ï¼šPOSTå’ŒGETï¼Œæ‰€ä»¥ï¼Œä¸ºäº†ä½¿ç”¨PUTå’ŒDELETEæ–¹æ³•</span></span><br><span class="line"><span class="comment">1ã€SpringMVCä¸­é…ç½®HiddenHttpMethodFilter;ï¼ˆSpringBootè‡ªåŠ¨é…ç½®å¥½çš„ï¼‰</span></span><br><span class="line"><span class="comment">2ã€é¡µé¢åˆ›å»ºä¸€ä¸ªpostè¡¨å•</span></span><br><span class="line"><span class="comment">3ã€åˆ›å»ºä¸€ä¸ªinputé¡¹ï¼Œname="_method";å€¼å°±æ˜¯æˆ‘ä»¬æŒ‡å®šçš„è¯·æ±‚æ–¹å¼</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"_method"</span> <span class="attr">value</span>=<span class="string">"put"</span> <span class="attr">th:if</span>=<span class="string">"$&#123;emp!=null&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">th:if</span>=<span class="string">"$&#123;emp!=null&#125;"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;emp.id&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>LastName<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;emp.lastName&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan@atguigu.com"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;emp.email&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Gender<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"1"</span> <span class="attr">th:checked</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;emp.gender==1&#125;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>ç”·<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"0"</span> <span class="attr">th:checked</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;emp.gender==0&#125;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>å¥³<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>department<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æäº¤çš„æ˜¯éƒ¨é—¨çš„id--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">name</span>=<span class="string">"department.id"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">th:selected</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;dept.id == emp.department.id&#125;"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;dept.id&#125;"</span> <span class="attr">th:each</span>=<span class="string">"dept:$&#123;depts&#125;"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;dept.departmentName&#125;"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Birth<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"birth"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;emp!=null&#125;?'ä¿®æ”¹':'æ·»åŠ '"</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="8ï¼‰ã€CRUD-å‘˜å·¥åˆ é™¤"><a href="#8ï¼‰ã€CRUD-å‘˜å·¥åˆ é™¤" class="headerlink" title="8ï¼‰ã€CRUD-å‘˜å·¥åˆ é™¤"></a>8ï¼‰ã€CRUD-å‘˜å·¥åˆ é™¤</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">"emp:$&#123;emps&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;emp.id&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>[[$&#123;emp.lastName&#125;]]<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;emp.email&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;emp.gender&#125;==0?'å¥³':'ç”·'"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;emp.department.departmentName&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm btn-primary"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/emp/&#125;+$&#123;emp.id&#125;"</span>&gt;</span>ç¼–è¾‘<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:attr</span>=<span class="string">"del_uri=@&#123;/emp/&#125;+$&#123;emp.id&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-sm btn-danger deleteBtn"</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="string">".deleteBtn"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">//åˆ é™¤å½“å‰å‘˜å·¥çš„</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#deleteEmpForm"</span>).attr(<span class="string">"action"</span>,$(<span class="keyword">this</span>).attr(<span class="string">"del_uri"</span>)).submit();</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p>é…å¥—è§†é¢‘ï¼š <a href="https://www.bilibili.com/video/av20965295" target="_blank" rel="noopener">å°šç¡…è°·</a> </p>]]></content>
      
      
      <categories>
          
          <category> SrpingBoot </category>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> SrpingBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot-æ—¥å¿—</title>
      <link href="/2019/12/11/SpringBoot-%E6%97%A5%E5%BF%97/"/>
      <url>/2019/12/11/SpringBoot-%E6%97%A5%E5%BF%97/</url>
      
        <content type="html"><![CDATA[<h1 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h1><h2 id="1ã€æ—¥å¿—æ¡†æ¶"><a href="#1ã€æ—¥å¿—æ¡†æ¶" class="headerlink" title="1ã€æ—¥å¿—æ¡†æ¶"></a>1ã€æ—¥å¿—æ¡†æ¶</h2><p> å°å¼ ï¼›å¼€å‘ä¸€ä¸ªå¤§å‹ç³»ç»Ÿï¼›</p><p>â€‹        1ã€System.out.println(â€œâ€)ï¼›å°†å…³é”®æ•°æ®æ‰“å°åœ¨æ§åˆ¶å°ï¼›å»æ‰ï¼Ÿå†™åœ¨ä¸€ä¸ªæ–‡ä»¶ï¼Ÿ</p><p>â€‹        2ã€æ¡†æ¶æ¥è®°å½•ç³»ç»Ÿçš„ä¸€äº›è¿è¡Œæ—¶ä¿¡æ¯ï¼›æ—¥å¿—æ¡†æ¶ ï¼›  zhanglogging.jarï¼›</p><p>â€‹        3ã€é«˜å¤§ä¸Šçš„å‡ ä¸ªåŠŸèƒ½ï¼Ÿå¼‚æ­¥æ¨¡å¼ï¼Ÿè‡ªåŠ¨å½’æ¡£ï¼Ÿxxxxï¼Ÿ  zhanglogging-good.jarï¼Ÿ</p><p>â€‹        4ã€å°†ä»¥å‰æ¡†æ¶å¸ä¸‹æ¥ï¼Ÿæ¢ä¸Šæ–°çš„æ¡†æ¶ï¼Œé‡æ–°ä¿®æ”¹ä¹‹å‰ç›¸å…³çš„APIï¼›zhanglogging-prefect.jarï¼›</p><p>â€‹        5ã€JDBCâ€”-æ•°æ®åº“é©±åŠ¨ï¼›</p><p>â€‹            å†™äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£å±‚ï¼›æ—¥å¿—é—¨é¢ï¼ˆæ—¥å¿—çš„ä¸€ä¸ªæŠ½è±¡å±‚ï¼‰ï¼›logging-abstract.jarï¼›</p><p>â€‹            ç»™é¡¹ç›®ä¸­å¯¼å…¥å…·ä½“çš„æ—¥å¿—å®ç°å°±è¡Œäº†ï¼›æˆ‘ä»¬ä¹‹å‰çš„æ—¥å¿—æ¡†æ¶éƒ½æ˜¯å®ç°çš„æŠ½è±¡å±‚ï¼›</p><p><strong>å¸‚é¢ä¸Šçš„æ—¥å¿—æ¡†æ¶ï¼›</strong></p><p>JULã€JCLã€Jboss-loggingã€logbackã€log4jã€log4j2ã€slf4jâ€¦.</p><div class="table-container"><table><thead><tr><th>æ—¥å¿—é—¨é¢  ï¼ˆæ—¥å¿—çš„æŠ½è±¡å±‚ï¼‰</th><th>æ—¥å¿—å®ç°</th></tr></thead><tbody><tr><td><del>JCLï¼ˆJakarta  Commons Loggingï¼‰</del>    SLF4jï¼ˆSimple  Logging Facade for Javaï¼‰    <strong><del>jboss-logging</del></strong></td><td>Log4j  JULï¼ˆjava.util.loggingï¼‰  Log4j2  <strong>Logback</strong></td></tr></tbody></table></div><p>å·¦è¾¹é€‰ä¸€ä¸ªé—¨é¢ï¼ˆæŠ½è±¡å±‚ï¼‰ã€å³è¾¹æ¥é€‰ä¸€ä¸ªå®ç°ï¼›</p><p>æ—¥å¿—é—¨é¢ï¼š  SLF4Jï¼›</p><p>æ—¥å¿—å®ç°ï¼šLogbackï¼›</p><p>SpringBootï¼šåº•å±‚æ˜¯Springæ¡†æ¶ï¼ŒSpringæ¡†æ¶é»˜è®¤æ˜¯ç”¨JCLï¼›â€˜</p><p>â€‹    <strong>==SpringBooté€‰ç”¨ SLF4jå’Œlogbackï¼›==</strong></p><h2 id="2ã€SLF4jä½¿ç”¨"><a href="#2ã€SLF4jä½¿ç”¨" class="headerlink" title="2ã€SLF4jä½¿ç”¨"></a>2ã€SLF4jä½¿ç”¨</h2><h3 id="1ã€å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨SLF4j-https-www-slf4j-org"><a href="#1ã€å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨SLF4j-https-www-slf4j-org" class="headerlink" title="1ã€å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨SLF4j   https://www.slf4j.org"></a>1ã€å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨SLF4j   <a href="https://www.slf4j.org" target="_blank" rel="noopener">https://www.slf4j.org</a></h3><p>ä»¥åå¼€å‘çš„æ—¶å€™ï¼Œæ—¥å¿—è®°å½•æ–¹æ³•çš„è°ƒç”¨ï¼Œä¸åº”è¯¥æ¥ç›´æ¥è°ƒç”¨æ—¥å¿—çš„å®ç°ç±»ï¼Œè€Œæ˜¯è°ƒç”¨æ—¥å¿—æŠ½è±¡å±‚é‡Œé¢çš„æ–¹æ³•ï¼›</p><p>ç»™ç³»ç»Ÿé‡Œé¢å¯¼å…¥slf4jçš„jarå’Œ  logbackçš„å®ç°jar</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Logger logger = LoggerFactory.getLogger(HelloWorld<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    logger.info(<span class="string">"Hello World"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›¾ç¤ºï¼›</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9so07y6puj30w00homz4.jpg" alt="/concrete-bindings.png"></p><p>æ¯ä¸€ä¸ªæ—¥å¿—çš„å®ç°æ¡†æ¶éƒ½æœ‰è‡ªå·±çš„é…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨slf4jä»¥åï¼Œ<strong>é…ç½®æ–‡ä»¶è¿˜æ˜¯åšæˆæ—¥å¿—å®ç°æ¡†æ¶è‡ªå·±æœ¬èº«çš„é…ç½®æ–‡ä»¶ï¼›</strong></p><h3 id="2ã€é—ç•™é—®é¢˜"><a href="#2ã€é—ç•™é—®é¢˜" class="headerlink" title="2ã€é—ç•™é—®é¢˜"></a>2ã€é—ç•™é—®é¢˜</h3><p>aï¼ˆslf4j+logbackï¼‰: Springï¼ˆcommons-loggingï¼‰ã€Hibernateï¼ˆjboss-loggingï¼‰ã€MyBatisã€xxxx</p><p>ç»Ÿä¸€æ—¥å¿—è®°å½•ï¼Œå³ä½¿æ˜¯åˆ«çš„æ¡†æ¶å’Œæˆ‘ä¸€èµ·ç»Ÿä¸€ä½¿ç”¨slf4jè¿›è¡Œè¾“å‡ºï¼Ÿ</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9so0evf0bj316e0u00xc.jpg" alt=""></p><p><strong>å¦‚ä½•è®©ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ—¥å¿—éƒ½ç»Ÿä¸€åˆ°slf4jï¼›</strong></p><p>==1ã€å°†ç³»ç»Ÿä¸­å…¶ä»–æ—¥å¿—æ¡†æ¶å…ˆæ’é™¤å‡ºå»ï¼›==</p><p>==2ã€ç”¨ä¸­é—´åŒ…æ¥æ›¿æ¢åŸæœ‰çš„æ—¥å¿—æ¡†æ¶ï¼›==</p><p>==3ã€æˆ‘ä»¬å¯¼å…¥slf4jå…¶ä»–çš„å®ç°==</p><h2 id="3ã€SpringBootæ—¥å¿—å…³ç³»"><a href="#3ã€SpringBootæ—¥å¿—å…³ç³»" class="headerlink" title="3ã€SpringBootæ—¥å¿—å…³ç³»"></a>3ã€SpringBootæ—¥å¿—å…³ç³»</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>SpringBootä½¿ç”¨å®ƒæ¥åšæ—¥å¿—åŠŸèƒ½ï¼›</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åº•å±‚ä¾èµ–å…³ç³»(IDEAæŸ¥çœ‹ä¾èµ–å…³ç³»ï¼šå³é”®é€‰æ‹©Diagrams-&gt;Show Dependenciesâ€¦)</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9rga09qsnj314u054dh3.jpg" alt=""></p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9snyvl4xjj30o709f0ta.jpg" alt=""></p><p>æ€»ç»“ï¼š</p><p>â€‹    1ï¼‰ã€SpringBootåº•å±‚ä¹Ÿæ˜¯ä½¿ç”¨slf4j+logbackçš„æ–¹å¼è¿›è¡Œæ—¥å¿—è®°å½•</p><p>â€‹    2ï¼‰ã€SpringBootä¹ŸæŠŠå…¶ä»–çš„æ—¥å¿—éƒ½æ›¿æ¢æˆäº†slf4jï¼›</p><p>â€‹    3ï¼‰ã€ä¸­é—´æ›¿æ¢åŒ…ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LogFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> String UNSUPPORTED_OPERATION_IN_JCL_OVER_SLF4J = <span class="string">"http://www.slf4j.org/codes.html#unsupported_operation_in_jcl_over_slf4j"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> LogFactory logFactory = <span class="keyword">new</span> SLF4JLogFactory();</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9snz5hc4kj30bd05ut8q.jpg" alt=""></p><p>â€‹    4ï¼‰ã€å¦‚æœæˆ‘ä»¬è¦å¼•å…¥å…¶ä»–æ¡†æ¶ï¼Ÿä¸€å®šè¦æŠŠè¿™ä¸ªæ¡†æ¶çš„é»˜è®¤æ—¥å¿—ä¾èµ–ç§»é™¤æ‰ï¼Ÿ</p><p>â€‹            Springæ¡†æ¶spring-boot-starter-pag  rentç”¨çš„æ˜¯commons-loggingï¼›</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>==SpringBootèƒ½è‡ªåŠ¨é€‚é…æ‰€æœ‰çš„æ—¥å¿—ï¼Œè€Œä¸”åº•å±‚ä½¿ç”¨slf4j+logbackçš„æ–¹å¼è®°å½•æ—¥å¿—ï¼Œå¼•å…¥å…¶ä»–æ¡†æ¶çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠè¿™ä¸ªæ¡†æ¶ä¾èµ–çš„æ—¥å¿—æ¡†æ¶æ’é™¤æ‰å³å¯ï¼›==</strong></p><h2 id="4ã€æ—¥å¿—ä½¿ç”¨ï¼›"><a href="#4ã€æ—¥å¿—ä½¿ç”¨ï¼›" class="headerlink" title="4ã€æ—¥å¿—ä½¿ç”¨ï¼›"></a>4ã€æ—¥å¿—ä½¿ç”¨ï¼›</h2><h3 id="1ã€é»˜è®¤é…ç½®"><a href="#1ã€é»˜è®¤é…ç½®" class="headerlink" title="1ã€é»˜è®¤é…ç½®"></a>1ã€é»˜è®¤é…ç½®</h3><p>SpringBooté»˜è®¤å¸®æˆ‘ä»¬é…ç½®å¥½äº†æ—¥å¿—ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®°å½•å™¨</span></span><br><span class="line">Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//System.out.println();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ—¥å¿—çš„çº§åˆ«ï¼›</span></span><br><span class="line"><span class="comment">//ç”±ä½åˆ°é«˜   trace&lt;debug&lt;info&lt;warn&lt;error</span></span><br><span class="line"><span class="comment">//å¯ä»¥è°ƒæ•´è¾“å‡ºçš„æ—¥å¿—çº§åˆ«ï¼›æ—¥å¿—å°±åªä¼šåœ¨è¿™ä¸ªçº§åˆ«ä»¥ä»¥åçš„é«˜çº§åˆ«ç”Ÿæ•ˆ</span></span><br><span class="line">logger.trace(<span class="string">"è¿™æ˜¯traceæ—¥å¿—..."</span>);</span><br><span class="line">logger.debug(<span class="string">"è¿™æ˜¯debugæ—¥å¿—..."</span>);</span><br><span class="line"><span class="comment">//SpringBooté»˜è®¤ç»™æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯infoçº§åˆ«çš„ï¼Œæ²¡æœ‰æŒ‡å®šçº§åˆ«çš„å°±ç”¨SpringBooté»˜è®¤è§„å®šçš„çº§åˆ«ï¼›rootçº§åˆ«</span></span><br><span class="line">logger.info(<span class="string">"è¿™æ˜¯infoæ—¥å¿—..."</span>);</span><br><span class="line">logger.warn(<span class="string">"è¿™æ˜¯warnæ—¥å¿—..."</span>);</span><br><span class="line">logger.error(<span class="string">"è¿™æ˜¯erroræ—¥å¿—..."</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>    æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼š        %dè¡¨ç¤ºæ—¥æœŸæ—¶é—´ï¼Œ        %threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ        %-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦        %logger{50} è¡¨ç¤ºloggeråå­—æœ€é•¿50ä¸ªå­—ç¬¦ï¼Œå¦åˆ™æŒ‰ç…§å¥ç‚¹åˆ†å‰²ã€‚         %msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ        %næ˜¯æ¢è¡Œç¬¦    --&gt;   ä¾‹å­ï¼š %d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</code></pre><p>SpringBootä¿®æ”¹æ—¥å¿—çš„é»˜è®¤é…ç½®</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">logging.level.com.atguigu</span>=<span class="string">trace</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#logging.path=</span></span><br><span class="line"><span class="comment"># ä¸æŒ‡å®šè·¯å¾„åœ¨å½“å‰é¡¹ç›®ä¸‹ç”Ÿæˆspringboot.logæ—¥å¿—</span></span><br><span class="line"><span class="comment"># å¯ä»¥æŒ‡å®šå®Œæ•´çš„è·¯å¾„ï¼›</span></span><br><span class="line"><span class="comment">#logging.file=G:/springboot.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å½“å‰ç£ç›˜çš„æ ¹è·¯å¾„ä¸‹åˆ›å»ºspringæ–‡ä»¶å¤¹å’Œé‡Œé¢çš„logæ–‡ä»¶å¤¹ï¼›ä½¿ç”¨Â spring.log ä½œä¸ºé»˜è®¤æ–‡ä»¶</span></span><br><span class="line"><span class="meta">logging.path</span>=<span class="string">/spring/log</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  åœ¨æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çš„æ ¼å¼</span></span><br><span class="line"><span class="meta">logging.pattern.console</span>=<span class="string">%d&#123;yyyy-MM-dd&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n</span></span><br><span class="line"><span class="comment"># æŒ‡å®šæ–‡ä»¶ä¸­æ—¥å¿—è¾“å‡ºçš„æ ¼å¼</span></span><br><span class="line"><span class="meta">logging.pattern.file</span>=<span class="string">%d&#123;yyyy-MM-dd&#125; === [%thread] === %-5level === %logger&#123;50&#125; ==== %msg%n</span></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>logging.file</th><th>logging.path</th><th>Example</th><th>Description</th></tr></thead><tbody><tr><td>(none)</td><td>(none)</td><td></td><td>åªåœ¨æ§åˆ¶å°è¾“å‡º</td></tr><tr><td>æŒ‡å®šæ–‡ä»¶å</td><td>(none)</td><td>my.log</td><td>è¾“å‡ºæ—¥å¿—åˆ°my.logæ–‡ä»¶</td></tr><tr><td>(none)</td><td>æŒ‡å®šç›®å½•</td><td>/var/log</td><td>è¾“å‡ºåˆ°æŒ‡å®šç›®å½•çš„ spring.log æ–‡ä»¶ä¸­</td></tr></tbody></table></div><h3 id="2ã€æŒ‡å®šé…ç½®"><a href="#2ã€æŒ‡å®šé…ç½®" class="headerlink" title="2ã€æŒ‡å®šé…ç½®"></a>2ã€æŒ‡å®šé…ç½®</h3><p>ç»™ç±»è·¯å¾„ä¸‹æ”¾ä¸Šæ¯ä¸ªæ—¥å¿—æ¡†æ¶è‡ªå·±çš„é…ç½®æ–‡ä»¶å³å¯ï¼›SpringBootå°±ä¸ä½¿ç”¨ä»–é»˜è®¤é…ç½®çš„äº†</p><div class="table-container"><table><thead><tr><th>Logging System</th><th>Customization</th></tr></thead><tbody><tr><td>Logback</td><td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code> or <code>logback.groovy</code></td></tr><tr><td>Log4j2</td><td><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></td></tr><tr><td>JDK (Java Util Logging)</td><td><code>logging.properties</code></td></tr></tbody></table></div><p>logback.xmlï¼šç›´æ¥å°±è¢«æ—¥å¿—æ¡†æ¶è¯†åˆ«äº†ï¼›</p><p><strong>logback-spring.xml</strong>ï¼šæ—¥å¿—æ¡†æ¶å°±ä¸ç›´æ¥åŠ è½½æ—¥å¿—çš„é…ç½®é¡¹ï¼Œç”±SpringBootè§£ææ—¥å¿—é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨SpringBootçš„é«˜çº§ProfileåŠŸèƒ½</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"staging"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- configuration to be enabled when the "staging" profile is active --&gt;</span></span><br><span class="line">  å¯ä»¥æŒ‡å®šæŸæ®µé…ç½®åªåœ¨æŸä¸ªç¯å¢ƒä¸‹ç”Ÿæ•ˆ</span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"stdout"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼š</span></span><br><span class="line"><span class="comment">%dè¡¨ç¤ºæ—¥æœŸæ—¶é—´ï¼Œ</span></span><br><span class="line"><span class="comment">%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ</span></span><br><span class="line"><span class="comment">%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦</span></span><br><span class="line"><span class="comment">%logger&#123;50&#125; è¡¨ç¤ºloggeråå­—æœ€é•¿50ä¸ªå­—ç¬¦ï¼Œå¦åˆ™æŒ‰ç…§å¥ç‚¹åˆ†å‰²ã€‚ </span></span><br><span class="line"><span class="comment">%msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ</span></span><br><span class="line"><span class="comment">%næ˜¯æ¢è¡Œç¬¦</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.PatternLayout"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"dev"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; ----&gt; [%thread] ---&gt; %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"!dev"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; ==== [%thread] ==== %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨logback.xmlä½œä¸ºæ—¥å¿—é…ç½®æ–‡ä»¶ï¼Œè¿˜è¦ä½¿ç”¨profileåŠŸèƒ½ï¼Œä¼šæœ‰ä»¥ä¸‹é”™è¯¯</p><p> <code>no applicable action for [springProfile]</code></p><h2 id="5ã€åˆ‡æ¢æ—¥å¿—æ¡†æ¶"><a href="#5ã€åˆ‡æ¢æ—¥å¿—æ¡†æ¶" class="headerlink" title="5ã€åˆ‡æ¢æ—¥å¿—æ¡†æ¶"></a>5ã€åˆ‡æ¢æ—¥å¿—æ¡†æ¶</h2><p>å¯ä»¥æŒ‰ç…§slf4jçš„æ—¥å¿—é€‚é…å›¾ï¼Œè¿›è¡Œç›¸å…³çš„åˆ‡æ¢ï¼›</p><p>slf4j+log4jçš„æ–¹å¼ï¼›</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ‡æ¢ä¸ºlog4j2</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p>é…å¥—è§†é¢‘ï¼š <a href="https://www.bilibili.com/video/av20965295" target="_blank" rel="noopener">å°šç¡…è°·</a> </p>]]></content>
      
      
      <categories>
          
          <category> SrpingBoot </category>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> SrpingBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootå…¥é—¨</title>
      <link href="/2019/12/11/SpringBoot%E5%85%A5%E9%97%A8/"/>
      <url>/2019/12/11/SpringBoot%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Boot-å…¥é—¨"><a href="#Spring-Boot-å…¥é—¨" class="headerlink" title="Spring Boot å…¥é—¨"></a>Spring Boot å…¥é—¨</h1><h2 id="1ã€Spring-Boot-ç®€ä»‹"><a href="#1ã€Spring-Boot-ç®€ä»‹" class="headerlink" title="1ã€Spring Boot ç®€ä»‹"></a>1ã€Spring Boot ç®€ä»‹</h2><blockquote><p>ç®€åŒ–Springåº”ç”¨å¼€å‘çš„ä¸€ä¸ªæ¡†æ¶ï¼›</p><p>æ•´ä¸ªSpringæŠ€æœ¯æ ˆçš„ä¸€ä¸ªå¤§æ•´åˆï¼›</p><p>J2EEå¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼›</p></blockquote><h2 id="2ã€å¾®æœåŠ¡"><a href="#2ã€å¾®æœåŠ¡" class="headerlink" title="2ã€å¾®æœåŠ¡"></a>2ã€å¾®æœåŠ¡</h2><p>2014ï¼Œmartin fowler</p><p>å¾®æœåŠ¡ï¼šæ¶æ„é£æ ¼ï¼ˆæœåŠ¡å¾®åŒ–ï¼‰</p><p>ä¸€ä¸ªåº”ç”¨åº”è¯¥æ˜¯ä¸€ç»„å°å‹æœåŠ¡ï¼›å¯ä»¥é€šè¿‡HTTPçš„æ–¹å¼è¿›è¡Œäº’é€šï¼›</p><p>å•ä½“åº”ç”¨ï¼šALL IN ONE</p><p>å¾®æœåŠ¡ï¼šæ¯ä¸€ä¸ªåŠŸèƒ½å…ƒç´ æœ€ç»ˆéƒ½æ˜¯ä¸€ä¸ªå¯ç‹¬ç«‹æ›¿æ¢å’Œç‹¬ç«‹å‡çº§çš„è½¯ä»¶å•å…ƒï¼›</p><p><a href="https://martinfowler.com/articles/microservices.html#MicroservicesAndSoa" target="_blank" rel="noopener">è¯¦ç»†å‚ç…§å¾®æœåŠ¡æ–‡æ¡£</a></p><h2 id="3ã€ç¯å¢ƒå‡†å¤‡"><a href="#3ã€ç¯å¢ƒå‡†å¤‡" class="headerlink" title="3ã€ç¯å¢ƒå‡†å¤‡"></a>3ã€ç¯å¢ƒå‡†å¤‡</h2><p><a href="http://www.gulixueyuan.com/" target="_blank" rel="noopener">http://www.gulixueyuan.com/</a> è°·ç²’å­¦é™¢</p><p>ç¯å¢ƒçº¦æŸ</p><p>â€“jdk1.8ï¼šSpring Boot æ¨èjdk1.7åŠä»¥ä¸Šï¼›java version â€œ1.8.0_112â€</p><p>â€“maven3.xï¼šmaven 3.3ä»¥ä¸Šç‰ˆæœ¬ï¼›Apache Maven 3.3.9</p><p>â€“IntelliJIDEA2017ï¼šIntelliJ IDEA 2017.2.2 x64ã€STS</p><p>â€“SpringBoot 1.5.9.RELEASEï¼š1.5.9ï¼›</p><p>ç»Ÿä¸€ç¯å¢ƒï¼›</p><h3 id="1ã€MAVENè®¾ç½®ï¼›"><a href="#1ã€MAVENè®¾ç½®ï¼›" class="headerlink" title="1ã€MAVENè®¾ç½®ï¼›"></a>1ã€MAVENè®¾ç½®ï¼›</h3><p>ç»™maven çš„settings.xmlé…ç½®æ–‡ä»¶çš„profilesæ ‡ç­¾æ·»åŠ </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2ã€IDEAè®¾ç½®"><a href="#2ã€IDEAè®¾ç½®" class="headerlink" title="2ã€IDEAè®¾ç½®"></a>2ã€IDEAè®¾ç½®</h3><p>æ•´åˆmavenè¿›æ¥ï¼›</p><p><img src="/Users/chenyawei/Library/Application Support/typora-user-images/image-20191211121007579.png" alt="image-20191211121007579" style="zoom:50%;" /></p><p><img src="/Users/chenyawei/Library/Application Support/typora-user-images/image-20191211121045022.png" alt="image-20191211121045022"></p><h2 id="4ã€Spring-Boot-HelloWorld"><a href="#4ã€Spring-Boot-HelloWorld" class="headerlink" title="4ã€Spring Boot HelloWorld"></a>4ã€Spring Boot HelloWorld</h2><p>ä¸€ä¸ªåŠŸèƒ½ï¼š</p><p>æµè§ˆå™¨å‘é€helloè¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥å—è¯·æ±‚å¹¶å¤„ç†ï¼Œå“åº”Hello Worldå­—ç¬¦ä¸²ï¼›</p><h3 id="1ã€åˆ›å»ºä¸€ä¸ªmavenå·¥ç¨‹ï¼›ï¼ˆjarï¼‰"><a href="#1ã€åˆ›å»ºä¸€ä¸ªmavenå·¥ç¨‹ï¼›ï¼ˆjarï¼‰" class="headerlink" title="1ã€åˆ›å»ºä¸€ä¸ªmavenå·¥ç¨‹ï¼›ï¼ˆjarï¼‰"></a>1ã€åˆ›å»ºä¸€ä¸ªmavenå·¥ç¨‹ï¼›ï¼ˆjarï¼‰</h3><h3 id="2ã€å¯¼å…¥spring-bootç›¸å…³çš„ä¾èµ–"><a href="#2ã€å¯¼å…¥spring-bootç›¸å…³çš„ä¾èµ–" class="headerlink" title="2ã€å¯¼å…¥spring bootç›¸å…³çš„ä¾èµ–"></a>2ã€å¯¼å…¥spring bootç›¸å…³çš„ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3ã€ç¼–å†™ä¸€ä¸ªä¸»ç¨‹åºï¼›å¯åŠ¨Spring-Bootåº”ç”¨"><a href="#3ã€ç¼–å†™ä¸€ä¸ªä¸»ç¨‹åºï¼›å¯åŠ¨Spring-Bootåº”ç”¨" class="headerlink" title="3ã€ç¼–å†™ä¸€ä¸ªä¸»ç¨‹åºï¼›å¯åŠ¨Spring Bootåº”ç”¨"></a>3ã€ç¼–å†™ä¸€ä¸ªä¸»ç¨‹åºï¼›å¯åŠ¨Spring Bootåº”ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@SpringBootApplication</span> æ¥æ ‡æ³¨ä¸€ä¸ªä¸»ç¨‹åºç±»ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªSpring Bootåº”ç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldMainApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Springåº”ç”¨å¯åŠ¨èµ·æ¥</span></span><br><span class="line">        SpringApplication.run(HelloWorldMainApplication<span class="class">.<span class="keyword">class</span>,<span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€ç¼–å†™ç›¸å…³çš„Controllerã€Service"><a href="#4ã€ç¼–å†™ç›¸å…³çš„Controllerã€Service" class="headerlink" title="4ã€ç¼–å†™ç›¸å…³çš„Controllerã€Service"></a>4ã€ç¼–å†™ç›¸å…³çš„Controllerã€Service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello World!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€è¿è¡Œä¸»ç¨‹åºæµ‹è¯•"><a href="#5ã€è¿è¡Œä¸»ç¨‹åºæµ‹è¯•" class="headerlink" title="5ã€è¿è¡Œä¸»ç¨‹åºæµ‹è¯•"></a>5ã€è¿è¡Œä¸»ç¨‹åºæµ‹è¯•</h3><h3 id="6ã€ç®€åŒ–éƒ¨ç½²"><a href="#6ã€ç®€åŒ–éƒ¨ç½²" class="headerlink" title="6ã€ç®€åŒ–éƒ¨ç½²"></a>6ã€ç®€åŒ–éƒ¨ç½²</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- è¿™ä¸ªæ’ä»¶ï¼Œå¯ä»¥å°†åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„jaråŒ…ï¼›--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å°†è¿™ä¸ªåº”ç”¨æ‰“æˆjaråŒ…ï¼Œç›´æ¥ä½¿ç”¨java -jarçš„å‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼›</p><h2 id="5ã€Hello-Worldæ¢ç©¶"><a href="#5ã€Hello-Worldæ¢ç©¶" class="headerlink" title="5ã€Hello Worldæ¢ç©¶"></a>5ã€Hello Worldæ¢ç©¶</h2><h3 id="1ã€POMæ–‡ä»¶"><a href="#1ã€POMæ–‡ä»¶" class="headerlink" title="1ã€POMæ–‡ä»¶"></a>1ã€POMæ–‡ä»¶</h3><h4 id="1ã€çˆ¶é¡¹ç›®"><a href="#1ã€çˆ¶é¡¹ç›®" class="headerlink" title="1ã€çˆ¶é¡¹ç›®"></a>1ã€çˆ¶é¡¹ç›®</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">ä»–çš„çˆ¶é¡¹ç›®æ˜¯</span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../../spring-boot-dependencies<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">ä»–æ¥çœŸæ­£ç®¡ç†Spring Bootåº”ç”¨é‡Œé¢çš„æ‰€æœ‰ä¾èµ–ç‰ˆæœ¬ï¼›</span><br></pre></td></tr></table></figure><p>Spring Bootçš„ç‰ˆæœ¬ä»²è£ä¸­å¿ƒï¼›</p><p>ä»¥åæˆ‘ä»¬å¯¼å…¥ä¾èµ–é»˜è®¤æ˜¯ä¸éœ€è¦å†™ç‰ˆæœ¬ï¼›ï¼ˆæ²¡æœ‰åœ¨dependenciesé‡Œé¢ç®¡ç†çš„ä¾èµ–è‡ªç„¶éœ€è¦å£°æ˜ç‰ˆæœ¬å·ï¼‰</p><h4 id="2ã€å¯åŠ¨å™¨"><a href="#2ã€å¯åŠ¨å™¨" class="headerlink" title="2ã€å¯åŠ¨å™¨"></a>2ã€å¯åŠ¨å™¨</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>spring-boot-starter</strong>-==web==ï¼š</p><p>â€‹    spring-boot-starterï¼šspring-bootåœºæ™¯å¯åŠ¨å™¨ï¼›å¸®æˆ‘ä»¬å¯¼å…¥äº†webæ¨¡å—æ­£å¸¸è¿è¡Œæ‰€ä¾èµ–çš„ç»„ä»¶ï¼›</p><p>Spring Bootå°†æ‰€æœ‰çš„åŠŸèƒ½åœºæ™¯éƒ½æŠ½å–å‡ºæ¥ï¼Œåšæˆä¸€ä¸ªä¸ªçš„startersï¼ˆå¯åŠ¨å™¨ï¼‰ï¼Œåªéœ€è¦åœ¨é¡¹ç›®é‡Œé¢å¼•å…¥è¿™äº›starterç›¸å…³åœºæ™¯çš„æ‰€æœ‰ä¾èµ–éƒ½ä¼šå¯¼å…¥è¿›æ¥ã€‚è¦ç”¨ä»€ä¹ˆåŠŸèƒ½å°±å¯¼å…¥ä»€ä¹ˆåœºæ™¯çš„å¯åŠ¨å™¨</p><h3 id="2ã€ä¸»ç¨‹åºç±»ï¼Œä¸»å…¥å£ç±»"><a href="#2ã€ä¸»ç¨‹åºç±»ï¼Œä¸»å…¥å£ç±»" class="headerlink" title="2ã€ä¸»ç¨‹åºç±»ï¼Œä¸»å…¥å£ç±»"></a>2ã€ä¸»ç¨‹åºç±»ï¼Œä¸»å…¥å£ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@SpringBootApplication</span> æ¥æ ‡æ³¨ä¸€ä¸ªä¸»ç¨‹åºç±»ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªSpring Bootåº”ç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldMainApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Springåº”ç”¨å¯åŠ¨èµ·æ¥</span></span><br><span class="line">        SpringApplication.run(HelloWorldMainApplication<span class="class">.<span class="keyword">class</span>,<span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@<strong>SpringBootApplication</strong>:    Spring Bootåº”ç”¨æ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Šè¯´æ˜è¿™ä¸ªç±»æ˜¯SpringBootçš„ä¸»é…ç½®ç±»ï¼ŒSpringBootå°±åº”è¯¥è¿è¡Œè¿™ä¸ªç±»çš„mainæ–¹æ³•æ¥å¯åŠ¨SpringBootåº”ç”¨ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(excludeFilters = &#123;</span><br><span class="line">      <span class="meta">@Filter</span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter<span class="class">.<span class="keyword">class</span>),</span></span><br><span class="line"><span class="class">      @<span class="title">Filter</span>(<span class="title">type</span> </span>= FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter<span class="class">.<span class="keyword">class</span>) &#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">SpringBootApplication</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>@<strong>SpringBootConfiguration</strong>:Spring Bootçš„é…ç½®ç±»ï¼›</p><p>â€‹        æ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Šï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªSpring Bootçš„é…ç½®ç±»ï¼›</p><p>â€‹        @<strong>Configuration</strong>:é…ç½®ç±»ä¸Šæ¥æ ‡æ³¨è¿™ä¸ªæ³¨è§£ï¼›</p><p>â€‹            é…ç½®ç±» â€”â€”-  é…ç½®æ–‡ä»¶ï¼›é…ç½®ç±»ä¹Ÿæ˜¯å®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼›@Component</p><p>@<strong>EnableAutoConfiguration</strong>ï¼šå¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼›</p><p>â€‹        ä»¥å‰æˆ‘ä»¬éœ€è¦é…ç½®çš„ä¸œè¥¿ï¼ŒSpring Bootå¸®æˆ‘ä»¬è‡ªåŠ¨é…ç½®ï¼›@<strong>EnableAutoConfiguration</strong>å‘Šè¯‰SpringBootå¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼›è¿™æ ·è‡ªåŠ¨é…ç½®æ‰èƒ½ç”Ÿæ•ˆï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import</span>(EnableAutoConfigurationImportSelector<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">EnableAutoConfiguration</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>â€‹          @<strong>AutoConfigurationPackage</strong>ï¼šè‡ªåŠ¨é…ç½®åŒ…</p><p>â€‹        @<strong>Import</strong>(AutoConfigurationPackages.Registrar.class)ï¼š</p><p>â€‹        Springçš„åº•å±‚æ³¨è§£@Importï¼Œç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ä¸ªç»„ä»¶ï¼›å¯¼å…¥çš„ç»„ä»¶ç”±AutoConfigurationPackages.Registrar.classï¼›</p><p>==å°†ä¸»é…ç½®ç±»ï¼ˆ@SpringBootApplicationæ ‡æ³¨çš„ç±»ï¼‰çš„æ‰€åœ¨åŒ…åŠä¸‹é¢æ‰€æœ‰å­åŒ…é‡Œé¢çš„æ‰€æœ‰ç»„ä»¶æ‰«æåˆ°Springå®¹å™¨ï¼›==</p><p>â€‹    @<strong>Import</strong>(EnableAutoConfigurationImportSelector.class)ï¼›</p><p>â€‹        ç»™å®¹å™¨ä¸­å¯¼å…¥ç»„ä»¶ï¼Ÿ</p><p>â€‹        <strong>EnableAutoConfigurationImportSelector</strong>ï¼šå¯¼å…¥å“ªäº›ç»„ä»¶çš„é€‰æ‹©å™¨ï¼›</p><p>â€‹        å°†æ‰€æœ‰éœ€è¦å¯¼å…¥çš„ç»„ä»¶ä»¥å…¨ç±»åçš„æ–¹å¼è¿”å›ï¼›è¿™äº›ç»„ä»¶å°±ä¼šè¢«æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼›</p><p>â€‹        ä¼šç»™å®¹å™¨ä¸­å¯¼å…¥éå¸¸å¤šçš„è‡ªåŠ¨é…ç½®ç±»ï¼ˆxxxAutoConfigurationï¼‰ï¼›å°±æ˜¯ç»™å®¹å™¨ä¸­å¯¼å…¥è¿™ä¸ªåœºæ™¯éœ€è¦çš„æ‰€æœ‰ç»„ä»¶ï¼Œå¹¶é…ç½®å¥½è¿™äº›ç»„ä»¶ï¼›        <img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9snrez2waj30of07zt98.jpg" alt="è‡ªåŠ¨é…ç½®ç±»"></p><p>æœ‰äº†è‡ªåŠ¨é…ç½®ç±»ï¼Œå…å»äº†æˆ‘ä»¬æ‰‹åŠ¨ç¼–å†™é…ç½®æ³¨å…¥åŠŸèƒ½ç»„ä»¶ç­‰çš„å·¥ä½œï¼›</p><p>â€‹        SpringFactoriesLoader.loadFactoryNames(EnableAutoConfiguration.class,classLoader)ï¼›</p><p>==Spring Bootåœ¨å¯åŠ¨çš„æ—¶å€™ä»ç±»è·¯å¾„ä¸‹çš„META-INF/spring.factoriesä¸­è·å–EnableAutoConfigurationæŒ‡å®šçš„å€¼ï¼Œå°†è¿™äº›å€¼ä½œä¸ºè‡ªåŠ¨é…ç½®ç±»å¯¼å…¥åˆ°å®¹å™¨ä¸­ï¼Œè‡ªåŠ¨é…ç½®ç±»å°±ç”Ÿæ•ˆï¼Œå¸®æˆ‘ä»¬è¿›è¡Œè‡ªåŠ¨é…ç½®å·¥ä½œï¼›==ä»¥å‰æˆ‘ä»¬éœ€è¦è‡ªå·±é…ç½®çš„ä¸œè¥¿ï¼Œè‡ªåŠ¨é…ç½®ç±»éƒ½å¸®æˆ‘ä»¬ï¼›</p><p>J2EEçš„æ•´ä½“æ•´åˆè§£å†³æ–¹æ¡ˆå’Œè‡ªåŠ¨é…ç½®éƒ½åœ¨spring-boot-autoconfigure-1.5.9.RELEASE.jarï¼›</p><p>â€‹        </p><p>==Springæ³¨è§£ç‰ˆï¼ˆè°·ç²’å­¦é™¢ï¼‰==</p><h2 id="6ã€ä½¿ç”¨Spring-Initializerå¿«é€Ÿåˆ›å»ºSpring-Booté¡¹ç›®"><a href="#6ã€ä½¿ç”¨Spring-Initializerå¿«é€Ÿåˆ›å»ºSpring-Booté¡¹ç›®" class="headerlink" title="6ã€ä½¿ç”¨Spring Initializerå¿«é€Ÿåˆ›å»ºSpring Booté¡¹ç›®"></a>6ã€ä½¿ç”¨Spring Initializerå¿«é€Ÿåˆ›å»ºSpring Booté¡¹ç›®</h2><h3 id="1ã€IDEAï¼šä½¿ç”¨-Spring-Initializerå¿«é€Ÿåˆ›å»ºé¡¹ç›®"><a href="#1ã€IDEAï¼šä½¿ç”¨-Spring-Initializerå¿«é€Ÿåˆ›å»ºé¡¹ç›®" class="headerlink" title="1ã€IDEAï¼šä½¿ç”¨ Spring Initializerå¿«é€Ÿåˆ›å»ºé¡¹ç›®"></a>1ã€IDEAï¼šä½¿ç”¨ Spring Initializerå¿«é€Ÿåˆ›å»ºé¡¹ç›®</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9rhhya8spj31a50u077h.jpg" alt=""></p><p>IDEéƒ½æ”¯æŒä½¿ç”¨Springçš„é¡¹ç›®åˆ›å»ºå‘å¯¼å¿«é€Ÿåˆ›å»ºä¸€ä¸ªSpring Booté¡¹ç›®ï¼›</p><p>é€‰æ‹©æˆ‘ä»¬éœ€è¦çš„æ¨¡å—ï¼›å‘å¯¼ä¼šè”ç½‘åˆ›å»ºSpring Booté¡¹ç›®ï¼›</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9rhiupyw3j31920u0ae9.jpg" alt=""></p><p>é»˜è®¤ç”Ÿæˆçš„Spring Booté¡¹ç›®ï¼›</p><ul><li>ä¸»ç¨‹åºå·²ç»ç”Ÿæˆå¥½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦æˆ‘ä»¬è‡ªå·±çš„é€»è¾‘</li><li>resourcesæ–‡ä»¶å¤¹ä¸­ç›®å½•ç»“æ„<ul><li>staticï¼šä¿å­˜æ‰€æœ‰çš„é™æ€èµ„æºï¼› js css  imagesï¼›</li><li>templatesï¼šä¿å­˜æ‰€æœ‰çš„æ¨¡æ¿é¡µé¢ï¼›ï¼ˆSpring Booté»˜è®¤jaråŒ…ä½¿ç”¨åµŒå…¥å¼çš„Tomcatï¼Œé»˜è®¤ä¸æ”¯æŒJSPé¡µé¢ï¼‰ï¼›å¯ä»¥ä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼ˆfreemarkerã€thymeleafï¼‰ï¼›</li><li>application.propertiesï¼šSpring Bootåº”ç”¨çš„é…ç½®æ–‡ä»¶ï¼›å¯ä»¥ä¿®æ”¹ä¸€äº›é»˜è®¤è®¾ç½®ï¼›</li></ul></li></ul><h3 id="2ã€STSä½¿ç”¨-Spring-Starter-Projectå¿«é€Ÿåˆ›å»ºé¡¹ç›®"><a href="#2ã€STSä½¿ç”¨-Spring-Starter-Projectå¿«é€Ÿåˆ›å»ºé¡¹ç›®" class="headerlink" title="2ã€STSä½¿ç”¨ Spring Starter Projectå¿«é€Ÿåˆ›å»ºé¡¹ç›®"></a>2ã€STSä½¿ç”¨ Spring Starter Projectå¿«é€Ÿåˆ›å»ºé¡¹ç›®</h3><hr><p>é…å¥—è§†é¢‘ï¼š [å°šç¡…è°·</p>]]></content>
      
      
      <categories>
          
          <category> SrpingBoot </category>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> SrpingBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerçš„ä½¿ç”¨</title>
      <link href="/2019/12/11/Docker%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2019/12/11/Docker%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="1ã€ç®€ä»‹"><a href="#1ã€ç®€ä»‹" class="headerlink" title="1ã€ç®€ä»‹"></a>1ã€ç®€ä»‹</h2><p><strong>Docker</strong>æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼›æ˜¯ä¸€ä¸ªè½»é‡çº§å®¹å™¨æŠ€æœ¯ï¼›</p><p>Dockeræ”¯æŒå°†è½¯ä»¶ç¼–è¯‘æˆä¸€ä¸ªé•œåƒï¼›ç„¶ååœ¨é•œåƒä¸­å„ç§è½¯ä»¶åšå¥½é…ç½®ï¼Œå°†é•œåƒå‘å¸ƒå‡ºå»ï¼Œå…¶ä»–ä½¿ç”¨è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªé•œåƒï¼›</p><p>è¿è¡Œä¸­çš„è¿™ä¸ªé•œåƒç§°ä¸ºå®¹å™¨ï¼Œå®¹å™¨å¯åŠ¨æ˜¯éå¸¸å¿«é€Ÿçš„ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9s4fwtxaqj30a8090mxh.jpg" style="zoom:80%;" /></p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9s4h3k3lpj316q0p6tci.jpg" alt=""></p><h2 id="2ã€æ ¸å¿ƒæ¦‚å¿µ"><a href="#2ã€æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="2ã€æ ¸å¿ƒæ¦‚å¿µ"></a>2ã€æ ¸å¿ƒæ¦‚å¿µ</h2><p>dockerä¸»æœº(Host)ï¼šå®‰è£…äº†Dockerç¨‹åºçš„æœºå™¨ï¼ˆDockerç›´æ¥å®‰è£…åœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šï¼‰ï¼›</p><p>dockerå®¢æˆ·ç«¯(Client)ï¼šè¿æ¥dockerä¸»æœºè¿›è¡Œæ“ä½œï¼›</p><p>dockerä»“åº“(Registry)ï¼šç”¨æ¥ä¿å­˜å„ç§æ‰“åŒ…å¥½çš„è½¯ä»¶é•œåƒï¼›</p><p>dockeré•œåƒ(Images)ï¼šè½¯ä»¶æ‰“åŒ…å¥½çš„é•œåƒï¼›æ”¾åœ¨dockerä»“åº“ä¸­ï¼›</p><p>dockerå®¹å™¨(Container)ï¼šé•œåƒå¯åŠ¨åçš„å®ä¾‹ç§°ä¸ºä¸€ä¸ªå®¹å™¨ï¼›å®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9s4hnf8kzj311k0outce.jpg" alt=""></p><p>ä½¿ç”¨Dockerçš„æ­¥éª¤ï¼š</p><p>1ï¼‰ã€å®‰è£…Docker</p><p>2ï¼‰ã€å»Dockerä»“åº“æ‰¾åˆ°è¿™ä¸ªè½¯ä»¶å¯¹åº”çš„é•œåƒï¼›</p><p>3ï¼‰ã€ä½¿ç”¨Dockerè¿è¡Œè¿™ä¸ªé•œåƒï¼Œè¿™ä¸ªé•œåƒå°±ä¼šç”Ÿæˆä¸€ä¸ªDockerå®¹å™¨ï¼›</p><p>4ï¼‰ã€å¯¹å®¹å™¨çš„å¯åŠ¨åœæ­¢å°±æ˜¯å¯¹è½¯ä»¶çš„å¯åŠ¨åœæ­¢ï¼›</p><h2 id="3ã€å®‰è£…Docker"><a href="#3ã€å®‰è£…Docker" class="headerlink" title="3ã€å®‰è£…Docker"></a>3ã€å®‰è£…Docker</h2><h4 id="1ï¼‰ã€å®‰è£…linuxè™šæ‹Ÿæœº"><a href="#1ï¼‰ã€å®‰è£…linuxè™šæ‹Ÿæœº" class="headerlink" title="1ï¼‰ã€å®‰è£…linuxè™šæ‹Ÿæœº"></a>1ï¼‰ã€å®‰è£…linuxè™šæ‹Ÿæœº</h4><p>â€‹    1ï¼‰ã€VMWareã€VirtualBoxï¼ˆå®‰è£…ï¼‰ï¼›</p><p>â€‹    2ï¼‰ã€å¯¼å…¥è™šæ‹Ÿæœºæ–‡ä»¶centos7-atguigu.ovaï¼›</p><p>â€‹    3ï¼‰ã€åŒå‡»å¯åŠ¨linuxè™šæ‹Ÿæœº;ä½¿ç”¨  root/ 123456ç™»é™†</p><p>â€‹    4ï¼‰ã€ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥linuxæœåŠ¡å™¨è¿›è¡Œå‘½ä»¤æ“ä½œï¼›</p><p>â€‹    5ï¼‰ã€è®¾ç½®è™šæ‹Ÿæœºç½‘ç»œï¼›</p><p>â€‹        æ¡¥æ¥ç½‘ç»œ===é€‰å¥½ç½‘å¡====æ¥å…¥ç½‘çº¿ï¼›</p><p>â€‹    6ï¼‰ã€è®¾ç½®å¥½ç½‘ç»œä»¥åä½¿ç”¨å‘½ä»¤é‡å¯è™šæ‹Ÿæœºçš„ç½‘ç»œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure><p>â€‹    7ï¼‰ã€æŸ¥çœ‹linuxçš„ipåœ°å€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure><p>â€‹    8ï¼‰ã€ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥linuxï¼›</p><h4 id="2ï¼‰ã€åœ¨linuxè™šæ‹Ÿæœºä¸Šå®‰è£…docker"><a href="#2ï¼‰ã€åœ¨linuxè™šæ‹Ÿæœºä¸Šå®‰è£…docker" class="headerlink" title="2ï¼‰ã€åœ¨linuxè™šæ‹Ÿæœºä¸Šå®‰è£…docker"></a>2ï¼‰ã€åœ¨linuxè™šæ‹Ÿæœºä¸Šå®‰è£…docker</h4><p>æ­¥éª¤ï¼šCentOS7 é‡Œé¢çš„å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬ï¼Œå¿…é¡»æ˜¯3.10åŠä»¥ä¸Š</span><br><span class="line">uname -r</span><br><span class="line">2ã€å®‰è£…docker</span><br><span class="line">yum install docker</span><br><span class="line">3ã€è¾“å…¥yç¡®è®¤å®‰è£…</span><br><span class="line">4ã€å¯åŠ¨docker</span><br><span class="line">[root@localhost ~]# systemctl start docker</span><br><span class="line">[root@localhost ~]# docker -v</span><br><span class="line">Docker version 1.12.6, build 3e8e77d/1.12.6</span><br><span class="line">5ã€å¼€æœºå¯åŠ¨docker</span><br><span class="line">[root@localhost ~]# systemctl enable docker</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line">6ã€åœæ­¢docker</span><br><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure><h2 id="4ã€Dockerå¸¸ç”¨å‘½ä»¤-amp-æ“ä½œ"><a href="#4ã€Dockerå¸¸ç”¨å‘½ä»¤-amp-æ“ä½œ" class="headerlink" title="4ã€Dockerå¸¸ç”¨å‘½ä»¤&amp;æ“ä½œ"></a>4ã€Dockerå¸¸ç”¨å‘½ä»¤&amp;æ“ä½œ</h2><h3 id="1ï¼‰ã€é•œåƒæ“ä½œ"><a href="#1ï¼‰ã€é•œåƒæ“ä½œ" class="headerlink" title="1ï¼‰ã€é•œåƒæ“ä½œ"></a>1ï¼‰ã€é•œåƒæ“ä½œ</h3><div class="table-container"><table><thead><tr><th>æ“ä½œ</th><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ£€ç´¢</td><td>docker  search å…³é”®å­—  egï¼šdocker  search redis</td><td>æˆ‘ä»¬ç»å¸¸å»docker  hubä¸Šæ£€ç´¢é•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚é•œåƒçš„TAGã€‚</td></tr><tr><td>æ‹‰å–</td><td>docker pull é•œåƒå:tag</td><td>:tagæ˜¯å¯é€‰çš„ï¼Œtagè¡¨ç¤ºæ ‡ç­¾ï¼Œå¤šä¸ºè½¯ä»¶çš„ç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯latest</td></tr><tr><td>åˆ—è¡¨</td><td>docker images</td><td>æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°é•œåƒ</td></tr><tr><td>åˆ é™¤</td><td>docker rmi image-id</td><td>åˆ é™¤æŒ‡å®šçš„æœ¬åœ°é•œåƒ</td></tr></tbody></table></div><p><a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a></p><h3 id="2ï¼‰ã€å®¹å™¨æ“ä½œ"><a href="#2ï¼‰ã€å®¹å™¨æ“ä½œ" class="headerlink" title="2ï¼‰ã€å®¹å™¨æ“ä½œ"></a>2ï¼‰ã€å®¹å™¨æ“ä½œ</h3><p>è½¯ä»¶é•œåƒï¼ˆQQå®‰è£…ç¨‹åºï¼‰â€”â€”è¿è¡Œé•œåƒâ€”â€”äº§ç”Ÿä¸€ä¸ªå®¹å™¨ï¼ˆæ­£åœ¨è¿è¡Œçš„è½¯ä»¶ï¼Œè¿è¡Œçš„QQï¼‰ï¼›</p><p>æ­¥éª¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1ã€æœç´¢é•œåƒ</span><br><span class="line">[root@localhost ~]# docker search tomcat</span><br><span class="line">2ã€æ‹‰å–é•œåƒ</span><br><span class="line">[root@localhost ~]# docker pull tomcat</span><br><span class="line">3ã€æ ¹æ®é•œåƒå¯åŠ¨å®¹å™¨</span><br><span class="line">docker run --name mytomcat -d tomcat:latest</span><br><span class="line">4ã€docker ps  </span><br><span class="line">æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨</span><br><span class="line">5ã€ åœæ­¢è¿è¡Œä¸­çš„å®¹å™¨</span><br><span class="line">docker stop  å®¹å™¨çš„id</span><br><span class="line">6ã€æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨</span><br><span class="line">docker ps -a</span><br><span class="line">7ã€å¯åŠ¨å®¹å™¨</span><br><span class="line">docker start å®¹å™¨id</span><br><span class="line">8ã€åˆ é™¤ä¸€ä¸ªå®¹å™¨</span><br><span class="line"> docker rm å®¹å™¨id</span><br><span class="line">9ã€å¯åŠ¨ä¸€ä¸ªåšäº†ç«¯å£æ˜ å°„çš„tomcat</span><br><span class="line">[root@localhost ~]# docker run -d -p 8888:8080 tomcat</span><br><span class="line">-dï¼šåå°è¿è¡Œ</span><br><span class="line">-p: å°†ä¸»æœºçš„ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ä¸€ä¸ªç«¯å£    ä¸»æœºç«¯å£:å®¹å™¨å†…éƒ¨çš„ç«¯å£</span><br><span class="line"></span><br><span class="line">10ã€ä¸ºäº†æ¼”ç¤ºç®€å•å…³é—­äº†linuxçš„é˜²ç«å¢™</span><br><span class="line">service firewalld status ï¼›æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</span><br><span class="line">service firewalld stopï¼šå…³é—­é˜²ç«å¢™</span><br><span class="line">11ã€æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—</span><br><span class="line">docker logs container-name/container-id</span><br><span class="line"></span><br><span class="line">æ›´å¤šå‘½ä»¤å‚çœ‹</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/docker/</span><br><span class="line">å¯ä»¥å‚è€ƒæ¯ä¸€ä¸ªé•œåƒçš„æ–‡æ¡£</span><br></pre></td></tr></table></figure><h3 id="3ï¼‰ã€å®‰è£…MySQLç¤ºä¾‹"><a href="#3ï¼‰ã€å®‰è£…MySQLç¤ºä¾‹" class="headerlink" title="3ï¼‰ã€å®‰è£…MySQLç¤ºä¾‹"></a>3ï¼‰ã€å®‰è£…MySQLç¤ºä¾‹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure><p>é”™è¯¯çš„å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run --name mysql01 -d mysql</span><br><span class="line">42f09819908bb72dd99ae19e792e0a5d03c48638421fa64cce5f8ba0f40f5846</span><br><span class="line"></span><br><span class="line">mysqlé€€å‡ºäº†</span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                           PORTS               NAMES</span><br><span class="line">42f09819908b        mysql               "docker-entrypoint.sh"   34 seconds ago      Exited (1) 33 seconds ago                            mysql01</span><br><span class="line">538bde63e500        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       compassionate_</span><br><span class="line">goldstine</span><br><span class="line">c4f1ac60b3fc        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       lonely_fermi</span><br><span class="line">81ec743a5271        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       sick_ramanujan</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//é”™è¯¯æ—¥å¿—</span><br><span class="line">[root@localhost ~]# docker logs 42f09819908b</span><br><span class="line">error: database is uninitialized and password option is not specified </span><br><span class="line">  You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORDï¼›è¿™ä¸ªä¸‰ä¸ªå‚æ•°å¿…é¡»æŒ‡å®šä¸€ä¸ª</span><br></pre></td></tr></table></figure><p>æ­£ç¡®çš„å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">b874c56bec49fb43024b3805ab51e9097da779f2f572c22c695305dedd684c5f</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">b874c56bec49        mysql               "docker-entrypoint.sh"   4 seconds ago       Up 3 seconds        3306/tcp            mysql01</span><br></pre></td></tr></table></figure><p>åšäº†ç«¯å£æ˜ å°„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -p 3306:3306 --name mysql02 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">ad10e4bc5c6a0f61cbad43898de71d366117d120e39db651844c0e73863b9434</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">ad10e4bc5c6a        mysql               "docker-entrypoint.sh"   4 seconds ago       Up 2 seconds        0.0.0.0:3306-&gt;3306/tcp   mysql02</span><br></pre></td></tr></table></figure><p>å‡ ä¸ªå…¶ä»–çš„é«˜çº§æ“ä½œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql03 -v /conf/mysql:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br><span class="line">æŠŠä¸»æœºçš„/conf/mysqlæ–‡ä»¶å¤¹æŒ‚è½½åˆ° mysqldockerå®¹å™¨çš„/etc/mysql/conf.dæ–‡ä»¶å¤¹é‡Œé¢</span><br><span class="line">æ”¹mysqlçš„é…ç½®æ–‡ä»¶å°±åªéœ€è¦æŠŠmysqlé…ç½®æ–‡ä»¶æ”¾åœ¨è‡ªå®šä¹‰çš„æ–‡ä»¶å¤¹ä¸‹ï¼ˆ/conf/mysqlï¼‰</span><br><span class="line"></span><br><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci</span><br><span class="line">æŒ‡å®šmysqlçš„ä¸€äº›é…ç½®å‚æ•°</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> å®¹å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springMVCé…ç½®formæ”¯æŒPUTå’ŒDELETEæ–¹æ³•</title>
      <link href="/2019/12/10/springMVC%E9%85%8D%E7%BD%AEform%E6%94%AF%E6%8C%81PUT%E5%92%8CDELETE%E6%96%B9%E6%B3%95/"/>
      <url>/2019/12/10/springMVC%E9%85%8D%E7%BD%AEform%E6%94%AF%E6%8C%81PUT%E5%92%8CDELETE%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h3 id="1-Spring-é¡¹ç›®ä¸­"><a href="#1-Spring-é¡¹ç›®ä¸­" class="headerlink" title="1. Spring é¡¹ç›®ä¸­"></a>1. Spring é¡¹ç›®ä¸­</h3><p>RESTçš„å…³é”®åŸåˆ™ä¹‹ä¸€å°±æ˜¯â€œä½¿ç”¨æ ‡å‡†æ¥å£â€ï¼ˆthe use of the Uniform Interfaceï¼‰ï¼Œä¹Ÿå°±æ˜¯æå€¡æ ¹æ®ä¸åŒçš„è¯­ä¹‰ä½¿ç”¨GET, PUT, POSTå’ŒDELETEæ–¹æ³•ï¼Œè€Œhtmlçš„formæ ‡ç­¾åªæ”¯æŒä¸¤ç§æäº¤æ–¹æ³•ï¼šPOSTå’ŒGETï¼Œæ‰€ä»¥ï¼Œä¸ºäº†ä½¿ç”¨PUTå’ŒDELETEæ–¹æ³•ï¼Œå¯ä»¥åœ¨web.xmlä¸­é…ç½®ä¸€ä¸ªè¿‡æ»¤å™¨ï¼š</p><p>åœ¨SpringMVCä¸­é…ç½®HiddenHttpMethodFilter</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>httpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>httpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>petclinic<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å€¼å¾—ä¸€æçš„æ˜¯ï¼šè¿™ä¸ªè¿‡æ»¤å™¨æ˜¯ä¸€ä¸ªæ™®é€šçš„è¿‡æ»¤å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯ä»¥å’Œä»»ä½•Javaæ¡†æ¶ä¸€èµ·ä½¿ç”¨ï¼Œè€Œä¸ä»…ä»…æ˜¯Spring MVC</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯springæä¾›çš„formæ ‡ç­¾ï¼Œé‚£ä¹ˆåƒä¸‹é¢è¿™æ ·å†™å°±å¥½äº†ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form:form</span> <span class="attr">method</span>=<span class="string">"delete"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"submit"</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Delete Pet"</span>/&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form:form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ™®é€šçš„htmlæ ‡ç­¾ï¼Œæˆ–è€…å…¶å®ƒæ ‡ç­¾ï¼Œé‚£ä¹ˆè¦å°†methodå€¼è®¾ç½®ä¸ºPOSTï¼Œç„¶åå†formé‡Œæ·»åŠ ä¸€ä¸ª_methodéšè—åŸŸï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"_method"</span> <span class="attr">value</span>=<span class="string">"delete"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"submit"</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Delete Pet"</span>/&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-springBoot-é¡¹ç›®ä¸­"><a href="#2-springBoot-é¡¹ç›®ä¸­" class="headerlink" title="2.springBoot é¡¹ç›®ä¸­"></a>2.springBoot é¡¹ç›®ä¸­</h3><p>SpringBootè‡ªåŠ¨é…ç½®å¥½çš„ï¼Œå¦‚ä¸‹è‡ªåŠ¨é…ç½®WebMvcAutoConfigurationç±»ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123;Servlet<span class="class">.<span class="keyword">class</span>, <span class="title">DispatcherServlet</span>.<span class="title">class</span>, <span class="title">WebMvcConfigurerAdapter</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnMissingBean</span>(</span>&#123;WebMvcConfigurationSupport<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureOrder</span>(-2147483638)</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureAfter</span>(</span>&#123;DispatcherServletAutoConfiguration<span class="class">.<span class="keyword">class</span>, <span class="title">ValidationAutoConfiguration</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">WebMvcAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WebMvcAutoConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//SpringBootå·²ç»æŠŠHiddenHttpMethodFilteræ”¾åˆ°å®¹å™¨é‡Œäº†</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span>(&#123;HiddenHttpMethodFilter<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">OrderedHiddenHttpMethodFilter</span> <span class="title">hiddenHttpMethodFilter</span>() </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OrderedHiddenHttpMethodFilter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>åœ¨é¡µé¢ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--éœ€è¦åŒºåˆ†æ˜¯å‘˜å·¥ä¿®æ”¹è¿˜æ˜¯æ·»åŠ ï¼›--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">"@&#123;/emp&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å‘é€putè¯·æ±‚ä¿®æ”¹å‘˜å·¥æ•°æ®--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        htmlçš„formæ ‡ç­¾åªæ”¯æŒä¸¤ç§æäº¤æ–¹æ³•ï¼šPOSTå’ŒGETï¼Œæ‰€ä»¥ï¼Œä¸ºäº†ä½¿ç”¨PUTå’ŒDELETEæ–¹æ³•</span></span><br><span class="line"><span class="comment">        1ã€SpringMVCä¸­é…ç½®HiddenHttpMethodFilter;ï¼ˆSpringBootè‡ªåŠ¨é…ç½®å¥½çš„ï¼‰</span></span><br><span class="line"><span class="comment">        2ã€é¡µé¢åˆ›å»ºä¸€ä¸ªpostè¡¨å•</span></span><br><span class="line"><span class="comment">        3ã€åˆ›å»ºä¸€ä¸ªinputé¡¹ï¼Œname="_method";å€¼å°±æ˜¯æˆ‘ä»¬æŒ‡å®šçš„è¯·æ±‚æ–¹å¼</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"_method"</span> <span class="attr">value</span>=<span class="string">"put"</span> <span class="attr">th:if</span>=<span class="string">"$&#123;emp!=null&#125;"</span>/&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">th:if</span>=<span class="string">"$&#123;emp!=null&#125;"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;emp.id&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>LastName<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;emp.lastName&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan@atguigu.com"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;emp.email&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Gender<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"1"</span> <span class="attr">th:checked</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;emp.gender==1&#125;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>ç”·<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"0"</span> <span class="attr">th:checked</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;emp.gender==0&#125;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>å¥³<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>department<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æäº¤çš„æ˜¯éƒ¨é—¨çš„id--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">name</span>=<span class="string">"department.id"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">th:selected</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;dept.id == emp.department.id&#125;"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;dept.id&#125;"</span> <span class="attr">th:each</span>=<span class="string">"dept:$&#123;depts&#125;"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;dept.departmentName&#125;"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Birth<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"birth"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span> <span class="attr">th:value</span>=<span class="string">"$&#123;emp!=null&#125;?$&#123;#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;emp!=null&#125;?'ä¿®æ”¹':'æ·»åŠ '"</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
          <category> java </category>
          
          <category> æ“ä½œè®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œè®°å½• </tag>
            
            <tag> java </tag>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaæ³›å‹</title>
      <link href="/2019/12/09/java%E6%B3%9B%E5%9E%8B/"/>
      <url>/2019/12/09/java%E6%B3%9B%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€-ã€æå‡ºèƒŒæ™¯"><a href="#ä¸€-ã€æå‡ºèƒŒæ™¯" class="headerlink" title="ä¸€.ã€æå‡ºèƒŒæ™¯"></a>ä¸€.ã€æå‡ºèƒŒæ™¯</h2><p>æ³›å‹åœ¨javaä¸­æœ‰å¾ˆé‡è¦çš„åœ°ä½ï¼Œåœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹åŠå„ç§è®¾è®¡æ¨¡å¼ä¸­æœ‰éå¸¸å¹¿æ³›çš„åº”ç”¨ã€‚</p><p>åœ¨<a href="https://baike.baidu.com/item/Java SE/4662159" target="_blank" rel="noopener">Java SE</a> 1.5ä¹‹å‰ï¼Œæ²¡æœ‰æ³›å‹ï¼ˆGenericsï¼‰çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å¯¹ç±»å‹Objectçš„å¼•ç”¨æ¥å®ç°å‚æ•°çš„â€œä»»æ„åŒ–â€ï¼Œâ€œä»»æ„åŒ–â€å¸¦æ¥çš„ç¼ºç‚¹æ˜¯è¦ä½œæ˜¾å¼çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œè€Œè¿™ç§è½¬æ¢æ˜¯è¦æ±‚å¼€å‘è€…å¯¹å®é™…å‚æ•°ç±»å‹å¯ä»¥åœ¨é¢„çŸ¥çš„æƒ…å†µä¸‹è¿›è¡Œçš„ã€‚å¯¹äºå¼ºåˆ¶ç±»å‹è½¬æ¢é”™è¯¯çš„æƒ…å†µï¼Œ<a href="https://baike.baidu.com/item/ç¼–è¯‘å™¨/8853067" target="_blank" rel="noopener">ç¼–è¯‘å™¨</a>å¯èƒ½ä¸æç¤ºé”™è¯¯ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™æ‰å‡ºç°å¼‚å¸¸ï¼Œè¿™æ˜¯ä¸€ä¸ªå®‰å…¨éšæ‚£ã€‚</p><p>SE1.5ä¸­å¼•å…¥çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œå…¶æœ¬è´¨æ˜¯å‚æ•°åŒ–ç±»å‹ã€‚å‚æ•°ç±»å‹å¯ä»¥ç”¨åœ¨<a href="https://baike.baidu.com/item/ç±»/6824577" target="_blank" rel="noopener">ç±»</a>ã€<a href="https://baike.baidu.com/item/æ¥å£/15422203" target="_blank" rel="noopener">æ¥å£</a>å’Œæ–¹æ³•çš„åˆ›å»ºä¸­ï¼Œåˆ†åˆ«ç§°ä¸ºæ³›å‹ç±»ã€æ³›å‹æ¥å£ã€æ³›å‹æ–¹æ³•ã€‚Javaå…è®¸ç¨‹åºå‘˜æ„å»ºä¸€ä¸ªå…ƒç´ ç±»å‹ä¸ºObjectçš„Collectionï¼Œå…¶ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ã€‚</p><blockquote><p>å‡å®šæˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼šå†™ä¸€ä¸ªæ’åºæ–¹æ³•ï¼Œèƒ½å¤Ÿå¯¹æ•´å‹æ•°ç»„ã€å­—ç¬¦ä¸²æ•°ç»„ç”šè‡³å…¶ä»–ä»»ä½•ç±»å‹çš„æ•°ç»„è¿›è¡Œæ’åºï¼Œè¯¥å¦‚ä½•å®ç°ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯å¯ä»¥ä½¿ç”¨ <strong>Java æ³›å‹</strong>ã€‚ä½¿ç”¨ Java æ³›å‹çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªæ³›å‹æ–¹æ³•æ¥å¯¹ä¸€ä¸ªå¯¹è±¡æ•°ç»„æ’åºã€‚ç„¶åï¼Œè°ƒç”¨è¯¥æ³›å‹æ–¹æ³•æ¥å¯¹æ•´å‹æ•°ç»„ã€æµ®ç‚¹æ•°æ•°ç»„ã€å­—ç¬¦ä¸²æ•°ç»„ç­‰è¿›è¡Œæ’åºã€‚</p><p>æ³›å‹ï¼Œå³â€œå‚æ•°åŒ–ç±»å‹â€ã€‚ä¸€æåˆ°å‚æ•°ï¼Œæœ€ç†Ÿæ‚‰çš„å°±æ˜¯å®šä¹‰æ–¹æ³•æ—¶æœ‰å½¢å‚ï¼Œç„¶åè°ƒç”¨æ­¤æ–¹æ³•æ—¶ä¼ é€’å®å‚ã€‚é‚£ä¹ˆå‚æ•°åŒ–ç±»å‹æ€ä¹ˆç†è§£å‘¢ï¼Ÿé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†ç±»å‹ç”±åŸæ¥çš„å…·ä½“çš„ç±»å‹å‚æ•°åŒ–ï¼Œç±»ä¼¼äºæ–¹æ³•ä¸­çš„å˜é‡å‚æ•°ï¼Œæ­¤æ—¶ç±»å‹ä¹Ÿå®šä¹‰æˆå‚æ•°å½¢å¼ï¼ˆå¯ä»¥ç§°ä¹‹ä¸ºç±»å‹å½¢å‚ï¼‰ï¼Œç„¶ååœ¨ä½¿ç”¨/è°ƒç”¨æ—¶ä¼ å…¥å…·ä½“çš„ç±»å‹ï¼ˆç±»å‹å®å‚ï¼‰ã€‚</p><p>æ³›å‹çš„æœ¬è´¨æ˜¯ä¸ºäº†å‚æ•°åŒ–ç±»å‹ï¼ˆåœ¨ä¸åˆ›å»ºæ–°çš„ç±»å‹çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡æ³›å‹æŒ‡å®šçš„ä¸åŒç±»å‹æ¥æ§åˆ¶å½¢å‚å…·ä½“é™åˆ¶çš„ç±»å‹ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æ³›å‹ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæ“ä½œçš„æ•°æ®ç±»å‹è¢«æŒ‡å®šä¸ºä¸€ä¸ªå‚æ•°ï¼Œè¿™ç§å‚æ•°ç±»å‹å¯ä»¥ç”¨åœ¨ç±»ã€æ¥å£å’Œæ–¹æ³•ä¸­ï¼Œåˆ†åˆ«è¢«ç§°ä¸ºæ³›å‹ç±»ã€æ³›å‹æ¥å£ã€æ³›å‹æ–¹æ³•ã€‚</p></blockquote><p>ä¸ä½¿ç”¨æ³›å‹å¼ï¼Œå®¹æ˜“å¼•èµ·çš„è¿è¡Œæ—¶é”™è¯¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List arrayList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">arrayList.add(<span class="string">"aaaa"</span>);</span><br><span class="line">arrayList.add(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt; arrayList.size();i++)&#123;</span><br><span class="line">    String item = (String)arrayList.get(i);</span><br><span class="line">    Log.d(<span class="string">"æ³›å‹æµ‹è¯•"</span>,<span class="string">"item = "</span> + item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯«æ— ç–‘é—®ï¼Œç¨‹åºçš„è¿è¡Œç»“æœä¼šä»¥å´©æºƒç»“æŸï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.ClassCastException: java.lang.Integer cannot be cast to java.lang.String</span><br></pre></td></tr></table></figure><p>ArrayListå¯ä»¥å­˜æ”¾ä»»æ„ç±»å‹ï¼Œä¾‹å­ä¸­æ·»åŠ äº†ä¸€ä¸ªStringç±»å‹ï¼Œæ·»åŠ äº†ä¸€ä¸ªIntegerç±»å‹ï¼Œå†ä½¿ç”¨æ—¶éƒ½ä»¥Stringçš„æ–¹å¼ä½¿ç”¨ï¼Œå› æ­¤ç¨‹åºå´©æºƒäº†ã€‚ä¸ºäº†è§£å†³ç±»ä¼¼è¿™æ ·çš„é—®é¢˜ï¼ˆåœ¨ç¼–è¯‘é˜¶æ®µå°±å¯ä»¥è§£å†³ï¼‰ï¼Œæ³›å‹åº”è¿è€Œç”Ÿã€‚</p><p>æˆ‘ä»¬å°†ç¬¬ä¸€è¡Œå£°æ˜åˆå§‹åŒ–listçš„ä»£ç æ›´æ”¹ä¸€ä¸‹ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘é˜¶æ®µå°±èƒ½å¤Ÿå¸®æˆ‘ä»¬å‘ç°ç±»ä¼¼è¿™æ ·çš„é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; arrayList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">...</span><br><span class="line"><span class="comment">//arrayList.add(100); åœ¨ç¼–è¯‘é˜¶æ®µï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ã€‚é¿å…äº†è¿è¡Œæ—¶é”™è¯¯</span></span><br></pre></td></tr></table></figure><h2 id="äºŒã€æ³›å‹ç±»"><a href="#äºŒã€æ³›å‹ç±»" class="headerlink" title="äºŒã€æ³›å‹ç±»"></a>äºŒã€æ³›å‹ç±»</h2><p>æ³›å‹ç±»å‹ç”¨äºç±»çš„å®šä¹‰ä¸­ï¼Œè¢«ç§°ä¸ºæ³›å‹ç±»ã€‚é€šè¿‡æ³›å‹å¯ä»¥å®Œæˆå¯¹ä¸€ç»„ç±»çš„æ“ä½œå¯¹å¤–å¼€æ”¾ç›¸åŒçš„æ¥å£ã€‚æœ€å…¸å‹çš„å°±æ˜¯å„ç§å®¹å™¨ç±»ï¼Œå¦‚ï¼šListã€Setã€Mapã€‚åœ¨ç±»ååé¢æ·»åŠ äº†ç±»å‹å‚æ•°å£°æ˜éƒ¨åˆ†ã€‚</p><p>å’Œæ³›å‹æ–¹æ³•ä¸€æ ·ï¼Œæ³›å‹ç±»çš„ç±»å‹å‚æ•°å£°æ˜éƒ¨åˆ†ä¹ŸåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹å‚æ•°ï¼Œå‚æ•°é—´ç”¨é€—å·éš”å¼€ã€‚ä¸€ä¸ªæ³›å‹å‚æ•°ï¼Œä¹Ÿè¢«ç§°ä¸ºä¸€ä¸ªç±»å‹å˜é‡ï¼Œæ˜¯ç”¨äºæŒ‡å®šä¸€ä¸ªæ³›å‹ç±»å‹åç§°çš„æ ‡è¯†ç¬¦ã€‚å› ä¸ºä»–ä»¬æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œè¿™äº›ç±»è¢«ç§°ä¸ºå‚æ•°åŒ–çš„ç±»æˆ–å‚æ•°åŒ–çš„ç±»å‹ã€‚</p><p>å¦‚ä¸‹å®ä¾‹æ¼”ç¤ºäº†æˆ‘ä»¬å¦‚ä½•å®šä¹‰ä¸€ä¸ªæ³›å‹ç±»:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Box</span>&lt;<span class="title">T</span>&gt; </span>&#123;  </span><br><span class="line">  <span class="keyword">private</span> T t;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.t = t;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Box&lt;Integer&gt; integerBox = <span class="keyword">new</span> Box&lt;Integer&gt;();</span><br><span class="line">    Box&lt;String&gt; stringBox = <span class="keyword">new</span> Box&lt;String&gt;();</span><br><span class="line"> </span><br><span class="line">    integerBox.add(<span class="keyword">new</span> Integer(<span class="number">10</span>));</span><br><span class="line">    stringBox.add(<span class="keyword">new</span> String(<span class="string">"èœé¸Ÿæ•™ç¨‹"</span>));</span><br><span class="line"> </span><br><span class="line">    System.out.printf(<span class="string">"æ•´å‹å€¼ä¸º :%d\n\n"</span>, integerBox.get());</span><br><span class="line">    System.out.printf(<span class="string">"å­—ç¬¦ä¸²ä¸º :%s\n"</span>, stringBox.get());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">æ•´å‹å€¼ä¸º :<span class="number">10</span></span><br><span class="line">å­—ç¬¦ä¸²ä¸º :èœé¸Ÿæ•™ç¨‹</span><br></pre></td></tr></table></figure><p>å®šä¹‰çš„æ³›å‹ç±»ï¼Œå°±ä¸€å®šè¦ä¼ å…¥æ³›å‹ç±»å‹å®å‚ä¹ˆï¼Ÿå¹¶ä¸æ˜¯è¿™æ ·ï¼Œåœ¨ä½¿ç”¨æ³›å‹çš„æ—¶å€™å¦‚æœä¼ å…¥æ³›å‹å®å‚ï¼Œåˆ™ä¼šæ ¹æ®ä¼ å…¥çš„æ³›å‹å®å‚åšç›¸åº”çš„é™åˆ¶ï¼Œæ­¤æ—¶æ³›å‹æ‰ä¼šèµ·åˆ°æœ¬åº”èµ·åˆ°çš„é™åˆ¶ä½œç”¨ã€‚å¦‚æœä¸ä¼ å…¥æ³›å‹ç±»å‹å®å‚çš„è¯ï¼Œåœ¨æ³›å‹ç±»ä¸­ä½¿ç”¨æ³›å‹çš„æ–¹æ³•æˆ–æˆå‘˜å˜é‡å®šä¹‰çš„ç±»å‹å¯ä»¥ä¸ºä»»ä½•çš„ç±»å‹ã€‚çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Generic generic = <span class="keyword">new</span> Generic(<span class="string">"111111"</span>);</span><br><span class="line">Generic generic1 = <span class="keyword">new</span> Generic(<span class="number">4444</span>);</span><br><span class="line">Generic generic2 = <span class="keyword">new</span> Generic(<span class="number">55.55</span>);</span><br><span class="line">Generic generic3 = <span class="keyword">new</span> Generic(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">Log.d(<span class="string">"æ³›å‹æµ‹è¯•"</span>,<span class="string">"key is "</span> + generic.getKey());</span><br><span class="line">Log.d(<span class="string">"æ³›å‹æµ‹è¯•"</span>,<span class="string">"key is "</span> + generic1.getKey());</span><br><span class="line">Log.d(<span class="string">"æ³›å‹æµ‹è¯•"</span>,<span class="string">"key is "</span> + generic2.getKey());</span><br><span class="line">Log.d(<span class="string">"æ³›å‹æµ‹è¯•"</span>,<span class="string">"key is "</span> + generic3.getKey());</span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">D/æ³›å‹æµ‹è¯•: key is <span class="number">111111</span></span><br><span class="line">D/æ³›å‹æµ‹è¯•: key is <span class="number">4444</span></span><br><span class="line">D/æ³›å‹æµ‹è¯•: key is <span class="number">55.55</span></span><br><span class="line">D/æ³›å‹æµ‹è¯•: key is <span class="keyword">false</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š</p><ul><li><ol><li>æ³›å‹çš„ç±»å‹å‚æ•°åªèƒ½æ˜¯ç±»ç±»å‹ï¼Œä¸èƒ½æ˜¯ç®€å•ç±»å‹ã€‚å³ç±»å‹å‚æ•°å¿…é¡»ä¸ºå¼•ç”¨ç±»å‹ï¼Œä¸èƒ½æ˜¯åŸºæœ¬ç±»å‹ã€‚</li></ol></li><li><ol><li><p>ä¸èƒ½å¯¹ç¡®åˆ‡çš„æ³›å‹ç±»å‹ä½¿ç”¨instanceofæ“ä½œã€‚å¦‚ä¸‹é¢çš„æ“ä½œæ˜¯éæ³•çš„ï¼Œç¼–è¯‘æ—¶ä¼šå‡ºé”™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(ex_num <span class="keyword">instanceof</span> Generic&lt;Number&gt;)&#123;   </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>ã€€ã€€instanceof ä¸¥æ ¼æ¥è¯´æ˜¯Javaä¸­çš„ä¸€ä¸ªåŒç›®è¿ç®—ç¬¦ï¼Œç”¨æ¥æµ‹è¯•ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œç”¨æ³•ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span>` `result = obj ``<span class="keyword">instanceof</span>` `Class</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ obj ä¸ºä¸€ä¸ªå¯¹è±¡ï¼ŒClass è¡¨ç¤ºä¸€ä¸ªç±»æˆ–è€…ä¸€ä¸ªæ¥å£ï¼Œå½“ obj ä¸º Class çš„å¯¹è±¡ï¼Œæˆ–è€…æ˜¯å…¶ç›´æ¥æˆ–é—´æ¥å­ç±»ï¼Œæˆ–è€…æ˜¯å…¶æ¥å£çš„å®ç°ç±»ï¼Œç»“æœresult éƒ½è¿”å› trueï¼Œå¦åˆ™è¿”å›falseã€‚</p><p>ã€€ã€€æ³¨æ„ï¼šç¼–è¯‘å™¨ä¼šæ£€æŸ¥ obj æ˜¯å¦èƒ½è½¬æ¢æˆå³è¾¹çš„classç±»å‹ï¼Œå¦‚æœä¸èƒ½è½¬æ¢åˆ™ç›´æ¥æŠ¥é”™ï¼Œå¦‚æœä¸èƒ½ç¡®å®šç±»å‹ï¼Œåˆ™é€šè¿‡ç¼–è¯‘ï¼Œå…·ä½“çœ‹è¿è¡Œæ—¶å®šã€‚ã€€ã€€</p></blockquote></li></ol></li></ul></blockquote><h2 id="å››ã€æ³›å‹æ¥å£"><a href="#å››ã€æ³›å‹æ¥å£" class="headerlink" title="å››ã€æ³›å‹æ¥å£"></a>å››ã€æ³›å‹æ¥å£</h2><p>æ³›å‹æ¥å£ä¸æ³›å‹ç±»çš„å®šä¹‰åŠä½¿ç”¨åŸºæœ¬ç›¸åŒã€‚æ³›å‹æ¥å£å¸¸è¢«ç”¨åœ¨å„ç§ç±»çš„ç”Ÿäº§å™¨ä¸­ï¼Œå¯ä»¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªæ³›å‹æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Generator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å®ç°æ³›å‹æ¥å£çš„ç±»ï¼Œæœªä¼ å…¥æ³›å‹å®å‚æ—¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æœªä¼ å…¥æ³›å‹å®å‚æ—¶ï¼Œä¸æ³›å‹ç±»çš„å®šä¹‰ç›¸åŒï¼Œåœ¨å£°æ˜ç±»çš„æ—¶å€™ï¼Œéœ€å°†æ³›å‹çš„å£°æ˜ä¹Ÿä¸€èµ·åŠ åˆ°ç±»ä¸­</span></span><br><span class="line"><span class="comment"> * å³ï¼šclass FruitGenerator&lt;T&gt; implements Generator&lt;T&gt;&#123;</span></span><br><span class="line"><span class="comment"> * å¦‚æœä¸å£°æ˜æ³›å‹ï¼Œå¦‚ï¼šclass FruitGenerator implements Generator&lt;T&gt;ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼š"Unknown class"</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FruitGenerator</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å®ç°æ³›å‹æ¥å£çš„ç±»ï¼Œä¼ å…¥æ³›å‹å®å‚æ—¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¼ å…¥æ³›å‹å®å‚æ—¶ï¼š</span></span><br><span class="line"><span class="comment"> * å®šä¹‰ä¸€ä¸ªç”Ÿäº§å™¨å®ç°è¿™ä¸ªæ¥å£,è™½ç„¶æˆ‘ä»¬åªåˆ›å»ºäº†ä¸€ä¸ªæ³›å‹æ¥å£Generator&lt;T&gt;</span></span><br><span class="line"><span class="comment"> * ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¸ºTä¼ å…¥æ— æ•°ä¸ªå®å‚ï¼Œå½¢æˆæ— æ•°ç§ç±»å‹çš„Generatoræ¥å£ã€‚</span></span><br><span class="line"><span class="comment"> * åœ¨å®ç°ç±»å®ç°æ³›å‹æ¥å£æ—¶ï¼Œå¦‚å·²å°†æ³›å‹ç±»å‹ä¼ å…¥å®å‚ç±»å‹ï¼Œåˆ™æ‰€æœ‰ä½¿ç”¨æ³›å‹çš„åœ°æ–¹éƒ½è¦æ›¿æ¢æˆä¼ å…¥çš„å®å‚ç±»å‹</span></span><br><span class="line"><span class="comment"> * å³ï¼šGenerator&lt;T&gt;ï¼Œpublic T next();ä¸­çš„çš„Téƒ½è¦æ›¿æ¢æˆä¼ å…¥çš„Stringç±»å‹ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitGenerator</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String[] fruits = <span class="keyword">new</span> String[]&#123;<span class="string">"Apple"</span>, <span class="string">"Banana"</span>, <span class="string">"Pear"</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">return</span> fruits[rand.nextInt(<span class="number">3</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€æ³›å‹é€šé…ç¬¦"><a href="#ä¸‰ã€æ³›å‹é€šé…ç¬¦" class="headerlink" title="ä¸‰ã€æ³›å‹é€šé…ç¬¦"></a>ä¸‰ã€æ³›å‹é€šé…ç¬¦</h2><p>1ã€ç±»å‹é€šé…ç¬¦ä¸€èˆ¬æ˜¯ä½¿ç”¨<strong>?</strong>ä»£æ›¿å…·ä½“çš„ç±»å‹å‚æ•°ã€‚</p><p>æˆ‘ä»¬çŸ¥é“Ingeteræ˜¯Numberçš„ä¸€ä¸ªå­ç±»ï¼ŒåŒæ—¶åœ¨ç‰¹æ€§ç« èŠ‚ä¸­æˆ‘ä»¬ä¹ŸéªŒè¯è¿‡Generic<Ingeter>ä¸Generic<Number>å®é™…ä¸Šæ˜¯ç›¸åŒçš„ä¸€ç§åŸºæœ¬ç±»å‹ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œåœ¨ä½¿ç”¨Generic<Number>ä½œä¸ºå½¢å‚çš„æ–¹æ³•ä¸­ï¼Œèƒ½å¦ä½¿ç”¨Generic<Ingeter>çš„å®ä¾‹ä¼ å…¥å‘¢ï¼Ÿåœ¨é€»è¾‘ä¸Šç±»ä¼¼äºGeneric<Number>å’ŒGeneric<Ingeter>æ˜¯å¦å¯ä»¥çœ‹æˆå…·æœ‰çˆ¶å­å…³ç³»çš„æ³›å‹ç±»å‹å‘¢ï¼Ÿ</p><p>ä¸ºäº†å¼„æ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>Generic</code>è¿™ä¸ªæ³›å‹ç±»ç»§ç»­çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showKeyValue</span><span class="params">(Generic&lt;Number&gt; obj)</span></span>&#123;</span><br><span class="line">    Log.d(<span class="string">"æ³›å‹æµ‹è¯•"</span>,<span class="string">"key value is "</span> + obj.getKey());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Generic&lt;Integer&gt; gInteger = <span class="keyword">new</span> Generic&lt;Integer&gt;(<span class="number">123</span>);</span><br><span class="line">Generic&lt;Number&gt; gNumber = <span class="keyword">new</span> Generic&lt;Number&gt;(<span class="number">456</span>);</span><br><span class="line"></span><br><span class="line">showKeyValue(gNumber);</span><br><span class="line"></span><br><span class="line"><span class="comment">// showKeyValueè¿™ä¸ªæ–¹æ³•ç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬æŠ¥é”™ï¼šGeneric&lt;java.lang.Integer&gt; </span></span><br><span class="line"><span class="comment">// cannot be applied to Generic&lt;java.lang.Number&gt;</span></span><br><span class="line"><span class="comment">// showKeyValue(gInteger);</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡æç¤ºä¿¡æ¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Generic<Integer>ä¸èƒ½è¢«çœ‹ä½œä¸º`Generic<Number>çš„å­ç±»ã€‚ç”±æ­¤å¯ä»¥çœ‹å‡º:åŒä¸€ç§æ³›å‹å¯ä»¥å¯¹åº”å¤šä¸ªç‰ˆæœ¬ï¼ˆå› ä¸ºå‚æ•°ç±»å‹æ˜¯ä¸ç¡®å®šçš„ï¼‰ï¼Œä¸åŒç‰ˆæœ¬çš„æ³›å‹ç±»å®ä¾‹æ˜¯ä¸å…¼å®¹çš„ã€‚</p><p>å›åˆ°ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚ä½•è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Ÿæ€»ä¸èƒ½ä¸ºäº†å®šä¹‰ä¸€ä¸ªæ–°çš„æ–¹æ³•æ¥å¤„ç†Generic<Integer>ç±»å‹çš„ç±»ï¼Œè¿™æ˜¾ç„¶ä¸javaä¸­çš„å¤šå°ç†å¿µç›¸è¿èƒŒã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåœ¨é€»è¾‘ä¸Šå¯ä»¥è¡¨ç¤ºåŒæ—¶æ˜¯Generic<Integer>å’ŒGeneric<Number>çˆ¶ç±»çš„å¼•ç”¨ç±»å‹ã€‚ç”±æ­¤ç±»å‹é€šé…ç¬¦åº”è¿è€Œç”Ÿã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„æ–¹æ³•æ”¹ä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showKeyValue1</span><span class="params">(Generic&lt;?&gt; obj)</span></span>&#123;</span><br><span class="line">    Log.d(<span class="string">"æ³›å‹æµ‹è¯•"</span>,<span class="string">"key value is "</span> + obj.getKey());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç±»å‹é€šé…ç¬¦ä¸€èˆ¬æ˜¯ä½¿ç”¨ï¼Ÿä»£æ›¿å…·ä½“çš„ç±»å‹å®å‚ï¼Œæ³¨æ„äº†ï¼Œæ­¤å¤„â€™ï¼Ÿâ€™æ˜¯ç±»å‹å®å‚ï¼Œè€Œä¸æ˜¯ç±»å‹å½¢å‚ ã€‚é‡è¦è¯´ä¸‰éï¼æ­¤å¤„â€™ï¼Ÿâ€™æ˜¯ç±»å‹å®å‚ï¼Œè€Œä¸æ˜¯ç±»å‹å½¢å‚ ï¼ æ­¤å¤„â€™ï¼Ÿâ€™æ˜¯ç±»å‹å®å‚ï¼Œè€Œä¸æ˜¯ç±»å‹å½¢å‚ ï¼å†ç›´ç™½ç‚¹çš„æ„æ€å°±æ˜¯ï¼Œæ­¤å¤„çš„ï¼Ÿå’ŒNumberã€Stringã€Integerä¸€æ ·éƒ½æ˜¯ä¸€ç§å®é™…çš„ç±»å‹ï¼Œå¯ä»¥æŠŠï¼Ÿçœ‹æˆæ‰€æœ‰ç±»å‹çš„çˆ¶ç±»ã€‚æ˜¯ä¸€ç§çœŸå®çš„ç±»å‹ã€‚å¯ä»¥è§£å†³å½“å…·ä½“ç±»å‹ä¸ç¡®å®šçš„æ—¶å€™ï¼Œè¿™ä¸ªé€šé…ç¬¦å°±æ˜¯ ?  ï¼›å½“æ“ä½œç±»å‹æ—¶ï¼Œä¸éœ€è¦ä½¿ç”¨ç±»å‹çš„å…·ä½“åŠŸèƒ½æ—¶ï¼Œåªä½¿ç”¨Objectç±»ä¸­çš„åŠŸèƒ½ã€‚é‚£ä¹ˆå¯ä»¥ç”¨ ? é€šé…ç¬¦æ¥è¡¨æœªçŸ¥ç±»å‹ã€‚</p><p>ä¾‹å¦‚ <strong>List</strong> åœ¨é€»è¾‘ä¸Šæ˜¯<strong>List,List</strong> ç­‰æ‰€æœ‰List&lt;å…·ä½“ç±»å‹å®å‚&gt;çš„çˆ¶ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; name = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        List&lt;Integer&gt; age = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">        List&lt;Number&gt; number = <span class="keyword">new</span> ArrayList&lt;Number&gt;();  </span><br><span class="line">        name.add(<span class="string">"icon"</span>);</span><br><span class="line">        age.add(<span class="number">18</span>);</span><br><span class="line">        number.add(<span class="number">314</span>);</span><br><span class="line"> </span><br><span class="line">        getData(name);</span><br><span class="line">        getData(age);</span><br><span class="line">        getData(number);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">(List&lt;?&gt; data)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"data :"</span> + data.get(<span class="number">0</span>));</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">data :icon</span><br><span class="line">data :<span class="number">18</span></span><br><span class="line">data :<span class="number">314</span></span><br></pre></td></tr></table></figure><p><strong>è§£æï¼š</strong> å› ä¸ºgetData()æ–¹æ³•çš„å‚æ•°æ˜¯Listç±»å‹çš„ï¼Œæ‰€ä»¥nameï¼Œageï¼Œnumberéƒ½å¯ä»¥ä½œä¸ºè¿™ä¸ªæ–¹æ³•çš„å®å‚ï¼Œè¿™å°±æ˜¯é€šé…ç¬¦çš„ä½œç”¨</p><p>2ã€ç±»å‹é€šé…ç¬¦ä¸Šé™é€šè¿‡å½¢å¦‚Listæ¥å®šä¹‰ï¼Œ</p><p>å¦‚æ­¤å®šä¹‰å°±æ˜¯é€šé…ç¬¦æ³›å‹å€¼æ¥å—NumberåŠå…¶ä¸‹å±‚å­ç±»ç±»å‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; name = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        List&lt;Integer&gt; age = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">        List&lt;Number&gt; number = <span class="keyword">new</span> ArrayList&lt;Number&gt;();</span><br><span class="line">        </span><br><span class="line">        name.add(<span class="string">"icon"</span>);</span><br><span class="line">        age.add(<span class="number">18</span>);</span><br><span class="line">        number.add(<span class="number">314</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//getUperNumber(name);//1</span></span><br><span class="line">        getUperNumber(age);<span class="comment">//2</span></span><br><span class="line">        getUperNumber(number);<span class="comment">//3</span></span><br><span class="line">       </span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">(List&lt;?&gt; data)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"data :"</span> + data.get(<span class="number">0</span>));</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getUperNumber</span><span class="params">(List&lt;? extends Number&gt; data)</span> </span>&#123;</span><br><span class="line">          System.out.println(<span class="string">"data :"</span> + data.get(<span class="number">0</span>));</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">data :<span class="number">18</span></span><br><span class="line">data :<span class="number">314</span></span><br></pre></td></tr></table></figure><p><strong>è§£æï¼š</strong> åœ¨(//1)å¤„ä¼šå‡ºç°é”™è¯¯ï¼Œå› ä¸ºgetUperNumber()æ–¹æ³•ä¸­çš„å‚æ•°å·²ç»é™å®šäº†å‚æ•°æ³›å‹ä¸Šé™ä¸ºNumberï¼Œæ‰€ä»¥æ³›å‹ä¸ºStringæ˜¯ä¸åœ¨è¿™ä¸ªèŒƒå›´ä¹‹å†…ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™</p><p>3ã€ç±»å‹é€šé…ç¬¦ä¸‹é™é€šè¿‡å½¢å¦‚ <strong>List</strong>æ¥å®šä¹‰ï¼Œè¡¨ç¤ºç±»å‹åªèƒ½æ¥å—NumberåŠå…¶ä¸‰å±‚çˆ¶ç±»ç±»å‹ï¼Œå¦‚ Object ç±»å‹çš„å®ä¾‹ã€‚</p><h2 id="äº”ã€æ³›å‹æ–¹æ³•"><a href="#äº”ã€æ³›å‹æ–¹æ³•" class="headerlink" title="äº”ã€æ³›å‹æ–¹æ³•"></a>äº”ã€æ³›å‹æ–¹æ³•</h2><p>ä½ å¯ä»¥å†™ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨è°ƒç”¨æ—¶å¯ä»¥æ¥æ”¶ä¸åŒç±»å‹çš„å‚æ•°ã€‚æ ¹æ®ä¼ é€’ç»™æ³›å‹æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œç¼–è¯‘å™¨é€‚å½“åœ°å¤„ç†æ¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ã€‚</p><p>ä¸‹é¢æ˜¯å®šä¹‰æ³›å‹æ–¹æ³•çš„è§„åˆ™ï¼š</p><ul><li>æ‰€æœ‰æ³›å‹æ–¹æ³•å£°æ˜éƒ½æœ‰ä¸€ä¸ªç±»å‹å‚æ•°å£°æ˜éƒ¨åˆ†ï¼ˆç”±å°–æ‹¬å·åˆ†éš”ï¼‰ï¼Œè¯¥ç±»å‹å‚æ•°å£°æ˜éƒ¨åˆ†åœ¨æ–¹æ³•è¿”å›ç±»å‹ä¹‹å‰ï¼ˆåœ¨ä¸‹é¢ä¾‹å­ä¸­çš„<E>ï¼‰ã€‚</li><li>æ¯ä¸€ä¸ªç±»å‹å‚æ•°å£°æ˜éƒ¨åˆ†åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹å‚æ•°ï¼Œå‚æ•°é—´ç”¨é€—å·éš”å¼€ã€‚ä¸€ä¸ªæ³›å‹å‚æ•°ï¼Œä¹Ÿè¢«ç§°ä¸ºä¸€ä¸ªç±»å‹å˜é‡ï¼Œæ˜¯ç”¨äºæŒ‡å®šä¸€ä¸ªæ³›å‹ç±»å‹åç§°çš„æ ‡è¯†ç¬¦ã€‚</li><li>ç±»å‹å‚æ•°èƒ½è¢«ç”¨æ¥å£°æ˜è¿”å›å€¼ç±»å‹ï¼Œå¹¶ä¸”èƒ½ä½œä¸ºæ³›å‹æ–¹æ³•å¾—åˆ°çš„å®é™…å‚æ•°ç±»å‹çš„å ä½ç¬¦ã€‚</li><li>æ³›å‹æ–¹æ³•ä½“çš„å£°æ˜å’Œå…¶ä»–æ–¹æ³•ä¸€æ ·ã€‚æ³¨æ„ç±»å‹å‚æ•°åªèƒ½ä»£è¡¨å¼•ç”¨å‹ç±»å‹ï¼Œä¸èƒ½æ˜¯åŸå§‹ç±»å‹ï¼ˆåƒint,double,charçš„ç­‰ï¼‰ã€‚</li></ul><h3 id="å®ä¾‹-1"><a href="#å®ä¾‹-1" class="headerlink" title="å®ä¾‹ 1"></a>å®ä¾‹ 1</h3><p>ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ³›å‹æ–¹æ³•æ‰“å°ä¸åŒå­—ç¬¦ä¸²çš„å…ƒç´ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericMethodTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="comment">// æ³›å‹æ–¹æ³• printArray                         </span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> &lt; E &gt; <span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">( E[] inputArray )</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      <span class="comment">// è¾“å‡ºæ•°ç»„å…ƒç´             </span></span><br><span class="line">         <span class="keyword">for</span> ( E element : inputArray )&#123;        </span><br><span class="line">            System.out.printf( <span class="string">"%s "</span>, element );</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String args[] )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸åŒç±»å‹æ•°ç»„ï¼š Integer, Double å’Œ Character</span></span><br><span class="line">        Integer[] intArray = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">        Double[] doubleArray = &#123; <span class="number">1.1</span>, <span class="number">2.2</span>, <span class="number">3.3</span>, <span class="number">4.4</span> &#125;;</span><br><span class="line">        Character[] charArray = &#123; <span class="string">'H'</span>, <span class="string">'E'</span>, <span class="string">'L'</span>, <span class="string">'L'</span>, <span class="string">'O'</span> &#125;;</span><br><span class="line"> </span><br><span class="line">        System.out.println( <span class="string">"æ•´å‹æ•°ç»„å…ƒç´ ä¸º:"</span> );</span><br><span class="line">        printArray( intArray  ); <span class="comment">// ä¼ é€’ä¸€ä¸ªæ•´å‹æ•°ç»„</span></span><br><span class="line"> </span><br><span class="line">        System.out.println( <span class="string">"\nåŒç²¾åº¦å‹æ•°ç»„å…ƒç´ ä¸º:"</span> );</span><br><span class="line">        printArray( doubleArray ); <span class="comment">// ä¼ é€’ä¸€ä¸ªåŒç²¾åº¦å‹æ•°ç»„</span></span><br><span class="line"> </span><br><span class="line">        System.out.println( <span class="string">"\nå­—ç¬¦å‹æ•°ç»„å…ƒç´ ä¸º:"</span> );</span><br><span class="line">        printArray( charArray ); <span class="comment">// ä¼ é€’ä¸€ä¸ªå­—ç¬¦å‹æ•°ç»„</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">æ•´å‹æ•°ç»„å…ƒç´ ä¸º:</span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> </span><br><span class="line">åŒç²¾åº¦å‹æ•°ç»„å…ƒç´ ä¸º:</span><br><span class="line"><span class="number">1.1</span> <span class="number">2.2</span> <span class="number">3.3</span> <span class="number">4.4</span> </span><br><span class="line">å­—ç¬¦å‹æ•°ç»„å…ƒç´ ä¸º:</span><br><span class="line">H E L L O</span><br></pre></td></tr></table></figure><p>åœ¨javaä¸­,æ³›å‹ç±»çš„å®šä¹‰éå¸¸ç®€å•ï¼Œä½†æ˜¯æ³›å‹æ–¹æ³•å°±æ¯”è¾ƒå¤æ‚äº†ã€‚å°¤å…¶æ˜¯æˆ‘ä»¬è§åˆ°çš„å¤§å¤šæ•°æ³›å‹ç±»ä¸­çš„æˆå‘˜æ–¹æ³•ä¹Ÿéƒ½ä½¿ç”¨äº†æ³›å‹ï¼Œæœ‰çš„ç”šè‡³æ³›å‹ç±»ä¸­ä¹ŸåŒ…å«ç€æ³›å‹æ–¹æ³•ï¼Œè¿™æ ·åœ¨åˆå­¦è€…ä¸­éå¸¸å®¹æ˜“å°†æ³›å‹æ–¹æ³•ç†è§£é”™äº†ã€‚</p><p><strong>æ³›å‹ç±»ï¼Œæ˜¯åœ¨å®ä¾‹åŒ–ç±»çš„æ—¶å€™æŒ‡æ˜æ³›å‹çš„å…·ä½“ç±»å‹ï¼›æ³›å‹æ–¹æ³•ï¼Œæ˜¯åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™æŒ‡æ˜æ³›å‹çš„å…·ä½“ç±»å‹</strong> ã€‚</p><h3 id="å®ä¾‹2"><a href="#å®ä¾‹2" class="headerlink" title="å®ä¾‹2"></a>å®ä¾‹2</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³›å‹æ–¹æ³•çš„åŸºæœ¬ä»‹ç»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tClass ä¼ å…¥çš„æ³›å‹å®å‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> T è¿”å›å€¼ä¸ºTç±»å‹</span></span><br><span class="line"><span class="comment"> * è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"> *     1ï¼‰public ä¸ è¿”å›å€¼ä¸­é—´&lt;T&gt;éå¸¸é‡è¦ï¼Œå¯ä»¥ç†è§£ä¸ºå£°æ˜æ­¤æ–¹æ³•ä¸ºæ³›å‹æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment"> *     2ï¼‰åªæœ‰å£°æ˜äº†&lt;T&gt;çš„æ–¹æ³•æ‰æ˜¯æ³›å‹æ–¹æ³•ï¼Œæ³›å‹ç±»ä¸­çš„ä½¿ç”¨äº†æ³›å‹çš„æˆå‘˜æ–¹æ³•å¹¶ä¸æ˜¯æ³›å‹æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment"> *     3ï¼‰&lt;T&gt;è¡¨æ˜è¯¥æ–¹æ³•å°†ä½¿ç”¨æ³›å‹ç±»å‹Tï¼Œæ­¤æ—¶æ‰å¯ä»¥åœ¨æ–¹æ³•ä¸­ä½¿ç”¨æ³›å‹ç±»å‹Tã€‚</span></span><br><span class="line"><span class="comment"> *     4ï¼‰ä¸æ³›å‹ç±»çš„å®šä¹‰ä¸€æ ·ï¼Œæ­¤å¤„Tå¯ä»¥éšä¾¿å†™ä¸ºä»»æ„æ ‡è¯†ï¼Œå¸¸è§çš„å¦‚Tã€Eã€Kã€Vç­‰å½¢å¼çš„å‚æ•°å¸¸ç”¨äºè¡¨ç¤ºæ³›å‹ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">genericMethod</span><span class="params">(Class&lt;T&gt; tClass)</span><span class="keyword">throws</span> InstantiationException ,</span></span><br><span class="line"><span class="function">  IllegalAccessException</span>&#123;</span><br><span class="line">        T instance = tClass.newInstance();</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object obj = genericMethod(Class.forName(<span class="string">"com.test.test"</span>));</span><br></pre></td></tr></table></figure><h3 id="5-1-æ³›å‹æ–¹æ³•çš„åŸºæœ¬ç”¨æ³•"><a href="#5-1-æ³›å‹æ–¹æ³•çš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="5.1 æ³›å‹æ–¹æ³•çš„åŸºæœ¬ç”¨æ³•"></a>5.1 æ³›å‹æ–¹æ³•çš„åŸºæœ¬ç”¨æ³•</h3><p>å…‰çœ‹ä¸Šé¢çš„ä¾‹å­æœ‰çš„åŒå­¦å¯èƒ½ä¾ç„¶ä¼šéå¸¸è¿·ç³Šï¼Œæˆ‘ä»¬å†é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼ŒæŠŠæˆ‘æ³›å‹æ–¹æ³•å†æ€»ç»“ä¸€ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTest</span> </span>&#123;</span><br><span class="line">   <span class="comment">//è¿™ä¸ªç±»æ˜¯ä¸ªæ³›å‹ç±»ï¼Œåœ¨ä¸Šé¢å·²ç»ä»‹ç»è¿‡</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Generic</span>&lt;<span class="title">T</span>&gt;</span>&#123;     </span><br><span class="line">        <span class="keyword">private</span> T key;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Generic</span><span class="params">(T key)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æˆ‘æƒ³è¯´çš„å…¶å®æ˜¯è¿™ä¸ªï¼Œè™½ç„¶åœ¨æ–¹æ³•ä¸­ä½¿ç”¨äº†æ³›å‹ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ã€‚</span></span><br><span class="line">        <span class="comment">//è¿™åªæ˜¯ç±»ä¸­ä¸€ä¸ªæ™®é€šçš„æˆå‘˜æ–¹æ³•ï¼Œåªä¸è¿‡ä»–çš„è¿”å›å€¼æ˜¯åœ¨å£°æ˜æ³›å‹ç±»å·²ç»å£°æ˜è¿‡çš„æ³›å‹ã€‚</span></span><br><span class="line">        <span class="comment">//æ‰€ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ‰å¯ä»¥ç»§ç»­ä½¿ç”¨ T è¿™ä¸ªæ³›å‹ã€‚</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> T <span class="title">getKey</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> key;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è¿™ä¸ªæ–¹æ³•æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„ï¼Œåœ¨ç¼–è¯‘å™¨ä¼šç»™æˆ‘ä»¬æç¤ºè¿™æ ·çš„é”™è¯¯ä¿¡æ¯"cannot reslove symbol E"</span></span><br><span class="line"><span class="comment">         * å› ä¸ºåœ¨ç±»çš„å£°æ˜ä¸­å¹¶æœªå£°æ˜æ³›å‹Eï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨Eåšå½¢å‚å’Œè¿”å›å€¼ç±»å‹æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ— æ³•è¯†åˆ«ã€‚</span></span><br><span class="line"><span class="comment">        public E setKey(E key)&#123;</span></span><br><span class="line"><span class="comment">             this.key = keu</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * è¿™æ‰æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ³›å‹æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">     * é¦–å…ˆåœ¨publicä¸è¿”å›å€¼ä¹‹é—´çš„&lt;T&gt;å¿…ä¸å¯å°‘ï¼Œè¿™è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œå¹¶ä¸”å£°æ˜äº†ä¸€ä¸ªæ³›å‹T</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªTå¯ä»¥å‡ºç°åœ¨è¿™ä¸ªæ³›å‹æ–¹æ³•çš„ä»»æ„ä½ç½®.</span></span><br><span class="line"><span class="comment">     * æ³›å‹çš„æ•°é‡ä¹Ÿå¯ä»¥ä¸ºä»»æ„å¤šä¸ª </span></span><br><span class="line"><span class="comment">     *    å¦‚ï¼špublic &lt;T,K&gt; K showKeyName(Generic&lt;T&gt; container)&#123;</span></span><br><span class="line"><span class="comment">     *        ...</span></span><br><span class="line"><span class="comment">     *        &#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">showKeyName</span><span class="params">(Generic&lt;T&gt; container)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"container key :"</span> + container.getKey());</span><br><span class="line">        <span class="comment">//å½“ç„¶è¿™ä¸ªä¾‹å­ä¸¾çš„ä¸å¤ªåˆé€‚ï¼Œåªæ˜¯ä¸ºäº†è¯´æ˜æ³›å‹æ–¹æ³•çš„ç‰¹æ€§ã€‚</span></span><br><span class="line">        T test = container.getKey();</span><br><span class="line">        <span class="keyword">return</span> test;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•ï¼Œåªæ˜¯ä½¿ç”¨äº†Generic&lt;Number&gt;è¿™ä¸ªæ³›å‹ç±»åšå½¢å‚è€Œå·²ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showKeyValue1</span><span class="params">(Generic&lt;Number&gt; obj)</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">"æ³›å‹æµ‹è¯•"</span>,<span class="string">"key value is "</span> + obj.getKey());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•ï¼Œåªä¸è¿‡ä½¿ç”¨äº†æ³›å‹é€šé…ç¬¦?</span></span><br><span class="line">    <span class="comment">//åŒæ—¶è¿™ä¹Ÿå°è¯äº†æ³›å‹é€šé…ç¬¦ç« èŠ‚æ‰€æè¿°çš„ï¼Œ?æ˜¯ä¸€ç§ç±»å‹å®å‚ï¼Œå¯ä»¥çœ‹åšä¸ºNumberç­‰æ‰€æœ‰ç±»çš„çˆ¶ç±»</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showKeyValue2</span><span class="params">(Generic&lt;?&gt; obj)</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">"æ³›å‹æµ‹è¯•"</span>,<span class="string">"key value is "</span> + obj.getKey());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªæ–¹æ³•æ˜¯æœ‰é—®é¢˜çš„ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬æç¤ºé”™è¯¯ä¿¡æ¯ï¼š"UnKnown class 'E' "</span></span><br><span class="line"><span class="comment">     * è™½ç„¶æˆ‘ä»¬å£°æ˜äº†&lt;T&gt;,ä¹Ÿè¡¨æ˜äº†è¿™æ˜¯ä¸€ä¸ªå¯ä»¥å¤„ç†æ³›å‹çš„ç±»å‹çš„æ³›å‹æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">     * ä½†æ˜¯åªå£°æ˜äº†æ³›å‹ç±»å‹Tï¼Œå¹¶æœªå£°æ˜æ³›å‹ç±»å‹Eï¼Œå› æ­¤ç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“è¯¥å¦‚ä½•å¤„ç†Eè¿™ä¸ªç±»å‹ã€‚</span></span><br><span class="line"><span class="comment">    public &lt;T&gt; T showKeyName(Generic&lt;E&gt; container)&#123;</span></span><br><span class="line"><span class="comment">        ...</span></span><br><span class="line"><span class="comment">    &#125;  </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯æœ‰é—®é¢˜çš„ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬æç¤ºé”™è¯¯ä¿¡æ¯ï¼š"UnKnown class 'T' "</span></span><br><span class="line"><span class="comment">     * å¯¹äºç¼–è¯‘å™¨æ¥è¯´Tè¿™ä¸ªç±»å‹å¹¶æœªé¡¹ç›®ä¸­å£°æ˜è¿‡ï¼Œå› æ­¤ç¼–è¯‘ä¹Ÿä¸çŸ¥é“è¯¥å¦‚ä½•ç¼–è¯‘è¿™ä¸ªç±»ã€‚</span></span><br><span class="line"><span class="comment">     * æ‰€ä»¥è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªæ­£ç¡®çš„æ³›å‹æ–¹æ³•å£°æ˜ã€‚</span></span><br><span class="line"><span class="comment">    public void showkey(T genericObj)&#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-ç±»ä¸­çš„æ³›å‹æ–¹æ³•"><a href="#5-2-ç±»ä¸­çš„æ³›å‹æ–¹æ³•" class="headerlink" title="5. 2 ç±»ä¸­çš„æ³›å‹æ–¹æ³•"></a>5. 2 ç±»ä¸­çš„æ³›å‹æ–¹æ³•</h3><p>å½“ç„¶è¿™å¹¶ä¸æ˜¯æ³›å‹æ–¹æ³•çš„å…¨éƒ¨ï¼Œæ³›å‹æ–¹æ³•å¯ä»¥å‡ºç°åœ¨ä»»ä½•åœ°æ–¹å’Œä»»ä½•åœºæ™¯ä¸­ä½¿ç”¨ã€‚ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µæ˜¯éå¸¸ç‰¹æ®Šçš„ï¼Œå½“æ³›å‹æ–¹æ³•å‡ºç°åœ¨æ³›å‹ç±»ä¸­æ—¶ï¼Œæˆ‘ä»¬å†é€šè¿‡ä¸€ä¸ªä¾‹å­çœ‹ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericFruit</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Fruit</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fruit"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Apple</span> <span class="keyword">extends</span> <span class="title">Fruit</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"apple"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Person"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">GenerateTest</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show_1</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">            System.out.println(t.toString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åœ¨æ³›å‹ç±»ä¸­å£°æ˜äº†ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œä½¿ç”¨æ³›å‹Eï¼Œè¿™ç§æ³›å‹Eå¯ä»¥ä¸ºä»»æ„ç±»å‹ã€‚å¯ä»¥ç±»å‹ä¸Tç›¸åŒï¼Œä¹Ÿå¯ä»¥ä¸åŒã€‚</span></span><br><span class="line">        <span class="comment">//ç”±äºæ³›å‹æ–¹æ³•åœ¨å£°æ˜çš„æ—¶å€™ä¼šå£°æ˜æ³›å‹&lt;E&gt;ï¼Œå› æ­¤å³ä½¿åœ¨æ³›å‹ç±»ä¸­å¹¶æœªå£°æ˜æ³›å‹ï¼Œç¼–è¯‘å™¨ä¹Ÿèƒ½å¤Ÿæ­£ç¡®è¯†åˆ«æ³›å‹æ–¹æ³•ä¸­è¯†åˆ«çš„æ³›å‹ã€‚</span></span><br><span class="line">        <span class="keyword">public</span> &lt;E&gt; <span class="function"><span class="keyword">void</span> <span class="title">show_3</span><span class="params">(E t)</span></span>&#123;</span><br><span class="line">            System.out.println(t.toString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åœ¨æ³›å‹ç±»ä¸­å£°æ˜äº†ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œä½¿ç”¨æ³›å‹Tï¼Œæ³¨æ„è¿™ä¸ªTæ˜¯ä¸€ç§å…¨æ–°çš„ç±»å‹ï¼Œå¯ä»¥ä¸æ³›å‹ç±»ä¸­å£°æ˜çš„Tä¸æ˜¯åŒä¸€ç§ç±»å‹ã€‚</span></span><br><span class="line">        <span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">show_2</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">            System.out.println(t.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Apple apple = <span class="keyword">new</span> Apple();</span><br><span class="line">        Person person = <span class="keyword">new</span> Person();</span><br><span class="line"></span><br><span class="line">        GenerateTest&lt;Fruit&gt; generateTest = <span class="keyword">new</span> GenerateTest&lt;Fruit&gt;();</span><br><span class="line">        <span class="comment">//appleæ˜¯Fruitçš„å­ç±»ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥</span></span><br><span class="line">        generateTest.show_1(apple);</span><br><span class="line">        <span class="comment">//ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œå› ä¸ºæ³›å‹ç±»å‹å®å‚æŒ‡å®šçš„æ˜¯Fruitï¼Œè€Œä¼ å…¥çš„å®å‚ç±»æ˜¯Person</span></span><br><span class="line">        <span class="comment">//generateTest.show_1(person);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥æˆåŠŸ</span></span><br><span class="line">        generateTest.show_2(apple);</span><br><span class="line">        generateTest.show_2(person);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¹Ÿéƒ½å¯ä»¥æˆåŠŸ</span></span><br><span class="line">        generateTest.show_3(apple);</span><br><span class="line">        generateTest.show_3(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-æ³›å‹æ–¹æ³•ä¸å¯å˜å‚æ•°"><a href="#5-3-æ³›å‹æ–¹æ³•ä¸å¯å˜å‚æ•°" class="headerlink" title="5.3 æ³›å‹æ–¹æ³•ä¸å¯å˜å‚æ•°"></a>5.3 æ³›å‹æ–¹æ³•ä¸å¯å˜å‚æ•°</h3><p>å†çœ‹ä¸€ä¸ªæ³›å‹æ–¹æ³•å’Œå¯å˜å‚æ•°çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">printMsg</span><span class="params">( T... args)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(T t : args)&#123;</span><br><span class="line">        Log.d(<span class="string">"æ³›å‹æµ‹è¯•"</span>,<span class="string">"t is "</span> + t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printMsg(<span class="string">"111"</span>,<span class="number">222</span>,<span class="string">"aaaa"</span>,<span class="string">"2323.4"</span>,<span class="number">55.55</span>);</span><br></pre></td></tr></table></figure><h3 id="5-4-é™æ€æ–¹æ³•ä¸æ³›å‹"><a href="#5-4-é™æ€æ–¹æ³•ä¸æ³›å‹" class="headerlink" title="5.4 é™æ€æ–¹æ³•ä¸æ³›å‹"></a>5.4 é™æ€æ–¹æ³•ä¸æ³›å‹</h3><p>é™æ€æ–¹æ³•æœ‰ä¸€ç§æƒ…å†µéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œé‚£å°±æ˜¯åœ¨ç±»ä¸­çš„é™æ€æ–¹æ³•ä½¿ç”¨æ³›å‹ï¼š<strong>é™æ€æ–¹æ³•æ— æ³•è®¿é—®ç±»ä¸Šå®šä¹‰çš„æ³›å‹ï¼›å¦‚æœé™æ€æ–¹æ³•æ“ä½œçš„å¼•ç”¨æ•°æ®ç±»å‹ä¸ç¡®å®šçš„æ—¶å€™ï¼Œå¿…é¡»è¦å°†æ³›å‹å®šä¹‰åœ¨æ–¹æ³•ä¸Šã€‚</strong></p><p>å³ï¼š<strong>å¦‚æœé™æ€æ–¹æ³•è¦ä½¿ç”¨æ³›å‹çš„è¯ï¼Œå¿…é¡»å°†é™æ€æ–¹æ³•ä¹Ÿå®šä¹‰æˆæ³›å‹æ–¹æ³•</strong> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticGenerator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    ....</span><br><span class="line">    ....</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¦‚æœåœ¨ç±»ä¸­å®šä¹‰ä½¿ç”¨æ³›å‹çš„é™æ€æ–¹æ³•ï¼Œéœ€è¦æ·»åŠ é¢å¤–çš„æ³›å‹å£°æ˜ï¼ˆå°†è¿™ä¸ªæ–¹æ³•å®šä¹‰æˆæ³›å‹æ–¹æ³•ï¼‰</span></span><br><span class="line"><span class="comment">     * å³ä½¿é™æ€æ–¹æ³•è¦ä½¿ç”¨æ³›å‹ç±»ä¸­å·²ç»å£°æ˜è¿‡çš„æ³›å‹ä¹Ÿä¸å¯ä»¥ã€‚</span></span><br><span class="line"><span class="comment">     * å¦‚ï¼špublic static void show(T t)&#123;..&#125;,æ­¤æ—¶ç¼–è¯‘å™¨ä¼šæç¤ºé”™è¯¯ä¿¡æ¯ï¼š</span></span><br><span class="line"><span class="comment">          "StaticGenerator cannot be refrenced from static context"</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-5-æ³›å‹æ–¹æ³•æ€»ç»“"><a href="#5-5-æ³›å‹æ–¹æ³•æ€»ç»“" class="headerlink" title="5.5 æ³›å‹æ–¹æ³•æ€»ç»“"></a>5.5 æ³›å‹æ–¹æ³•æ€»ç»“</h3><p>æ³›å‹æ–¹æ³•èƒ½ä½¿æ–¹æ³•ç‹¬ç«‹äºç±»è€Œäº§ç”Ÿå˜åŒ–ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„æŒ‡å¯¼åŸåˆ™ï¼š</p><blockquote><p>æ— è®ºä½•æ—¶ï¼Œå¦‚æœä½ èƒ½åšåˆ°ï¼Œä½ å°±è¯¥å°½é‡ä½¿ç”¨æ³›å‹æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½¿ç”¨æ³›å‹æ–¹æ³•å°†æ•´ä¸ªç±»æ³›å‹åŒ–ï¼Œé‚£ä¹ˆå°±åº”è¯¥ä½¿ç”¨æ³›å‹æ–¹æ³•ã€‚å¦å¤–å¯¹äºä¸€ä¸ªstaticçš„æ–¹æ³•ï¼Œæ— æ³•è®¿é—®æ³›å‹ç±»å‹çš„å‚æ•°ã€‚æ‰€ä»¥å¦‚æœstaticæ–¹æ³•è¦ä½¿ç”¨æ³›å‹èƒ½åŠ›ï¼Œå°±å¿…é¡»ä½¿å…¶æˆä¸ºæ³›å‹æ–¹æ³•ã€‚</p></blockquote><h2 id="å…­-æ³›å‹ä¸Šä¸‹è¾¹ç•Œ"><a href="#å…­-æ³›å‹ä¸Šä¸‹è¾¹ç•Œ" class="headerlink" title="å…­. æ³›å‹ä¸Šä¸‹è¾¹ç•Œ"></a>å…­. æ³›å‹ä¸Šä¸‹è¾¹ç•Œ</h2><p>åœ¨ä½¿ç”¨æ³›å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºä¼ å…¥çš„æ³›å‹ç±»å‹å®å‚è¿›è¡Œä¸Šä¸‹è¾¹ç•Œçš„é™åˆ¶ï¼Œå¦‚ï¼šç±»å‹å®å‚åªå‡†ä¼ å…¥æŸç§ç±»å‹çš„çˆ¶ç±»æˆ–æŸç§ç±»å‹çš„å­ç±»ã€‚</p><p>ä¸ºæ³›å‹æ·»åŠ ä¸Šè¾¹ç•Œï¼Œå³ä¼ å…¥çš„ç±»å‹å®å‚å¿…é¡»æ˜¯æŒ‡å®šç±»å‹çš„å­ç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showKeyValue1</span><span class="params">(Generic&lt;? extends Number&gt; obj)</span></span>&#123;</span><br><span class="line">    Log.d(<span class="string">"æ³›å‹æµ‹è¯•"</span>,<span class="string">"key value is "</span> + obj.getKey());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Generic&lt;String&gt; generic1 = <span class="keyword">new</span> Generic&lt;String&gt;(<span class="string">"11111"</span>);</span><br><span class="line">Generic&lt;Integer&gt; generic2 = <span class="keyword">new</span> Generic&lt;Integer&gt;(<span class="number">2222</span>);</span><br><span class="line">Generic&lt;Float&gt; generic3 = <span class="keyword">new</span> Generic&lt;Float&gt;(<span class="number">2.4f</span>);</span><br><span class="line">Generic&lt;Double&gt; generic4 = <span class="keyword">new</span> Generic&lt;Double&gt;(<span class="number">2.56</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™ä¸€è¡Œä»£ç ç¼–è¯‘å™¨ä¼šæç¤ºé”™è¯¯ï¼Œå› ä¸ºStringç±»å‹å¹¶ä¸æ˜¯Numberç±»å‹çš„å­ç±»</span></span><br><span class="line"><span class="comment">//showKeyValue1(generic1);</span></span><br><span class="line"></span><br><span class="line">showKeyValue1(generic2);</span><br><span class="line">showKeyValue1(generic3);</span><br><span class="line">showKeyValue1(generic4);</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æŠŠæ³›å‹ç±»çš„å®šä¹‰ä¹Ÿæ”¹ä¸€ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Generic</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Number</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T key;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Generic</span><span class="params">(T key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getKey</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¿™ä¸€è¡Œä»£ç ä¹Ÿä¼šæŠ¥é”™ï¼Œå› ä¸ºStringä¸æ˜¯Numberçš„å­ç±»</span></span><br><span class="line">Generic&lt;String&gt; generic1 = <span class="keyword">new</span> Generic&lt;String&gt;(<span class="string">"11111"</span>);</span><br></pre></td></tr></table></figure><p>å†æ¥ä¸€ä¸ªæ³›å‹æ–¹æ³•çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨æ³›å‹æ–¹æ³•ä¸­æ·»åŠ ä¸Šä¸‹è¾¹ç•Œé™åˆ¶çš„æ—¶å€™ï¼Œå¿…é¡»åœ¨æƒé™å£°æ˜ä¸è¿”å›å€¼ä¹‹é—´çš„&lt;T&gt;ä¸Šæ·»åŠ ä¸Šä¸‹è¾¹ç•Œï¼Œå³åœ¨æ³›å‹å£°æ˜çš„æ—¶å€™æ·»åŠ </span></span><br><span class="line"><span class="comment">//public &lt;T&gt; T showKeyName(Generic&lt;T extends Number&gt; container)ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼š"Unexpected bound"</span></span><br><span class="line"><span class="keyword">public</span> &lt;T extends Number&gt; <span class="function">T <span class="title">showKeyName</span><span class="params">(Generic&lt;T&gt; container)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"container key :"</span> + container.getKey());</span><br><span class="line">    T test = container.getKey();</span><br><span class="line">    <span class="keyword">return</span> test;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ä¸¤ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºï¼š<strong>æ³›å‹çš„ä¸Šä¸‹è¾¹ç•Œæ·»åŠ ï¼Œå¿…é¡»ä¸æ³›å‹çš„å£°æ˜åœ¨ä¸€èµ·</strong> ã€‚è¦å£°æ˜ä¸€ä¸ªæœ‰ç•Œçš„ç±»å‹å‚æ•°ï¼Œé¦–å…ˆåˆ—å‡ºç±»å‹å‚æ•°çš„åç§°ï¼Œåè·Ÿextendså…³é”®å­—ï¼Œæœ€åç´§è·Ÿå®ƒçš„ä¸Šç•Œã€‚</p><p>æœ‰ç•Œçš„ç±»å‹å‚æ•°:å¯èƒ½æœ‰æ—¶å€™ï¼Œä½ ä¼šæƒ³é™åˆ¶é‚£äº›è¢«å…è®¸ä¼ é€’åˆ°ä¸€ä¸ªç±»å‹å‚æ•°çš„ç±»å‹ç§ç±»èŒƒå›´ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ“ä½œæ•°å­—çš„æ–¹æ³•å¯èƒ½åªå¸Œæœ›æ¥å—Numberæˆ–è€…Numberå­ç±»çš„å®ä¾‹ã€‚è¿™å°±æ˜¯æœ‰ç•Œç±»å‹å‚æ•°çš„ç›®çš„ã€‚</p><h3 id="å®ä¾‹-2"><a href="#å®ä¾‹-2" class="headerlink" title="å®ä¾‹ 2"></a>å®ä¾‹ 2</h3><p>ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†â€extendsâ€å¦‚ä½•ä½¿ç”¨åœ¨ä¸€èˆ¬æ„ä¹‰ä¸Šçš„æ„æ€â€extendsâ€ï¼ˆç±»ï¼‰æˆ–è€…â€implementsâ€ï¼ˆæ¥å£ï¼‰ã€‚è¯¥ä¾‹å­ä¸­çš„æ³›å‹æ–¹æ³•è¿”å›ä¸‰ä¸ªå¯æ¯”è¾ƒå¯¹è±¡çš„æœ€å¤§å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericMethodTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// æ¯”è¾ƒä¸‰ä¸ªå€¼å¹¶è¿”å›æœ€å¤§å€¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;T&gt;&gt; <span class="function">T <span class="title">maximum</span><span class="params">(T x, T y, T z)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        T max = x; <span class="comment">// å‡è®¾xæ˜¯åˆå§‹æœ€å¤§å€¼</span></span><br><span class="line">        <span class="keyword">if</span> ( y.compareTo( max ) &gt; <span class="number">0</span> )&#123;</span><br><span class="line">            max = y; <span class="comment">//y æ›´å¤§</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( z.compareTo( max ) &gt; <span class="number">0</span> )&#123;</span><br><span class="line">            max = z; <span class="comment">// ç°åœ¨ z æ›´å¤§</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max; <span class="comment">// è¿”å›æœ€å¤§å¯¹è±¡</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String args[] )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.printf( <span class="string">"%d, %d å’Œ %d ä¸­æœ€å¤§çš„æ•°ä¸º %d\n"</span>,</span><br><span class="line">                <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, maximum( <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> ) );</span><br><span class="line"></span><br><span class="line">        System.out.printf( <span class="string">"%.1f, %.1f å’Œ %.1f ä¸­æœ€å¤§çš„æ•°ä¸º %.1f\n"</span>,</span><br><span class="line">                <span class="number">6.6</span>, <span class="number">8.8</span>, <span class="number">7.7</span>, maximum( <span class="number">6.6</span>, <span class="number">8.8</span>, <span class="number">7.7</span> ) );</span><br><span class="line"></span><br><span class="line">        System.out.printf( <span class="string">"%s, %s å’Œ %s ä¸­æœ€å¤§çš„æ•°ä¸º %s\n"</span>,<span class="string">"pear"</span>,</span><br><span class="line">                <span class="string">"apple"</span>, <span class="string">"orange"</span>, maximum( <span class="string">"pear"</span>, <span class="string">"apple"</span>, <span class="string">"orange"</span> ) );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line"><span class="number">3</span>, <span class="number">4</span> å’Œ <span class="number">5</span> ä¸­æœ€å¤§çš„æ•°ä¸º <span class="number">5</span></span><br><span class="line"><span class="number">6.6</span>, <span class="number">8.8</span> å’Œ <span class="number">7.7</span> ä¸­æœ€å¤§çš„æ•°ä¸º <span class="number">8.8</span></span><br><span class="line">pear, apple å’Œ orange ä¸­æœ€å¤§çš„æ•°ä¸º pear</span><br></pre></td></tr></table></figure><h2 id="ä¸ƒã€å…³äºæ³›å‹æ•°ç»„è¦æä¸€ä¸‹"><a href="#ä¸ƒã€å…³äºæ³›å‹æ•°ç»„è¦æä¸€ä¸‹" class="headerlink" title="ä¸ƒã€å…³äºæ³›å‹æ•°ç»„è¦æä¸€ä¸‹"></a>ä¸ƒã€å…³äºæ³›å‹æ•°ç»„è¦æä¸€ä¸‹</h2><p>çœ‹åˆ°äº†å¾ˆå¤šæ–‡ç« ä¸­éƒ½ä¼šæèµ·æ³›å‹æ•°ç»„ï¼Œç»è¿‡æŸ¥çœ‹sunçš„è¯´æ˜æ–‡æ¡£ï¼Œåœ¨javaä¸­æ˜¯<strong>â€ä¸èƒ½åˆ›å»ºä¸€ä¸ªç¡®åˆ‡çš„æ³›å‹ç±»å‹çš„æ•°ç»„â€</strong>çš„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ä¸‹é¢çš„è¿™ä¸ªä¾‹å­æ˜¯ä¸å¯ä»¥çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt;[] ls = <span class="keyword">new</span> ArrayList&lt;String&gt;[<span class="number">10</span>];</span><br></pre></td></tr></table></figure><p>è€Œä½¿ç”¨é€šé…ç¬¦åˆ›å»ºæ³›å‹æ•°ç»„æ˜¯å¯ä»¥çš„ï¼Œå¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;?&gt;[] ls = <span class="keyword">new</span> ArrayList&lt;?&gt;[<span class="number">10</span>];</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt;[] ls = <span class="keyword">new</span> ArrayList[<span class="number">10</span>];</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ä½¿ç”¨<a href="http://docs.oracle.com/javase/tutorial/extra/generics/fineprint.html" target="_blank" rel="noopener">Sun</a><a href="http://docs.oracle.com/javase/tutorial/extra/generics/fineprint.html" target="_blank" rel="noopener">çš„ä¸€ç¯‡æ–‡æ¡£</a>çš„ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt;[] lsa = <span class="keyword">new</span> List&lt;String&gt;[<span class="number">10</span>]; <span class="comment">// Not really allowed.    </span></span><br><span class="line">Object o = lsa;    </span><br><span class="line">Object[] oa = (Object[]) o;    </span><br><span class="line">List&lt;Integer&gt; li = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();    </span><br><span class="line">li.add(<span class="keyword">new</span> Integer(<span class="number">3</span>));    </span><br><span class="line">oa[<span class="number">1</span>] = li; <span class="comment">// Unsound, but passes run time store check    </span></span><br><span class="line">String s = lsa[<span class="number">1</span>].get(<span class="number">0</span>); <span class="comment">// Run-time error: ClassCastException.</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºJVMæ³›å‹çš„æ“¦é™¤æœºåˆ¶ï¼Œåœ¨è¿è¡Œæ—¶JVMæ˜¯ä¸çŸ¥é“æ³›å‹ä¿¡æ¯çš„ï¼Œæ‰€ä»¥å¯ä»¥ç»™oa[1]èµ‹ä¸Šä¸€ä¸ªArrayListè€Œä¸ä¼šå‡ºç°å¼‚å¸¸ï¼Œä½†æ˜¯åœ¨å–å‡ºæ•°æ®çš„æ—¶å€™å´è¦åšä¸€æ¬¡ç±»å‹è½¬æ¢ï¼Œæ‰€ä»¥å°±ä¼šå‡ºç°ClassCastExceptionï¼Œå¦‚æœå¯ä»¥è¿›è¡Œæ³›å‹æ•°ç»„çš„å£°æ˜ï¼Œä¸Šé¢è¯´çš„è¿™ç§æƒ…å†µåœ¨ç¼–è¯‘æœŸå°†ä¸ä¼šå‡ºç°ä»»ä½•çš„è­¦å‘Šå’Œé”™è¯¯ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶æ‰ä¼šå‡ºé”™ã€‚</p><p>è€Œå¯¹æ³›å‹æ•°ç»„çš„å£°æ˜è¿›è¡Œé™åˆ¶ï¼Œå¯¹äºè¿™æ ·çš„æƒ…å†µï¼Œå¯ä»¥åœ¨ç¼–è¯‘æœŸæç¤ºä»£ç æœ‰ç±»å‹å®‰å…¨é—®é¢˜ï¼Œæ¯”æ²¡æœ‰ä»»ä½•æç¤ºè¦å¼ºå¾ˆå¤šã€‚</p></blockquote><p>ä¸‹é¢é‡‡ç”¨é€šé…ç¬¦çš„æ–¹å¼æ˜¯è¢«å…è®¸çš„:<strong>æ•°ç»„çš„ç±»å‹ä¸å¯ä»¥æ˜¯ç±»å‹å˜é‡ï¼Œé™¤éæ˜¯é‡‡ç”¨é€šé…ç¬¦çš„æ–¹å¼</strong>ï¼Œå› ä¸ºå¯¹äºé€šé…ç¬¦çš„æ–¹å¼ï¼Œæœ€åå–å‡ºæ•°æ®æ˜¯è¦åšæ˜¾å¼çš„ç±»å‹è½¬æ¢çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;?&gt;[] lsa = <span class="keyword">new</span> List&lt;?&gt;[<span class="number">10</span>]; <span class="comment">// OK, array of unbounded wildcard type.    </span></span><br><span class="line">Object o = lsa;    </span><br><span class="line">Object[] oa = (Object[]) o;    </span><br><span class="line">List&lt;Integer&gt; li = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();    </span><br><span class="line">li.add(<span class="keyword">new</span> Integer(<span class="number">3</span>));    </span><br><span class="line">oa[<span class="number">1</span>] = li; <span class="comment">// Correct.    </span></span><br><span class="line">Integer i = (Integer) lsa[<span class="number">1</span>].get(<span class="number">0</span>); <span class="comment">// OK</span></span><br></pre></td></tr></table></figure><h2 id="å…«ã€ç‰¹æ€§ï¼šåªåœ¨ç¼–è¯‘é˜¶æ®µæœ‰æ•ˆ"><a href="#å…«ã€ç‰¹æ€§ï¼šåªåœ¨ç¼–è¯‘é˜¶æ®µæœ‰æ•ˆ" class="headerlink" title="å…«ã€ç‰¹æ€§ï¼šåªåœ¨ç¼–è¯‘é˜¶æ®µæœ‰æ•ˆ"></a>å…«ã€ç‰¹æ€§ï¼šåªåœ¨ç¼–è¯‘é˜¶æ®µæœ‰æ•ˆ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; stringArrayList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">List&lt;Integer&gt; integerArrayList = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line"></span><br><span class="line">Class classStringArrayList = stringArrayList.getClass();</span><br><span class="line">Class classIntegerArrayList = integerArrayList.getClass();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(classStringArrayList.equals(classIntegerArrayList))&#123;</span><br><span class="line">    Log.d(<span class="string">"æ³›å‹æµ‹è¯•"</span>,<span class="string">"ç±»å‹ç›¸åŒ"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¾“å‡ºç»“æœï¼šD/æ³›å‹æµ‹è¯•: ç±»å‹ç›¸åŒã€‚</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥è¯æ˜ï¼Œåœ¨ç¼–è¯‘ä¹‹åç¨‹åºä¼šé‡‡å–å»æ³›å‹åŒ–çš„æªæ–½ã€‚ä¹Ÿå°±æ˜¯è¯´Javaä¸­çš„æ³›å‹ï¼Œåªåœ¨ç¼–è¯‘é˜¶æ®µæœ‰æ•ˆã€‚åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œæ­£ç¡®æ£€éªŒæ³›å‹ç»“æœåï¼Œä¼šå°†æ³›å‹çš„ç›¸å…³ä¿¡æ¯æ“¦å‡ºï¼Œå¹¶ä¸”åœ¨å¯¹è±¡è¿›å…¥å’Œç¦»å¼€æ–¹æ³•çš„è¾¹ç•Œå¤„æ·»åŠ ç±»å‹æ£€æŸ¥å’Œç±»å‹è½¬æ¢çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ³›å‹ä¿¡æ¯ä¸ä¼šè¿›å…¥åˆ°è¿è¡Œæ—¶é˜¶æ®µã€‚</p><p>JVMé‡Œæ²¡æœ‰æ³›å‹ï¼Œå¯¹äºæ‰€æœ‰çš„æ³›å‹å¯¹äºè™šæ‹Ÿæœºæ¥è®²éƒ½æ˜¯å±äºæ™®é€šç±»ã€‚</p><p>å¯¹æ­¤æ€»ç»“æˆä¸€å¥è¯ï¼šæ³›å‹ç±»å‹åœ¨é€»è¾‘ä¸Šçœ‹ä»¥çœ‹æˆæ˜¯å¤šä¸ªä¸åŒçš„ç±»å‹ï¼Œå®é™…ä¸Šéƒ½æ˜¯ç›¸åŒçš„åŸºæœ¬ç±»å‹</p><h2 id="ä¹-æœ€å"><a href="#ä¹-æœ€å" class="headerlink" title="ä¹. æœ€å"></a>ä¹. æœ€å</h2><p>æœ¬æ–‡ä¸­çš„ä¾‹å­ä¸»è¦æ˜¯ä¸ºäº†é˜è¿°æ³›å‹ä¸­çš„ä¸€äº›æ€æƒ³è€Œç®€å•ä¸¾å‡ºçš„ï¼Œå¹¶ä¸ä¸€å®šæœ‰ç€å®é™…çš„å¯ç”¨æ€§ã€‚å¦å¤–ï¼Œä¸€æåˆ°æ³›å‹ï¼Œç›¸ä¿¡å¤§å®¶ç”¨åˆ°æœ€å¤šçš„å°±æ˜¯åœ¨é›†åˆä¸­ï¼Œå…¶å®ï¼Œåœ¨å®é™…çš„ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œè‡ªå·±å¯ä»¥ä½¿ç”¨æ³›å‹å»ç®€åŒ–å¼€å‘ï¼Œä¸”èƒ½å¾ˆå¥½çš„ä¿è¯ä»£ç è´¨é‡ã€‚</p><hr><p>å‚è€ƒèµ„æ–™ï¼š<br>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€ŒVieLeiã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/s10461/article/details/53941091" target="_blank" rel="noopener">https://blog.csdn.net/s10461/article/details/53941091</a></p><p><a href="https://www.runoob.com/java/java-generics.html" target="_blank" rel="noopener">https://www.runoob.com/java/java-generics.html</a></p><p><a href="https://baike.baidu.com/item/javaæ³›å‹/511821?fr=aladdin" target="_blank" rel="noopener">https://baike.baidu.com/item/java%E6%B3%9B%E5%9E%8B/511821?fr=aladdin</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> åŸºç¡€ç†è§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaé›†åˆ(å®¹å™¨)</title>
      <link href="/2019/12/09/Java%E9%9B%86%E5%90%88-%E5%8D%B3%E5%AE%B9%E5%99%A8/"/>
      <url>/2019/12/09/Java%E9%9B%86%E5%90%88-%E5%8D%B3%E5%AE%B9%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€-é›†åˆç±»å¸¦æ¥çš„å¥½å¤„"><a href="#ä¸€-é›†åˆç±»å¸¦æ¥çš„å¥½å¤„" class="headerlink" title="ä¸€. é›†åˆç±»å¸¦æ¥çš„å¥½å¤„"></a>ä¸€. é›†åˆç±»å¸¦æ¥çš„å¥½å¤„</h2><ol><li><p>é™ä½ç¼–ç¨‹éš¾åº¦ï¼šåœ¨ç¼–ç¨‹ä¸­ä¼šç»å¸¸éœ€è¦<a href="https://baike.baidu.com/item/é“¾è¡¨/9794473" target="_blank" rel="noopener">é“¾è¡¨</a>ã€<a href="https://baike.baidu.com/item/å‘é‡/20402530" target="_blank" rel="noopener">å‘é‡</a>ç­‰é›†åˆç±»ï¼Œå¦‚æœè‡ªå·±åŠ¨æ‰‹å†™ä»£ç å®ç°è¿™äº›ç±»ï¼Œéœ€è¦èŠ±è´¹è¾ƒå¤šçš„æ—¶é—´å’Œç²¾åŠ›ã€‚è°ƒç”¨Javaä¸­æä¾›çš„è¿™äº›æ¥å£å’Œç±»ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„å¤„ç†æ•°æ®ã€‚</p></li><li><p>æå‡ç¨‹åºçš„è¿è¡Œé€Ÿåº¦å’Œè´¨é‡ï¼šJavaæä¾›çš„é›†åˆç±»å…·æœ‰è¾ƒé«˜çš„è´¨é‡ï¼Œè¿è¡Œæ—¶é€Ÿåº¦ä¹Ÿè¾ƒå¿«ã€‚ä½¿ç”¨è¿™äº›é›†åˆç±»æä¾›çš„æ•°æ®ç»“æ„ï¼Œç¨‹åºå‘˜å¯ä»¥ä»â€œé‡å¤é€ è½®å­â€ä¸­è§£è„±å‡ºæ¥ï¼Œå°†ç²¾åŠ›ä¸“æ³¨äºæå‡ç¨‹åºçš„è´¨é‡å’Œæ€§èƒ½ã€‚</p></li><li><p>æ— éœ€å†å­¦ä¹ æ–°çš„APlï¼šå€ŸåŠ©<a href="https://baike.baidu.com/item/æ³›å‹/4475207" target="_blank" rel="noopener">æ³›å‹</a>ï¼Œåªè¦äº†è§£äº†è¿™äº›ç±»çš„ä½¿ç”¨æ–¹æ³•ï¼Œå°±å¯ä»¥å°†å®ƒä»¬åº”ç”¨åˆ°å¾ˆå¤šæ•°æ®ç±»å‹ä¸­ã€‚å¦‚æœçŸ¥é“äº†LinkedList<String>çš„ä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿä¼šçŸ¥é“LinkedList<Double>æ€ä¹ˆç”¨ï¼Œåˆ™æ— éœ€ä¸ºæ¯ä¸€ç§æ•°æ®ç±»å‹å­¦ä¹ ä¸åŒçš„APIã€‚</p></li><li><p>å¢åŠ ä»£ç é‡ç”¨æ€§ï¼šä¹Ÿæ˜¯å€ŸåŠ©æ³›å‹ï¼Œå°±ç®—å¯¹é›†åˆç±»ä¸­çš„å…ƒç´ ç±»å‹è¿›è¡Œäº†ä¿®æ”¹ï¼Œé›†åˆç±»ç›¸å…³çš„ä»£ç ä¹Ÿå‡ ä¹ä¸ç”¨ä¿®æ”¹ã€‚</p><blockquote><p>é›†åˆç±»çš„ç‰¹ç‚¹æœ‰ä¸‰ä¸ªï¼š</p><ol><li>é›†åˆç±»è¿™ç§æ¡†æ¶æ˜¯é«˜æ€§èƒ½çš„ã€‚å¯¹åŸºæœ¬ç±»é›†ï¼ˆåŠ¨æ€æ•°ç»„ï¼Œé“¾æ¥è¡¨ï¼Œæ ‘å’Œæ•£åˆ—è¡¨ï¼‰çš„å®ç°æ˜¯é«˜æ•ˆç‡çš„ã€‚ä¸€èˆ¬äººå¾ˆå°‘å»æ”¹åŠ¨è¿™äº›å·²ç»å¾ˆæˆç†Ÿå¹¶ä¸”é«˜æ•ˆçš„APlï¼›</li><li>é›†åˆç±»å…è®¸ä¸åŒç±»å‹çš„é›†åˆä»¥ç›¸åŒçš„æ–¹å¼å’Œé«˜åº¦äº’æ“ä½œæ–¹å¼å·¥ä½œï¼›</li><li>é›†åˆç±»å®¹æ˜“æ‰©å±•å’Œä¿®æ”¹ï¼Œç¨‹åºå‘˜å¯ä»¥å¾ˆå®¹æ˜“åœ°ç¨åŠ æ”¹é€ å°±èƒ½æ»¡è¶³è‡ªå·±çš„æ•°æ®ç»“æ„éœ€æ±‚ã€‚</li></ol></blockquote></li></ol><h2 id="äºŒ-é›†åˆæ¶æ„"><a href="#äºŒ-é›†åˆæ¶æ„" class="headerlink" title="äºŒ. é›†åˆæ¶æ„"></a>äºŒ. é›†åˆæ¶æ„</h2><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9pmpojefej30w60u0grb.jpg" alt=""></p><p>Javaä¸­çš„é›†åˆç±»å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š<strong>ä¸€ç±»æ˜¯å®ç°Collectionæ¥å£ï¼›å¦ä¸€ç±»æ˜¯å®ç°Mapæ¥å£</strong>ã€‚</p><h2 id="ä¸‰-å®ç°Collectionæ¥å£çš„é›†åˆåŒºåˆ«"><a href="#ä¸‰-å®ç°Collectionæ¥å£çš„é›†åˆåŒºåˆ«" class="headerlink" title="ä¸‰. å®ç°Collectionæ¥å£çš„é›†åˆåŒºåˆ«"></a>ä¸‰. å®ç°Collectionæ¥å£çš„é›†åˆåŒºåˆ«</h2><p>æ‰€æœ‰Javaé›†åˆç±»éƒ½ä½äºJava.utilåŒ…ä¸­ï¼Œä¸Javaæ•°ç»„ä¸åŒï¼Œ<strong>Javaé›†åˆä¸èƒ½å­˜æ”¾åŸºæœ¬æ•°æ®ç±»å‹æ•°æ®ï¼Œè€Œåªèƒ½å­˜æ”¾å¯¹è±¡çš„å¼•ç”¨</strong>ã€‚</p><h3 id="1-Listé›†åˆï¼šæœ‰åºåˆ—è¡¨ï¼Œå…è®¸å­˜æ”¾é‡å¤çš„å…ƒç´ "><a href="#1-Listé›†åˆï¼šæœ‰åºåˆ—è¡¨ï¼Œå…è®¸å­˜æ”¾é‡å¤çš„å…ƒç´ " class="headerlink" title="1. Listé›†åˆï¼šæœ‰åºåˆ—è¡¨ï¼Œå…è®¸å­˜æ”¾é‡å¤çš„å…ƒç´ "></a>1. Listé›†åˆï¼šæœ‰åºåˆ—è¡¨ï¼Œå…è®¸å­˜æ”¾é‡å¤çš„å…ƒç´ </h3><p>ArrayListå’ŒLinkedListåœ¨ç”¨æ³•ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œä½†æ˜¯åœ¨åŠŸèƒ½ä¸Šè¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚</p><ul><li>ArrayListï¼šæ•°ç»„å®ç°ï¼ŒæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢ï¼Œè½»é‡çº§ï¼›(çº¿ç¨‹ä¸å®‰å…¨)ï¼Œåº•å±‚æ˜¯Objectæ•°ç»„ï¼Œæ‰€ä»¥ArrayListå…·æœ‰æ•°ç»„çš„æŸ¥è¯¢é€Ÿåº¦å¿«çš„ä¼˜ç‚¹ä»¥åŠå¢åˆ é€Ÿåº¦æ…¢çš„ç¼ºç‚¹ã€‚</li><li>LinkedListï¼šåŒå‘é“¾è¡¨å®ç°ï¼Œå¢åˆ å¿«ï¼ŒæŸ¥è¯¢æ…¢ (çº¿ç¨‹ä¸å®‰å…¨)ï¼Œåº•å±‚æ˜¯ä¸€ç§åŒå‘å¾ªç¯é“¾è¡¨ã€‚åœ¨æ­¤é“¾è¡¨ä¸Šæ¯ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹éƒ½ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šå‰æŒ‡é’ˆï¼ˆæŒ‡å‘å‰é¢çš„èŠ‚ç‚¹çš„ä½ç½®ï¼‰ï¼Œæ•°æ®ï¼ŒåæŒ‡é’ˆï¼ˆæŒ‡å‘åé¢çš„èŠ‚ç‚¹çš„ä½ç½®ï¼‰ã€‚æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„åæŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„å‰æŒ‡é’ˆï¼Œå½¢æˆä¸€ä¸ªå¾ªç¯ã€‚åŒå‘å¾ªç¯é“¾è¡¨çš„æŸ¥è¯¢æ•ˆç‡ä½ä½†æ˜¯å¢åˆ æ•ˆç‡é«˜ã€‚åˆ©ç”¨LinkedListå®ç°æ ˆ(stack)ã€é˜Ÿåˆ—(queue)ã€åŒå‘é˜Ÿåˆ—(double-ended queue )ã€‚ å®ƒå…·æœ‰æ–¹æ³•addFirst()ã€addLast()ã€getFirst()ã€getLast()ã€removeFirst()ã€removeLast()ç­‰ã€‚</li><li>Vectorï¼šä¸ArrayListç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯Vectoræ˜¯é‡é‡çº§çš„ç»„ä»¶ï¼Œä½¿ç”¨ä½¿æ¶ˆè€—çš„èµ„æºæ¯”è¾ƒå¤šã€‚åœ¨è€ƒè™‘å¹¶å‘çš„æƒ…å†µä¸‹ç”¨Vectorï¼ˆä¿è¯çº¿ç¨‹çš„å®‰å…¨ï¼‰,åœ¨ä¸è€ƒè™‘å¹¶å‘çš„æƒ…å†µä¸‹ç”¨ArrayListï¼ˆä¸èƒ½ä¿è¯çº¿ç¨‹çš„å®‰å…¨ï¼‰ã€‚</li></ul><h3 id="2-seté›†åˆï¼šæ— åºåˆ—è¡¨ï¼Œä¸é‡å¤çš„æ•°æ®"><a href="#2-seté›†åˆï¼šæ— åºåˆ—è¡¨ï¼Œä¸é‡å¤çš„æ•°æ®" class="headerlink" title="2. seté›†åˆï¼šæ— åºåˆ—è¡¨ï¼Œä¸é‡å¤çš„æ•°æ®"></a>2. seté›†åˆï¼šæ— åºåˆ—è¡¨ï¼Œä¸é‡å¤çš„æ•°æ®</h3><p>Setæ¥å£çš„ç‰¹ç‚¹æ˜¯æ— åºçš„ï¼Œä¸é‡å¤çš„æ•°æ®ã€‚å¯¹Setä¸­ä»»æ„çš„ä¸¤ä¸ªå…ƒç´ element1å’Œelement2éƒ½elementl.equals(element2)= falseã€‚å¦å¤–ï¼ŒSetæœ€å¤šæœ‰ä¸€ä¸ªnullå…ƒç´ ã€‚æ­¤æ¥å£æ¨¡ä»¿äº†æ•°å­¦ä¸Šçš„é›†åˆæ¦‚å¿µã€‚æ£€ç´¢æ•ˆç‡ä½ä¸‹ï¼Œåˆ é™¤å’Œæ’å…¥æ•ˆç‡é«˜ï¼Œæ’å…¥å’Œåˆ é™¤ä¸ä¼šå¼•èµ·å…ƒç´ ä½ç½®æ”¹å˜ã€‚</p><h4 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a><strong>HashSet</strong></h4><p>ç›´æ¥å®ç°äº†Setæ¥å£ï¼Œå…¶åº•å±‚å…¶å®æ˜¯åŒ…è£…äº†ä¸€ä¸ªHashMapå»å®ç°çš„ã€‚HashSeté‡‡ç”¨HashCodeç®—æ³•æ¥å­˜å–é›†åˆä¸­çš„å…ƒç´ ï¼Œåªä¸è¿‡ç”Ÿæˆä¸€ä¸ªHashSetçš„è¯ï¼Œç³»ç»Ÿåªæä¾›keyçš„è®¿é—®ï¼› å¦‚æœæœ‰ä¸¤ä¸ªKeyé‡å¤ï¼Œé‚£ä¹ˆä¼šè¦†ç›–ä¹‹å‰çš„ï¼›equalsè¿”å›trueï¼ŒhashCodeè¿”å›ç›¸åŒçš„æ•´æ•°ï¼›å“ˆå¸Œè¡¨ï¼›å­˜å‚¨çš„æ•°æ®æ˜¯æ— åºçš„ã€‚å› æ­¤å…·æœ‰æ¯”è¾ƒå¥½çš„è¯»å–å’ŒæŸ¥æ‰¾æ€§èƒ½ã€‚çº¿ç¨‹éå®‰å…¨ã€‚HashSetå…ƒç´ å€¼å¯ä»¥ä¸ºNULLã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HashSetå¸¸ç”¨æ–¹æ³•ï¼š</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> ï¼šå¦‚æœsetåŒ…å«æŒ‡å®šå…ƒç´ ï¼Œè¿”å›<span class="keyword">true</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Iterator <span class="title">iterator</span><span class="params">()</span>è¿”å›setä¸­å…ƒç´ çš„è¿­ä»£å™¨</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object[] <span class="title">toArray</span><span class="params">()</span> ï¼šè¿”å›åŒ…å«setä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„<span class="keyword">public</span> Object[] <span class="title">toArray</span><span class="params">(Object[] a)</span> ï¼šè¿”å›åŒ…å«setä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ï¼Œè¿”å›æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹æ˜¯æŒ‡å®šæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(Object o)</span> ï¼šå¦‚æœsetä¸­ä¸å­˜åœ¨æŒ‡å®šå…ƒç´ ï¼Œåˆ™å‘setåŠ å…¥</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> ï¼šå¦‚æœsetä¸­å­˜åœ¨æŒ‡å®šå…ƒç´ ï¼Œåˆ™ä»setä¸­åˆ é™¤</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeAll</span><span class="params">(Collection c)</span> ï¼šå¦‚æœsetåŒ…å«æŒ‡å®šé›†åˆï¼Œåˆ™ä»setä¸­åˆ é™¤æŒ‡å®šé›†åˆçš„æ‰€æœ‰å…ƒç´ </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsAll</span><span class="params">(Collection c)</span> ï¼šå¦‚æœsetåŒ…å«æŒ‡å®šé›†åˆçš„æ‰€æœ‰å…ƒç´ ï¼Œè¿”å›<span class="keyword">true</span>ã€‚å¦‚æœæŒ‡å®šé›†åˆä¹Ÿæ˜¯ä¸€ä¸ªsetï¼Œåªæœ‰æ˜¯å½“å‰setçš„å­é›†æ—¶ï¼Œæ–¹æ³•è¿”å›<span class="keyword">true</span></span></span><br></pre></td></tr></table></figure><p>HashSetçš„equalså’ŒHashCodeï¼š</p><blockquote><p>å‰é¢è¯´è¿‡ï¼ŒSeté›†åˆæ˜¯ä¸å…è®¸é‡å¤å…ƒç´ çš„ï¼Œå¦åˆ™å°†ä¼šå¼•å‘å„ç§å¥‡æ€ªçš„é—®é¢˜ã€‚é‚£ä¹ˆHashSetå¦‚ä½•åˆ¤æ–­å…ƒç´ é‡å¤å‘¢ï¼Ÿ<br>HashSetéœ€è¦åŒæ—¶é€šè¿‡equalså’ŒHashCodeæ¥åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼Œå…·ä½“è§„åˆ™æ˜¯ï¼Œå¦‚æœä¸¤ä¸ªå…ƒç´ é€šè¿‡equalsä¸ºtrueï¼Œå¹¶ä¸”ä¸¤ä¸ªå…ƒç´ çš„hashCodeç›¸ç­‰ï¼Œåˆ™è¿™ä¸¤ä¸ªå…ƒç´ ç›¸ç­‰ï¼ˆå³é‡å¤ï¼‰ã€‚<br>æ‰€ä»¥å¦‚æœè¦é‡å†™ä¿å­˜åœ¨HashSetä¸­çš„å¯¹è±¡çš„equalsæ–¹æ³•ï¼Œä¹Ÿè¦é‡å†™hashCodeæ–¹æ³•ï¼Œé‡å†™å‰åhashCodeè¿”å›çš„ç»“æœç›¸ç­‰ï¼ˆå³ä¿è¯ä¿å­˜åœ¨åŒä¸€ä¸ªä½ç½®ï¼‰ã€‚æ‰€æœ‰å‚ä¸è®¡ç®— hashCode() è¿”å›å€¼çš„å…³é”®å±æ€§ï¼Œéƒ½åº”è¯¥ç”¨äºä½œä¸º equals() æ¯”è¾ƒçš„æ ‡å‡†ã€‚<br>è¯•æƒ³å¦‚æœé‡å†™äº†equalsæ–¹æ³•ä½†ä¸é‡å†™hashCodeæ–¹æ³•ï¼Œå³ç›¸åŒequalsç»“æœçš„ä¸¤ä¸ªå¯¹è±¡å°†ä¼šè¢«HashSetå½“ä½œä¸¤ä¸ªå…ƒç´ ä¿å­˜èµ·æ¥ï¼Œè¿™ä¸æˆ‘ä»¬è®¾è®¡HashSetçš„åˆè¡·ä¸ç¬¦ï¼ˆå…ƒç´ ä¸é‡å¤ï¼‰ã€‚<br>å¦å¤–å¦‚æœä¸¤ä¸ªå…ƒç´ å“ˆå¸‚Codeç›¸ç­‰ä½†equalsç»“æœä¸ä¸ºtrueï¼ŒHashSetä¼šå°†è¿™ä¸¤ä¸ªå…ƒç´ ä¿å­˜åœ¨åŒä¸€ä¸ªä½ç½®ï¼Œå¹¶å°†è¶…è¿‡ä¸€ä¸ªçš„å…ƒç´ ä»¥é“¾è¡¨æ–¹å¼ä¿å­˜ï¼Œè¿™å°†å½±å“HashSetçš„æ•ˆç‡ã€‚<br>å¦‚æœé‡å†™äº†equalsæ–¹æ³•ä½†æ²¡æœ‰é‡å†™hashCodeæ–¹æ³•ï¼Œåˆ™HashSetå¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tests</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tests</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Tests&#123;"</span> + <span class="string">"count="</span> + count + <span class="string">" # hashCode="</span> + <span class="keyword">this</span>.hashCode() + <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        Tests r = (Tests) o;</span><br><span class="line">        <span class="keyword">return</span> count == r.count;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    @Override</span></span><br><span class="line"><span class="comment">//    public int hashCode() &#123;</span></span><br><span class="line"><span class="comment">//        return Objects.hash(count);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Set set = <span class="keyword">new</span> HashSet();</span><br><span class="line">        set.add(<span class="keyword">new</span> Tests(<span class="number">5</span>));</span><br><span class="line">        set.add(<span class="keyword">new</span> Tests(-<span class="number">3</span>));</span><br><span class="line">        set.add(<span class="keyword">new</span> Tests(<span class="number">9</span>));</span><br><span class="line">        set.add(<span class="keyword">new</span> Tests(-<span class="number">2</span>));</span><br><span class="line">        System.out.println(set.contains(<span class="keyword">new</span> Tests(-<span class="number">3</span>)));</span><br><span class="line">        System.out.println(set);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æ³¨é‡Šæ‰hashCodeæ–¹æ³•ï¼Œè¿è¡Œç»“æœï¼š</span><br><span class="line"><span class="keyword">false</span></span><br><span class="line">[Tests&#123;count=9 # hashCode=834600351&#125;, Tests&#123;count=-2 # hashCode=471910020&#125;, Tests&#123;count=-3 # hashCode=791452441&#125;, Tests&#123;count=5 # hashCode=321001045&#125;]</span><br><span class="line"></span><br><span class="line">å–æ¶ˆæ³¨é‡Šï¼Œè¿è¡Œç»“æœï¼š</span><br><span class="line"><span class="keyword">true</span></span><br><span class="line">[Tests&#123;count=5 # hashCode=36&#125;, Tests&#123;count=9 # hashCode=40&#125;, Tests&#123;count=-3 # hashCode=28&#125;, Tests&#123;count=-2 # hashCode=29&#125;]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="å¦‚ä½•è¾¾åˆ°ä¸èƒ½å­˜åœ¨é‡å¤å…ƒç´ çš„ç›®çš„ï¼Ÿ"><a href="#å¦‚ä½•è¾¾åˆ°ä¸èƒ½å­˜åœ¨é‡å¤å…ƒç´ çš„ç›®çš„ï¼Ÿ" class="headerlink" title="å¦‚ä½•è¾¾åˆ°ä¸èƒ½å­˜åœ¨é‡å¤å…ƒç´ çš„ç›®çš„ï¼Ÿ"></a>å¦‚ä½•è¾¾åˆ°ä¸èƒ½å­˜åœ¨é‡å¤å…ƒç´ çš„ç›®çš„ï¼Ÿ</h6><p>â€œé”®â€å°±æ˜¯æˆ‘ä»¬è¦å­˜å…¥çš„å¯¹è±¡ï¼Œâ€œå€¼â€åˆ™æ˜¯ä¸€ä¸ªå¸¸é‡ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ï¼Œæˆ‘ä»¬æ‰€éœ€è¦çš„å­˜å‚¨çš„ä¿¡æ¯æ˜¯â€œé”®â€ã€‚è€Œâ€œé”®â€åœ¨Mapä¸­æ˜¯ä¸èƒ½é‡å¤çš„ï¼Œè¿™å°±ä¿è¯äº†æˆ‘ä»¬å­˜å…¥Setä¸­çš„æ‰€æœ‰çš„å…ƒç´ éƒ½ä¸é‡å¤ã€‚<br>HashSetå¦‚ä½•è¿‡æ»¤é‡å¤å…ƒç´ <br>è°ƒç”¨å…ƒç´ HashCodeè·å¾—å“ˆå¸Œç â€”ã€‹åˆ¤æ–­å“ˆå¸Œç æ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰åˆ™å½•å…¥ â€”-ã€‹ç›¸ç­‰åˆ™åˆ¤æ–­equals()åæ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰åœ¨è¿›è¡Œ hashcodeå½•å…¥ï¼Œç›¸ç­‰ä¸å½•å…¥</p></blockquote><h4 id="LinkedHashSetï¼š"><a href="#LinkedHashSetï¼š" class="headerlink" title="LinkedHashSetï¼š"></a><strong>LinkedHashSet</strong>ï¼š</h4><p>æ˜¯HashSetçš„ä¸€ä¸ªå­ç±»ï¼ŒLinkedHashSetä¹Ÿæ ¹æ®HashCodeçš„å€¼æ¥å†³å®šå…ƒç´ çš„å­˜å‚¨ä½ç½®ï¼Œä½†åŒæ—¶å®ƒè¿˜ç”¨ä¸€ä¸ªé“¾è¡¨æ¥ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºï¼Œæ’å…¥çš„æ—¶å€™å³è¦è®¡ç®—hashCodeåˆè¦ç»´æŠ¤é“¾è¡¨ï¼Œè€Œéå†çš„æ—¶å€™åªéœ€è¦æŒ‰é“¾è¡¨æ¥è®¿é—®å…ƒç´ ã€‚æ­¤å®ç°ä¸HashSetçš„ä¸åŒä¹‹å¤–åœ¨äºï¼Œåè€…ç»´æŠ¤ç€ä¸€ä¸ªè¿è¡Œäºæ‰€æœ‰æ¡ç›®çš„åŒé‡é“¾æ¥åˆ—è¡¨ã€‚å­˜å‚¨çš„æ•°æ®æ˜¯æœ‰åºçš„ã€‚æŸ¥çœ‹LinkedHashSetçš„æºç å‘ç°å®ƒæ˜¯æ ·çš„ã€‚</p><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedHashSet</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">HashSet</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">Set</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">2851667679971038690L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedHashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(initialCapacity, loadFactor, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  </span><br></pre></td></tr></table></figure><p>JAVA8ä¸­ï¼Œ LinkedHashSetæ²¡æœ‰å®šä¹‰ä»»ä½•æ–¹æ³•ï¼Œåªæœ‰å››ä¸ªæ„é€ å‡½æ•°ï¼Œå®ƒçš„æ„é€ å‡½æ•°è°ƒç”¨äº†çˆ¶ç±»ï¼ˆHashSet)çš„å¸¦ä¸‰ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œçˆ¶ç±»çš„æ„é€ å‡½æ•°å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * Constructs a new, empty linked hash set.  (This package private</span><br><span class="line">    * constructor is only used by LinkedHashSet.) The backing</span><br><span class="line">    * HashMap instance is a LinkedHashMap with the specified initial</span><br><span class="line">    * capacity and the specified load factor.</span><br><span class="line">    *</span><br><span class="line">    * @param      initialCapacity   the initial capacity of the hash map</span><br><span class="line">    * @param      loadFactor        the load factor of the hash map</span><br><span class="line">    * @param      dummy             ignored (distinguishes this</span><br><span class="line">    *             constructor from other int, float constructor.)</span><br><span class="line">    * @throws     IllegalArgumentException if the initial capacity is less</span><br><span class="line">    *             than zero, or if the load factor is nonpositive</span><br><span class="line">    */</span><br><span class="line">   HashSet(int initialCapacity, float loadFactor, boolean dummy) &#123;</span><br><span class="line">       map = new LinkedHashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>LinkedHashSetæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä»LinkedHashMapè€Œæ¥ï¼ŒLinkedHashSetçš„æ‰€æœ‰æ–¹æ³•éƒ½ç»§æ‰¿è‡ªHashSet, è€Œå®ƒèƒ½ç»´æŒå…ƒç´ çš„æ’å…¥é¡ºåºçš„æ€§è´¨åˆ™ç»§æ‰¿è‡ªLinkedHashMap.</p><p><em>ä¸‹é¢æ˜¯ä¸€ä¸ªLinkedHashSetç»´æŒå…ƒç´ æ’å…¥é¡ºåºçš„ä¾‹å­</em>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.LinkedHashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tests</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Set set = <span class="keyword">new</span> LinkedHashSet();</span><br><span class="line">        set.add(<span class="string">"abc"</span>);</span><br><span class="line">        set.add(<span class="string">"efg"</span>);</span><br><span class="line">        set.add(<span class="string">"hjk"</span>);</span><br><span class="line">        System.out.println(set);</span><br><span class="line">        set.remove(<span class="keyword">new</span> String(<span class="string">"abc"</span>));</span><br><span class="line">        set.add(<span class="string">"abc"</span>);</span><br><span class="line">        System.out.println(set);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">[abc, efg, hjk]</span><br><span class="line">[efg, hjk, abc]</span><br></pre></td></tr></table></figure></blockquote><h4 id="TreeSetç±»çš„ç‰¹å¾"><a href="#TreeSetç±»çš„ç‰¹å¾" class="headerlink" title="TreeSetç±»çš„ç‰¹å¾"></a><strong>TreeSetç±»çš„ç‰¹å¾</strong></h4><p>TreeSetå®ç°äº†SortedSetæ¥å£ï¼Œé¡¾åæ€ä¹‰è¿™æ˜¯ä¸€ç§æ’åºçš„Seté›†åˆï¼ŒæŸ¥çœ‹jdkæºç å‘ç°åº•å±‚æ˜¯ç”¨TreeMapå®ç°çš„ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªçº¢é»‘æ ‘åŸç†ã€‚ æ­£å› ä¸ºå®ƒæ˜¯æ’åºäº†çš„ï¼Œæ‰€ä»¥ç›¸å¯¹HashSetæ¥è¯´ï¼ŒTreeSetæä¾›äº†ä¸€äº›é¢å¤–çš„æŒ‰æ’åºä½ç½®è®¿é—®å…ƒç´ çš„æ–¹æ³•ï¼Œä¾‹å¦‚first(), last(), lower(), higher(), subSet(), headSet(), tailSet().</p><blockquote><p>TreeSetçš„æ’åºåˆ†ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯è‡ªç„¶æ’åºï¼Œå¦ä¸€ç§æ˜¯å®šåˆ¶æ’åºã€‚</p><p><strong>è‡ªç„¶æ’åºï¼ˆåœ¨å…ƒç´ ä¸­å†™æ’åºè§„åˆ™ï¼‰</strong></p><p>TreeSet ä¼šè°ƒç”¨compareToæ–¹æ³•æ¯”è¾ƒå…ƒç´ å¤§å°ï¼Œç„¶åæŒ‰å‡åºæ’åºã€‚æ‰€ä»¥è‡ªç„¶æ’åºä¸­çš„å…ƒç´ å¯¹è±¡ï¼Œéƒ½å¿…é¡»å®ç°äº†Comparableæ¥å£ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å¯¹äºTreeSetåˆ¤æ–­å…ƒç´ æ˜¯å¦é‡å¤çš„æ ‡å‡†ï¼Œä¹Ÿæ˜¯è°ƒç”¨å…ƒç´ ä»Comparableæ¥å£ç»§æ‰¿è€Œæ¥é¢compareToæ–¹æ³•ï¼Œå¦‚æœè¿”å›0åˆ™æ˜¯é‡å¤å…ƒç´ ï¼ˆä¸¤ä¸ªå…ƒç´ Iç›¸ç­‰ï¼‰ã€‚Javaçš„å¸¸è§ç±»éƒ½å·²ç»å®ç°äº†Comparableæ¥å£ï¼Œ</p><p>ä¸‹é¢ä¸¾ä¾‹è¯´æ˜æ²¡æœ‰å®ç°Comparableå­˜å…¥TreeSetæ—¶å¼•å‘å¼‚å¸¸çš„æƒ…å†µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeSet;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSets</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Set set = <span class="keyword">new</span> TreeSet();</span><br><span class="line">        set.add(<span class="keyword">new</span> Err());</span><br><span class="line">        set.add(<span class="keyword">new</span> Err());</span><br><span class="line">        set.add(<span class="keyword">new</span> Err());</span><br><span class="line">        System.out.println(set);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Err</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¿è¡Œç¨‹åºä¼šæŠ›å‡ºå¦‚ä¸‹å¼‚å¸¸:</span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.ClassCastException: clc.Err cannot be cast to java.lang.Comparable</span><br><span class="line">at java.util.TreeMap.compare(TreeMap.java:<span class="number">1294</span>)</span><br><span class="line">at java.util.TreeMap.put(TreeMap.java:<span class="number">538</span>)</span><br><span class="line">at java.util.TreeSet.add(TreeSet.java:<span class="number">255</span>)</span><br><span class="line">at clc.TestSets.main(TestSets.java:<span class="number">17</span>)</span><br></pre></td></tr></table></figure><p>å°†ä¸Šé¢çš„Errç±»å®ç°Comparableæ¥å£ä¹‹åç¨‹åºå°±èƒ½æ­£å¸¸è¿è¡Œäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Err</span> <span class="keyword">implements</span> <span class="title">Comparable</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸ªé‡è¦é—®é¢˜æ˜¯ï¼Œå› ä¸ºTreeSetä¼šè°ƒç”¨å…ƒç´ çš„compareToæ–¹æ³•ï¼Œè¿™å°±è¦æ±‚æ‰€æœ‰å…ƒç´ çš„ç±»å‹éƒ½ç›¸åŒï¼Œå¦åˆ™ä¹Ÿä¼šå‘ç”Ÿå¼‚å¸¸ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒTreeSetåªå…è®¸å­˜å…¥åŒä¸€ç±»çš„å…ƒç´ ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­å°±ä¼šæŠ›å‡ºç±»å‹è½¬æ¢å¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  Set set = <span class="keyword">new</span> TreeSet();</span><br><span class="line">  set.add(<span class="number">1</span>);</span><br><span class="line">  set.add(<span class="string">"2"</span>);</span><br><span class="line">  System.out.println(set);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœ:</span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.ClassCastException: java.lang.Integer cannot be cast to java.util.Date</span><br><span class="line">at java.util.Date.compareTo(Date.java:<span class="number">131</span>)</span><br><span class="line">at java.util.TreeMap.put(TreeMap.java:<span class="number">568</span>)</span><br><span class="line">at java.util.TreeSet.add(TreeSet.java:<span class="number">255</span>)</span><br><span class="line">at clc.TestSets.main(TestSets.java:<span class="number">19</span>)</span><br></pre></td></tr></table></figure><h6 id="å®šåˆ¶æ’åºï¼ˆåœ¨é›†åˆä¸­å†™æ’åºè§„åˆ™ï¼‰"><a href="#å®šåˆ¶æ’åºï¼ˆåœ¨é›†åˆä¸­å†™æ’åºè§„åˆ™ï¼‰" class="headerlink" title="å®šåˆ¶æ’åºï¼ˆåœ¨é›†åˆä¸­å†™æ’åºè§„åˆ™ï¼‰"></a>å®šåˆ¶æ’åºï¼ˆåœ¨é›†åˆä¸­å†™æ’åºè§„åˆ™ï¼‰</h6><p>TreeSetè¿˜æœ‰ä¸€ç§æ’åºå°±æ˜¯å®šåˆ¶æ’åºï¼Œå®šåˆ¶æ’åºæ—¶å€™ï¼Œéœ€è¦å…³è”ä¸€ä¸ªComparatorå¯¹è±¡ï¼Œç”±Comparatoræä¾›æ’åºé€»è¾‘ã€‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªä½¿ç”¨Lambdaè¡¨è¾¾å¼ä»£æ›¿Comparatorå¯¹è±¡æ¥æä¾›å®šåˆ¶æ’åºçš„ä¾‹å­ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®šåˆ¶æ’åºçš„åˆ—å­ï¼šç±»ä¼¼äºC++å®¹å™¨sort()çš„å‚æ•°bool cmp(){}å‡½æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tests</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Set set = <span class="keyword">new</span> TreeSet(<span class="keyword">new</span> MyCommpare());</span><br><span class="line">        set.add(<span class="keyword">new</span> M(<span class="number">5</span>));</span><br><span class="line">        set.add(<span class="keyword">new</span> M(<span class="number">3</span>));</span><br><span class="line">        set.add(<span class="keyword">new</span> M(<span class="number">9</span>));</span><br><span class="line">        System.out.println(set);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">M</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">M</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"age:"</span> + age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCommpare</span> <span class="keyword">implements</span> <span class="title">Comparator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Object o1, Object o2)</span> </span>&#123;</span><br><span class="line">        M m1 = (M) o1;</span><br><span class="line">        M m2 = (M) o2;</span><br><span class="line">        <span class="keyword">return</span> m1.age &gt; m2.age ? <span class="number">1</span> : m1.age &lt; m2.age ? -<span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">[age:<span class="number">3</span>, age:<span class="number">5</span>, age:<span class="number">9</span>]</span><br></pre></td></tr></table></figure><p>å½“ç„¶å°†Comparatorç›´æ¥å†™å…¥TreeSetåˆå§‹åŒ–ä¸­ä¹Ÿå¯ä»¥ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tests</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Set set = <span class="keyword">new</span> TreeSet(<span class="keyword">new</span> MyCommpare());</span><br><span class="line">        set.add(<span class="keyword">new</span> M(<span class="number">5</span>));</span><br><span class="line">        set.add(<span class="keyword">new</span> M(<span class="number">3</span>));</span><br><span class="line">        set.add(<span class="keyword">new</span> M(<span class="number">9</span>));</span><br><span class="line">        System.out.println(set);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description: å°†Comparatorç›´æ¥å†™å…¥TreeSetåˆå§‹åŒ–ä¸­1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTreeSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Set set = <span class="keyword">new</span> TreeSet(<span class="keyword">new</span> Comparator() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Object o1, Object o2)</span> </span>&#123;</span><br><span class="line">                M m1 = (M) o1;</span><br><span class="line">                M m2 = (M) o2;</span><br><span class="line">                <span class="keyword">return</span> m1.age &gt; m2.age ? <span class="number">1</span> : m1.age &lt; m2.age ? -<span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        set.add(<span class="keyword">new</span> M(<span class="number">5</span>));</span><br><span class="line">        set.add(<span class="keyword">new</span> M(<span class="number">3</span>));</span><br><span class="line">        set.add(<span class="keyword">new</span> M(<span class="number">9</span>));</span><br><span class="line">        System.out.println(set);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description: å°†Comparatorç›´æ¥å†™å…¥TreeSetåˆå§‹åŒ–ä¸­</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTreeSetLam</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Set set = <span class="keyword">new</span> TreeSet((o1, o2) -&gt; &#123;</span><br><span class="line">            M m1 = (M) o1;</span><br><span class="line">            M m2 = (M) o2;</span><br><span class="line">            <span class="keyword">return</span> m1.age &gt; m2.age ? <span class="number">1</span> : m1.age &lt; m2.age ? -<span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        set.add(<span class="keyword">new</span> M(<span class="number">5</span>));</span><br><span class="line">        set.add(<span class="keyword">new</span> M(<span class="number">3</span>));</span><br><span class="line">        set.add(<span class="keyword">new</span> M(<span class="number">9</span>));</span><br><span class="line">        System.out.println(set);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">M</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">M</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"age:"</span> + age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCommpare</span> <span class="keyword">implements</span> <span class="title">Comparator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Object o1, Object o2)</span> </span>&#123;</span><br><span class="line">        M m1 = (M) o1;</span><br><span class="line">        M m2 = (M) o2;</span><br><span class="line">        <span class="keyword">return</span> m1.age &gt; m2.age ? <span class="number">1</span> : m1.age &lt; m2.age ? -<span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Err</span> <span class="keyword">implements</span> <span class="title">Comparable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">[age:<span class="number">3</span>, age:<span class="number">5</span>, age:<span class="number">9</span>]</span><br></pre></td></tr></table></figure><p>TreeSetæ˜¯ä¸€ä¸ªæœ‰åºé›†åˆï¼ŒTreeSetä¸­å…ƒç´ å°†æŒ‰ç…§å‡åºæ’åˆ—ï¼Œç¼ºçœæ˜¯æŒ‰ç…§è‡ªç„¶é¡ºåºè¿›è¡Œæ’åˆ—ï¼Œæ„å‘³ç€TreeSetä¸­å…ƒç´ è¦å®ç°Comparableæ¥å£ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ„é€ TreeSetå¯¹è±¡æ—¶ï¼Œä¼ é€’å®ç°äº†Comparatoræ¥å£çš„æ¯”è¾ƒå™¨å¯¹è±¡ã€‚</p><p><strong>Comparableå’ŒComparator</strong><br>Comparable æ¥å£ä»¥æä¾›è‡ªç„¶æ’åºé¡ºåºã€‚<br>å¯¹äºé‚£äº›æ²¡æœ‰è‡ªç„¶é¡ºåºçš„ç±»ã€æˆ–è€…å½“æ‚¨æƒ³è¦ä¸€ä¸ªä¸åŒäºè‡ªç„¶é¡ºåºçš„é¡ºåºæ—¶ï¼Œæ‚¨å¯ä»¥å®ç°Comparator æ¥å£æ¥å®šä¹‰æ‚¨è‡ªå·±çš„æ’åºå‡½æ•°ã€‚å¯ä»¥å°†Comparatorä¼ é€’ç»™Collections.sortæˆ–Arrays.sortã€‚</p><p><strong>Comparatoræ¥å£</strong><br>å½“ä¸€ä¸ªç±»å¹¶æœªå®ç°Comparableï¼Œæˆ–è€…ä¸å–œæ¬¢ç¼ºçœçš„Comaparableè¡Œä¸ºã€‚å¯ä»¥å®ç°Comparatoræ¥å£<br>ç›´æ¥å®ç°Comparatorçš„compareæ¥å£å®Œæˆè‡ªå®šä¹‰æ¯”è¾ƒç±»ã€‚<br>ä¾‹ï¼šArrays.sort(results, new Comparator<RepDataQueryResultVO>() æ•°ç»„æ’åº RepDataQueryExecutor<br>ä¾‹ï¼šCollections.sort(lst,new Comparator<TaskPrintSchemeVO>()</p></blockquote><ul><li><p><strong>EnumSetç‰¹å¾</strong><br>EnumSeté¡¾åæ€ä¹‰å°±æ˜¯ä¸“ä¸ºæšä¸¾ç±»å‹è®¾è®¡çš„é›†åˆï¼Œå› æ­¤é›†åˆå…ƒç´ å¿…é¡»æ˜¯æšä¸¾ç±»å‹ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ EnumSeté›†åˆä¹Ÿæ˜¯æœ‰åºçš„ï¼Œå…¶é¡ºåºå°±æ˜¯Enumç±»å†…å…ƒç´ å®šä¹‰çš„é¡ºåºã€‚ EnumSetå­˜å–çš„é€Ÿåº¦éå¸¸å¿«ï¼Œæ‰¹é‡æ“ä½œçš„é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚EnumSetä¸»è¦æä¾›ä»¥ä¸‹æ–¹æ³•ï¼ŒallOf, complementOf, copyOf, noneOf, of, rangeç­‰ã€‚æ³¨æ„åˆ°EnumSetå¹¶æ²¡æœ‰æä¾›ä»»ä½•æ„é€ å‡½æ•°ï¼Œè¦åˆ›å»ºä¸€ä¸ªEnumSeté›†åˆå¯¹è±¡ï¼Œåªéœ€è¦è°ƒç”¨allOfç­‰æ–¹æ³•ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªEnumSetçš„ä¾‹å­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.EnumSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnumSets</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        EnumSet es1 = EnumSet.allOf(Season<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(es1);</span><br><span class="line">        EnumSet es2 = EnumSet.noneOf(Season<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        es2.add(Season.WINTER);</span><br><span class="line">        es2.add(Season.SUMER);</span><br><span class="line">        System.out.println(es2);</span><br><span class="line">        EnumSet es3 = EnumSet.of(Season.WINTER, Season.SUMER);</span><br><span class="line">        System.out.println(es3);</span><br><span class="line">        EnumSet es4 = EnumSet.range(Season.SUMER,Season.WINTER );</span><br><span class="line">        System.out.println(es4);</span><br><span class="line">        EnumSet es5 = EnumSet.complementOf(es4);</span><br><span class="line">        System.out.println(es5);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> Season &#123;</span><br><span class="line">    SPRING, SUMER, FALL, WINTER</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">[SPRING, SUMER, FALL, WINTER]</span><br><span class="line">[SUMER, WINTER]</span><br><span class="line">[SUMER, WINTER]</span><br><span class="line">[SUMER, FALL, WINTER]</span><br><span class="line">[SPRING]</span><br></pre></td></tr></table></figure></li></ul><h4 id="å‡ ç§Setçš„æ¯”è¾ƒï¼š"><a href="#å‡ ç§Setçš„æ¯”è¾ƒï¼š" class="headerlink" title="å‡ ç§Setçš„æ¯”è¾ƒï¼š"></a><strong>å‡ ç§Setçš„æ¯”è¾ƒ</strong>ï¼š</h4><ul><li>HashSetå¤–éƒ¨æ— åºåœ°éå†æˆå‘˜ï¼Œæˆå‘˜å¯ä¸ºä»»æ„Objectå­ç±»çš„å¯¹è±¡ï¼Œä½†å¦‚æœè¦†ç›–äº†equalsæ–¹æ³•ï¼ŒåŒæ—¶æ³¨æ„ä¿®æ”¹hashCodeæ–¹æ³•ã€‚HashSetæ˜¯åŸºäºHashç®—æ³•å®ç°çš„ï¼Œå…¶æ€§èƒ½é€šå¸¸éƒ½ä¼˜äºTreeSetã€‚æˆ‘ä»¬é€šå¸¸éƒ½åº”è¯¥ä½¿ç”¨HashSetï¼Œåœ¨æˆ‘ä»¬éœ€è¦æ’åºçš„åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬æ‰ä½¿ç”¨TreeSetã€‚</li><li>TreeSetå¤–éƒ¨æœ‰åºåœ°éå†æˆå‘˜ï¼›é™„åŠ å®ç°äº†SortedSet, æ”¯æŒå­é›†ç­‰è¦æ±‚é¡ºåºçš„æ“ä½œï¼Œæˆå‘˜è¦æ±‚å®ç°Comparableæ¥å£ï¼Œæˆ–è€…ä½¿ç”¨Comparatoræ„é€ TreeSetã€‚æˆå‘˜ä¸€èˆ¬ä¸ºåŒä¸€ç±»å‹ã€‚</li><li>LinkedHashSetå¤–éƒ¨æŒ‰æˆå‘˜çš„æ’å…¥é¡ºåºéå†æˆå‘˜ï¼Œæˆå‘˜ä¸HashSetæˆå‘˜ç±»ä¼¼ã€‚</li><li>HashSetçš„å…ƒç´ å­˜æ”¾é¡ºåºå’Œæˆ‘ä»¬æ·»åŠ è¿›å»æ—¶å€™çš„é¡ºåºæ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œè€ŒLinkedHashSet åˆ™ä¿æŒå…ƒç´ çš„æ·»åŠ é¡ºåºã€‚TreeSetåˆ™æ˜¯å¯¹æˆ‘ä»¬çš„Setä¸­çš„å…ƒç´ è¿›è¡Œæ’åºå­˜æ”¾ã€‚</li><li>ä¸€èˆ¬æ¥è¯´ï¼Œå½“æ‚¨è¦ä»é›†åˆä¸­ä»¥æœ‰åºçš„æ–¹å¼æŠ½å–å…ƒç´ æ—¶ï¼ŒTreeSetå®ç°å°±ä¼šæœ‰ç”¨å¤„ã€‚ä¸ºäº†èƒ½é¡ºåˆ©è¿›è¡Œï¼Œæ·»åŠ åˆ° TreeSet çš„å…ƒç´ å¿…é¡»æ˜¯å¯æ’åºçš„ã€‚ è€Œæ‚¨åŒæ ·éœ€è¦å¯¹æ·»åŠ åˆ°TreeSetä¸­çš„ç±»å¯¹è±¡å®ç° Comparable æ¥å£çš„æ”¯æŒã€‚ä¸€èˆ¬è¯´æ¥ï¼Œå…ˆæŠŠå…ƒç´ æ·»åŠ åˆ° HashSetï¼Œå†æŠŠé›†åˆè½¬æ¢ä¸º TreeSet æ¥è¿›è¡Œæœ‰åºéå†ä¼šæ›´å¿«ã€‚</li></ul><h4 id="å„ç§Seté›†åˆæ€§èƒ½åˆ†æï¼š"><a href="#å„ç§Seté›†åˆæ€§èƒ½åˆ†æï¼š" class="headerlink" title="å„ç§Seté›†åˆæ€§èƒ½åˆ†æï¼š"></a><strong>å„ç§Seté›†åˆæ€§èƒ½åˆ†æ</strong>ï¼š</h4><ul><li>HashSetå’ŒTreeSetæ˜¯Seté›†åˆä¸­ç”¨å¾—æœ€å¤šçš„Ié›†åˆã€‚HashSetæ€»æ˜¯æ¯”TreeSeté›†åˆæ€§èƒ½å¥½ï¼Œå› ä¸ºHashSetä¸éœ€è¦é¢ç»´æŠ¤å…ƒç´ çš„é¡ºåºã€‚</li><li>LinkedHashSetéœ€è¦ç”¨é¢å¤–çš„é“¾è¡¨ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºï¼Œå› æ­¤åœ¨æ’å…¥æ—¶æ€§èƒ½æ¯”HashSetä½ï¼Œä½†åœ¨è¿­ä»£è®¿é—®ï¼ˆéå†ï¼‰æ—¶æ€§èƒ½æ›´é«˜ã€‚å› ä¸ºæ’å…¥çš„æ—¶å€™å³è¦è®¡ç®—hashCodeåˆè¦ç»´æŠ¤é“¾è¡¨ï¼Œè€Œéå†çš„æ—¶å€™åªéœ€è¦æŒ‰é“¾è¡¨æ¥è®¿é—®å…ƒç´ ã€‚</li><li>EnumSetå…ƒç´ æ˜¯æ‰€æœ‰Setå…ƒç´ ä¸­æ€§èƒ½æœ€å¥½çš„ï¼Œä½†æ˜¯å®ƒåªèƒ½ä¿å­˜Enumç±»å‹çš„å…ƒç´ </li></ul><h2 id="å››-å®ç°Mapæ¥å£çš„é›†åˆåŒºåˆ«"><a href="#å››-å®ç°Mapæ¥å£çš„é›†åˆåŒºåˆ«" class="headerlink" title="å››. å®ç°Mapæ¥å£çš„é›†åˆåŒºåˆ«"></a>å››. å®ç°Mapæ¥å£çš„é›†åˆåŒºåˆ«</h2><p>å®ƒæä¾›äº†ä¸€ç»„é”®å€¼çš„æ˜ å°„ã€‚å…¶ä¸­å­˜å‚¨çš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„å…³é”®å­—(key)ï¼Œå…³é”®å­—å†³å®šäº†å¯¹è±¡åœ¨Mapä¸­çš„å­˜å‚¨ä½ç½®ã€‚<br>å…³é”®å­—åº”è¯¥æ˜¯å”¯ä¸€çš„ï¼Œæ¯ä¸ªkey åªèƒ½æ˜ å°„ä¸€ä¸ªvalueã€‚å®ç°ç±»æœ‰HashMapã€TreeMapã€LinkedHashMapã€Hashtableç­‰</p><ul><li>HashMapï¼šé”®å€¼å¯¹ï¼Œkeyä¸èƒ½é‡å¤ï¼Œä½†æ˜¯valueå¯ä»¥é‡å¤ï¼›keyçš„å®ç°å°±æ˜¯HashSetï¼›valueå¯¹åº”ç€æ”¾ï¼›å…è®¸nullçš„é”®æˆ–å€¼ï¼›</li><li>Hashtableï¼šçº¿ç¨‹å®‰å…¨çš„ï¼Œä¸å…è®¸nullçš„é”®æˆ–å€¼ï¼›</li><li>Properties:ï¼škeyå’Œvalueéƒ½æ˜¯Stringç±»å‹ï¼Œç”¨æ¥è¯»é…ç½®æ–‡ä»¶ï¼›</li><li>TreeMapï¼šå¯¹keyæ’å¥½åºçš„Map; key å°±æ˜¯TreeSet, valueå¯¹åº”æ¯ä¸ªkey; keyè¦å®ç°Comparableæ¥å£æˆ–TreeMapæœ‰è‡ªå·±çš„æ„é€ å™¨ï¼›</li><li>LinkedHashMapï¼š æ­¤å®ç°ä¸HashMapçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œåè€…ç»´æŠ¤ç€ä¸€ä¸ªè¿è¡Œäºæ‰€æœ‰æ¡ç›®çš„åŒé‡é“¾æ¥åˆ—è¡¨ã€‚å­˜å‚¨çš„æ•°æ®æ˜¯æœ‰åºçš„ã€‚</li></ul><h3 id="HashMapï¼š"><a href="#HashMapï¼š" class="headerlink" title="HashMapï¼š"></a>HashMapï¼š</h3><ul><li>Map ä¸»è¦ç”¨äºå­˜å‚¨é”®(key)å€¼(value)å¯¹ï¼Œæ ¹æ®é”®å¾—åˆ°å€¼ï¼Œå› æ­¤é”®ä¸å…è®¸é‡å¤,ä½†å…è®¸å€¼é‡å¤ã€‚</li><li>HashMap æ˜¯ä¸€ä¸ªæœ€å¸¸ç”¨çš„Map,å®ƒæ ¹æ®é”®çš„HashCodeå€¼å­˜å‚¨æ•°æ®,æ ¹æ®é”®å¯ä»¥ç›´æ¥è·å–å®ƒçš„å€¼ï¼Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ã€‚</li><li>HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºNull;å…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸º Null;</li><li>HashMapä¸æ”¯æŒçº¿ç¨‹çš„åŒæ­¥ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMap;å¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚å¦‚æœéœ€è¦åŒæ­¥ï¼Œå¯ä»¥ç”¨ Collectionsçš„synchronizedMapæ–¹æ³•ä½¿HashMapå…·æœ‰åŒæ­¥çš„èƒ½åŠ›ã€‚</li></ul><blockquote><p> HashMapå®ç°åŸç†â€”-æ•£åˆ—</p><p>Hashå“ˆå¸Œç®—æ³•çš„æ„ä¹‰åœ¨äºæä¾›äº†ä¸€ç§å¿«é€Ÿå­˜å–æ•°æ®çš„æ–¹æ³•,å®ƒç”¨ä¸€ç§ç®—æ³•å»ºç«‹é”®å€¼ä¸çœŸå®å€¼ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚æ•£åˆ—è¡¨åˆç§°ä¸ºå“ˆå¸Œè¡¨ã€‚æ•£åˆ—è¡¨ç®—æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šä»¥ç»“ç‚¹çš„å…³é”®å­—ä¸ºè‡ªå˜é‡ï¼Œé€šè¿‡ä¸€å®šçš„å‡½æ•°å…³ç³»ï¼ˆæ•£åˆ—å‡½æ•°ï¼‰è®¡ç®—å‡ºå¯¹åº”çš„å‡½æ•°å€¼ï¼Œä»¥è¿™ä¸ªå€¼ä½œä¸ºè¯¥ç»“ç‚¹å­˜å‚¨åœ¨æ•£åˆ—è¡¨ä¸­åœ°å€ã€‚<br>å½“æ•£åˆ—è¡¨ä¸­çš„å…ƒç´ å­˜æ”¾å¤ªæ»¡ï¼Œå°±å¿…é¡»è¿›è¡Œå†æ•£åˆ—ï¼Œå°†äº§ç”Ÿä¸€ä¸ªæ–°çš„æ•£åˆ—è¡¨ï¼Œæ‰€æœ‰å…ƒç´ å­˜æ”¾åˆ°æ–°çš„æ•£åˆ—è¡¨ä¸­ï¼ŒåŸå…ˆçš„æ•£åˆ—è¡¨å°†è¢«åˆ é™¤ã€‚åœ¨Javaè¯­è¨€ä¸­ï¼Œé€šè¿‡è´Ÿè½½å› å­(load factor)æ¥å†³å®šä½•æ—¶å¯¹æ•£åˆ—è¡¨è¿›è¡Œå†æ•£åˆ—ã€‚ä¾‹å¦‚ï¼šå¦‚æœè´Ÿè½½å› å­0.75ï¼Œå½“æ•£åˆ—è¡¨ä¸­å·²ç»æœ‰75%ä½ç½®å·²ç»æ”¾æ»¡ï¼Œé‚£ä¹ˆå°†è¿›è¡Œå†æ•£åˆ—ã€‚<br>è´Ÿè½½å› å­è¶Šé«˜(è¶Šæ¥è¿‘1.0)ï¼Œå†…å­˜çš„ä½¿ç”¨æ•ˆç‡è¶Šé«˜ï¼Œå…ƒç´ çš„å¯»æ‰¾æ—¶é—´è¶Šé•¿ã€‚è´Ÿè½½å› å­è¶Šä½(è¶Šæ¥è¿‘0.0)ï¼Œå…ƒç´ çš„å¯»æ‰¾æ—¶é—´è¶ŠçŸ­ï¼Œå†…å­˜æµªè´¹è¶Šå¤šã€‚</p></blockquote><h3 id="ä½•æ—¶éœ€é‡å†™equalsï¼Ÿ"><a href="#ä½•æ—¶éœ€é‡å†™equalsï¼Ÿ" class="headerlink" title="ä½•æ—¶éœ€é‡å†™equalsï¼Ÿ"></a><strong>ä½•æ—¶éœ€é‡å†™</strong>equalsï¼Ÿ</h3><p>å½“ä¸€ä¸ªç±»æœ‰è‡ªå·±ç‰¹æœ‰çš„â€œé€»è¾‘ç›¸ç­‰â€æ¦‚å¿µï¼ˆä¸åŒäºå¯¹è±¡èº«ä»½çš„æ¦‚å¿µï¼‰ï¼›<br>Objectç±»ä»…ä»…æä¾›äº†ä¸€ä¸ªå¯¹å¼•ç”¨çš„æ¯”è¾ƒï¼Œå¦‚æœä¸¤ä¸ªå¼•ç”¨ä¸æ˜¯åŒä¸€ä¸ªé‚£å°±è¿”å›falseï¼Œè¿™æ˜¯æ— æ³•æ»¡è¶³å¤§å¤šæ•°å¯¹è±¡æ¯”è¾ƒçš„éœ€è¦çš„ï¼Œæ‰€ä»¥è¦è¦†ç›–ï¼›<br>ä½¿ç”¨==æ“ä½œç¬¦æ£€æŸ¥å®å‚æ˜¯å¦ä¸ºæŒ‡å‘å¯¹è±¡çš„å¼•ç”¨â€<br>ä½¿ç”¨instanceofæ“ä½œç¬¦æ£€æŸ¥å®å‚æ˜¯å¦ä¸ºæ­£ç¡®çš„ç±»å‹<br>æŠŠå®å‚è½¬æ¢åˆ°æ­£ç¡®çš„ç±»å‹ï¼›<br>å¯¹äºè¯¥ç±»ä¸­æ¯ä¸€ä¸ªâ€œå…³é”®â€åŸŸï¼Œæ£€æŸ¥å®å‚ä¸­çš„åŸŸä¸å½“å‰å¯¹è±¡ä¸­å¯¹åº”çš„åŸŸå€¼æ˜¯å¦åŒ¹é…ã€‚<strong>å¯¹äºæ—¢ä¸æ˜¯floatä¹Ÿä¸æ˜¯doubleç±»å‹çš„åŸºæœ¬ç±»å‹çš„åŸŸï¼Œå¯ä»¥ä½¿ç”¨==æ“ä½œç¬¦è¿›è¡Œæ¯”è¾ƒï¼›å¯¹äºå¯¹è±¡å¼•ç”¨ç±»å‹çš„åŸŸï¼Œå¯ä»¥é€’å½’åœ°è°ƒç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„equalsæ–¹æ³•</strong>ï¼Œå¯¹äºfloatå’Œdoubleç±»å‹çš„åŸŸï¼Œå…ˆè½¬æ¢æˆintæˆ–longç±»å‹çš„å€¼ï¼Œç„¶åä½¿ç”¨==æ“ä½œç¬¦æ¯”è¾ƒï¼›<br>å½“ä½ ç¼–å†™å®Œæˆäº†equalsæ–¹æ³•ä¹‹åï¼Œåº”è¯¥é—®è‡ªå·±ä¸‰ä¸ªé—®é¢˜ï¼šå®ƒæ˜¯å¦æ˜¯å¯¹ç§°çš„ã€ä¼ é€’çš„ã€ä¸€è‡´çš„ï¼Ÿ å¦‚æœç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œé‚£ä¹ˆè¯·æ‰¾åˆ° è¿™äº›ç‰¹æ€§æœªèƒ½æ»¡è¶³çš„åŸå› ï¼Œå†ä¿®æ”¹equalsæ–¹æ³•çš„ä»£ç </p><h3 id="equals-å’ŒhashCode-åŒæ—¶è¦†å†™"><a href="#equals-å’ŒhashCode-åŒæ—¶è¦†å†™" class="headerlink" title="equals()å’ŒhashCode()åŒæ—¶è¦†å†™"></a><strong>equals</strong>()å’ŒhashCode()åŒæ—¶è¦†å†™</h3><p>å°¤å…¶å¼ºè°ƒå½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œé”®å€¼ï¼ˆæˆ–ç´¢å¼•ï¼‰æ¥ä½¿ç”¨çš„æ—¶å€™è¦é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•ï¼›<br>è¦†å†™equalsåï¼Œä¸¤ä¸ªä¸åŒå®ä¾‹å¯èƒ½åœ¨é€»è¾‘ä¸Šç›¸ç­‰ï¼Œä½†æ˜¯æ ¹æ®Object.hashCodeæ–¹æ³•å´äº§ç”Ÿä¸åŒçš„æ•£åˆ—ç ï¼Œè¿åâ€œç›¸ç­‰çš„å¯¹è±¡å¿…é¡»å…·æœ‰ç›¸ç­‰çš„æ•£åˆ—ç â€ã€‚<br>å¯¼è‡´ï¼Œå½“ä½ ç”¨å…¶ä¸­çš„ä¸€ä¸ªä½œä¸ºé”®ä¿å­˜åˆ°hashMapã€hasoTableæˆ–hashSetä¸­ï¼Œå†ä»¥â€œç›¸ç­‰çš„â€æ‰¾å¦ä¸€ä¸ªä½œä¸ºé”®å€¼å»æŸ¥æ‰¾ä»–ä»¬çš„æ—¶å€™ï¼Œåˆ™æ ¹æœ¬æ‰¾ä¸åˆ°ã€‚</p><p>ä¸åŒç±»å‹çš„hashCodeå–å€¼</p><ul><li>å¦‚æœè¯¥åŸŸæ˜¯å¸ƒå°”å‹çš„ï¼Œè®¡ç®—ï¼ˆf ï¼Ÿ0ï¼š1ï¼‰</li><li>å¦‚æœæ˜¯char,short,byteæˆ–intï¼Œè®¡ç®—(int)f</li><li>å¦‚æœæ˜¯longç±»å‹ï¼Œè®¡ç®—ï¼ˆintï¼‰(f^(f&gt;&gt;&gt;32))</li><li>å¦‚æœæ˜¯floatç±»å‹ï¼Œè®¡ç®—Float.floatToIntBitsï¼ˆfï¼‰</li><li>å¦‚æœæ˜¯doubleç±»å‹ï¼Œè®¡ç®—Dobule.doubleToLongBits(f)</li><li>å¦‚æœè¯¥åŸŸæ˜¯ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œé€’å½’è°ƒç”¨hashCode</li><li>å¦‚æœè¯¥åŸŸæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™æŠŠæ¯ä¸ªå…ƒç´ å½“åšå•ç‹¬çš„åŸŸæ¥å¤„ç†ï¼Œå¯¹æ¯ä¸ªé‡è¦çš„å…ƒç´ è®¡ç®—ä¸€ä¸ªæ•£åˆ—ç </li></ul><h3 id="Mapé›†åˆæ¯”è¾ƒï¼š"><a href="#Mapé›†åˆæ¯”è¾ƒï¼š" class="headerlink" title="Mapé›†åˆæ¯”è¾ƒï¼š"></a><strong>Mapé›†åˆæ¯”è¾ƒï¼š</strong></h3><ul><li>HashMapçš„å­˜å…¥é¡ºåºå’Œè¾“å‡ºé¡ºåºæ— å…³ã€‚</li><li>LinkedHashMap åˆ™ä¿ç•™äº†é”®å€¼å¯¹çš„å­˜å…¥é¡ºåºã€‚</li><li>TreeMapåˆ™æ˜¯å¯¹Mapä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚</li><li>å› ä¸ºHashMapå’ŒLinkedHashMap å­˜å‚¨æ•°æ®çš„é€Ÿåº¦æ¯”ç›´æ¥ä½¿ç”¨TreeMap è¦å¿«ï¼Œå­˜å–æ•ˆç‡è¦é«˜ã€‚</li><li>å½“å®Œæˆäº†æ‰€æœ‰çš„å…ƒç´ çš„å­˜æ”¾åï¼Œæˆ‘ä»¬å†å¯¹æ•´ä¸ªçš„Mapä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚è¿™æ ·å¯ä»¥æé«˜æ•´ä¸ªç¨‹åºçš„è¿è¡Œçš„æ•ˆç‡ï¼Œç¼©çŸ­æ‰§è¡Œæ—¶é—´ã€‚</li></ul><p>æ³¨æ„ï¼šTreeMapä¸­æ˜¯æ ¹æ®é”®ï¼ˆKeyï¼‰è¿›è¡Œæ’åºçš„ã€‚è€Œå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨TreeMapæ¥è¿›è¡Œæ­£å¸¸çš„æ’åºçš„è¯ï¼ŒKey ä¸­å­˜æ”¾çš„å¯¹è±¡å¿…é¡»å®ç°Comparable æ¥å£ã€‚</p><h3 id="Mapå¸¸ç”¨æ–¹æ³•ï¼š"><a href="#Mapå¸¸ç”¨æ–¹æ³•ï¼š" class="headerlink" title="Mapå¸¸ç”¨æ–¹æ³•ï¼š"></a><strong>Mapå¸¸ç”¨æ–¹æ³•ï¼š</strong></h3><ul><li>Object put(Object key,Object value)ï¼šç”¨æ¥å­˜æ”¾ä¸€ä¸ªé”®-å€¼å¯¹Mapä¸­</li><li>Object remove(Object key)ï¼šæ ¹æ®key(é”®)ï¼Œç§»é™¤é”®-å€¼å¯¹ï¼Œå¹¶å°†å€¼è¿”å›</li><li>void putAll(Map mapping) ï¼šå°†å¦å¤–ä¸€ä¸ªMapä¸­çš„å…ƒç´ å­˜å…¥å½“å‰çš„Mapä¸­</li><li>void clear() ï¼šæ¸…ç©ºå½“å‰Mapä¸­çš„å…ƒç´ </li><li>Object get(Object key) ï¼šæ ¹æ®key(é”®)å–å¾—å¯¹åº”çš„å€¼</li><li>boolean containsKey(Object key) ï¼šåˆ¤æ–­Mapä¸­æ˜¯å¦å­˜åœ¨æŸé”®ï¼ˆkeyï¼‰</li><li>boolean containsValue(Object value):åˆ¤æ–­Mapä¸­æ˜¯å¦å­˜åœ¨æŸå€¼(value)</li><li>public Set keySet() ï¼šè¿”å›æ‰€æœ‰çš„é”®ï¼ˆkeyï¼‰ï¼Œå¹¶ä½¿ç”¨Setå®¹å™¨å­˜æ”¾</li><li>public Collection values() ï¼šè¿”å›æ‰€æœ‰çš„å€¼ï¼ˆValueï¼‰ï¼Œå¹¶ä½¿ç”¨Collectionå­˜æ”¾</li><li>public Set entrySet() ï¼šè¿”å›ä¸€ä¸ªå®ç° Map.Entry æ¥å£çš„å…ƒç´  Set</li></ul><h3 id="éå†Mapçš„å››ç§æ–¹æ³•"><a href="#éå†Mapçš„å››ç§æ–¹æ³•" class="headerlink" title="éå†Mapçš„å››ç§æ–¹æ³•"></a>éå†Mapçš„å››ç§æ–¹æ³•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import java.util.*;</span><br><span class="line"></span><br><span class="line">public class Tests &#123;</span><br><span class="line">    </span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();</span><br><span class="line">        map.put(&quot;1&quot;, &quot;value1&quot;);</span><br><span class="line">        map.put(&quot;2&quot;, &quot;value2&quot;);</span><br><span class="line">        map.put(&quot;3&quot;, &quot;value3&quot;);</span><br><span class="line"></span><br><span class="line">        //ç¬¬ä¸€ç§ï¼šæ™®éä½¿ç”¨ï¼ŒkeySet()è¿”å›æ‰€æœ‰çš„keyå€¼</span><br><span class="line">        for (String key : map.keySet()) &#123;</span><br><span class="line">            System.out.println(&quot;key= &quot;+ key + &quot; and value= &quot; + map.get(key));</span><br><span class="line">        &#125;</span><br><span class="line">        //ç¬¬äºŒç§ é€šè¿‡Map.entrySetä½¿ç”¨iteratoréå†keyå’Œvalue</span><br><span class="line">        Iterator&lt;Map.Entry&lt;String, String&gt;&gt; it = map.entrySet().iterator();</span><br><span class="line">        while (it.hasNext()) &#123;</span><br><span class="line">            Map.Entry&lt;String, String&gt; entry = it.next();</span><br><span class="line">            System.out.println(&quot;key= &quot; + entry.getKey() + &quot; and value= &quot; + entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        //ç¬¬ä¸‰ç§ï¼šæ¨èï¼Œå°¤å…¶æ˜¯å®¹é‡å¤§æ—¶ é€šè¿‡Map.entrySetéå†keyå’Œvalue</span><br><span class="line">        for (Map.Entry&lt;String, String&gt; entry : map.entrySet()) &#123;</span><br><span class="line">            System.out.println(&quot;key= &quot; + entry.getKey() + &quot; and value= &quot; + entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        //ç¬¬å››ç§ é€šè¿‡Map.values()éå†æ‰€æœ‰çš„valueï¼Œä½†ä¸èƒ½éå†key</span><br><span class="line">        for (String v : map.values()) &#123;</span><br><span class="line">            System.out.println(&quot;value= &quot; + v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9pvbo86b6j313q0u018f.jpg" style="zoom:150%;" /></p><h3 id="HashMapå’ŒHashtableçš„åŒºåˆ«ï¼š"><a href="#HashMapå’ŒHashtableçš„åŒºåˆ«ï¼š" class="headerlink" title="HashMapå’ŒHashtableçš„åŒºåˆ«ï¼š"></a><strong>HashMapå’ŒHashtableçš„åŒºåˆ«ï¼š</strong></h3><p>HashMapå’ŒHashtableéƒ½æ˜¯javaçš„é›†åˆç±»ï¼Œéƒ½å¯ä»¥ç”¨æ¥å­˜æ”¾javaå¯¹è±¡ï¼Œè¿™æ˜¯ä»–ä»¬çš„ç›¸åŒç‚¹<br>ä»¥ä¸‹æ˜¯ä»–ä»¬çš„åŒºåˆ«ï¼š</p><ol><li>å†å²åŸå› ï¼š<br>Hashtableæ˜¯åŸºäºé™ˆæ—§çš„Dictionaryç±»çš„ï¼ŒHashMapæ˜¯java 1.2å¼•è¿›çš„Mapæ¥å£çš„ä¸€ä¸ªç°å®ã€‚</li><li>åŒæ­¥æ€§ï¼š<br>hashtableæ˜¯åŒæ­¥çš„ï¼Œè¿™ä¸ªç±»ä¸­çš„ä¸€äº›æ–¹æ³•ä¿è¯äº†Hashtableä¸­çš„å¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒHashMapåˆ™æ˜¯å¼‚æ­¥çš„ï¼Œå› æ­¤HashMapä¸­çš„å¯¹è±¡å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºåŒæ­¥çš„è¦æ±‚ä¼šå½±å“æ‰§è¡Œçš„æ•ˆç‡ï¼Œæ‰€ä»¥å¦‚æœä½ ä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„ç»“åˆé‚£ä¹ˆä½¿ç”¨HashMapæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œè¿™æ ·å¯ä»¥é¿å…ç”±äºåŒæ­¥å¸¦æ¥çš„ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ï¼Œä»è€Œæé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ‰€ç¼–å†™çš„ç¨‹åºéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä½†å¦‚æœæ˜¯æœåŠ¡å™¨ç«¯çš„ä»£ç é™¤å¤–ã€‚</li><li>å€¼ï¼š<br>HashMapå¯ä»¥è®©ä½ å°†ç©ºå€¼ä½œä¸ºä¸€ä¸ªè¡¨çš„æ¡ç›®çš„keyæˆ–value<br>Hashtableæ˜¯ä¸èƒ½æ”¾å…¥ç©ºå€¼ï¼ˆnullï¼‰çš„</li></ol><h3 id="ArrayListå’ŒVectorçš„åŒºåˆ«ï¼š"><a href="#ArrayListå’ŒVectorçš„åŒºåˆ«ï¼š" class="headerlink" title="ArrayListå’ŒVectorçš„åŒºåˆ«ï¼š"></a><strong>ArrayListå’ŒVectorçš„åŒºåˆ«</strong>ï¼š</h3><p>ArrayListä¸Vectoréƒ½æ˜¯javaçš„é›†åˆç±»ï¼Œéƒ½æ˜¯ç”¨æ¥å­˜æ”¾javaå¯¹è±¡ï¼Œè¿™æ˜¯ä»–ä»¬çš„ç›¸åŒç‚¹ï¼Œ<br>åŒºåˆ«ï¼š</p><ol><li>åŒæ­¥æ€§ï¼š Vectoræ˜¯åŒæ­¥çš„ï¼Œè¿™ä¸ªç±»çš„ä¸€äº›æ–¹æ³•ä¿è¯äº†Vectorä¸­çš„å¯¹è±¡çš„çº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒArrayListåˆ™æ˜¯å¼‚æ­¥çš„ï¼Œå› æ­¤ArrayListä¸­çš„å¯¹è±¡å¹¶ä¸ æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºåŒæ­¥è¦æ±‚ä¼šå½±å“æ‰§è¡Œçš„æ•ˆç‡ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„é›†åˆé‚£ä¹ˆä½¿ç”¨ArrayListæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œè¿™æ ·å¯ä»¥é¿å…ç”±äºåŒæ­¥å¸¦æ¥çš„ä¸å¿… è¦çš„æ€§èƒ½å¼€é”€ã€‚</li><li>æ•°æ®å¢é•¿ï¼š ä»å†…éƒ¨å®ç°çš„æœºåˆ¶æ¥è®²ï¼ŒArrayListå’ŒVectoréƒ½æ˜¯ä½¿ç”¨æ•°ç»„ï¼ˆArrayï¼‰æ¥æ§åˆ¶é›†åˆä¸­çš„å¯¹è±¡ï¼Œå½“ä½ å‘ä¸¤ç§ç±»å‹ä¸­å¢åŠ å…ƒç´ çš„æ—¶å€™ï¼Œå¦‚æœå…ƒç´ çš„æ•°ç›®è¶…è¿‡äº†å†…éƒ¨æ•°ç»„ç›®å‰çš„é•¿åº¦ä»–ä»¬éƒ½éœ€è¦æ‰©å±•å†…éƒ¨æ•°ç»„çš„é•¿åº¦ï¼ŒVectorç¼ºçœæƒ…å†µä¸‹è‡ªåŠ¨å¢é•¿åŸæ¥ä¸€å€çš„æ•°ç»„é•¿åº¦ï¼ŒArrayListæ˜¯åŸæ¥çš„50%ï¼Œæ‰€ä»¥æœ€åä½ è·å¾—çš„è¿™ä¸ªé›†åˆæ‰€å çš„ç©ºé—´æ€»æ˜¯æ¯”ä½ å®é™…éœ€è¦çš„è¦å¤§ï¼Œæ‰€ä»¥å¦‚æœä½ è¦åœ¨é›†åˆä¸­ä¿å­˜å¤§é‡çš„æ•°æ®ï¼Œé‚£ä¹ˆä½¿ç”¨Vectoræœ‰ä¸€äº›ä¼˜åŠ¿ï¼Œå› ä¸ºä½ å¯ä»¥é€šè¿‡è®¾ç½®é›†åˆçš„åˆå§‹å¤§å°æ¥é¿å…ä¸å¿…è¦çš„èµ„æºå¼€é”€ã€‚</li></ol><h3 id="çº¿ç¨‹å®‰å…¨æ€»ç»“ï¼š"><a href="#çº¿ç¨‹å®‰å…¨æ€»ç»“ï¼š" class="headerlink" title="çº¿ç¨‹å®‰å…¨æ€»ç»“ï¼š"></a><strong>çº¿ç¨‹å®‰å…¨æ€»ç»“ï¼š</strong></h3><ol><li>å¦‚æœè¦æ±‚çº¿ç¨‹å®‰å…¨ï¼Œä½¿ç”¨Vectorï¼ŒHashtable</li><li>å¦‚æœä¸è¦æ±‚çº¿ç¨‹å®‰å…¨ï¼Œä½¿ç”¨ArrayListï¼ŒLinkedListï¼ŒHashMap</li><li>å¦‚æœè¦æ±‚é”®å€¼å¯¹ï¼Œåˆ™ä½¿ç”¨HashMapï¼ŒHashtable</li><li>å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œåˆè¦æ±‚çº¿ç¨‹å®‰å…¨è€ƒè™‘Vector</li></ol><h3 id="arraylistå’Œlinkedlistè”ç³»ä¸åŒºåˆ«"><a href="#arraylistå’Œlinkedlistè”ç³»ä¸åŒºåˆ«" class="headerlink" title="arraylistå’Œlinkedlistè”ç³»ä¸åŒºåˆ«"></a><strong>arraylistå’Œlinkedlistè”ç³»ä¸åŒºåˆ«</strong></h3><ol><li>ArrayListæ˜¯å®ç°äº†åŸºäºåŠ¨æ€æ•°ç»„çš„æ•°æ®ç»“æ„ï¼ŒLinkedListåŸºäºé“¾è¡¨çš„æ•°æ®ç»“æ„ã€‚</li><li>å¯¹äºéšæœºè®¿é—®getå’Œsetï¼ŒArrayListè§‰å¾—ä¼˜äºLinkedListï¼Œå› ä¸ºLinkedListè¦ç§»åŠ¨æŒ‡é’ˆã€‚</li><li>å¯¹äºæ–°å¢å’Œåˆ é™¤æ“ä½œaddå’Œremoveï¼ŒLinedListæ¯”è¾ƒå ä¼˜åŠ¿ï¼Œå› ä¸ºArrayListè¦ç§»åŠ¨æ•°æ®ã€‚ è¿™ä¸€ç‚¹è¦çœ‹å®é™…æƒ…å†µçš„ã€‚è‹¥åªå¯¹å•æ¡æ•°æ®æ’å…¥æˆ–åˆ é™¤ï¼ŒArrayListçš„é€Ÿåº¦åè€Œä¼˜äºLinkedListã€‚ä½†è‹¥æ˜¯æ‰¹é‡éšæœºçš„æ’å…¥åˆ é™¤æ•°æ®ï¼ŒLinkedListçš„é€Ÿåº¦å¤§å¤§ä¼˜äºArrayList. å› ä¸ºArrayListæ¯æ’å…¥ä¸€æ¡æ•°æ®ï¼Œè¦ç§»åŠ¨æ’å…¥ç‚¹åŠä¹‹åçš„æ‰€æœ‰æ•°æ®ã€‚</li></ol><h3 id="HashMapä¸TreeMapè”ç³»ä¸åŒºåˆ«"><a href="#HashMapä¸TreeMapè”ç³»ä¸åŒºåˆ«" class="headerlink" title="HashMapä¸TreeMapè”ç³»ä¸åŒºåˆ«"></a><strong>HashMapä¸TreeMapè”ç³»ä¸åŒºåˆ«</strong></h3><ol><li>HashMapé€šè¿‡hashcodeå¯¹å…¶å†…å®¹è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾ï¼Œè€ŒTreeMapä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½ä¿æŒç€æŸç§å›ºå®šçš„é¡ºåºï¼Œå¦‚æœä½ éœ€è¦å¾—åˆ°ä¸€ä¸ªæœ‰åºçš„ç»“æœä½ å°±åº”è¯¥ä½¿ç”¨TreeMapï¼ˆHashMapä¸­å…ƒç´ çš„æ’åˆ—é¡ºåºæ˜¯ä¸å›ºå®šçš„ï¼‰ã€‚</li><li>åœ¨Map ä¸­æ’å…¥ã€åˆ é™¤å’Œå®šä½å…ƒç´ ï¼ŒHashMapæ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚ä½†å¦‚æœæ‚¨è¦æŒ‰è‡ªç„¶é¡ºåºæˆ–è‡ªå®šä¹‰é¡ºåºéå†é”®ï¼Œé‚£ä¹ˆTreeMapä¼šæ›´å¥½ã€‚ä½¿ç”¨HashMapè¦æ±‚æ·»åŠ çš„é”®ç±»æ˜ç¡®å®šä¹‰äº†hashCode()å’Œ equals()çš„å®ç°ã€‚</li><li>ä¸¤ä¸ªmapä¸­çš„å…ƒç´ ä¸€æ ·ï¼Œä½†é¡ºåºä¸ä¸€æ ·ï¼Œå¯¼è‡´hashCode()ä¸ä¸€æ ·ã€‚<br>åŒæ ·åšæµ‹è¯•ï¼š<br>åœ¨HashMapä¸­ï¼ŒåŒæ ·çš„å€¼çš„map,é¡ºåºä¸åŒï¼Œequalsæ—¶ï¼Œfalse;<br>è€Œåœ¨treeMapä¸­ï¼ŒåŒæ ·çš„å€¼çš„map,é¡ºåºä¸åŒï¼Œequalsæ—¶ï¼Œtrueï¼Œè¯´æ˜ï¼ŒtreeMapåœ¨equals()æ—¶æ˜¯æ•´ç†äº†é¡ºåºäº†çš„ã€‚</li></ol><hr><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><a href="https://www.cnblogs.com/chenglc/p/8073049.html" target="_blank" rel="noopener">https://www.cnblogs.com/chenglc/p/8073049.html</a></li><li><a href="https://baike.baidu.com/item/javaé›†åˆç±»/4758922?fr=aladdin#reference-[2]-7989307-wrap" target="_blank" rel="noopener">https://baike.baidu.com/item/java%E9%9B%86%E5%90%88%E7%B1%BB/4758922?fr=aladdin#reference-[2]-7989307-wrap</a></li><li><a href="https://www.runoob.com/java/java-collections.html" target="_blank" rel="noopener">https://www.runoob.com/java/java-collections.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> åŸºç¡€ç†è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> åŸºç¡€ç†è§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>try_catch_finallyå…³é”®å­—ç›¸å…³é—®é¢˜</title>
      <link href="/2019/12/08/try-catch-finally%E5%85%B3%E9%94%AE%E5%AD%97%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/"/>
      <url>/2019/12/08/try-catch-finally%E5%85%B3%E9%94%AE%E5%AD%97%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h3 id="1-ä»€ä¹ˆæ—¶å€™ç”¨åˆ°finallyå‘¢-finallyå…³é”®è¯åœ¨å¼‚å¸¸å¤„ç†ä¸­å¦‚ä½•ä½¿ç”¨"><a href="#1-ä»€ä¹ˆæ—¶å€™ç”¨åˆ°finallyå‘¢-finallyå…³é”®è¯åœ¨å¼‚å¸¸å¤„ç†ä¸­å¦‚ä½•ä½¿ç”¨" class="headerlink" title="1. ä»€ä¹ˆæ—¶å€™ç”¨åˆ°finallyå‘¢? finallyå…³é”®è¯åœ¨å¼‚å¸¸å¤„ç†ä¸­å¦‚ä½•ä½¿ç”¨:"></a>1. ä»€ä¹ˆæ—¶å€™ç”¨åˆ°finallyå‘¢? finallyå…³é”®è¯åœ¨å¼‚å¸¸å¤„ç†ä¸­å¦‚ä½•ä½¿ç”¨:</h3><p>ä¸ç®¡å¼‚å¸¸ä¼šä¸ä¼šè¢«æ•æ‰æˆ–è€…å¤„ç†éƒ½ä¼šæ‰§è¡Œçš„ä»£ç ï¼ŒæŸäº›äº‹ç‰©ï¼ˆé™¤å†…å­˜å¤–ï¼‰åœ¨å¼‚å¸¸å¤„ç†å®Œåéœ€è¦æ¢å¤åˆ°åˆå§‹çŠ¶æ€,å¦‚å…³é—­IOæ“ä½œ, å…³é—­ä¸€äº›è€—æ€§èƒ½çš„èµ„æºï¼Œæ•°æ®åº“çš„è¿æ¥ã€‚</p><p>æŸäº›äº‹ç‰©ï¼ˆé™¤å†…å­˜å¤–ï¼‰åœ¨å¼‚å¸¸åœ¨å¼‚å¸¸å¤„ç†å®Œåéœ€è¦æ¢å¤åˆ°åˆå§‹çŠ¶æ€ï¼Œå¦‚å¼€å¯çš„æ–‡ä»¶ï¼Œç½‘ç»œçš„è¿æ¥ç­‰ã€‚</p><h3 id="2-tryé‡Œæœ‰returnï¼Œfinallyè¿˜æ‰§è¡Œä¹ˆï¼Ÿinallyè¯­å¥åœ¨tryæˆ–catchä¸­çš„returnè¯­å¥æ‰§è¡Œä¹‹åï¼Œè¿˜æ˜¯returnè¿”å›ä¹‹å‰æ‰§è¡Œå‘¢ï¼Ÿ"><a href="#2-tryé‡Œæœ‰returnï¼Œfinallyè¿˜æ‰§è¡Œä¹ˆï¼Ÿinallyè¯­å¥åœ¨tryæˆ–catchä¸­çš„returnè¯­å¥æ‰§è¡Œä¹‹åï¼Œè¿˜æ˜¯returnè¿”å›ä¹‹å‰æ‰§è¡Œå‘¢ï¼Ÿ" class="headerlink" title="2. tryé‡Œæœ‰returnï¼Œfinallyè¿˜æ‰§è¡Œä¹ˆï¼Ÿinallyè¯­å¥åœ¨tryæˆ–catchä¸­çš„returnè¯­å¥æ‰§è¡Œä¹‹åï¼Œè¿˜æ˜¯returnè¿”å›ä¹‹å‰æ‰§è¡Œå‘¢ï¼Ÿ"></a>2. tryé‡Œæœ‰returnï¼Œfinallyè¿˜æ‰§è¡Œä¹ˆï¼Ÿinallyè¯­å¥åœ¨tryæˆ–catchä¸­çš„returnè¯­å¥æ‰§è¡Œä¹‹åï¼Œè¿˜æ˜¯returnè¿”å›ä¹‹å‰æ‰§è¡Œå‘¢ï¼Ÿ</h3><p>è¿™ä¸ªé¢˜ç›®ä¹Ÿæ˜¯è€ƒæŸ¥å¼‚å¸¸ç›¸å…³çš„ã€‚å¯¹äºè¿™ä¸ªé¢˜ç›®ï¼Œæˆ‘ä»¬é€šè¿‡ä»£ç æ¥éªŒè¯æˆ‘ä»¬çš„ç­”æ¡ˆï¼Œå› ä¸ºæœ‰å¼‚è®®çš„çŸ¥è¯†ç‚¹ï¼Œä»£ç æ˜¯æœ€æœ‰è¯´æœåŠ›çš„ã€‚è¿™ä¸ªé—®é¢˜æ˜¯ä¸€ä¸ªå¾ˆç»å…¸çš„é—®é¢˜ï¼Œç»å¸¸è¢«é¢è¯•å®˜é—®ï¼Œå¦‚æœè‡ªå·±ä¸å»å®éªŒä¸€ä¸‹ï¼Œå¯èƒ½åˆ¤æ–­å°±ä¼šå‡ºé”™ã€‚æˆ‘ä»¬ç»“åˆä»£ç æ¥åˆ†æä¸€ä¸‹ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡4ä¸ªdemoæ¥å¾—å‡ºæœ€ç»ˆç»“è®ºã€‚</p><ul><li>test1</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> hello;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"test1():"</span> + test1());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"try..."</span>);</span><br><span class="line">            <span class="keyword">return</span> i += <span class="number">10</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"catch..."</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            i++;</span><br><span class="line">            System.out.println(<span class="string">"finally..."</span>);</span><br><span class="line">            System.out.println(<span class="string">"i="</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œç»“æœï¼š</span><br><span class="line"><span class="keyword">try</span>...</span><br><span class="line"><span class="keyword">finally</span>...</span><br><span class="line">i=<span class="number">12</span></span><br><span class="line">test1():<span class="number">11</span></span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼šfinallyä»£ç å—æ˜¯åœ¨tryä»£ç å—ä¸­çš„returnè¯­å¥æ‰§è¡Œä¹‹åï¼Œè¿”å›ä¹‹å‰æ‰§è¡Œçš„ã€‚æœ€å¤–é¢çš„return i; æ²¡æœ‰æ‰§è¡Œã€‚æ— è®ºfinallyä»£ç å—æ‰§è¡Œä»€ä¹ˆï¼Œè¿”å›å€¼ä¸å˜ã€‚</p><ul><li>test2</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMain</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        test2();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"try..."</span>);</span><br><span class="line">            <span class="keyword">return</span> i += <span class="number">10</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"catch..."</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            i++;</span><br><span class="line">            System.out.println(<span class="string">"finally..."</span>);</span><br><span class="line">            System.out.println(<span class="string">"i="</span> + i);</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œç»“æœï¼š</span><br><span class="line"><span class="keyword">try</span>...</span><br><span class="line"><span class="keyword">finally</span>...</span><br><span class="line">i=<span class="number">12</span></span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼šfinallyä»£ç å—ä¸­çš„returnè¯­å¥è¦†ç›–tryä»£ç å—ä¸­çš„returnè¯­å¥ã€‚</p><ul><li>test3</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMain</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = test3();</span><br><span class="line">        System.out.println(map.get(<span class="string">"KEY"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        map.put(<span class="string">"KEY"</span>, <span class="string">"INIT"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"try..."</span>);</span><br><span class="line">            map.put(<span class="string">"KEY"</span>, <span class="string">"TRY"</span>);</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"catch..."</span>);</span><br><span class="line">            map.put(<span class="string">"KEY"</span>, <span class="string">"CATCH"</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"finally..."</span>);</span><br><span class="line">            map.put(<span class="string">"KEY"</span>, <span class="string">"FINALLY"</span>);</span><br><span class="line">            map = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">æ‰§è¡Œç»“æœï¼š</span><br><span class="line"><span class="keyword">try</span>...</span><br><span class="line"><span class="keyword">finally</span>...</span><br><span class="line">FINALLY</span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼š å¦‚æœfinallyè¯­å¥ä¸­æ²¡æœ‰returnè¯­å¥è¦†ç›–è¿”å›å€¼ï¼Œé‚£ä¹ˆåŸæ¥çš„è¿”å›å€¼å¯èƒ½å› ä¸ºfinallyé‡Œçš„ä¿®æ”¹è€Œæ”¹å˜ä¹Ÿå¯èƒ½ä¸å˜ã€‚<strong>ä¼ å€¼ç±»å‹</strong>çš„è¿”å›å€¼ï¼šä¸å˜ï¼›<strong>ä¼ å€ç±»å‹</strong>çš„è¿”å›å€¼ï¼šä¼šå˜ã€‚</p><blockquote><p>è¿™é‡Œå¼•å…¥æ¥ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œæ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯ä¼ å€¼è¿˜æ˜¯ä¼ å€ï¼Ÿ</p><p>ä¼ å€¼ï¼š8ç§åŸºæœ¬æ•°æ®ç±»å‹åŠå…¶åŒ…è£…ç±»ï¼Œå­—ç¬¦å¸¸é‡ã€‚<em>ä¸å˜</em></p><p>ä¼ å€ï¼šæ•°ç»„å’Œå¯¹è±¡ã€‚<em>ä¼šå˜</em></p></blockquote><ul><li>test4</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMain</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"test4è¿”å›ï¼š"</span> + test4());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"try..."</span>);</span><br><span class="line">            i = i / <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> i += <span class="number">10</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"catch..."</span>);</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            i++;</span><br><span class="line">            System.out.println(<span class="string">"finally..."</span>);</span><br><span class="line">            System.out.println(<span class="string">"i="</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">æ‰§è¡Œç»“æœï¼š</span><br><span class="line"><span class="keyword">try</span>...</span><br><span class="line"><span class="keyword">catch</span>...</span><br><span class="line"><span class="keyword">finally</span>...</span><br><span class="line">i=<span class="number">2</span></span><br><span class="line">test4è¿”å›ï¼š<span class="number">1</span></span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼š tryä»£ç å—ä¸­çš„returnè¯­å¥åœ¨å¼‚å¸¸çš„æƒ…å†µä¸‹ä¸ä¼šè¢«æ‰§è¡Œï¼Œè¿™æ ·å…·ä½“è¿”å›å“ªä¸ªçœ‹æƒ…å†µï¼›<strong>catchä¸­çš„returnæ‰§è¡Œæƒ…å†µä¸æœªå‘ç”Ÿå¼‚å¸¸æ—¶tryä¸­returnçš„æ‰§è¡Œæƒ…å†µå®Œå…¨ä¸€æ ·</strong>ï¼ˆå¦‚test4æœ€åè¿”å›è¿˜æ˜¯1ï¼‰ã€‚</p><h3 id="3-å¦‚æœæ‰§è¡Œfinallyä»£ç å—ä¹‹å‰æ–¹æ³•è¿”å›äº†ç»“æœï¼Œæˆ–è€…JVMé€€å‡ºäº†ï¼Œfinallyå—ä¸­çš„ä»£ç è¿˜ä¼šæ‰§è¡Œå—-åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œfinallyè¯­å¥ä¸ä¼šæ‰§è¡Œ"><a href="#3-å¦‚æœæ‰§è¡Œfinallyä»£ç å—ä¹‹å‰æ–¹æ³•è¿”å›äº†ç»“æœï¼Œæˆ–è€…JVMé€€å‡ºäº†ï¼Œfinallyå—ä¸­çš„ä»£ç è¿˜ä¼šæ‰§è¡Œå—-åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œfinallyè¯­å¥ä¸ä¼šæ‰§è¡Œ" class="headerlink" title="3. å¦‚æœæ‰§è¡Œfinallyä»£ç å—ä¹‹å‰æ–¹æ³•è¿”å›äº†ç»“æœï¼Œæˆ–è€…JVMé€€å‡ºäº†ï¼Œfinallyå—ä¸­çš„ä»£ç è¿˜ä¼šæ‰§è¡Œå—? åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œfinallyè¯­å¥ä¸ä¼šæ‰§è¡Œ"></a>3. å¦‚æœæ‰§è¡Œfinallyä»£ç å—ä¹‹å‰æ–¹æ³•è¿”å›äº†ç»“æœï¼Œæˆ–è€…JVMé€€å‡ºäº†ï¼Œfinallyå—ä¸­çš„ä»£ç è¿˜ä¼šæ‰§è¡Œå—? åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œfinallyè¯­å¥ä¸ä¼šæ‰§è¡Œ</h3><ol><li>tryè¯­å¥æ²¡æœ‰è¢«æ‰§è¡Œï¼Œå¦‚åœ¨tryè¯­å¥ä¹‹å‰å°±è¿”å›äº†ï¼Œè¿™æ ·finallyè¯­å¥å°±ä¸ä¼šæ‰§è¡Œï¼›å› æ­¤è¯´æ˜äº†finallyè¯­å¥è¢«æ‰§è¡Œçš„å¿…è¦è€Œéå……åˆ†æ¡ä»¶æ˜¯ï¼šç›¸åº”çš„tryè¯­å¥ä¸€å®šè¢«æ‰§è¡Œåˆ°ã€‚</li><li>å¦‚æœåœ¨tryä»£ç å—ä¸­æ‰§è¡ŒSystem.exit(0)è¯­å¥;é‚£ä¹ˆå°†ç»ˆæ­¢Javaè™šæ‹ŸæœºJVMï¼Œå› æ­¤ï¼Œfinallyè¯­å¥ä¹Ÿä¸ä¼šè¢«æ‰§è¡Œåˆ°ã€‚</li><li>finallyå—çš„è¯­å¥åœ¨tryæˆ–catchä¸­çš„<strong>returnè¯­å¥æ‰§è¡Œä¹‹åè¿”å›ä¹‹å‰æ‰§è¡Œ</strong>ä¸”finallyé‡Œçš„ä¿®æ”¹è¯­å¥å¯èƒ½å½±å“ä¹Ÿå¯èƒ½ä¸å½±å“tryæˆ–catchä¸­returnå·²ç»ç¡®å®šçš„è¿”å›å€¼ï¼Œå¦‚æœè¿”å›å€¼ç±»å‹ä¸ºä¼ å€ç±»å‹ï¼Œåˆ™å½±å“ï¼›ä¼ å€¼ç±»å‹ï¼Œåˆ™ä¸å½±å“ã€‚</li><li>è‹¥finallyé‡Œä¹Ÿæœ‰returnè¯­å¥åˆ™è¦†ç›–tryæˆ–catchä¸­çš„returnè¯­å¥ç›´æ¥è¿”å›ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒå‰æ ‘çš„éå†å’Œåˆ›å»º</title>
      <link href="/2019/12/06/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86%E5%92%8C%E5%88%9B%E5%BB%BA/"/>
      <url>/2019/12/06/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86%E5%92%8C%E5%88%9B%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h3 id="1-äºŒå‰æ ‘çš„éå†"><a href="#1-äºŒå‰æ ‘çš„éå†" class="headerlink" title="1. äºŒå‰æ ‘çš„éå†"></a>1. äºŒå‰æ ‘çš„éå†</h3><p>å…ˆåºéå†ã€ä¸­åºéå†ã€ååºéå†ï¼Œæ— è®ºè¿™ä¸‰ç§éå†çš„å“ªä¸€ç§ï¼Œå·¦å­æ ‘ä¸€å®šå…ˆä¸å³å­æ ‘éå†ï¼›æ‰€è°“çš„â€œå…ˆä¸­åâ€æ˜¯æŒ‡è®¿é—®æ ¹ç»“ç‚¹é¡ºåºåœ¨éå†ä¸­çš„ä½ç½®ã€‚ä¾‹å¤–è¿˜æœ‰å±‚æ¬¡éå†ï¼Œå³å¹¿åº¦ä¼˜å…ˆéå†</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9ncg3d3gtj30py0eg3z4.jpg" style="zoom:40%;" /></p><ul><li><p>å…ˆåºï¼š<strong>æ ¹ç»“ç‚¹</strong>-&gt;&gt;å·¦å­æ ‘-&gt;&gt;å³å­æ ‘</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preOrder</span><span class="params">(node* root)</span></span>&#123; <span class="comment">//å…ˆåºéå†</span></span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    preOrder(root-&gt;lchild);</span><br><span class="line">    preOrder(root-&gt;rchild);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>ä¸­åºï¼šå·¦å­æ ‘-&gt;&gt;<strong>æ ¹ç»“ç‚¹</strong>-&gt;&gt;å³å­æ ‘</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">inOrder</span><span class="params">(node* root)</span></span>&#123; <span class="comment">//ä¸­åºéå†</span></span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    inOrder(root-&gt;lchild);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d"</span>,root-&gt;data);</span><br><span class="line">    inOrder(root-&gt;rchild);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>ååºï¼šå·¦å­æ ‘-&gt;&gt;å³å­æ ‘-&gt;&gt;<strong>æ ¹ç»“ç‚¹</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">postOrder</span><span class="params">(node* root)</span></span>&#123; <span class="comment">//ååºéå†</span></span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    postOrder(root-&gt;lchild);</span><br><span class="line">    postOrder(root-&gt;rchild);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d"</span>,root-&gt;data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å±‚æ¬¡éå†ï¼ˆBFSéå†ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS</span><span class="params">(node* root)</span></span>&#123;  <span class="comment">//å±‚æ¬¡éå†</span></span><br><span class="line">    <span class="built_in">queue</span>&lt;node*&gt; q;</span><br><span class="line">    q.push(root);</span><br><span class="line">    <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">        node* now = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d"</span>,now-&gt;data);</span><br><span class="line">        <span class="keyword">if</span>(now-&gt;lchild != <span class="literal">NULL</span>) q.push(now-&gt;lchild);</span><br><span class="line">        <span class="keyword">if</span>(now-&gt;rchild != <span class="literal">NULL</span>) q.push(now-&gt;rchild);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-åˆ›å»ºäºŒå‰æ ‘"><a href="#2-åˆ›å»ºäºŒå‰æ ‘" class="headerlink" title="2. åˆ›å»ºäºŒå‰æ ‘"></a>2. åˆ›å»ºäºŒå‰æ ‘</h3><p>ä¸­åºåºåˆ—å¯ä»¥ä¸å…ˆåºåºåˆ—ã€ååºåºåˆ—ã€å±‚åºåºåˆ—ä¸­çš„ä»»æ„ä¸€ä¸ªæ¥æ„å»ºå”¯ä¸€çš„äºŒå‰æ ‘ï¼Œè€Œåä¸‰è€…ä¸¤ä¸¤æ­é…æˆ–æ˜¯ä¸‰ä¸ªä¸€èµ·ä¸Šéƒ½æ— æ³•æ„å»ºå”¯ä¸€çš„äºŒå‰æ ‘ã€‚åŸå› æ˜¯å…ˆåºã€ååºã€å±‚åºå‡æ˜¯æä¾›æ ¹ç»“ç‚¹ï¼ŒåŠŸèƒ½æ˜¯ç›¸åŒçš„ï¼Œéƒ½å¿…é¡»ç”±ä¸­åºåºåˆ—æ¥åŒºåˆ†å‡ºå·¦å³å­æ ‘ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    node* lchild;</span><br><span class="line">    node* rchild;</span><br><span class="line">    <span class="keyword">int</span> data;   </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; pre;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; in;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; post;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; layer;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®ä¸­åºå’Œååºï¼Œåˆ›å»ºäºŒå‰æ ‘</span></span><br><span class="line"><span class="function">node* <span class="title">createByPostAndIn</span><span class="params">(<span class="keyword">int</span> postL, <span class="keyword">int</span> postR, <span class="keyword">int</span> inL, <span class="keyword">int</span> inR)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(postL &gt; postR) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    node* root = <span class="keyword">new</span> node;</span><br><span class="line">    root-&gt;data = post[postR];</span><br><span class="line">    <span class="keyword">int</span> k;</span><br><span class="line">    <span class="keyword">for</span>(k = inL; k &lt;= inR; k++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(in[k] == post[postR])&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> numLeft = k - inL;  <span class="comment">//å·¦å­æ ‘çš„ç»“ç‚¹ä¸ªæ•°</span></span><br><span class="line">    root-&gt;lchild = createByPostAndIn(postL, postL + numLeft - <span class="number">1</span>, inL, k - <span class="number">1</span>);</span><br><span class="line">    root-&gt;rchild = createByPostAndIn(postL + numLeft, postR - <span class="number">1</span>, k + <span class="number">1</span>, inR);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®ä¸­åºå’Œå‰åºï¼Œåˆ›å»ºäºŒå‰æ ‘</span></span><br><span class="line"><span class="function">node* <span class="title">createByPreAndIn</span><span class="params">(<span class="keyword">int</span> preL, <span class="keyword">int</span> preR, <span class="keyword">int</span> inL, <span class="keyword">int</span> inR)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preL &gt; preR) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    node* root = <span class="keyword">new</span> node;</span><br><span class="line">    root-&gt;data = pre[preL];</span><br><span class="line">    <span class="keyword">int</span> k;</span><br><span class="line">    <span class="keyword">for</span>(k = inL; k &lt;= inR; k++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(in[k] == pre[preL])&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> numLeft = k - inL; <span class="comment">//å·¦å­æ ‘çš„ç»“ç‚¹ä¸ªæ•°</span></span><br><span class="line">    root-&gt;lchild = createByPreAndIn(preL + <span class="number">1</span>, preL + numLeft, inL, k - <span class="number">1</span>);</span><br><span class="line">    root-&gt;rchild = createByPreAndIn(preL + numLeft + <span class="number">1</span>, preR, k + <span class="number">1</span>, inR);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®ä¸­åºå’Œå±‚åºåˆ›å»ºäºŒå‰æ ‘</span></span><br><span class="line"><span class="function">node* <span class="title">createByLayerAndIn</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; layer, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; in, <span class="keyword">int</span> inL, <span class="keyword">int</span> inR)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(inL &gt; inR || layer.<span class="built_in">size</span>() == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    node* root = <span class="keyword">new</span> node;</span><br><span class="line">    root-&gt;data = layer[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">int</span> pos;</span><br><span class="line">    <span class="keyword">for</span>(pos = inL; pos &lt;= inR; pos++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(in[pos] == layer[<span class="number">0</span>])&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; layerLeft, layerRight; <span class="comment">//å­˜æ”¾å·¦ã€å³å­æ ‘çš„å±‚åºåºåˆ—</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; layer.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> j;</span><br><span class="line">        <span class="keyword">for</span>(j = inL; j &lt; pos; j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(in[j] == layer[i])&#123;</span><br><span class="line">                layerLeft.push_back(layer[i]); <span class="comment">//å¦‚æœåœ¨poså‰æ‰¾åˆ°ï¼Œæ’å…¥å·¦å­æ ‘</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¶…è¿‡posï¼Œj==posæ—¶å³ä¸ºåœ¨å·¦å­æ ‘ä¸­æ²¡æœ‰æ‰¾åˆ°æ’å…¥å³å­æ ‘ï¼ˆå±‚åºéå†ä¿æŒå·¦å³å­æ ‘å±‚åºéå†é¡ºåºçš„ä¸€è‡´æ€§ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span>(j == pos) layerRight.push_back(layer[i]); </span><br><span class="line">    &#125;</span><br><span class="line">    root-&gt;lchild = createByLayerAndIn(layerLeft, in, inL, pos - <span class="number">1</span>);</span><br><span class="line">    root-&gt;rchild = createByLayerAndIn(layerRight, in, pos + <span class="number">1</span>, inR);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS</span><span class="params">(node* root)</span></span>&#123;  <span class="comment">//å±‚æ¬¡éå†</span></span><br><span class="line">    <span class="built_in">queue</span>&lt;node*&gt; q;</span><br><span class="line">    q.push(root);</span><br><span class="line">    <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">        node* now = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d"</span>,now-&gt;data);</span><br><span class="line">        num++;</span><br><span class="line">        <span class="keyword">if</span>(num &lt; n)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(now-&gt;lchild != <span class="literal">NULL</span>) q.push(now-&gt;lchild);</span><br><span class="line">        <span class="keyword">if</span>(now-&gt;rchild != <span class="literal">NULL</span>) q.push(now-&gt;rchild);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preOrder</span><span class="params">(node* root)</span></span>&#123; <span class="comment">//å…ˆåºéå†</span></span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d"</span>,root-&gt;data);</span><br><span class="line">    num++;</span><br><span class="line">    <span class="keyword">if</span>(num &lt; n)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">" "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    preOrder(root-&gt;lchild);</span><br><span class="line">    preOrder(root-&gt;rchild);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">inOrder</span><span class="params">(node* root)</span></span>&#123; <span class="comment">//ä¸­åºéå†</span></span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    inOrder(root-&gt;lchild);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d"</span>,root-&gt;data);</span><br><span class="line">    num++;</span><br><span class="line">    <span class="keyword">if</span>(num &lt; n)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">" "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    inOrder(root-&gt;rchild);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">postOrder</span><span class="params">(node* root)</span></span>&#123; <span class="comment">//ååºéå†</span></span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    postOrder(root-&gt;lchild);</span><br><span class="line">    postOrder(root-&gt;rchild);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d"</span>,root-&gt;data);</span><br><span class="line">    num++;</span><br><span class="line">    <span class="keyword">if</span>(num &lt; n)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">" "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">    <span class="keyword">int</span> temp;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;temp);</span><br><span class="line">        in.push_back(temp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*æµ‹è¯•æ•°æ®ï¼šä¸­å</span></span><br><span class="line"><span class="comment">7</span></span><br><span class="line"><span class="comment">1 2 3 4 5 6 7</span></span><br><span class="line"><span class="comment">2 3 1 5 7 6 4</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;temp);</span><br><span class="line">        post.push_back(temp);</span><br><span class="line">    &#125;</span><br><span class="line">    node* root = createByPostAndIn(<span class="number">0</span>, n <span class="number">-1</span>, <span class="number">0</span>, n <span class="number">-1</span>);</span><br><span class="line"><span class="comment">/*æµ‹è¯•æ•°æ®ï¼šä¸­å‰</span></span><br><span class="line"><span class="comment">7</span></span><br><span class="line"><span class="comment">1 2 3 4 5 6 7</span></span><br><span class="line"><span class="comment">4 1 3 2 6 5 7</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="comment">// for(int i = 0; i &lt; n; i++)&#123;</span></span><br><span class="line">    <span class="comment">//     scanf("%d",&amp;temp);</span></span><br><span class="line">    <span class="comment">//     pre.push_back(temp);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// node* root = createByPreAndIn(0, n -1, 0, n -1);</span></span><br><span class="line"><span class="comment">/*æµ‹è¯•æ•°æ®ï¼šä¸­å±‚</span></span><br><span class="line"><span class="comment">7</span></span><br><span class="line"><span class="comment">1 2 3 4 5 6 7</span></span><br><span class="line"><span class="comment">4 1 6 3 5 7 2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="comment">// for(int i = 0; i &lt; n; i++)&#123;</span></span><br><span class="line">    <span class="comment">//     scanf("%d",&amp;temp);</span></span><br><span class="line">    <span class="comment">//     layer.push_back(temp);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// node* root = createByLayerAndIn(layer, in, 0, n -1);</span></span><br><span class="line">    BFS(root);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„å’Œç®—æ³• </category>
          
          <category> c/c++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„å’Œç®—æ³• </tag>
            
            <tag> c/c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€Ÿæ’åº</title>
      <link href="/2019/12/05/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/"/>
      <url>/2019/12/05/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h3 id="å¿«é€Ÿæ’åºæ€è·¯ï¼š"><a href="#å¿«é€Ÿæ’åºæ€è·¯ï¼š" class="headerlink" title="å¿«é€Ÿæ’åºæ€è·¯ï¼š"></a>å¿«é€Ÿæ’åºæ€è·¯ï¼š</h3><p>å¿«é€Ÿæ’åºæ—¶é—´æœ€å¥½æƒ…å†µä¸‹çš„å¤æ‚åº¦ä¸º<script type="math/tex">O(\log_2 n)</script>ï¼Œå¾…æ’åºåºåˆ—è¶Šæ— åºï¼Œæœ¬ç®—æ³•æ•ˆç‡è¶Šé«˜ã€‚æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ä¸º<script type="math/tex">O(n^2)</script>ï¼Œå¹³å‡å¤æ‚åº¦ä¸º$O(\log_2 n)$ï¼Œ</p><ul><li>å¯¹ä¸€ä¸ªåºåˆ—A[1]ã€A[2]ã€â€¦ ã€A[n]ï¼Œè°ƒæ•´åºåˆ—ä¸­å…ƒç´ çš„ä½ç½®ï¼Œä¸€è¶Ÿæ’åºåï¼Œä½¿å¾—A[1]çš„å·¦ä¾§æ‰€æœ‰å…ƒç´ éƒ½ä¸è¶…è¿‡A[1]ã€å³ä¾§æ‰€æœ‰å…ƒç´ éƒ½å¤§äºA[1].</li><li>ç„¶åï¼Œä»¥A[1]ä½ç½®åˆ†å‰²å·¦å³ä¸¤éƒ¨åˆ†é€’å½’å¿«é€Ÿæ’åº</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸€è¶Ÿå…³é”®å…ƒç´ ï¼ˆä¸»åŸï¼‰æ’åº</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">partition</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = A[left];</span><br><span class="line">    <span class="keyword">while</span>(left &lt; right)&#123;</span><br><span class="line">        <span class="keyword">while</span>(left &lt; right &amp;&amp; A[right] &gt; temp) right--;</span><br><span class="line">        A[left] = A[right];</span><br><span class="line">        <span class="keyword">while</span>(left &lt; right &amp;&amp; A[left] &lt;= temp ) left++;</span><br><span class="line">        A[right] = A[left];</span><br><span class="line">    &#125;</span><br><span class="line">    A[left] = temp;</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¼˜åŒ–ä¸»åŸæ²¡æœ‰æŠŠåŒºé—´[left,right]åˆ†æˆä¸¤ä¸ªè¿‘ä¼¼çš„å­åŒºé—´:éšæœºçš„é€‰æ‹©ä¸»åŸ</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">randPartition</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> randNum = (round(<span class="number">1.0</span>*rand()/RAND_MAX*(right - left) + left));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"randNum: %d\n"</span>,randNum);</span><br><span class="line">    swap(A[randNum],A[left]);</span><br><span class="line">    <span class="keyword">int</span> temp = A[left];</span><br><span class="line">    <span class="keyword">while</span>(left &lt; right)&#123;</span><br><span class="line">        <span class="keyword">while</span>(left &lt; right &amp;&amp; A[right] &gt; temp) right--;</span><br><span class="line">        A[left] = A[right];</span><br><span class="line">        <span class="keyword">while</span>(left &lt; right &amp;&amp; A[left] &lt;= temp) left++;</span><br><span class="line">        A[right] = A[left]; </span><br><span class="line">    &#125;</span><br><span class="line">    A[left] = temp;</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="keyword">int</span> A[],<span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(left &lt; right)&#123;</span><br><span class="line">        <span class="comment">//int pos = partition(A,left,right);</span></span><br><span class="line">        <span class="keyword">int</span> pos = randPartition(A,left,right);</span><br><span class="line">        quickSort(A,left,pos - <span class="number">1</span>);</span><br><span class="line">        quickSort(A,pos + <span class="number">1</span>,right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> A[] = &#123;<span class="number">35</span>,<span class="number">18</span>,<span class="number">16</span>,<span class="number">72</span>,<span class="number">24</span>,<span class="number">65</span>,<span class="number">12</span>,<span class="number">88</span>,<span class="number">46</span>,<span class="number">28</span>,<span class="number">100</span>,<span class="number">66</span>,<span class="number">866</span>&#125;;</span><br><span class="line">    quickSort(A,<span class="number">0</span>,<span class="number">9</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,A[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„å’Œç®—æ³• </category>
          
          <category> c/c++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„å’Œç®—æ³• </tag>
            
            <tag> c/c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å½’å¹¶æ’åº</title>
      <link href="/2019/12/05/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/"/>
      <url>/2019/12/05/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h3 id="äºŒè·¯å½’å¹¶æ’åºæ€è·¯ï¼š"><a href="#äºŒè·¯å½’å¹¶æ’åºæ€è·¯ï¼š" class="headerlink" title="äºŒè·¯å½’å¹¶æ’åºæ€è·¯ï¼š"></a>äºŒè·¯å½’å¹¶æ’åºæ€è·¯ï¼š</h3><p>å°†åŸå§‹åºåˆ—çœ‹ä½œNä¸ªåªåŒ…å«ä¸€ä¸ªå…ƒç´ çš„æœ‰åºå­åºåˆ—ï¼Œç„¶åæ¯æ¬¡è¿­ä»£å½’å¹¶ä¸¤ä¸ªç›¸é‚»çš„æœ‰åºå­åºåˆ—ï¼Œç›´åˆ°æœ€ååªå‰©ä¸‹ä¸€ä¸ªæœ‰åºçš„åºåˆ—ã€‚æ—¶é—´å¤æ‚åº¦ä¸º<script type="math/tex">O(\log_2 n)</script></p><p>ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°†æ•°ç»„Açš„[L1,R1]ä¸[L2,R2]åŒºé—´åˆå¹¶ä¸ºæœ‰åºçš„åŒºé—´</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> L1, <span class="keyword">int</span> R1, <span class="keyword">int</span> L2, <span class="keyword">int</span> R2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i=L1, j=L2;</span><br><span class="line">    <span class="keyword">int</span> temp[maxn], index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; R1 &amp;&amp; j &lt; R2)&#123;</span><br><span class="line">        <span class="keyword">if</span>(A[i] &lt;= A[j])&#123;</span><br><span class="line">            temp[index++] = A[i++];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            temp[index++] = A[j++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; R1) temp[index++] = A[i++];</span><br><span class="line">    <span class="keyword">while</span> (j &lt; R2) temp[index++] = A[j++];</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; index; i++)&#123;</span><br><span class="line">        A[L1 + <span class="number">1</span>] = temp[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2è·¯å½’å¹¶å½’å¹¶æ’åº: é€’å½’å®ç°</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(left &lt; right)&#123;</span><br><span class="line">        <span class="keyword">int</span> mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">        mergeSort(A, left, mid);</span><br><span class="line">        mergeSort(A, mid+<span class="number">1</span>, right);</span><br><span class="line">        merge(A, left, mid, mid + <span class="number">1</span>, right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2è·¯å½’å¹¶å½’å¹¶æ’åºï¼šéé€’å½’å®ç°</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(<span class="keyword">int</span> A[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> <span class="built_in">step</span> = <span class="number">2</span>; <span class="built_in">step</span> / <span class="number">2</span> &lt;= n; <span class="built_in">step</span> *= <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i += <span class="built_in">step</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> mid = i + <span class="built_in">step</span> / <span class="number">2</span> <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">if</span>(mid + <span class="number">1</span> &lt;= n)&#123;</span><br><span class="line">                merge(A, i, mid, mid + <span class="number">1</span>, <span class="built_in">min</span>(i + <span class="built_in">step</span> - <span class="number">1</span>,n));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„å’Œç®—æ³• </category>
          
          <category> c/c++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„å’Œç®—æ³• </tag>
            
            <tag> c/c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ’å…¥æ’åº</title>
      <link href="/2019/12/05/%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/"/>
      <url>/2019/12/05/%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h3 id="ç›´æ¥æ’å…¥æ€è·¯ï¼š"><a href="#ç›´æ¥æ’å…¥æ€è·¯ï¼š" class="headerlink" title="ç›´æ¥æ’å…¥æ€è·¯ï¼š"></a>ç›´æ¥æ’å…¥æ€è·¯ï¼š</h3><p>æ¯è¶Ÿå°†ä¸€ä¸ªå¾…æ’åºçš„å…³é”®å­—æŒ‰ç…§å…¶å€¼çš„å¤§å°ï¼Œæ’å…¥åˆ°æœ‰åºåºåˆ—ä¸­çš„æ­£ç¡®çš„ä½ç½®ï¼Œç›´åˆ°å…¨éƒ¨åºåˆ—æœ‰åºã€‚å…¶æ—¶é—´å¤æ‚åº¦ä¸º<script type="math/tex">O(n^2)</script>, å¾…æ’åºçš„å…ƒç´ è¶…è¿‡<script type="math/tex">10^5</script>çš„è§„æ¨¡æ—¶æ˜¯æ— æ³•æ‰¿å—çš„ã€‚</p><p>ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">int</span> <span class="title">getArrayLen</span>(<span class="title">T</span>&amp;<span class="title">array</span>)&#123;</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">sizeof</span>(<span class="built_in">array</span>) / <span class="keyword">sizeof</span>(<span class="built_in">array</span>[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ’å…¥æ’åºçš„ä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insertSort</span><span class="params">(<span class="keyword">int</span> A[],<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i&lt;= n; i++)&#123;</span><br><span class="line"><span class="keyword">int</span> temp = A[i], j = i;</span><br><span class="line"><span class="keyword">while</span>(j&gt;<span class="number">0</span> &amp;&amp; temp &lt; A[j - <span class="number">1</span>])&#123;</span><br><span class="line">A[j] = A[j - <span class="number">1</span>];</span><br><span class="line">j--;</span><br><span class="line">&#125;</span><br><span class="line">A[j] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> A[] = &#123;<span class="number">6</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">4</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> n = getArrayLen(A);</span><br><span class="line">insertSort(A,n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,A[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„å’Œç®—æ³• </category>
          
          <category> c/c++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„å’Œç®—æ³• </tag>
            
            <tag> c/c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>two pointersç¼–ç¨‹æ€æƒ³</title>
      <link href="/2019/12/05/two-pointers%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/"/>
      <url>/2019/12/05/two-pointers%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/</url>
      
        <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯two-pointers"><a href="#ä»€ä¹ˆæ˜¯two-pointers" class="headerlink" title="ä»€ä¹ˆæ˜¯two pointers"></a>ä»€ä¹ˆæ˜¯two pointers</h3><p>two pointersæ˜¯ç®—æ³•ç¼–ç¨‹ä¸­ä¸€ç§éå¸¸é‡è¦çš„æ€æƒ³ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ç§ç¼–ç¨‹æŠ€å·§ã€‚å®ƒéå¸¸ç®€æ´å’Œé«˜æ•ˆã€‚</p><ul><li><p>ä»¥ä¸€ä¸ªä¾‹å­å¼•å…¥ï¼šç»™å®šä¸€ä¸ªé€’å¢çš„æ­£æ•´æ•°åºåˆ—å’Œä¸€ä¸ªæ­£æ•´æ•°Mï¼Œæ±‚åºåˆ—ä¸­çš„ä¸¤ä¸ªä¸åŒä½ç½®çš„æ•°aå’Œb,ä½¿å¾—å®ƒä»¬çš„å’Œæ°å¥½ä¸ºMï¼Œè¾“å‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„æ–¹æ¡ˆã€‚å¦‚ç»™å®šåºåˆ—{1,2,3,4,5,6}å’Œæ­£å¥½æ˜¯M=8ï¼Œå°±å­˜åœ¨2+6=8ä¸3+5=8æˆç«‹ã€‚</p><p>ç›´è§‚çš„æƒ³æ³•æ˜¯ä½¿ç”¨äºŒé‡å¾ªç¯æšä¸¾åºåˆ—ä¸­çš„aå’Œbï¼Œåˆ¤æ–­å’Œæ˜¯å¦ä¸ºM</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(a[i] + a[j] == M)&#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>, a[i], a[j]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œè¿™ç§åšæ³•æ—¶é—´å¤æ‚åº¦ä¸º<script type="math/tex">O(n^2)</script>ï¼Œå¯¹nåœ¨<script type="math/tex">10^5</script>çš„è§„æ¨¡æ—¶æ˜¯æ— æ³•æ‰¿å—çš„ã€‚</p><p>two pointerså®ç°æ–¹æ³•ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(i &lt; j)&#123;</span><br><span class="line">  <span class="keyword">if</span>(a[i] + a[j] == M)&#123;</span><br><span class="line">    i++;</span><br><span class="line">    j--;</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(a[i] + a[j] &lt; M)&#123;</span><br><span class="line">    i++;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    j--;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œtwo pointersæ€æƒ³å……åˆ†åˆ©ç”¨äº†åºåˆ—é€’å¢çš„æ€§è´¨ï¼Œä»¥å¾ˆæµ…æ˜¾çš„æ€æƒ³é™ä½äº†å¤æ‚åº¦ã€‚</p></li><li><p>å†æ¥çœ‹ä¸€ä¸ªåºåˆ—åˆå¹¶çš„é—®é¢˜ï¼šå‡å¦‚ä¸¤ä¸ªéé€’å‡åºåˆ—Aå’ŒBï¼Œè¦æ±‚å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªéé€’å‡åºåˆ—Cã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> B[], <span class="keyword">int</span> C[], <span class="keyword">int</span> n, <span class="keyword">int</span> m)</span></span>&#123; <span class="comment">//n,måˆ†åˆ«ä¸ºAï¼ŒBçš„åºåˆ—é•¿åº¦</span></span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(i &lt; n &amp;&amp; j &lt; m)&#123;</span><br><span class="line">    <span class="keyword">if</span>(A[i] &lt;= B[j])&#123;</span><br><span class="line">      C[index++] = A[i++];</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      C[index++] = B[j++];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span>(i &lt; n) C[index++] = A[i++];</span><br><span class="line">  <span class="keyword">while</span>(j &lt; m) C[index++] = B[j++];</span><br><span class="line">  <span class="keyword">return</span> index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Two pointers åˆ©ç”¨é—®é¢˜æœ¬èº«ä¸åºåˆ—çš„ç‰¹æ€§ï¼Œä½¿ç”¨ä¸¤ä¸ªä¸‹æ ‡i,jå¯¹åºåˆ—è¿›è¡Œæ‰«æï¼ˆå¯ä»¥åŒå‘æ‰«æï¼Œä¹Ÿå¯ä»¥åå“æ‰«æï¼‰ï¼Œä»¥è¾ƒä½çš„å¤æ‚åº¦ï¼ˆä¸€èˆ¬æ˜¯O(n)çš„å¤æ‚åº¦ï¼‰è§£å†³é—®é¢˜ã€‚</p></li></ul><h3 id="ä¾‹å­B1030-A1085-å®Œç¾æ•°åˆ—ï¼š-two-pointerså®ç°"><a href="#ä¾‹å­B1030-A1085-å®Œç¾æ•°åˆ—ï¼š-two-pointerså®ç°" class="headerlink" title="ä¾‹å­B1030/A1085 å®Œç¾æ•°åˆ—ï¼š  two pointerså®ç°"></a>ä¾‹å­B1030/A1085 å®Œç¾æ•°åˆ—ï¼š  two pointerså®ç°</h3><p>ç»™å®šä¸€ä¸ªæ­£æ•´æ•°æ•°åˆ—ï¼Œå’Œæ­£æ•´æ•° <em>p</em>ï¼Œè®¾è¿™ä¸ªæ•°åˆ—ä¸­çš„æœ€å¤§å€¼æ˜¯ <em>M</em>ï¼Œæœ€å°å€¼æ˜¯ <em>m</em>ï¼Œå¦‚æœ <em>M</em>â‰¤<em>m**p</em>ï¼Œåˆ™ç§°è¿™ä¸ªæ•°åˆ—æ˜¯å®Œç¾æ•°åˆ—ã€‚</p><p>ç°åœ¨ç»™å®šå‚æ•° <em>p</em> å’Œä¸€äº›æ­£æ•´æ•°ï¼Œè¯·ä½ ä»ä¸­é€‰æ‹©å°½å¯èƒ½å¤šçš„æ•°æ„æˆä¸€ä¸ªå®Œç¾æ•°åˆ—ã€‚</p><h3 id="è¾“å…¥æ ¼å¼ï¼š"><a href="#è¾“å…¥æ ¼å¼ï¼š" class="headerlink" title="è¾“å…¥æ ¼å¼ï¼š"></a>è¾“å…¥æ ¼å¼ï¼š</h3><p>è¾“å…¥ç¬¬ä¸€è¡Œç»™å‡ºä¸¤ä¸ªæ­£æ•´æ•° <em>N</em> å’Œ <em>p</em>ï¼Œå…¶ä¸­ <em>N</em>ï¼ˆâ‰¤105ï¼‰æ˜¯è¾“å…¥çš„æ­£æ•´æ•°çš„ä¸ªæ•°ï¼Œ<em>p</em>ï¼ˆâ‰¤109ï¼‰æ˜¯ç»™å®šçš„å‚æ•°ã€‚ç¬¬äºŒè¡Œç»™å‡º <em>N</em> ä¸ªæ­£æ•´æ•°ï¼Œæ¯ä¸ªæ•°ä¸è¶…è¿‡ 109ã€‚</p><h3 id="è¾“å‡ºæ ¼å¼ï¼š"><a href="#è¾“å‡ºæ ¼å¼ï¼š" class="headerlink" title="è¾“å‡ºæ ¼å¼ï¼š"></a>è¾“å‡ºæ ¼å¼ï¼š</h3><p>åœ¨ä¸€è¡Œä¸­è¾“å‡ºæœ€å¤šå¯ä»¥é€‰æ‹©å¤šå°‘ä¸ªæ•°å¯ä»¥ç”¨å®ƒä»¬ç»„æˆä¸€ä¸ªå®Œç¾æ•°åˆ—ã€‚</p><h3 id="è¾“å…¥æ ·ä¾‹ï¼š"><a href="#è¾“å…¥æ ·ä¾‹ï¼š" class="headerlink" title="è¾“å…¥æ ·ä¾‹ï¼š"></a>è¾“å…¥æ ·ä¾‹ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10 8</span><br><span class="line">2 3 20 4 5 1 6 7 8 9</span><br></pre></td></tr></table></figure><h3 id="è¾“å‡ºæ ·ä¾‹ï¼š"><a href="#è¾“å‡ºæ ·ä¾‹ï¼š" class="headerlink" title="è¾“å‡ºæ ·ä¾‹ï¼š"></a>è¾“å‡ºæ ·ä¾‹ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8</span><br></pre></td></tr></table></figure><h3 id="ä»£ç å®ç°ï¼š"><a href="#ä»£ç å®ç°ï¼š" class="headerlink" title="ä»£ç å®ç°ï¼š"></a>ä»£ç å®ç°ï¼š</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">int</span> n,p,num[maxn];</span><br><span class="line"><span class="comment">//two pointerså®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;p);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;num[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    sort(num, num + n);</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, count = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; n &amp;&amp; j &lt; n)&#123;</span><br><span class="line">        <span class="keyword">while</span>(j &lt; n &amp;&amp; num[j] &lt;= (<span class="keyword">long</span> <span class="keyword">long</span>)num[i] * p)&#123;</span><br><span class="line">            count = <span class="built_in">max</span>(count, j - i + <span class="number">1</span>);</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,count);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„å’Œç®—æ³• </category>
          
          <category> c/c++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„å’Œç®—æ³• </tag>
            
            <tag> c/c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>lower_boundå’Œupper_boundå‡½æ•°åº”ç”¨</title>
      <link href="/2019/12/05/lower-bound%E5%92%8Cupper-bound%E5%87%BD%E6%95%B0%E5%BA%94%E7%94%A8/"/>
      <url>/2019/12/05/lower-bound%E5%92%8Cupper-bound%E5%87%BD%E6%95%B0%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h4 id="äºŒåˆ†æŸ¥æ‰¾çš„åº”ç”¨-lower-bound-å’Œupper-bound"><a href="#äºŒåˆ†æŸ¥æ‰¾çš„åº”ç”¨-lower-bound-å’Œupper-bound" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾çš„åº”ç”¨ lower_bound( )å’Œupper_bound( )"></a>äºŒåˆ†æŸ¥æ‰¾çš„åº”ç”¨ lower_bound( )å’Œupper_bound( )</h4><ul><li>ä½¿ç”¨æ—¶éœ€è¦å¼•ç”¨c++æ ‡å‡†åº“ä¸­<algorithm>  </li></ul><p>åœ¨ä»å°åˆ°å¤§çš„æ’åºæ•°ç»„ä¸­:</p><ul><li>lower_bound( begin,end,num)ï¼šä»æ•°ç»„çš„beginä½ç½®åˆ°end-1ä½ç½®äºŒåˆ†æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºæˆ–ç­‰äºnumçš„æ•°å­—,æ‰¾åˆ°è¿”å›è¯¥æ•°å­—çš„åœ°å€ï¼Œä¸å­˜åœ¨åˆ™è¿”å›endã€‚é€šè¿‡è¿”å›çš„åœ°å€å‡å»èµ·å§‹åœ°å€begin,å¾—åˆ°æ‰¾åˆ°æ•°å­—åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ã€‚</li><li>upper_bound( begin,end,num)ï¼šä»æ•°ç»„çš„beginä½ç½®åˆ°end-1ä½ç½®äºŒåˆ†æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºnumçš„æ•°å­—ï¼Œæ‰¾åˆ°è¿”å›è¯¥æ•°å­—çš„åœ°å€ï¼Œä¸å­˜åœ¨åˆ™è¿”å›endã€‚é€šè¿‡è¿”å›çš„åœ°å€å‡å»èµ·å§‹åœ°å€begin,å¾—åˆ°æ‰¾åˆ°æ•°å­—åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ã€‚</li></ul><p>åœ¨ä»å¤§åˆ°å°çš„æ’åºæ•°ç»„ä¸­:</p><ul><li>lower_bound( begin,end,num,greater<type>() ):ä»æ•°ç»„çš„beginä½ç½®åˆ°end-1ä½ç½®äºŒåˆ†æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå°äºæˆ–ç­‰äºnumçš„æ•°å­—ï¼Œæ‰¾åˆ°è¿”å›è¯¥æ•°å­—çš„åœ°å€ï¼Œä¸å­˜åœ¨åˆ™è¿”å›endã€‚é€šè¿‡è¿”å›çš„åœ°å€å‡å»èµ·å§‹åœ°å€begin,å¾—åˆ°æ‰¾åˆ°æ•°å­—åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ã€‚</li><li>upper_bound( begin,end,num,greater<type>() ):ä»æ•°ç»„çš„beginä½ç½®åˆ°end-1ä½ç½®äºŒåˆ†æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå°äºnumçš„æ•°å­—ï¼Œæ‰¾åˆ°è¿”å›è¯¥æ•°å­—çš„åœ°å€ï¼Œä¸å­˜åœ¨åˆ™è¿”å›endã€‚é€šè¿‡è¿”å›çš„åœ°å€å‡å»èµ·å§‹åœ°å€begin,å¾—åˆ°æ‰¾åˆ°æ•°å­—åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ã€‚</li></ul><p>å®ä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">100000</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF=<span class="number">2</span>*<span class="keyword">int</span>(<span class="number">1e9</span>)+<span class="number">10</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LL long long</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmd</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a&gt;b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> num[<span class="number">6</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">15</span>,<span class="number">34</span>&#125;; </span><br><span class="line">sort(num,num+<span class="number">6</span>);                           <span class="comment">//æŒ‰ä»å°åˆ°å¤§æ’åº </span></span><br><span class="line"><span class="keyword">int</span> pos1=lower_bound(num,num+<span class="number">6</span>,<span class="number">7</span>)-num;    <span class="comment">//è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå¤§äºæˆ–ç­‰äºè¢«æŸ¥æ•°çš„å€¼ </span></span><br><span class="line"><span class="keyword">int</span> pos2=upper_bound(num,num+<span class="number">6</span>,<span class="number">7</span>)-num;    <span class="comment">//è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå¤§äºè¢«æŸ¥æ•°çš„å€¼</span></span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;pos1&lt;&lt;<span class="string">" "</span>&lt;&lt;num[pos1]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;pos2&lt;&lt;<span class="string">" "</span>&lt;&lt;num[pos2]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">sort(num,num+<span class="number">6</span>,cmd);                      <span class="comment">//æŒ‰ä»å¤§åˆ°å°æ’åº</span></span><br><span class="line"><span class="keyword">int</span> pos3=lower_bound(num,num+<span class="number">6</span>,<span class="number">7</span>,greater&lt;<span class="keyword">int</span>&gt;())-num;  <span class="comment">//è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå°äºæˆ–ç­‰äºè¢«æŸ¥æ•°çš„å€¼ </span></span><br><span class="line"><span class="keyword">int</span> pos4=upper_bound(num,num+<span class="number">6</span>,<span class="number">7</span>,greater&lt;<span class="keyword">int</span>&gt;())-num;  <span class="comment">//è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå°äºè¢«æŸ¥æ•°çš„å€¼ </span></span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;pos3&lt;&lt;<span class="string">" "</span>&lt;&lt;num[pos3]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;pos4&lt;&lt;<span class="string">" "</span>&lt;&lt;num[pos4]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line"><span class="number">3</span> <span class="number">7</span></span><br><span class="line"><span class="number">4</span> <span class="number">15</span></span><br><span class="line"><span class="number">2</span> <span class="number">7</span></span><br><span class="line"><span class="number">3</span> <span class="number">4</span></span><br></pre></td></tr></table></figure><ul><li>lower_boundå’Œupper_boundçš„ä»£ç ï¼Œ</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lower_bound</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> left, <span class="keyword">int</span> right, <span class="keyword">int</span> cmpX)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid;</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right)</span><br><span class="line">    &#123;</span><br><span class="line">       mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (A[mid] &gt;= cmpX)</span><br><span class="line">        &#123;</span><br><span class="line">            right = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">left = mid + <span class="number">1</span>;</span><br><span class="line">&#125;   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">upper_bound</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> left, <span class="keyword">int</span> right, <span class="keyword">int</span> cmpX)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid;</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right)</span><br><span class="line">    &#123;</span><br><span class="line">       mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (A[mid] &gt; cmpX)</span><br><span class="line">        &#123;</span><br><span class="line">            right = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">left = mid + <span class="number">1</span>;</span><br><span class="line">&#125;   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥ä½œä¸ºè§£å†³â€œå¯»æ‰¾æœ‰åºåºåˆ—ç¬¬ä¸€ä¸ªæ»¡è¶³æŸä¸€æ¡ä»¶çš„å…ƒç´ çš„ä½ç½®â€é—®é¢˜çš„å›ºå®šæ¨¡ç‰ˆã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">äºŒåˆ†åŒºé—´[left,right]ä¸ºå·¦é—­å³é—­ï¼Œåˆå€¼è¦å¿…é¡»è¦†ç›–</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid;</span><br><span class="line">    <span class="keyword">while</span>(left &lt; right)&#123;</span><br><span class="line">        mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(æ¡ä»¶æˆç«‹)&#123;</span><br><span class="line">            right = mid;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¾‹å­ï¼š"><a href="#ä¾‹å­ï¼š" class="headerlink" title="ä¾‹å­ï¼š"></a>ä¾‹å­ï¼š</h3><p>ç»™å®šä¸€ä¸ªæ­£æ•´æ•°æ•°åˆ—ï¼Œå’Œæ­£æ•´æ•° <em>p</em>ï¼Œè®¾è¿™ä¸ªæ•°åˆ—ä¸­çš„æœ€å¤§å€¼æ˜¯ <em>M</em>ï¼Œæœ€å°å€¼æ˜¯ <em>m</em>ï¼Œå¦‚æœ <em>M</em>â‰¤<em>m**p</em>ï¼Œåˆ™ç§°è¿™ä¸ªæ•°åˆ—æ˜¯å®Œç¾æ•°åˆ—ã€‚</p><p>ç°åœ¨ç»™å®šå‚æ•° <em>p</em> å’Œä¸€äº›æ­£æ•´æ•°ï¼Œè¯·ä½ ä»ä¸­é€‰æ‹©å°½å¯èƒ½å¤šçš„æ•°æ„æˆä¸€ä¸ªå®Œç¾æ•°åˆ—ã€‚</p><h3 id="è¾“å…¥æ ¼å¼ï¼š"><a href="#è¾“å…¥æ ¼å¼ï¼š" class="headerlink" title="è¾“å…¥æ ¼å¼ï¼š"></a>è¾“å…¥æ ¼å¼ï¼š</h3><p>è¾“å…¥ç¬¬ä¸€è¡Œç»™å‡ºä¸¤ä¸ªæ­£æ•´æ•° <em>N</em> å’Œ <em>p</em>ï¼Œå…¶ä¸­ <em>N</em>ï¼ˆâ‰¤105ï¼‰æ˜¯è¾“å…¥çš„æ­£æ•´æ•°çš„ä¸ªæ•°ï¼Œ<em>p</em>ï¼ˆâ‰¤109ï¼‰æ˜¯ç»™å®šçš„å‚æ•°ã€‚ç¬¬äºŒè¡Œç»™å‡º <em>N</em> ä¸ªæ­£æ•´æ•°ï¼Œæ¯ä¸ªæ•°ä¸è¶…è¿‡ 109ã€‚</p><h3 id="è¾“å‡ºæ ¼å¼ï¼š"><a href="#è¾“å‡ºæ ¼å¼ï¼š" class="headerlink" title="è¾“å‡ºæ ¼å¼ï¼š"></a>è¾“å‡ºæ ¼å¼ï¼š</h3><p>åœ¨ä¸€è¡Œä¸­è¾“å‡ºæœ€å¤šå¯ä»¥é€‰æ‹©å¤šå°‘ä¸ªæ•°å¯ä»¥ç”¨å®ƒä»¬ç»„æˆä¸€ä¸ªå®Œç¾æ•°åˆ—ã€‚</p><h3 id="è¾“å…¥æ ·ä¾‹ï¼š"><a href="#è¾“å…¥æ ·ä¾‹ï¼š" class="headerlink" title="è¾“å…¥æ ·ä¾‹ï¼š"></a>è¾“å…¥æ ·ä¾‹ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10 8</span><br><span class="line">2 3 20 4 5 1 6 7 8 9</span><br></pre></td></tr></table></figure><h3 id="è¾“å‡ºæ ·ä¾‹ï¼š"><a href="#è¾“å‡ºæ ·ä¾‹ï¼š" class="headerlink" title="è¾“å‡ºæ ·ä¾‹ï¼š"></a>è¾“å‡ºæ ·ä¾‹ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8</span><br></pre></td></tr></table></figure><p>ä»£ç å®ç°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">int</span> n,p,num[maxn];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &lt; b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">long</span> <span class="keyword">long</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(num[n - <span class="number">1</span>] &lt;= x) <span class="keyword">return</span> n;</span><br><span class="line">    <span class="keyword">int</span> l = i + <span class="number">1</span>, r = n - <span class="number">1</span>, mid;</span><br><span class="line">    <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">        mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(num[mid] &lt;= x)&#123;</span><br><span class="line">            l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            r = mid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// int main()&#123;</span></span><br><span class="line"><span class="comment">//     scanf("%d %d",&amp;n,&amp;p);</span></span><br><span class="line"><span class="comment">//     for(int i = 0; i &lt; n; i++)&#123;</span></span><br><span class="line"><span class="comment">//         scanf("%d",&amp;num[i]);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     sort(num,num + n,cmp);</span></span><br><span class="line"><span class="comment">//     int ans = 1;</span></span><br><span class="line"><span class="comment">//     for(int i = 0; i &lt; n; i++)&#123;</span></span><br><span class="line"><span class="comment">//         int j = binarySearch(i,(long long)num[i]*p);</span></span><br><span class="line"><span class="comment">//         ans = max(ans,j - i);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     printf("%d\n",ans);</span></span><br><span class="line"><span class="comment">//     return 0;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;p);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;num[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    sort(num, num + n);</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> j = upper_bound(num + i + <span class="number">1</span>, num + n, (<span class="keyword">long</span> <span class="keyword">long</span>)num[i]*p) - num;</span><br><span class="line">        ans = <span class="built_in">max</span>(ans, j - i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> c/c++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> c/c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è´ªå¿ƒç®—æ³•</title>
      <link href="/2019/12/04/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95/"/>
      <url>/2019/12/04/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h2 id="è´ªå¿ƒç®—æ³•"><a href="#è´ªå¿ƒç®—æ³•" class="headerlink" title="è´ªå¿ƒç®—æ³•"></a>è´ªå¿ƒç®—æ³•</h2><p>è´ªå¿ƒæ˜¯ç”¨æ¥è§£å†³ä¸€ç±»æœ€ä¼˜åŒ–é—®é¢˜ï¼Œä¸€èˆ¬å°±æ˜¯é—®æœ€å¤šï¼Œæœ€å°‘ï¼Œæœ€å¤§å€¼ï¼Œæœ€å°å€¼ï¼Œæœ€çŸ­ï¼Œæœ€é•¿ï¼Œåªè¦è¿™ä¸ªé¢˜è€ƒæœ€ã€‚ã€‚ã€‚ã€‚æˆ–è€…é—®æ€ä¹ˆæ‰èƒ½ä½¿ã€‚ã€‚ã€‚ã€‚ã€‚æˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘è´ªå¿ƒç®—æ³•ã€‚</p><h2 id="1-ç®€å•è´ªå¿ƒ"><a href="#1-ç®€å•è´ªå¿ƒ" class="headerlink" title="1. ç®€å•è´ªå¿ƒ"></a>1. ç®€å•è´ªå¿ƒ</h2><p>æ±‚è§£ä¸€ç±»æœ€ä¼˜åŒ–é—®é¢˜çš„æ–¹æ³•ï¼Œå®ƒæ€»æ˜¯è€ƒè™‘åœ¨å½“å‰çŠ¶æ€ä¸‹å±€éƒ¨æœ€ä¼˜ï¼ˆæˆ–è¾ƒä¼˜ï¼‰çš„ç­–ç•¥ï¼Œæ¥ä½¿å…¨å±€çš„ç»“æœè¾¾åˆ°æœ€ä¼˜ï¼ˆæˆ–è¾ƒä¼˜ï¼‰ã€‚è€Œè¦è·å¾—æœ€ä¼˜ç»“æœï¼Œåˆ™è¦æ±‚ä¸­é—´çš„æ¯æ­¥ç­–ç•¥éƒ½æ˜¯æœ€ä¼˜çš„ï¼Œå› æ­¤åœ¨ä¸¥è°¨çš„ä½¿ç”¨è´ªå¿ƒæ³•æ±‚è§£æœ€ä¼˜é—®é¢˜ï¼Œéœ€è¦å¯¹é‡‡å–çš„ç­–ç•¥è¿›è¡Œè¯æ˜ã€‚è¯æ˜çš„ä¸€èˆ¬æ€è·¯æ˜¯ä½¿ç”¨åæ­£æ³•åŠæ•°å­¦å½’çº³æ³•ã€‚</p><h3 id="ä¸‹é¢ä¸¤ä¸ªä½¿ç”¨è´ªå¿ƒçš„å°ä¾‹å­ï¼š"><a href="#ä¸‹é¢ä¸¤ä¸ªä½¿ç”¨è´ªå¿ƒçš„å°ä¾‹å­ï¼š" class="headerlink" title="ä¸‹é¢ä¸¤ä¸ªä½¿ç”¨è´ªå¿ƒçš„å°ä¾‹å­ï¼š"></a>ä¸‹é¢ä¸¤ä¸ªä½¿ç”¨è´ªå¿ƒçš„å°ä¾‹å­ï¼š</h3><h4 id="1-æ±‚æœ€å¤§æ”¶ç›Š"><a href="#1-æ±‚æœ€å¤§æ”¶ç›Š" class="headerlink" title="1.  æ±‚æœ€å¤§æ”¶ç›Š"></a>1.  æ±‚æœ€å¤§æ”¶ç›Š</h4><p>æœˆé¥¼æ˜¯ä¸­å›½äººåœ¨ä¸­ç§‹ä½³èŠ‚æ—¶åƒçš„ä¸€ç§ä¼ ç»Ÿé£Ÿå“ï¼Œä¸åŒåœ°åŒºæœ‰è®¸å¤šä¸åŒé£å‘³çš„æœˆé¥¼ã€‚ç°ç»™å®šæ‰€æœ‰ç§ç±»æœˆé¥¼çš„åº“å­˜é‡ã€æ€»å”®ä»·ã€ä»¥åŠå¸‚åœºçš„æœ€å¤§éœ€æ±‚é‡ï¼Œè¯·ä½ è®¡ç®—å¯ä»¥è·å¾—çš„æœ€å¤§æ”¶ç›Šæ˜¯å¤šå°‘ã€‚</p><p>æ³¨æ„ï¼šé”€å”®æ—¶å…è®¸å–å‡ºä¸€éƒ¨åˆ†åº“å­˜ã€‚æ ·ä¾‹ç»™å‡ºçš„æƒ…å½¢æ˜¯è¿™æ ·çš„ï¼šå‡å¦‚æˆ‘ä»¬æœ‰ 3 ç§æœˆé¥¼ï¼Œå…¶åº“å­˜é‡åˆ†åˆ«ä¸º 18ã€15ã€10 ä¸‡å¨ï¼Œæ€»å”®ä»·åˆ†åˆ«ä¸º 75ã€72ã€45 äº¿å…ƒã€‚å¦‚æœå¸‚åœºçš„æœ€å¤§éœ€æ±‚é‡åªæœ‰ 20 ä¸‡å¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ€å¤§æ”¶ç›Šç­–ç•¥åº”è¯¥æ˜¯å–å‡ºå…¨éƒ¨ 15 ä¸‡å¨ç¬¬ 2 ç§æœˆé¥¼ã€ä»¥åŠ 5 ä¸‡å¨ç¬¬ 3 ç§æœˆé¥¼ï¼Œè·å¾— 72 + 45/2 = 94.5ï¼ˆäº¿å…ƒï¼‰ã€‚</p><h4 id="è¾“å…¥æ ¼å¼ï¼š"><a href="#è¾“å…¥æ ¼å¼ï¼š" class="headerlink" title="è¾“å…¥æ ¼å¼ï¼š"></a>è¾“å…¥æ ¼å¼ï¼š</h4><p>æ¯ä¸ªè¾“å…¥åŒ…å«ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å…ˆç»™å‡ºä¸€ä¸ªä¸è¶…è¿‡ 1000 çš„æ­£æ•´æ•° <em>N</em> è¡¨ç¤ºæœˆé¥¼çš„ç§ç±»æ•°ã€ä»¥åŠä¸è¶…è¿‡ 500ï¼ˆä»¥ä¸‡å¨ä¸ºå•ä½ï¼‰çš„æ­£æ•´æ•° <em>D</em> è¡¨ç¤ºå¸‚åœºæœ€å¤§éœ€æ±‚é‡ã€‚éšåä¸€è¡Œç»™å‡º <em>N</em> ä¸ªæ­£æ•°è¡¨ç¤ºæ¯ç§æœˆé¥¼çš„åº“å­˜é‡ï¼ˆä»¥ä¸‡å¨ä¸ºå•ä½ï¼‰ï¼›æœ€åä¸€è¡Œç»™å‡º <em>N</em> ä¸ªæ­£æ•°è¡¨ç¤ºæ¯ç§æœˆé¥¼çš„æ€»å”®ä»·ï¼ˆä»¥äº¿å…ƒä¸ºå•ä½ï¼‰ã€‚æ•°å­—é—´ä»¥ç©ºæ ¼åˆ†éš”ã€‚</p><h4 id="è¾“å‡ºæ ¼å¼ï¼š"><a href="#è¾“å‡ºæ ¼å¼ï¼š" class="headerlink" title="è¾“å‡ºæ ¼å¼ï¼š"></a>è¾“å‡ºæ ¼å¼ï¼š</h4><p>å¯¹æ¯ç»„æµ‹è¯•ç”¨ä¾‹ï¼Œåœ¨ä¸€è¡Œä¸­è¾“å‡ºæœ€å¤§æ”¶ç›Šï¼Œä»¥äº¿å…ƒä¸ºå•ä½å¹¶ç²¾ç¡®åˆ°å°æ•°ç‚¹å 2 ä½ã€‚</p><h4 id="è¾“å…¥æ ·ä¾‹ï¼š"><a href="#è¾“å…¥æ ·ä¾‹ï¼š" class="headerlink" title="è¾“å…¥æ ·ä¾‹ï¼š"></a>è¾“å…¥æ ·ä¾‹ï¼š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3 20</span><br><span class="line">18 15 10</span><br><span class="line">75 72 45</span><br></pre></td></tr></table></figure><h4 id="è¾“å‡ºæ ·ä¾‹ï¼š"><a href="#è¾“å‡ºæ ·ä¾‹ï¼š" class="headerlink" title="è¾“å‡ºæ ·ä¾‹ï¼š"></a>è¾“å‡ºæ ·ä¾‹ï¼š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">94.50</span><br></pre></td></tr></table></figure><h4 id="ä»£ç å®ç°ï¼š"><a href="#ä»£ç å®ç°ï¼š" class="headerlink" title="ä»£ç å®ç°ï¼š"></a>ä»£ç å®ç°ï¼š</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Goods</span>&#123;</span></span><br><span class="line">    <span class="keyword">double</span> store;</span><br><span class="line">    <span class="keyword">double</span> sell;</span><br><span class="line">    <span class="keyword">double</span> price;</span><br><span class="line">&#125;goods[<span class="number">1010</span>];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(Goods a,Goods b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.price &gt; b.price;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">double</span> d,total = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%lf"</span>,&amp;n,&amp;d);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%lf"</span>,&amp;goods[i].store);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;       <span class="comment">//æ±‚å±€éƒ¨æœ€ä¼˜</span></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%lf"</span>,&amp;goods[i].sell);</span><br><span class="line">        goods[i].price = goods[i].sell / goods[i].store;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(goods,goods + n,cmp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(d &gt;= goods[j].store)&#123;</span><br><span class="line">            total = total + goods[j].sell;</span><br><span class="line">            d = d - goods[j].store;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            total = total + d * goods[j].price;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.2f\n"</span>,total);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-æ±‚æœ€å°ç»„æˆçš„æ•°"><a href="#2-æ±‚æœ€å°ç»„æˆçš„æ•°" class="headerlink" title="2. æ±‚æœ€å°ç»„æˆçš„æ•°"></a>2. æ±‚æœ€å°ç»„æˆçš„æ•°</h3><p>ç»™å®šæ•°å­— 0-9 å„è‹¥å¹²ä¸ªã€‚ä½ å¯ä»¥ä»¥ä»»æ„é¡ºåºæ’åˆ—è¿™äº›æ•°å­—ï¼Œä½†å¿…é¡»å…¨éƒ¨ä½¿ç”¨ã€‚ç›®æ ‡æ˜¯ä½¿å¾—æœ€åå¾—åˆ°çš„æ•°å°½å¯èƒ½å°ï¼ˆæ³¨æ„ 0 ä¸èƒ½åšé¦–ä½ï¼‰ã€‚ä¾‹å¦‚ï¼šç»™å®šä¸¤ä¸ª 0ï¼Œä¸¤ä¸ª 1ï¼Œä¸‰ä¸ª 5ï¼Œä¸€ä¸ª 8ï¼Œæˆ‘ä»¬å¾—åˆ°çš„æœ€å°çš„æ•°å°±æ˜¯ 10015558ã€‚</p><p>ç°ç»™å®šæ•°å­—ï¼Œè¯·ç¼–å†™ç¨‹åºè¾“å‡ºèƒ½å¤Ÿç»„æˆçš„æœ€å°çš„æ•°ã€‚</p><h4 id="è¾“å…¥æ ¼å¼ï¼š-1"><a href="#è¾“å…¥æ ¼å¼ï¼š-1" class="headerlink" title="è¾“å…¥æ ¼å¼ï¼š"></a>è¾“å…¥æ ¼å¼ï¼š</h4><p>è¾“å…¥åœ¨ä¸€è¡Œä¸­ç»™å‡º 10 ä¸ªéè´Ÿæ•´æ•°ï¼Œé¡ºåºè¡¨ç¤ºæˆ‘ä»¬æ‹¥æœ‰æ•°å­— 0ã€æ•°å­— 1ã€â€¦â€¦æ•°å­— 9 çš„ä¸ªæ•°ã€‚æ•´æ•°é—´ç”¨ä¸€ä¸ªç©ºæ ¼åˆ†éš”ã€‚10 ä¸ªæ•°å­—çš„æ€»ä¸ªæ•°ä¸è¶…è¿‡ 50ï¼Œä¸”è‡³å°‘æ‹¥æœ‰ 1 ä¸ªé 0 çš„æ•°å­—ã€‚</p><h4 id="è¾“å‡ºæ ¼å¼ï¼š-1"><a href="#è¾“å‡ºæ ¼å¼ï¼š-1" class="headerlink" title="è¾“å‡ºæ ¼å¼ï¼š"></a>è¾“å‡ºæ ¼å¼ï¼š</h4><p>åœ¨ä¸€è¡Œä¸­è¾“å‡ºèƒ½å¤Ÿç»„æˆçš„æœ€å°çš„æ•°ã€‚</p><h4 id="è¾“å…¥æ ·ä¾‹ï¼š-1"><a href="#è¾“å…¥æ ·ä¾‹ï¼š-1" class="headerlink" title="è¾“å…¥æ ·ä¾‹ï¼š"></a>è¾“å…¥æ ·ä¾‹ï¼š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 2 0 0 0 3 0 0 1 0</span><br></pre></td></tr></table></figure><h4 id="è¾“å‡ºæ ·ä¾‹ï¼š-1"><a href="#è¾“å‡ºæ ·ä¾‹ï¼š-1" class="headerlink" title="è¾“å‡ºæ ·ä¾‹ï¼š"></a>è¾“å‡ºæ ·ä¾‹ï¼š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10015558</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;<span class="number">10</span>; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;count[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">10</span>; i++)&#123; <span class="comment">//å±€éƒ¨æœ€å°å€¼1</span></span><br><span class="line">        <span class="keyword">if</span>(count[i] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d"</span>,i);</span><br><span class="line">            count[i]--;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;<span class="number">10</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;count[i]; j++)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d"</span>,i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-åŒºé—´è´ªå¿ƒ"><a href="#2-åŒºé—´è´ªå¿ƒ" class="headerlink" title="2. åŒºé—´è´ªå¿ƒ"></a>2. åŒºé—´è´ªå¿ƒ</h2><p>åŒºé—´ä¸ç›¸äº¤é—®é¢˜ï¼šç»™å‡ºNä¸ªå¼€åŒºé—´(x, y)ï¼Œä»ä¸­é€‰æ‹©å°½å¯èƒ½å¤šçš„å¼€åŒºé—´ï¼Œä½¿å¾—è¿™äº›å¼€åŒºé—´ä¸¤ä¸¤æ²¡æœ‰äº¤é›†ã€‚</p><p>çœ‹åˆ°åŒºé—´æ¯”å¤§å°ï¼Œæˆ‘ä»¬ç¬¬ä¸€ä¸ªåº”è¯¥æƒ³èµ·è¿™ä¸ªé¢˜ï¼Œåº”è¯¥å°±æ˜¯è¿™ä¸ªé¢˜çš„æœ¬è´¨ï¼Œæ ¹æ®ç«¯ç‚¹å»åˆ¤æ–­ï¼Œè¿™å°±æ˜¯åŒºé—´é¢˜çš„çªç ´å£ã€‚</p><p>å›¾a, <strong>åŒºé—´åŒ…å«</strong>ï¼Œåº”è¯¥é€‰æ‹©I1,è¿™æ ·çš„è¯å°±å¯ä»¥ç»™å…¶ä»–åŒºé—´è…¾å‡ºå¾ˆå¤šçš„ç©ºé—²ä½ç½®ï¼›</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9m1vn8vosj30fq09w0t1.jpg" style="zoom:50%;" /></p><p>å›¾b,<strong>åŒºé—´é‡å </strong>ï¼Œæ€»æ˜¯é€‰æ‹©å·¦ç«¯ç‚¹æœ€å¤§çš„åŒºé—´ï¼Œå³I1</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9m1w15efxj30vo0ee763.jpg" style="zoom:50%;" /></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*åŒºé—´è´ªå¿ƒ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Inteval</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">&#125;I[<span class="number">110</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥å·¦ç«¯ç‚¹ä½œä¸ºç«¯ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmpLeft</span><span class="params">(Inteval a,Inteval b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a.x != b.x)&#123;</span><br><span class="line">        <span class="keyword">return</span> a.x &gt; b.x; <span class="comment">//å·¦ç«¯ç‚¹ä¸åŒçš„ï¼Œä»å¤§åˆ°å°æ’åº</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.y &lt; b.y; <span class="comment">//å·¦ç«¯ç‚¹ç›¸åŒçš„ï¼Œä»å°åˆ°å¤§æ’åº </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥å³ç«¯ç‚¹ä½œä¸ºç«¯ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmpRight</span><span class="params">(Inteval a,Inteval b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a.y != b.y)&#123;</span><br><span class="line">        <span class="keyword">return</span> a.y &lt; b.y;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.x &gt; b.x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n), n != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;I[i].x, &amp;I[i].y);</span><br><span class="line">        &#125;</span><br><span class="line">        sort(I, I + n, cmpLeft);</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">1</span>, lastX = I[<span class="number">0</span>].x;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(I[i].y &lt;= lastX)&#123;</span><br><span class="line">                lastX = I[i].x;</span><br><span class="line">                ans ++; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%s\n"</span>,<span class="string">"=========================="</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">        sort(I, I + n, cmpRight);</span><br><span class="line">        <span class="keyword">int</span> ansr = <span class="number">1</span>, lastRX = I[<span class="number">0</span>].y;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(I[i].x &lt;= lastRX)&#123;</span><br><span class="line">                lastRX = I[i].y;</span><br><span class="line">                ansr ++; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ansr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„å’Œç®—æ³• </category>
          
          <category> c/c++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„å’Œç®—æ³• </tag>
            
            <tag> c/c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQLè§†å›¾çš„ä½¿ç”¨</title>
      <link href="/2019/11/29/SQL%E8%A7%86%E5%9B%BE%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2019/11/29/SQL%E8%A7%86%E5%9B%BE%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="1-è§†å›¾ä½œç”¨"><a href="#1-è§†å›¾ä½œç”¨" class="headerlink" title="1.è§†å›¾ä½œç”¨"></a>1.è§†å›¾ä½œç”¨</h3><p>è¯•å›¾æ˜¯è™šæ‹Ÿçš„è¡¨ã€‚ä¸åŒ…å«æ•°æ®çš„è¡¨ä¸ä¸€æ ·ï¼Œè¯•å›¾åªåŒ…å«ä½¿ç”¨æ—¶åŠ¨æ€çš„æ£€ç´¢æ•°æ®çš„æŸ¥è¯¢ã€‚ å¯ä»¥ç”¨ä¸è¡¨åŸºæœ¬ç›¸åŒçš„æ–¹å¼ä½¿ç”¨å®ƒä»¬ã€‚å¯¹è§†å›¾æ‰§è¡Œselectæ“ä½œï¼Œè¿‡æ»¤å’Œæ’åºæ•°æ®ï¼Œå°†è§†å›¾è”ç»“åˆ°å…¶ä»–è§†å›¾æˆ–è¡¨ï¼Œç”šè‡³æ·»åŠ å’Œæ›´æ–°æ•°æ®ï¼ˆæ·»åŠ å’Œæ›´æ–°æ•°æ®æœ‰æŸäº›é™åˆ¶ï¼‰ </p><ul><li>ç®€åŒ–å¤æ‚çš„SQLæ“ä½œï¼Œè¿‡æ»¤ä¿¡æ¯ï¼Œè®¡ç®—å­—æ®µç­‰ã€‚ç¼–å†™æŸ¥è¯¢åï¼Œå¯ä»¥æ–¹ä¾¿çš„é‡ç”¨å®ƒè€Œä¸å¿…çŸ¥é“å…¶åŸºæœ¬æŸ¥è¯¢ç»†èŠ‚</li><li>ä½¿ç”¨è¡¨çš„ä¸€éƒ¨åˆ†è€Œä¸æ˜¯æ•´ä¸ªè¡¨ã€‚</li><li>ä¿æŠ¤æ•°æ®ã€‚å¯ä»¥æˆäºˆç”¨æˆ·è®¿é—®è¡¨çš„ç‰¹å®šéƒ¨åˆ†çš„æƒé™ï¼Œè€Œä¸æ˜¯æ•´ä¸ªè¡¨çš„è®¿é—®æƒé™</li><li>æ›´æ”¹æ•°æ®æ ¼å¼å’Œè¡¨ç¤ºã€‚è§†å›¾å¯è¿”å›ä¸åº•å±‚è¡¨çš„è¡¨ç¤ºå’Œæ ¼å¼ä¸åŒçš„æ•°æ®ã€‚</li></ul><h3 id="2-è§†å›¾çš„è§„åˆ™å’Œé™åˆ¶"><a href="#2-è§†å›¾çš„è§„åˆ™å’Œé™åˆ¶" class="headerlink" title="2.è§†å›¾çš„è§„åˆ™å’Œé™åˆ¶"></a>2.è§†å›¾çš„è§„åˆ™å’Œé™åˆ¶</h3><ul><li>ä¸è¡¨ä¸€æ ·ï¼Œè§†å›¾å‘½åå¿…é¡»å”¯ä¸€ã€‚è§†å›¾çš„æ•°ç›®æ²¡æœ‰é™åˆ¶ã€‚</li><li>è¦æœ‰åˆ›å»ºè§†å›¾çš„æƒé™ã€‚</li><li>è§†å›¾å¯ä»¥åµŒå¥—ï¼Œå¯ä»¥åˆ©ç”¨ä»å…¶ä»–è§†å›¾ä¸­æ£€ç´¢æ•°æ®çš„æŸ¥è¯¢æ¥æ„é€ è§†å›¾ã€‚ï¼ˆåµŒå¥—è§†å›¾å¯èƒ½ä¼šä¸¥é‡é™ä½æŸ¥è¯¢æ€§èƒ½ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ä¹‹å‰ï¼Œåº”è¯¥å¯¹å…¶è¿›è¡Œå…¨é¢çš„æµ‹è¯•ï¼‰</li><li>è®¸å¤šDBMSï¼ˆMicrosoftåœ¨SQL Serverï¼‰ç¦æ­¢åœ¨è§†å›¾æŸ¥è¯¢ä¸­ä½¿ç”¨ORDER BYå­å¥</li><li>æœ‰äº›DBMSè¦æ±‚å¯¹è¿”å›çš„æ‰€æœ‰åˆ—è¿›è¡Œå‘½åï¼Œå¦‚æœåˆ—æ˜¯è®¡ç®—å­—æ®µï¼Œéœ€è¦ä½¿ç”¨åˆ«åã€‚</li><li>æœ‰äº›DBMSæŠŠè§†å›¾ä½œä¸ºè‡ªæ¸çš„æŸ¥è¯¢ã€‚ä¸èƒ½å°†æ•°æ®å†™å›åº•å±‚è¡¨ã€‚</li></ul><h3 id="3-åˆ›å»ºè§†å›¾"><a href="#3-åˆ›å»ºè§†å›¾" class="headerlink" title="3.åˆ›å»ºè§†å›¾"></a>3.åˆ›å»ºè§†å›¾</h3><h4 id="3-1-åˆ©ç”¨è§†å›¾æå¤§ç®€åŒ–äº†å¤æ‚çš„è”ç»“"><a href="#3-1-åˆ©ç”¨è§†å›¾æå¤§ç®€åŒ–äº†å¤æ‚çš„è”ç»“" class="headerlink" title="3.1 åˆ©ç”¨è§†å›¾æå¤§ç®€åŒ–äº†å¤æ‚çš„è”ç»“"></a>3.1 åˆ©ç”¨è§†å›¾æå¤§ç®€åŒ–äº†å¤æ‚çš„è”ç»“</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> c.cust_name,c.cust_contact</span><br><span class="line"><span class="keyword">FROM</span> Customers c, Orders o, OrderItems i</span><br><span class="line"><span class="keyword">WHERE</span> c.cust_id = o.cust_id</span><br><span class="line"><span class="keyword">AND</span> i.order_num = o.order_num</span><br><span class="line"><span class="keyword">AND</span> i.prod_id = <span class="string">'RGAN01'</span>;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºï¼šæˆ‘æƒ³æŠŠä¸Šé¢è¿™æ¡æŸ¥è¯¢åŒ…è£…æˆä¸ºä¸€ä¸ªåä¸ºProductCustomersçš„è™šæ‹Ÿè¡¨ï¼ˆè§†å›¾ï¼‰ï¼š<strong>åˆ›å»ºè§†å›¾æ—¶å°½é‡ä¸ç»‘å®šç‰¹å®šæ•°æ®</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> ProductCustomers <span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> c.cust_name,c.cust_contact</span><br><span class="line"><span class="keyword">FROM</span> Customers c, Orders o, OrderItems i</span><br><span class="line"><span class="keyword">WHERE</span> c.cust_id = o.cust_id</span><br><span class="line"><span class="keyword">AND</span> i.order_num = o.order_num;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ï¼šå¯ä»¥é€šè¿‡ä¸‹é¢è¯­å¥æ£€ç´¢ç›¸åŒæ•°æ®,<strong>åˆ©ç”¨è§†å›¾æå¤§ç®€åŒ–äº†å¤æ‚çš„è”ç»“</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name,cust_contact</span><br><span class="line"><span class="keyword">FROM</span> ProductCustomers</span><br><span class="line"><span class="keyword">WHERE</span> prod_id = <span class="string">'RGAN01'</span>;</span><br></pre></td></tr></table></figure><p>åˆ é™¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> ProductCustomers;</span><br></pre></td></tr></table></figure><h4 id="3-2-åˆ©ç”¨è§†å›¾æ ¼å¼åŒ–æ£€ç´¢å‡ºçš„æ•°æ®"><a href="#3-2-åˆ©ç”¨è§†å›¾æ ¼å¼åŒ–æ£€ç´¢å‡ºçš„æ•°æ®" class="headerlink" title="3.2 åˆ©ç”¨è§†å›¾æ ¼å¼åŒ–æ£€ç´¢å‡ºçš„æ•°æ®"></a>3.2 åˆ©ç”¨è§†å›¾æ ¼å¼åŒ–æ£€ç´¢å‡ºçš„æ•°æ®</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(<span class="keyword">RTRIM</span>(vend_name),<span class="string">"("</span>,<span class="keyword">RTRIM</span>(vend_country),<span class="string">")"</span> )</span><br><span class="line"><span class="keyword">AS</span> vend_title</span><br><span class="line"><span class="keyword">FROM</span> Vendors</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Vend_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) + <span class="string">'('</span> + <span class="keyword">RTRIM</span>(vend_country) + <span class="string">')'</span></span><br><span class="line"><span class="keyword">AS</span> vend_title</span><br><span class="line"><span class="keyword">FROM</span> Vendors</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) || <span class="string">'('</span> || <span class="keyword">RTRIM</span>(vend_country) || <span class="string">')'</span></span><br><span class="line"><span class="keyword">AS</span> vend_title</span><br><span class="line"><span class="keyword">FROM</span> Vendors</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br><span class="line"></span><br><span class="line">ä¸Šé¢3æ¡è¯­å¥æ‰§è¡Œç»“æœç›¸åŒ</span><br></pre></td></tr></table></figure><p>å‡è®¾ç»å¸¸ä½¿ç”¨è¿™ä¸ªæ ¼å¼çš„ç»“æœï¼Œä¸ç”¨åœ¨æ¯æ¬¡éœ€è¦æ—¶æ‰§è¡Œè¿™æ ·çš„æ‹¼æ¥ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªè§†å›¾ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> VendorLocations <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) + <span class="string">'('</span> + <span class="keyword">RTRIM</span>(vend_country) + <span class="string">')'</span></span><br><span class="line"><span class="keyword">AS</span> vend_title</span><br><span class="line"><span class="keyword">FROM</span> Vendors;</span><br><span class="line"></span><br><span class="line">æŸ¥è¯¢æ—¶æ‰§è¡Œï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> VendorLocations;</span><br></pre></td></tr></table></figure><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>è§†å›¾ä¸ºè™šæ‹Ÿçš„è¡¨ã€‚å®ƒä»¬åŒ…å«çš„ä¸æ˜¯æ•°æ®è€Œæ˜¯æ ¹æ®éœ€è¦æ£€ç´¢æ•°æ®çš„æŸ¥è¯¢ã€‚æä¾›ä¸€å¥—å°è£…selectè¯­å¥çš„å±‚æ¬¡ï¼Œå¯ç”¨æ¥ç®€åŒ–æ•°æ®å¤„ç†ï¼Œé‡æ–°æ ¼å¼åŒ–æˆ–ä¿æŠ¤åŸºç¡€æ•°æ®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> sql </category>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sql </tag>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éƒ¨ç½²Hexoåšå®¢åˆ°é˜¿é‡Œäº‘centOS7</title>
      <link href="/2019/11/23/%E9%83%A8%E7%BD%B2Hexo%E5%8D%9A%E5%AE%A2%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91centOS7/"/>
      <url>/2019/11/23/%E9%83%A8%E7%BD%B2Hexo%E5%8D%9A%E5%AE%A2%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91centOS7/</url>
      
        <content type="html"><![CDATA[<h3 id="1ã€åšå®¢çš„æ¶æ„"><a href="#1ã€åšå®¢çš„æ¶æ„" class="headerlink" title="1ã€åšå®¢çš„æ¶æ„"></a>1ã€åšå®¢çš„æ¶æ„</h3><p>å…ˆææ˜ç™½Hexoåšå®¢ä»æ­å»ºåˆ°è‡ªåŠ¨å‘å¸ƒçš„æ¶æ„ï¼Œæ‰èƒ½æ›´å¥½çš„ç†è§£æˆ‘ä»¬æ¯ä¸€æ­¥è¿›è¡Œçš„æ“ä½œã€‚<br>ä¸ç„¶åªè·Ÿç€æ­¥éª¤è¿‡äº†ä¸€éï¼Œå´ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿™ä¹ˆåšã€‚</p><p>é¦–å…ˆçœ‹è¿™å¼ æ¶æ„å›¾ï¼š<br><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g97sxjyakcj31dt0u0qab.jpg" alt=""></p><h3 id="2ã€æ•´ä¸ªæ­å»ºæµç¨‹"><a href="#2ã€æ•´ä¸ªæ­å»ºæµç¨‹" class="headerlink" title="2ã€æ•´ä¸ªæ­å»ºæµç¨‹"></a>2ã€æ•´ä¸ªæ­å»ºæµç¨‹</h3><p>ç¬¬ä¸€éƒ¨åˆ†: æœåŠ¡å™¨ç¯å¢ƒæ­å»ºï¼ŒåŒ…æ‹¬å®‰è£… Git ã€Nginxé…ç½® ã€åˆ›å»º git ç”¨æˆ· ã€‚</p><p>ç¬¬äºŒéƒ¨åˆ†: æœ¬åœ°Hexoåˆå§‹åŒ–ï¼Œ åŒ…æ‹¬å®‰è£… NodeJS ã€hexo-cli, ç”Ÿæˆæœ¬åœ°é™æ€ç½‘ç«™</p><p>ç¬¬ä¸‰éƒ¨åˆ†: ä½¿ç”¨Gitè‡ªåŠ¨åŒ–éƒ¨ç½²å‘å¸ƒåšå®¢</p><h3 id="3ã€æœåŠ¡å™¨ç¯å¢ƒæ­å»º"><a href="#3ã€æœåŠ¡å™¨ç¯å¢ƒæ­å»º" class="headerlink" title="3ã€æœåŠ¡å™¨ç¯å¢ƒæ­å»º"></a>3ã€æœåŠ¡å™¨ç¯å¢ƒæ­å»º</h3><h4 id="3-1-å®‰è£…Gitå’ŒNodeJS-CentOS-ç¯å¢ƒ"><a href="#3-1-å®‰è£…Gitå’ŒNodeJS-CentOS-ç¯å¢ƒ" class="headerlink" title="3-1.å®‰è£…Gitå’ŒNodeJS (CentOS ç¯å¢ƒ)"></a>3-1.å®‰è£…Gitå’ŒNodeJS (CentOS ç¯å¢ƒ)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install git</span><br><span class="line">#å®‰è£…NodeJS</span><br><span class="line">curl --silent --location https://rpm.nodesource.com/setup_5.x | bash -</span><br></pre></td></tr></table></figure><h4 id="3-2-åˆ›å»ºgitæ™®é€šç”¨æˆ·"><a href="#3-2-åˆ›å»ºgitæ™®é€šç”¨æˆ·" class="headerlink" title="3-2. åˆ›å»ºgitæ™®é€šç”¨æˆ·"></a>3-2. åˆ›å»ºgitæ™®é€šç”¨æˆ·</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adduser git      </span><br><span class="line">sudo passwd git  #è®¾ç½®gitç”¨æˆ·çš„å¯†ç </span><br></pre></td></tr></table></figure><p>åœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub git@SERVER</span><br></pre></td></tr></table></figure><br>å¦‚æœä½ ä¹‹å‰æ²¡æœ‰ç”Ÿæˆè¿‡å…¬é’¥ï¼Œåˆ™å¯èƒ½å°±æ²¡æœ‰ id_rsa.pub æ–‡ä»¶ï¼Œå…·ä½“çš„ç”Ÿæˆæ–¹æ³•ï¼Œå¯ä»¥<br><a href="https://help.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent" target="_blank" rel="noopener">å‚è€ƒè¿™é‡Œ</a></p><p>åˆ‡æ¢è‡³gitç”¨æˆ·ï¼Œ å¯ä»¥çœ‹åˆ°~/.ssh/authorized_keys æ–‡ä»¶é‡Œå·²ç»æœ‰äº†æœ¬åœ°ç”µè„‘çš„å…¬é’¥æ‹·è´ï¼Œè¿™æ ·å°±å»ºç«‹äº†sshä¿¡ä»»<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su git</span><br><span class="line">mkdir ~/.ssh</span><br><span class="line">cat ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><br>ç„¶ååœ¨æœ¬åœ°å°±å¯ä»¥æ‰§è¡Œssh å‘½ä»¤æµ‹è¯•æ˜¯å¦å¯ä»¥å…å¯†ç™»å½•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -v git@SERVER</span><br></pre></td></tr></table></figure><br>ä¸ºäº†å®‰å…¨èµ·è§ç¦ç”¨gitç”¨æˆ·çš„ shell ç™»å½•æƒé™ï¼Œä»è€Œåªèƒ½ç”¨git clone,git pushç­‰ç™»å½•ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/shells  #æŸ¥çœ‹`git-shell`æ˜¯å¦åœ¨ç™»å½•æ–¹å¼é‡Œé¢ï¼Œæœ‰åˆ™è·³è¿‡</span><br><span class="line">which git-shell  #æŸ¥çœ‹æ˜¯å¦å®‰è£…</span><br><span class="line">vi /etc/shells  #æ·»åŠ ä¸Šæ˜¾ç¤ºå‡ºæ¥çš„è·¯åŠ²ï¼Œé€šå¸¸åœ¨/usr/bin/git-shell</span><br><span class="line">vi /etc/passwd</span><br><span class="line">    æŠŠ git:x:1000:1000::/home/git:/bin/bash</span><br><span class="line">    ä¿®æ”¹ä¸º git:x:1000:1000::/home/git:/usr/bin/git-shell</span><br></pre></td></tr></table></figure><br>è‡³æ­¤ï¼Œgituserç”¨æˆ·æ·»åŠ å®Œæˆ</p><h4 id="3-3-nginxå®‰è£…å’Œé…ç½®"><a href="#3-3-nginxå®‰è£…å’Œé…ç½®" class="headerlink" title="3-3. nginxå®‰è£…å’Œé…ç½®"></a>3-3. nginxå®‰è£…å’Œé…ç½®</h4><p>æ³¨æ„ï¼šæ–°ä¹°åˆ°é˜¿é‡Œäº‘centOS7æ˜¯æ²¡æœ‰å¼€é€š80ç«¯å£çš„ï¼Œæ·»åŠ ç«¯å£<a href="https://blog.csdn.net/moyanxiaoq/article/details/85221262" target="_blank" rel="noopener">ï¼šå‚è€ƒè¿™é‡Œ</a>  </p><p>å®‰è£…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y git nginx</span><br></pre></td></tr></table></figure><br>é…ç½® æ‰¾åˆ°nginxçš„é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹é…ç½®å¦‚ä¸‹ï¼švim /etc/nginx/nginx.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line"></span><br><span class="line"> listen 80;</span><br><span class="line">    #listen [::]:80;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    index index.html index.htm index.php default.html default.htm default.php;</span><br><span class="line">    #è¿™é‡Œè¦æ”¹æˆç½‘ç«™çš„æ ¹ç›®å½•</span><br><span class="line">    root  /home/git/projects/repos/blog/;</span><br><span class="line"></span><br><span class="line">    #include other.conf;</span><br><span class="line">    #error_page   404   /404.html;</span><br><span class="line">    location ~ .*\.(ico|gif|jpg|jpeg|png|bmp|swf)$</span><br><span class="line">    &#123;</span><br><span class="line">        access_log   off;</span><br><span class="line">        expires      1d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ .*\.(js|css|txt|xml)?$</span><br><span class="line">    &#123;</span><br><span class="line">        access_log   off;</span><br><span class="line">        expires      12h;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><br>nginx -s reload  //åˆ·æ–°é…ç½®<br>å¦‚æœæŠ¥å¦‚ä¸‹é”™ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx: [error] open() &quot;/run/nginx.pid&quot; failed (2: No such file or directory)</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œå¯è§£å†³ï¼š</span><br><span class="line">/usr/sbin/nginx -c /etc/nginx/nginx.conf   #ä½¿ç”¨æŒ‡å®šnginx.confæ–‡ä»¶çš„æ–¹å¼é‡å¯nginx</span><br></pre></td></tr></table></figure><br>å¯åŠ¨: è¾“å…¥ï¼šnginx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœå‘ç°å¦‚ä¸‹æŠ¥é”™ï¼š</span><br><span class="line">nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)</span><br><span class="line">nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)</span><br><span class="line">nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)</span><br><span class="line">nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)</span><br><span class="line">nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)</span><br><span class="line">nginx: [emerg] still could not bind()</span><br><span class="line">è¯´æ˜80ç«¯å£è¢«å ç”¨ï¼Œæ€æ‰è¿™ä¸ªè¿›ç¨‹ï¼š</span><br><span class="line"></span><br><span class="line">killall -9 nginx</span><br><span class="line">å†æ¬¡å¯åŠ¨nginx</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æ˜¯å¦å¯åŠ¨ï¼š</span><br><span class="line">ps aux|grep nginx</span><br><span class="line"></span><br><span class="line">root      2484  0.0  0.2 120832  2104 ?        Ss   18:04   0:00 nginx: master process nginx</span><br><span class="line">root      2485  0.0  0.3 121228  3128 ?        S    18:04   0:00 nginx: worker process</span><br><span class="line">root      2494  0.0  0.0 112676   980 pts/7    R+   18:08   0:00 grep --color=auto nginx</span><br><span class="line"></span><br><span class="line">å¯åŠ¨æˆåŠŸã€‚</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">centOS7è®¿é—®nginxå¤±è´¥è§£å†³-.0:80 failed (98: Address already in use)è§£å†³</span><br><span class="line"></span><br><span class="line">ä»¥é˜²ä¸‡ä¸€ï¼Œå…ˆå®‰è£…å¥½iptablesæœåŠ¡ï¼ˆä¸ç®¡ä½ è£…æ²¡è£…ï¼Œå…ˆæ‰§è¡Œï¼Œå…å¾—åé¢æ·»ä¹±ï¼‰</span><br><span class="line">[root@localhost ~]# yum install iptables-services</span><br><span class="line">[root@localhost ~]# systemctl mask firewalld.service</span><br><span class="line">[root@localhost ~]# systemctl enable iptables.service</span><br><span class="line">[root@localhost ~]# systemctl enable ip6tables.service</span><br><span class="line">è¿›å…¥iptablesé…ç½®80ç«¯å£ï¼Œå› ä¸ºnginxé»˜è®¤æ˜¯ç”±80ç«¯å£è®¿é—®</span><br><span class="line">[root@localhost ~]# vim /etc/sysconfig/iptables</span><br><span class="line">è¿™æ˜¯é…ç½®ä¿¡æ¯ï¼š</span><br><span class="line"># Generated by iptables-save v1.4.21 on Fri May 12 21:28:29 2017</span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:FORWARD ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [6:696]</span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A INPUT -p icmp -j ACCEPT</span><br><span class="line">-A INPUT -i lo -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 21 -j ACCEPTï¼ˆæˆ‘ç»™vsftpdé…ç½®çš„ç«¯å£ï¼‰</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPTï¼ˆç»™nginxé…ç½®çš„ç«¯å£ï¼ŒåŸæ ·è¾“å…¥å°±è¡Œäº†ï¼‰</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 30000:30999 -j ACCEPT</span><br><span class="line">-A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line">-A FORWARD -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line">COMMIT</span><br><span class="line"># Completed on Fri May 12 21:28:29 2017</span><br><span class="line">ç„¶å:wqï¼Œä¿å­˜é€€å‡ºå°±è¡Œäº†</span><br><span class="line">é‡å¯iptablesï¼Œé…ç½®æ‰ç”Ÿæ•ˆ</span><br><span class="line">[root@localhost ~]# systemctl restart iptables.service</span><br><span class="line">å¼€å¯é˜²ç«å¢™ï¼Œä¸ç®¡ä½ å¼€æ²¡æœ‰ï¼Œå†å¼€ä¸€éï¼š</span><br><span class="line">[root@localhost ~]# systemctl start firewalld</span><br><span class="line">å¼€å¯httpè®¿é—®</span><br><span class="line">[root@localhost ~]# firewall-cmd --permanent --add-service=http</span><br><span class="line">åŠ å…¥80ç«¯å£</span><br><span class="line">[root@localhost ~]# firewall-cmd --permanent --zone=trusted --add-port=80/tcp</span><br><span class="line">å¯åŠ¨nginxï¼ï¼ï¼ï¼ï¼ˆé‡ç‚¹æ¥äº†ï¼ï¼ï¼ï¼‰</span><br><span class="line">centOS7çš„nginxå¯åŠ¨ä¸å…¶ä»–çš„æœ‰åŒºåˆ«ï¼ï¼ï¼æ³¨æ„ï¼šæˆ‘æ˜¯è£…çš„nginx1.80ï¼Œåœ¨centOS6.Xç³»åˆ—ä¸­ï¼Œæ˜¯é€šè¿‡</span><br><span class="line">cd /usr/local/nginx/sbin/</span><br></pre></td></tr></table></figure><h3 id="4-æœ¬åœ°Hexoç¨‹åº"><a href="#4-æœ¬åœ°Hexoç¨‹åº" class="headerlink" title="4. æœ¬åœ°Hexoç¨‹åº"></a>4. æœ¬åœ°Hexoç¨‹åº</h3><h4 id="4-1ï¼šåˆå§‹åŒ–Hexoåšå®¢"><a href="#4-1ï¼šåˆå§‹åŒ–Hexoåšå®¢" class="headerlink" title="4-1ï¼šåˆå§‹åŒ–Hexoåšå®¢"></a>4-1ï¼šåˆå§‹åŒ–Hexoåšå®¢</h4><p>é¦–å…ˆè¦å®‰è£… hexo-cliï¼Œå®‰è£…hexo-cli éœ€è¦ root æƒé™ï¼Œä½¿ç”¨ sudo è¿è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install -g hexo-cli</span><br></pre></td></tr></table></figure><br>ç„¶ååˆå§‹åŒ–Hexoç¨‹åº<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init blog</span><br></pre></td></tr></table></figure><br>ç­‰æ‰§è¡ŒæˆåŠŸä»¥åå®‰è£…ä¸¤ä¸ªæ’ä»¶ï¼Œ hexo-deployer-git å’Œ hexo-server ,è¿™ä¿©æ’ä»¶çš„ä½œç”¨åˆ†åˆ«æ˜¯ä½¿ç”¨Gitè‡ªåŠ¨éƒ¨ç½²ï¼Œå’Œæœ¬åœ°ç®€å•çš„æœåŠ¡å™¨ã€‚<br><a href="https://github.com/hexojs/hexo-deployer-git" target="_blank" rel="noopener">hexo-deployer-gitå¸®åŠ©æ–‡æ¡£</a><br><a href="https://hexo.io/zh-cn/docs/server.html" target="_blank" rel="noopener">hexo-serverå¸®åŠ©æ–‡æ¡£</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd blog</span><br><span class="line">npm install hexo-deployer-git --save</span><br><span class="line">npm install hero -server</span><br></pre></td></tr></table></figure></p><h4 id="4-2-ç”Ÿæˆè‡ªå·±çš„ç¬¬ä¸€ç¯‡æ–‡ç« -hello-world"><a href="#4-2-ç”Ÿæˆè‡ªå·±çš„ç¬¬ä¸€ç¯‡æ–‡ç« -hello-world" class="headerlink" title="4-2. ç”Ÿæˆè‡ªå·±çš„ç¬¬ä¸€ç¯‡æ–‡ç«  hello world !"></a>4-2. ç”Ÿæˆè‡ªå·±çš„ç¬¬ä¸€ç¯‡æ–‡ç«  hello world !</h4><p>ä½¿ç”¨ hexo new &lt;æ–‡ç« åç§°&gt; æ¥æ–°å»ºæ–‡ç« ï¼Œè¯¥å‘½ä»¤ä¼šæˆæˆä¸€ä¸ª .mdæ–‡ä»¶æ”¾ç½®åœ¨ sources/_postsæ–‡ä»¶å¤¹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo new &quot;hello Hexo&quot;</span><br><span class="line">vim sources/_posts/hello-hexo.md</span><br></pre></td></tr></table></figure><br>ç¼–è¾‘å®Œæ¯•ä»¥åï¼Œ ä½¿ç”¨hexo gå°† .mdæ–‡ä»¶æ¸²æŸ“æˆé™æ€æ–‡ä»¶ï¼Œç„¶åå¯åŠ¨hexo sï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure><br>æ‰“å¼€æµè§ˆå™¨è®¿é—® <a href="http://localhost:4000" target="_blank" rel="noopener">http://localhost:4000</a> æ¥æŸ¥çœ‹æˆ‘ä»¬çš„åšå®¢äº†ï¼</p><h3 id="5-è‡ªåŠ¨åŒ–éƒ¨ç½²"><a href="#5-è‡ªåŠ¨åŒ–éƒ¨ç½²" class="headerlink" title="5. è‡ªåŠ¨åŒ–éƒ¨ç½²"></a>5. è‡ªåŠ¨åŒ–éƒ¨ç½²</h3><h4 id="5-1ï¼šæœåŠ¡å™¨ä¸Šå»ºç«‹gitè£¸åº“"><a href="#5-1ï¼šæœåŠ¡å™¨ä¸Šå»ºç«‹gitè£¸åº“" class="headerlink" title="5-1ï¼šæœåŠ¡å™¨ä¸Šå»ºç«‹gitè£¸åº“"></a>5-1ï¼šæœåŠ¡å™¨ä¸Šå»ºç«‹gitè£¸åº“</h4><p>åˆ›å»ºä¸€ä¸ªè£¸ä»“åº“ï¼Œè£¸ä»“åº“å°±æ˜¯åªä¿å­˜gitä¿¡æ¯çš„Repository, é¦–å…ˆåˆ‡æ¢åˆ°gituserç”¨æˆ·ç¡®ä¿gituserç”¨æˆ·æ‹¥æœ‰ä»“åº“æ‰€æœ‰æƒ<br>ä¸€å®šè¦åŠ  â€”bareï¼Œè¿™æ ·æ‰æ˜¯ä¸€ä¸ªè£¸åº“ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">su git</span><br><span class="line">cd ~</span><br><span class="line">mkdir -p projects/blog</span><br><span class="line">mkdir repos &amp;&amp; cd repos</span><br><span class="line">git init --bare blog.git</span><br></pre></td></tr></table></figure></p><h4 id="5-2-ä½¿ç”¨-git-hooks-åŒæ­¥ç½‘ç«™æ ¹ç›®å½•"><a href="#5-2-ä½¿ç”¨-git-hooks-åŒæ­¥ç½‘ç«™æ ¹ç›®å½•" class="headerlink" title="5-2. ä½¿ç”¨ git-hooks åŒæ­¥ç½‘ç«™æ ¹ç›®å½•"></a>5-2. ä½¿ç”¨ git-hooks åŒæ­¥ç½‘ç«™æ ¹ç›®å½•</h4><p>åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ post-receiveè¿™ä¸ªé’©å­ï¼Œå½“gitæœ‰æ”¶å‘çš„æ—¶å€™å°±ä¼šè°ƒç”¨è¿™ä¸ªé’©å­ã€‚ åœ¨ ~/blog.git è£¸åº“çš„ hooksæ–‡ä»¶å¤¹ä¸­ï¼Œ<br>æ–°å»ºpost-receiveæ–‡ä»¶ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim ./blog.git/hooks/post-receive</span><br><span class="line"></span><br><span class="line">#!/bin/sh</span><br><span class="line">git --work-tree=/home/git/projects/blog --git-dir=/home/git/repos/blog.git checkout -f</span><br></pre></td></tr></table></figure><br>ä¿å­˜åï¼Œè¦èµ‹äºˆè¿™ä¸ªæ–‡ä»¶å¯æ‰§è¡Œæƒé™<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod +x ./blog.git/hooks/post-receive</span><br><span class="line">cd ~</span><br><span class="line">chown -R git:git /home/git/repos/blog.git/   #æ·»åŠ æƒé™</span><br></pre></td></tr></table></figure></p><h4 id="5-3-é…ç½®-config-yml-å®Œæˆè‡ªåŠ¨åŒ–éƒ¨ç½²"><a href="#5-3-é…ç½®-config-yml-å®Œæˆè‡ªåŠ¨åŒ–éƒ¨ç½²" class="headerlink" title="5-3. é…ç½®_config.yml,å®Œæˆè‡ªåŠ¨åŒ–éƒ¨ç½²"></a>5-3. é…ç½®_config.yml,å®Œæˆè‡ªåŠ¨åŒ–éƒ¨ç½²</h4><p>ç„¶åæ‰“å¼€ _config.yml, æ‰¾åˆ° deploy<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">    type: git</span><br><span class="line">    repo: git@SERVER:/home/git/blog.git    //&lt;repository url&gt;</span><br><span class="line">    branch: master            //è¿™é‡Œå¡«å†™åˆ†æ”¯   [branch]</span><br><span class="line">    message: æäº¤çš„ä¿¡æ¯         //è‡ªå®šä¹‰æäº¤ä¿¡æ¯ (é»˜è®¤ä¸º Site updated: &#123;&#123; now(&apos;YYYY-MM-DD HH:mm:ss&apos;) &#125;&#125;)</span><br></pre></td></tr></table></figure><br>ä¿å­˜åï¼Œå°è¯•å°†æˆ‘ä»¬åˆšæ‰å†™çš„â€hello hexoâ€éƒ¨ç½²åˆ°æœåŠ¡å™¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate --deploy</span><br></pre></td></tr></table></figure><br>è®¿é—®æœåŠ¡å™¨åœ°å€ï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å†™çš„æ–‡ç« â€Hello hexoâ€,ä»¥åå†™æ–‡ç« åªéœ€è¦ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo new &quot;Blog article name&quot;</span><br><span class="line">Â·Â·Â·å†™æ–‡ç« </span><br><span class="line">hexo clean &amp;&amp; hexo generate --deploy</span><br></pre></td></tr></table></figure></p><p>å‚è€ƒæ–‡æ¡£ï¼š</p><ol><li><a href="https://blog.csdn.net/moyanxiaoq/article/details/85221262" target="_blank" rel="noopener">https://blog.csdn.net/moyanxiaoq/article/details/85221262</a></li><li><a href="https://segmentfault.com/a/1190000005723321" target="_blank" rel="noopener">https://segmentfault.com/a/1190000005723321</a></li><li><a href="http://www.swiftyper.com/2016/04/17/deploy-hexo-with-git-hook/" target="_blank" rel="noopener">http://www.swiftyper.com/2016/04/17/deploy-hexo-with-git-hook/</a></li><li><a href="https://help.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent" target="_blank" rel="noopener">https://help.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent</a></li><li><a href="https://www.bilibili.com/video/av50025574?from=search&amp;seid=11458733547652119175" target="_blank" rel="noopener">https://www.bilibili.com/video/av50025574?from=search&amp;seid=11458733547652119175</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ“ä½œè®°å½• </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œè®°å½• </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå…³é”®å­—ä¹‹static</title>
      <link href="/2019/11/22/Java%E5%85%B3%E9%94%AE%E5%AD%97%E4%B9%8Bstatic/"/>
      <url>/2019/11/22/Java%E5%85%B3%E9%94%AE%E5%AD%97%E4%B9%8Bstatic/</url>
      
        <content type="html"><![CDATA[<h4 id="ä¸€-ä»€ä¹ˆæ˜¯staticå…³é”®å­—"><a href="#ä¸€-ä»€ä¹ˆæ˜¯staticå…³é”®å­—" class="headerlink" title="ä¸€. ä»€ä¹ˆæ˜¯staticå…³é”®å­—"></a>ä¸€. ä»€ä¹ˆæ˜¯staticå…³é”®å­—</h4><ul><li>æˆ‘ä»¬å¯ä»¥åŸºäºä¸€ä¸ªç±»åˆ›å»ºå¤šä¸ªè¯¥ç±»çš„å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰è‡ªå·±çš„æˆå‘˜ï¼Œäº’ç›¸ç‹¬ç«‹ã€‚ç„¶è€Œåœ¨æŸäº›æ—¶å€™ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›è¯¥ç±»æ‰€æœ‰çš„å¯¹è±¡å…±äº«åŒä¸€ä¸ªæˆå‘˜ã€‚æ­¤æ—¶å°±æ˜¯ static å¤§æ˜¾èº«æ‰‹çš„æ—¶å€™äº†ï¼ï¼</li><li>Java ä¸­è¢« staticä¿®é¥°çš„æˆå‘˜ç§°ä¸ºé™æ€æˆå‘˜æˆ–ç±»æˆå‘˜ã€‚å®ƒå±äºæ•´ä¸ªç±»æ‰€æœ‰ï¼Œè€Œä¸æ˜¯æŸä¸ªå¯¹è±¡æ‰€æœ‰ï¼Œå³è¢«==ç±»çš„æ‰€æœ‰å¯¹è±¡==æ‰€å…±äº«ã€‚</li><li>æ–¹ä¾¿åœ¨æ²¡æœ‰åˆ›å»ºå¯¹è±¡çš„æƒ…å†µä¸‹è¿›è¡Œè°ƒç”¨ï¼ˆå˜é‡æˆ–æ–¹æ³•ï¼‰ã€‚</li><li>é™æ€æˆå‘˜å¯ä»¥ä½¿ç”¨ç±»åç›´æ¥è®¿é—®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¯¹è±¡åè¿›è¡Œè®¿é—®ã€‚</li></ul><h4 id="äºŒ-é™æ€å˜é‡"><a href="#äºŒ-é™æ€å˜é‡" class="headerlink" title="äºŒ. é™æ€å˜é‡"></a>äºŒ. é™æ€å˜é‡</h4><p>ä½¿ç”¨ static å¯ä»¥ä¿®é¥°å˜é‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;</span><br><span class="line">    <span class="comment">// staticä¿®é¥°çš„å˜é‡ä¸ºé™æ€å˜é‡ï¼Œæ‰€æœ‰ç±»çš„å¯¹è±¡å…±äº«hobby</span></span><br><span class="line">    <span class="keyword">static</span> String hobby = <span class="string">"Tedu"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// é™æ€å˜é‡å¯ä»¥ç›´æ¥ä½¿ç”¨ç±»åæ¥è®¿é—®ï¼Œæ— éœ€åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        System.out.println(<span class="string">"é€šè¿‡ç±»åè®¿é—®hobbyï¼š"</span> + Test1.hobby);</span><br><span class="line">        <span class="comment">// åˆ›å»ºç±»çš„å¯¹è±¡</span></span><br><span class="line">        Test1 t1 = <span class="keyword">new</span> Test1();</span><br><span class="line">        <span class="comment">// ä½¿ç”¨å¯¹è±¡åè®¿é—®é™æ€å˜é‡</span></span><br><span class="line">        System.out.println(<span class="string">"ä½¿ç”¨å¯¹è±¡åè®¿hobby:"</span> + t1.hobby);</span><br><span class="line">        <span class="comment">// ä½¿ç”¨å¯¹è±¡åçš„å½¢å¼ä¿®æ”¹é™æ€å˜é‡çš„å€¼</span></span><br><span class="line">        t1.hobby = <span class="string">"cjj"</span>;</span><br><span class="line">        <span class="comment">// å†æ¬¡ä½¿ç”¨ç±»åè®¿é—®é™æ€ç™½å˜é‡ï¼Œå€¼å·²ç»è¢«ä¿®æ”¹</span></span><br><span class="line">        System.out.println(<span class="string">"é€šè¿‡ç±»åè®¿é—®hobbyï¼š"</span> + Test1.hobby);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é€šè¿‡ç±»åè®¿é—®hobbyï¼šTedu</span><br><span class="line">ä½¿ç”¨å¯¹è±¡åè®¿hobby:Tedu</span><br><span class="line">é€šè¿‡ç±»åè®¿é—®hobbyï¼šcjj</span><br></pre></td></tr></table></figure></p><h4 id="ä¸‰-static-ä½¿ç”¨ä¹‹é™æ€æ–¹æ³•"><a href="#ä¸‰-static-ä½¿ç”¨ä¹‹é™æ€æ–¹æ³•" class="headerlink" title="ä¸‰. static ä½¿ç”¨ä¹‹é™æ€æ–¹æ³•"></a>ä¸‰. static ä½¿ç”¨ä¹‹é™æ€æ–¹æ³•</h4><p>ä½¿ç”¨ static ä¿®é¥°æ–¹æ³•ï¼Œç§°ä¸ºé™æ€æ–¹æ³•æˆ–ç±»æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ä½¿ç”¨staticå…³é”®å­—å£°æ˜é™æ€æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ¬¢è¿ä½ ï¼šCjj!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//ç›´æ¥ä½¿ç”¨ç±»åè°ƒç”¨é™æ€æ–¹æ³•</span></span><br><span class="line">        Test01.print();</span><br><span class="line">        <span class="comment">//ä¹Ÿå¯ä»¥é€šè¿‡å¯¹è±¡åè°ƒç”¨ï¼Œå½“ç„¶æ›´æ¨èä½¿ç”¨ç±»åè°ƒç”¨</span></span><br><span class="line">        Test01 t1 = <span class="keyword">new</span> Test01();</span><br><span class="line">        t1.print();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br> è¿è¡Œç»“æœï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ¬¢è¿ä½ ï¼šCjj!</span><br><span class="line">æ¬¢è¿ä½ ï¼šCjj!</span><br></pre></td></tr></table></figure><br>3.static ä½¿ç”¨ä¹‹é™æ€åˆå§‹åŒ–å—<br>Java ä¸­å¯ä»¥é€šè¿‡åˆå§‹åŒ–å—è¿›è¡Œæ•°æ®èµ‹å€¼ã€‚å¦‚ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p><strong>æ³¨æ„ï¼š</strong>  </p><ol><li>é™æ€æˆå‘˜å±äºæ•´ä¸ªç±»ï¼Œå½“ç³»ç»Ÿç¬¬ä¸€æ¬¡ä½¿ç”¨è¯¥ç±»æ—¶ï¼Œå°±ä¼šä¸ºå…¶åˆ†é…å†…å­˜ç©ºé—´ç›´åˆ°è¯¥ç±»è¢«å¸è½½æ‰ä¼šè¿›è¡Œèµ„æºå›æ”¶ï¼~~ </li><li>é™æ€æ–¹æ³•ä¸­å¯ä»¥ç›´æ¥è°ƒç”¨åŒç±»ä¸­çš„é™æ€æˆå‘˜ï¼Œä½†ä¸èƒ½ç›´æ¥è°ƒç”¨éé™æ€æˆå‘˜ã€‚å¦‚ï¼š<br><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g94qojv9thj30x4096jsf.jpg" alt=""><br>å¦‚æœå¸Œæœ›åœ¨é™æ€æ–¹æ³•ä¸­è°ƒç”¨éé™æ€å˜é‡ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºç±»çš„å¯¹è±¡ï¼Œç„¶åé€šè¿‡å¯¹è±¡æ¥è®¿é—®éé™æ€å˜é‡ã€‚å¦‚ï¼š<br><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g94qpd5dvhj30x20cmabh.jpg" alt=""></li><li>åœ¨æ™®é€šæˆå‘˜æ–¹æ³•ä¸­ï¼Œåˆ™å¯ä»¥ç›´æ¥è®¿é—®åŒç±»çš„éé™æ€å˜é‡å’Œé™æ€å˜é‡ï¼Œå¦‚ï¼š<br><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g94qqy58fnj30x60a8t9s.jpg" alt=""></li><li>é™æ€æ–¹æ³•ä¸­ä¸èƒ½ç›´æ¥è°ƒç”¨éé™æ€æ–¹æ³•ï¼Œéœ€è¦é€šè¿‡å¯¹è±¡æ¥è®¿é—®éé™æ€æ–¹æ³•ã€‚å¦‚ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</span><br><span class="line">    String name = <span class="string">"Cjj"</span>; <span class="comment">//éé™æ€æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="keyword">static</span> String hobby = <span class="string">"study"</span>; <span class="comment">//é™æ€æˆå‘˜å˜é‡</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æ™®é€šæˆå‘˜æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ™®é€šæˆå‘˜æ–¹æ³•~~~"</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//é™æ€æˆå‘˜æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"é™æ€æˆå‘˜æ–¹æ³•~~~"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//æ™®é€šæˆå‘˜æ–¹æ³•å¿…é¡»é€šè¿‡å¯¹è±¡æ¥è°ƒç”¨</span></span><br><span class="line">        Test01 t1 = <span class="keyword">new</span> Test01();</span><br><span class="line">        t1.print1();</span><br><span class="line">        <span class="comment">//å¯ä»¥ç›´æ¥è°ƒç”¨é™æ€æ–¹æ³•</span></span><br><span class="line">        print2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å››-static-ä½¿ç”¨ä¹‹é™æ€åˆå§‹åŒ–å—"><a href="#å››-static-ä½¿ç”¨ä¹‹é™æ€åˆå§‹åŒ–å—" class="headerlink" title="å››.static ä½¿ç”¨ä¹‹é™æ€åˆå§‹åŒ–å—"></a>å››.static ä½¿ç”¨ä¹‹é™æ€åˆå§‹åŒ–å—</h4>Java ä¸­å¯ä»¥é€šè¿‡åˆå§‹åŒ–å—è¿›è¡Œæ•°æ®èµ‹å€¼ã€‚å¦‚ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</span><br><span class="line">    String name = <span class="string">"chenyw"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šè¿‡åˆå§‹åŒ–å—ä¸ºæˆå‘˜å˜é‡èµ‹å€¼</span></span><br><span class="line">    &#123;</span><br><span class="line">        name = <span class="string">"cjj"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Test01 test01 = <span class="keyword">new</span> Test01();</span><br><span class="line">        System.out.println(<span class="string">"name="</span>+test01.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>è¿è¡Œç»“æœï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=cjj</span><br></pre></td></tr></table></figure></li></ol><p><strong>æ³¨æ„ï¼š</strong></p><p>é™æ€åˆå§‹åŒ–å—åªåœ¨ç±»åŠ è½½æ—¶æ‰§è¡Œï¼Œä¸”åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼ŒåŒæ—¶é™æ€åˆå§‹åŒ–å—åªèƒ½ç»™é™æ€å˜é‡èµ‹å€¼ï¼Œä¸èƒ½åˆå§‹åŒ–æ™®é€šçš„æˆå‘˜å˜é‡ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test02</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num1;</span><br><span class="line">    <span class="keyword">int</span> num2;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> num3;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test02</span><span class="params">()</span> </span>&#123;<span class="comment">// æ„é€ æ–¹æ³•</span></span><br><span class="line">        num1 = <span class="number">11</span>;</span><br><span class="line">        System.out.println(<span class="string">"é€šè¿‡æ„é€ æ–¹æ³•ä¸ºå˜é‡num1èµ‹å€¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#123; <span class="comment">// åˆå§‹åŒ–å—</span></span><br><span class="line">        num2 = <span class="number">22</span>;</span><br><span class="line">        System.out.println(<span class="string">"é€šè¿‡åˆå§‹åŒ–å—ä¸ºå˜é‡num2èµ‹å€¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;<span class="comment">// é™æ€åˆå§‹åŒ–å—</span></span><br><span class="line">        num3 = <span class="number">33</span>;</span><br><span class="line">        System.out.println(<span class="string">"é€šè¿‡é™æ€åˆå§‹åŒ–å—ä¸ºé™æ€å˜é‡num3èµ‹å€¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Test02 t1 = <span class="keyword">new</span> Test02(); <span class="comment">//åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        System.out.println(<span class="string">"num1:"</span> + t1.num1);</span><br><span class="line">        System.out.println(<span class="string">"num2:"</span> + t1.num2);</span><br><span class="line">        System.out.println(<span class="string">"num3:"</span> + num3);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿è¡Œç»“æœï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">é€šè¿‡é™æ€åˆå§‹åŒ–å—ä¸ºé™æ€å˜é‡num3èµ‹å€¼</span><br><span class="line">é€šè¿‡åˆå§‹åŒ–å—ä¸ºå˜é‡num2èµ‹å€¼</span><br><span class="line">é€šè¿‡æ„é€ æ–¹æ³•ä¸ºå˜é‡num1èµ‹å€¼</span><br><span class="line">num1:11</span><br><span class="line">num2:22</span><br><span class="line">num3:33</span><br></pre></td></tr></table></figure><br><em>é€šè¿‡è¾“å‡ºç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºè¿è¡Œæ—¶é™æ€åˆå§‹åŒ–å—æœ€å…ˆè¢«æ‰§è¡Œï¼Œç„¶åæ‰§è¡Œæ™®é€šåˆå§‹åŒ–å—ï¼Œæœ€åæ‰æ‰§è¡Œæ„é€ æ–¹æ³•ã€‚ç”±äºé™æ€åˆå§‹åŒ–å—åªåœ¨ç±»åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥å½“å†æ¬¡åˆ›å»ºå¯¹è±¡ hello2 æ—¶å¹¶æœªæ‰§è¡Œé™æ€åˆå§‹åŒ–å—ã€‚ç±»æ˜¯åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™æ‰åŠ è½½ï¼ŒåŠ è½½ä¹‹åå°±ä¸ä¼šç§»é™¤</em></p><p>å†…å®¹æ¥æºï¼š<a href="https://www.cnblogs.com/chuijingjing/p/9452893.html" target="_blank" rel="noopener">https://www.cnblogs.com/chuijingjing/p/9452893.html</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> åŸºç¡€ç†è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> åŸºç¡€ç†è§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­å»ºè‡ªå·±çš„Hexoåšå®¢</title>
      <link href="/2019/11/22/%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84Hexo%E5%8D%9A%E5%AE%A2/"/>
      <url>/2019/11/22/%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84Hexo%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<h4 id="1-å®‰è£…node-js"><a href="#1-å®‰è£…node-js" class="headerlink" title="1.å®‰è£…node.js"></a>1.å®‰è£…node.js</h4><p>Hexoéœ€ç”¨é€šè¿‡npmå®‰è£…ï¼Œè€Œnpméœ€è¦nodeï¼Œç°åœ¨åªè¦å®‰è£…node å°±è‡ªå¸¦ npmäº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ:</span><br><span class="line"></span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å®‰è£…nmpé˜¿é‡Œçš„å‘½ä»¤ï¼š</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org </span><br><span class="line"></span><br><span class="line">æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸï¼š</span><br><span class="line">cnpm -v</span><br><span class="line"></span><br><span class="line">cnpmå®‰è£…è½¯ä»¶æ—¶ä¼šæ¯”è¾ƒå¿«</span><br></pre></td></tr></table></figure><h4 id="2-å®‰è£…git"><a href="#2-å®‰è£…git" class="headerlink" title="2.å®‰è£…git"></a>2.å®‰è£…git</h4><p>é¦–å…ˆæŸ¥çœ‹ç”µè„‘æ˜¯å¦å®‰è£…Gitï¼Œç»ˆç«¯è¾“å…¥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git</span><br></pre></td></tr></table></figure><br>æŸ¥çœ‹æ˜¯å¦å‡ºç°ä¸‹å›¾å†…å®¹ï¼š<br><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g9636b15nhj30zi0sawli.jpg" alt=""></p><p>å®‰è£…gitï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install git</span><br></pre></td></tr></table></figure><br>å¦‚æœä¹‹å‰æœªå®‰è£…homebrewï¼Œéœ€å®‰è£…homebrewï¼Œåœ¨ç»ˆç«¯è¾“å…¥ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span><br></pre></td></tr></table></figure></p><h4 id="3-å®‰è£…hexo"><a href="#3-å®‰è£…hexo" class="headerlink" title="3.å®‰è£…hexo"></a>3.å®‰è£…hexo</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo su è¿›å…¥rootç”¨æˆ·ï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤å®‰è£…ï¼š</span><br><span class="line"></span><br><span class="line">cnpm install hexo-cli -g</span><br><span class="line">    æˆ–è€…ï¼š</span><br><span class="line">npm install hexo-cli -g</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼š</span><br><span class="line">hexo -v</span><br></pre></td></tr></table></figure><h4 id="4-æ­å»ºhexo"><a href="#4-æ­å»ºhexo" class="headerlink" title="4.æ­å»ºhexo"></a>4.æ­å»ºhexo</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo init blog  //åˆå§‹åŒ–</span><br><span class="line">cd blog         //è¿›å…¥æ–‡ä»¶å¤¹blog</span><br><span class="line">npm install    //å®‰è£…</span><br><span class="line">è¿è¡Œï¼š==hexo s== (æµè§ˆå™¨é‡Œè¾“å…¥åœ°å€ localhost:4000 å³å¯çœ‹åˆ°æ•ˆæœ)</span><br></pre></td></tr></table></figure><h4 id="5-éƒ¨ç½²åˆ°GitHub"><a href="#5-éƒ¨ç½²åˆ°GitHub" class="headerlink" title="5.éƒ¨ç½²åˆ°GitHub"></a>5.éƒ¨ç½²åˆ°GitHub</h4><ul><li><p>åˆ›å»ºä¸€ä¸ªxxx.github.ioçš„publicä»“åº“</p></li><li><p>å®‰è£…ä¸€ä¸ªGitçš„æ’ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install --save hexo-deployer-git</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶(_config.yml)ï¼Œä¿®æ”¹ depoly ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https://github.com/chenyawei1227/chenyawei1227.github.io.git  &lt;æ‰€å»ºä»“åº“åœ°å€&gt;</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ä¿®æ”¹ä¸»é¢˜åå¯åŠ¨å¦‚æœæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</span><br><span class="line">extends includes/layout.pug block content include includes/recent-posts.pug include includes/partial</span><br><span class="line"></span><br><span class="line">åˆ™æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯è§£å†³ï¼š</span><br><span class="line">npm install --save hexo-renderer-jade hexo-generator-feed hexo-generator-sitemap hexo-browsersync hexo-generator-archive</span><br><span class="line"></span><br><span class="line">hexo clean</span><br><span class="line"></span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure></li><li><p>éƒ¨ç½²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hexo clean  <span class="comment">//æ¸…ç†</span></span><br><span class="line">hexo g      <span class="comment">//ç”Ÿäº§é¡µé¢</span></span><br><span class="line">hexo d      <span class="comment">//éƒ¨ç½²åˆ°GitHub</span></span><br><span class="line"></span><br><span class="line">æµè§ˆå™¨è®¿é—®ï¼šhttps:<span class="comment">//chenyawei1227.github.io æŸ¥çœ‹åˆ°æ•ˆæœã€‚</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="6-æ›´æ”¹ä¸»é¢˜"><a href="#6-æ›´æ”¹ä¸»é¢˜" class="headerlink" title="6.æ›´æ”¹ä¸»é¢˜"></a>6.æ›´æ”¹ä¸»é¢˜</h4><p>hexoçš„ä¸»é¢˜å¾ˆå¤šï¼Œå®˜ç½‘çš„ä¸»é¢˜ï¼š<a href="https://hexo.io/themes/" target="_blank" rel="noopener">https://hexo.io/themes/</a><br>è¿™é‡Œä»¥Cxoä¸»é¢˜ä¸ºä¾‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#è¿›å…¥åˆ°themesæ–‡ä»¶å¤¹ä¸‹ï¼Œä¸‹è½½ä¸»é¢˜ï¼š</span><br><span class="line">git clone https://github.com/Longlongyu/hexo-theme-Cxo Cxo</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹ _config.yml é…ç½®</span><br><span class="line">theme: Cxo</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œ:</span><br><span class="line">hexo clean</span><br><span class="line">hexo deploy</span><br><span class="line"></span><br><span class="line">æµè§ˆå™¨è®¿é—®ï¼šhttps://chenyawei.github1227.io æŸ¥çœ‹åˆ°æ•ˆæœã€‚</span><br></pre></td></tr></table></figure></p><h4 id="7-åˆ›å»ºæ–°æ–‡ç« "><a href="#7-åˆ›å»ºæ–°æ–‡ç« " class="headerlink" title="7.åˆ›å»ºæ–°æ–‡ç« "></a>7.åˆ›å»ºæ–°æ–‡ç« </h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo new &apos;æ–‡ç« å&apos;</span><br><span class="line"></span><br><span class="line">å°±å¯ä»¥åœ¨blogçš„sourceæ–‡ä»¶å¤¹é‡Œçœ‹åˆ°</span><br></pre></td></tr></table></figure><h4 id="å¸¸ç”¨æŒ‡ä»¤ï¼š"><a href="#å¸¸ç”¨æŒ‡ä»¤ï¼š" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤ï¼š"></a>å¸¸ç”¨æŒ‡ä»¤ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli -g </span><br><span class="line">hexo init </span><br><span class="line">npm install</span><br><span class="line">hexo s</span><br><span class="line">hexo new "postName"          #æ–°å»ºæ–‡ç« </span><br><span class="line">hexo new page "pageName"     #æ–°å»ºé¡µé¢</span><br><span class="line">hexo generate                #ç”Ÿæˆé™æ€é¡µé¢è‡³publicç›®å½•</span><br><span class="line">hexo server     #å¼€å¯é¢„è§ˆè®¿é—®ç«¯å£ï¼ˆé»˜è®¤ç«¯å£4000ï¼Œ'ctrl + c'å…³é—­serverï¼‰</span><br><span class="line">hexo deploy     #éƒ¨ç½²åˆ°GitHub</span><br><span class="line">hexo help       #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">hexo version    #æŸ¥çœ‹Hexoçš„ç‰ˆæœ¬</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ“ä½œè®°å½• </category>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œè®°å½• </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo-Theme-Snail</title>
      <link href="/2019/11/01/Hexo-Theme-Snail/"/>
      <url>/2019/11/01/Hexo-Theme-Snail/</url>
      
        <content type="html"><![CDATA[<h1 id="hexo-theme-snail"><a href="#hexo-theme-snail" class="headerlink" title="hexo-theme-snail"></a>hexo-theme-snail</h1><p><a href="https://github.com/chenyawei1227/hexo-theme-snail" target="_blank" rel="noopener">View Hexo-Theme-Snail Sources On Github &#10174; </a></p><p><a href="https://www.bytenote.cn" target="_blank" rel="noopener">View Live Super Snail Blog &#10174;</a></p><p><img src="snail.png" alt="hexo-theme-snail"></p><p>Hexo-theme-snail is a succinct hexo theme. It has two colors, light and star, that can be set according to your own preferences in the settings, and also has the functions of sharing and commenting. More features are under development.</p><h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><ul><li>light color theme and star theme</li><li>diversified comment system</li><li>notice tips</li><li>share to other platforms (under development)</li><li>picture sharing (under development)</li></ul><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Install-Hexo"><a href="#Install-Hexo" class="headerlink" title="Install Hexo"></a>Install Hexo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-cli -g</span><br></pre></td></tr></table></figure><h3 id="Setup-your-blog"><a href="#Setup-your-blog" class="headerlink" title="Setup your blog"></a>Setup your blog</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init blog</span><br></pre></td></tr></table></figure><h3 id="Installation-Theme"><a href="#Installation-Theme" class="headerlink" title="Installation Theme"></a>Installation Theme</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> blog</span><br><span class="line">$ rm -rf <span class="built_in">source</span></span><br><span class="line">$ rm _config.yml package.json README.md LICENSE</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/chenyawei1227/hexo-theme-snail.git</span><br><span class="line">$ mv ./hexo-theme-snail/snail ./themes</span><br><span class="line">$ mv ./hexo-theme-snail/* ./</span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure><h3 id="Set-Theme"><a href="#Set-Theme" class="headerlink" title="Set Theme"></a>Set Theme</h3><p>Modify the value of <code>theme:</code> in <code>_config.yml</code><br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">## Themes: https://hexo.io/themes/</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">snail</span></span><br></pre></td></tr></table></figure></p><h3 id="Start-the-Server"><a href="#Start-the-Server" class="headerlink" title="Start the Server"></a>Start the Server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><h3 id="Site"><a href="#Site" class="headerlink" title="Site"></a>Site</h3><p>Replace the following information with your own.<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Site</span></span><br><span class="line"><span class="attr">title:</span> </span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">At</span> <span class="string">the</span> <span class="string">bottom</span> <span class="string">of</span> <span class="string">the</span> <span class="string">well,</span> <span class="string">it</span> <span class="string">is</span> <span class="string">destined</span> <span class="string">to</span> <span class="string">see</span> <span class="string">only</span> <span class="string">the</span> <span class="string">sky</span> <span class="string">at</span> <span class="string">the</span> <span class="string">wellhead.</span> </span><br><span class="line">          <span class="string">However,</span> <span class="string">the</span> <span class="string">starting</span> <span class="string">point</span> <span class="string">only</span> <span class="string">affects</span> <span class="string">the</span> <span class="string">process</span> <span class="string">of</span> <span class="string">reaching</span> <span class="string">your</span> <span class="string">peak</span> <span class="string">and</span> <span class="string">does</span> <span class="string">not</span> <span class="string">determine</span> <span class="string">the</span> <span class="string">height</span> <span class="string">you</span> <span class="string">reach.</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">Dusign</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">en</span></span><br><span class="line"><span class="attr">timezone:</span></span><br></pre></td></tr></table></figure></p><h3 id="Site-Settings"><a href="#Site-Settings" class="headerlink" title="Site Settings"></a>Site Settings</h3><p>Put customized pictures in <code>img</code> directory.<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Site settings</span></span><br><span class="line"><span class="attr">SEOTitle:</span> <span class="string">Hexo-theme-snail</span></span><br><span class="line"><span class="attr">email:</span> <span class="string">hexo-theme-snail@mail.com</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">"A hexo theme"</span></span><br><span class="line"><span class="attr">keyword:</span> <span class="string">"dusign, hexo-theme-snail"</span></span><br><span class="line"><span class="attr">header-img:</span> <span class="string">img/header_img/home-bg-1-dark.jpg</span></span><br><span class="line"><span class="attr">signature:</span> <span class="literal">true</span> <span class="comment">#show signature</span></span><br><span class="line"><span class="attr">signature-img:</span> <span class="string">img/signature/Just-do-it-white.png</span></span><br></pre></td></tr></table></figure></p><h3 id="SNS-Settings"><a href="#SNS-Settings" class="headerlink" title="SNS Settings"></a>SNS Settings</h3><p>If you donâ€™t want to display it, you can delete it directly.<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SNS settings</span></span><br><span class="line"><span class="attr">github_username:</span>    <span class="string">dusign</span></span><br><span class="line"><span class="attr">twitter_username:</span>   <span class="string">dusignr</span></span><br><span class="line"><span class="attr">facebook_username:</span>  <span class="string">Gang</span> <span class="string">Du</span></span><br><span class="line"><span class="attr">zhihu_username:</span> <span class="string">dusignr</span></span><br></pre></td></tr></table></figure></p><h3 id="Sidebar-Settings"><a href="#Sidebar-Settings" class="headerlink" title="Sidebar Settings"></a>Sidebar Settings</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sidebar Settings</span></span><br><span class="line"><span class="attr">sidebar:</span> <span class="literal">true</span>                      <span class="comment"># whether or not using Sidebar.</span></span><br><span class="line"><span class="attr">sidebar-about-description:</span> <span class="string">"Welcome to visit, I'm Dusign!"</span></span><br><span class="line"><span class="attr">sidebar-avatar:</span> <span class="string">img/ironman-draw.png</span>      <span class="comment"># use absolute URL, seeing it's used in both `/` and `/about/`</span></span><br><span class="line"><span class="attr">widgets:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">featured-tags</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">short-about</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">recent-posts</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">friends-blog</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">archive</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">category</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># widget behavior</span></span><br><span class="line"><span class="comment">## Archive</span></span><br><span class="line"><span class="attr">archive_type:</span> <span class="string">'monthly'</span></span><br><span class="line"><span class="attr">show_count:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## Featured Tags</span></span><br><span class="line"><span class="attr">featured-tags:</span> <span class="literal">true</span>                     <span class="comment"># whether or not using Feature-Tags</span></span><br><span class="line"><span class="attr">featured-condition-size:</span> <span class="number">1</span>              <span class="comment"># A tag will be featured if the size of it is more than this condition value</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## Friends</span></span><br><span class="line"><span class="attr">friends:</span> <span class="string">[</span></span><br><span class="line">    <span class="string">&#123;</span></span><br><span class="line">        <span class="attr">title:</span> <span class="string">"Dusign's Blog"</span><span class="string">,</span></span><br><span class="line">        <span class="attr">href:</span> <span class="string">"https://www.jianshu.com/u/78b636e8a217"</span></span><br><span class="line">    <span class="string">&#125;,&#123;</span></span><br><span class="line">        <span class="attr">title:</span> <span class="string">"Dusign's Web"</span><span class="string">,</span></span><br><span class="line">        <span class="attr">href:</span> <span class="string">"#"</span></span><br><span class="line">    <span class="string">&#125;,&#123;</span></span><br><span class="line">        <span class="attr">title:</span> <span class="string">"Dusign's Github"</span><span class="string">,</span></span><br><span class="line">        <span class="attr">href:</span> <span class="string">"https://github.com/chenyawei1227"</span></span><br><span class="line">    <span class="string">&#125;,&#123;</span></span><br><span class="line">        <span class="attr">title:</span> <span class="string">"Other"</span><span class="string">,</span></span><br><span class="line">        <span class="attr">href:</span> <span class="string">"#"</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line"><span class="string">]</span></span><br></pre></td></tr></table></figure><h3 id="Theme"><a href="#Theme" class="headerlink" title="Theme"></a>Theme</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">## Themes: https://hexo.io/themes/</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">snail</span></span><br></pre></td></tr></table></figure><h3 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span></span><br><span class="line">      <span class="attr">github:</span> <span class="string">github.repository.address</span></span><br><span class="line">      <span class="attr">coding:</span> <span class="string">coding.repository.address</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><h3 id="Comment"><a href="#Comment" class="headerlink" title="Comment"></a>Comment</h3><p>See httpymls://github.com/imsun/gitment for detailed configuration method.<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Comment</span></span><br><span class="line"><span class="comment">## This comment system is gitment</span></span><br><span class="line"><span class="comment">## gitment url: https://github.com/imsun/gitment</span></span><br><span class="line"><span class="attr">comment:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">owner:</span></span><br><span class="line">  <span class="attr">repo:</span></span><br><span class="line">  <span class="attr">client_id:</span></span><br><span class="line">  <span class="attr">client_secret:</span></span><br></pre></td></tr></table></figure></p><h3 id="Tip"><a href="#Tip" class="headerlink" title="Tip"></a>Tip</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Tip</span></span><br><span class="line"><span class="attr">tip:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">content:</span> <span class="string">æ¬¢è¿è®¿é—®</span> <span class="string">&lt;a</span> <span class="string">href="https://www.bytenote.cn"</span> <span class="string">target="dusign"&gt;dusign&lt;/a&gt;</span> <span class="string">çš„åšå®¢ï¼Œåšå®¢ç³»ç»Ÿä¸€é”®åˆ†äº«çš„åŠŸèƒ½è¿˜åœ¨å®Œå–„ä¸­ï¼Œè¯·å¤§å®¶è€å¿ƒç­‰å¾…ã€‚</span></span><br><span class="line">          <span class="string">è‹¥æœ‰é—®é¢˜æˆ–è€…æœ‰å¥½çš„å»ºè®®æ¬¢è¿ç•™è¨€ï¼Œç¬”è€…çœ‹åˆ°ä¹‹åä¼šåŠæ—¶å›å¤ã€‚</span></span><br><span class="line">          <span class="string">è¯„è®ºç‚¹èµéœ€è¦githubè´¦å·ç™»å½•ï¼Œå¦‚æœæ²¡æœ‰è´¦å·çš„è¯è¯·ç‚¹å‡»</span> </span><br><span class="line">          <span class="string">&lt;a</span> <span class="string">href="https://github.com"</span> <span class="string">target="view_window"</span> <span class="string">&gt;</span> <span class="string">github</span> <span class="string">&lt;/a&gt;</span> <span class="string">æ³¨å†Œï¼Œ</span> <span class="string">è°¢è°¢</span> <span class="string">!</span></span><br></pre></td></tr></table></figure><h3 id="Color-Sheme"><a href="#Color-Sheme" class="headerlink" title="Color Sheme"></a>Color Sheme</h3><p>Set the <code>enable</code> value of the desired color sheme to <code>true</code>. If the value of <code>bg_effects.star.enable</code> is <code>true</code>, please modify the value of <code>highlight_theme</code> in <code>./themes/snail/_config.yml</code> to <code>night</code>.<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Color Sheme</span></span><br><span class="line"><span class="comment">## If there is no effect after modification, please empty the cache and try again.</span></span><br><span class="line"><span class="comment">## âš ï¸ The following special effects will take up a lot of cpu resorces, please open it carefully.</span></span><br><span class="line"><span class="attr">bg_effects:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">line:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">color:</span> <span class="number">129</span><span class="string">,200,61</span></span><br><span class="line">    <span class="attr">pointColor:</span> <span class="number">129</span><span class="string">,200,61</span></span><br><span class="line">    <span class="attr">opacity:</span> <span class="number">0.7</span></span><br><span class="line">    <span class="attr">zIndex:</span> <span class="number">-9</span></span><br><span class="line">    <span class="attr">count:</span> <span class="number">99</span></span><br><span class="line">  <span class="attr">mouse_click:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">content:</span> <span class="string">'"ğŸŒ±","just do it","ğŸŒ¾","ğŸ€","don'</span><span class="string">'t give up","ğŸ‚","ğŸŒ»","try it again","ğŸƒ","never say die","ğŸŒµ","ğŸŒ¿","ğŸŒ´"'</span></span><br><span class="line">    <span class="attr">color:</span> <span class="string">'"rgb(121,93,179)"</span></span><br><span class="line"><span class="string">          ,"rgb(76,180,231)"</span></span><br><span class="line"><span class="string">          ,"rgb(184,90,154)"</span></span><br><span class="line"><span class="string">          ,"rgb(157,211,250)"</span></span><br><span class="line"><span class="string">          ,"rgb(255,0,0)"</span></span><br><span class="line"><span class="string">          ,"rgb(242,153,29)"</span></span><br><span class="line"><span class="string">          ,"rgb(23,204,16)"</span></span><br><span class="line"><span class="string">          ,"rgb(222,0,0)"</span></span><br><span class="line"><span class="string">          ,"rgb(22,36,92)"</span></span><br><span class="line"><span class="string">          ,"rgb(127,24,116)"</span></span><br><span class="line"><span class="string">          ,"rgb(119,195,79)"</span></span><br><span class="line"><span class="string">          ,"rgb(4,77,34)"</span></span><br><span class="line"><span class="string">          ,"rgb(122,2,60)"'</span></span><br><span class="line">  <span class="attr">star:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></p><h2 id="Releases"><a href="#Releases" class="headerlink" title="Releases"></a>Releases</h2><p>V1.0</p><ul><li>fix the bugs</li><li>add comment system</li><li>add notice tips</li><li>add star sheme</li></ul><h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p>Apache License 2.0 Copyright(c) 2018-2020 <a href="https://github.com/chenyawei1227" target="_blank" rel="noopener">Dusign</a>   </p><p><a href="https://github.com/chenyawei1227/hexo-theme-snail" target="_blank" rel="noopener">hexo-theme-snail</a> is derived from <a href="https://github.com/Huxpro/huxpro.github.io" target="_blank" rel="noopener">Huxpro</a> Apache License 2.0. Copyright (c) 2015-2020 Huxpro</p>]]></content>
      
      
      <categories>
          
          <category> æ“ä½œè®°å½• </category>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œè®°å½• </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
